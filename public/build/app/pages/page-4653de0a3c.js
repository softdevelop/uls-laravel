function humanized_time_span(e,t,n,a){function i(){for(var e=0;e<n[d].length;e++)if(null==n[d][e].ceiling||s<=n[d][e].ceiling)return n[d][e];return null}function o(){for(var e=s,t={},n=0;n<a.length;n++){var i=Math.floor(e/a[n][0]);e-=a[n][0]*i,t[a[n][1]]=i}return t}function r(e){var t=o(),n=e.text.replace(/\$(\w+)/g,function(){return t[arguments[1]]});return l(n,t)}function l(e,t){for(var n in t)if(1==t[n]){var a=new RegExp("\\b"+n+"\\b");e=e.replace(a,function(){return arguments[0].replace(/s\b/g,"")})}return e}if(n=n||{past:[{ceiling:60,text:"$seconds seconds ago"},{ceiling:3600,text:"$minutes minutes ago"},{ceiling:86400,text:"$hours hours ago"},{ceiling:2629744,text:"$days days ago"},{ceiling:31556926,text:"$months months ago"},{ceiling:null,text:"$years years ago"}],future:[{ceiling:60,text:"in $seconds seconds"},{ceiling:3600,text:"in $minutes minutes"},{ceiling:86400,text:"in $hours hours"},{ceiling:2629744,text:"in $days days"},{ceiling:31556926,text:"in $months months"},{ceiling:null,text:"in $years years"}]},a=a||[[31556926,"years"],[2629744,"months"],[86400,"days"],[3600,"hours"],[60,"minutes"],[1,"seconds"]],"Invalid Date"==new Date(e))for(;-1!=String(e).indexOf("-");)e=e.replace("-","/");e=new Date(e),t=t?new Date(t):new Date;var s=(t-e)/1e3,d="past";return 0>s&&(d="future",s=0-s),r(i())}angular.module("user",[]),angular.module("permission",[]),angular.module("role",[]),angular.module("multiSelect",[]),angular.module("ticket",[]),angular.module("type",[]),angular.module("dataOption",[]),angular.module("nlcFilter",[]),angular.module("file",[]),angular.module("AppLanguage",[]),angular.module("TemplateManagerApp",[]),angular.module("RegionApp",[]),angular.module("campaignApp",[]),angular.module("campaignDetailApp",[]),angular.module("MarketsegmentApp",[]),angular.module("notification",[]),angular.module("transApp",[]),angular.module("assetManager",[]),angular.module("BlockApp",[]),angular.module("ChannelPartnersApp",[]),angular.module("roleGroup1",[]),angular.module("filedType",[]),angular.module("filed",[]),angular.module("term",[]),angular.module("customFormatDate",[]),angular.module("SeoAnalysisApp",[]),angular.module("pageApp",[]),angular.module("treeresizer",[]),angular.module("CreatePageApp",[]),angular.module("EditDraftApp",[]),angular.module("fomatHtml",[]),angular.module("colorpicker.module",[]),angular.module("formBuilderDirectiveApp",[]),angular.module("appManageTerm",[]),angular.module("TermTemplateManagerApp",[]),angular.module("configurator",[]),angular.module("TemplateContentManager",[]),angular.module("cmsContentFolderApp",[]),angular.module("lowercaseCharater",[]),angular.module("selectLevel",[]),angular.module("modalSelectLevel",[]),angular.module("configField",[]),angular.module("cmsContentInsertApp",[]),angular.module("confirmDirective",[]),angular.module("CmsApp",[]),angular.module("checkLimitAndChangeDateTimeDirectiveApp",[]),angular.module("tagContentApp",[]),angular.module("tagContentDirective",[]),angular.module("cmsContentTagApp",[]),angular.module("viewDraft",[]),angular.module("databaseManager",[]),angular.module("selectLevelDatabase",[]),angular.module("modalSelectPage",[]),angular.module("configFormDatabaseApp",[]),angular.module("historyApp",[]),angular.module("BlockNestedApp",[]),angular.module("selectLevelAsset",[]),angular.module("MaterialApp",[]),angular.module("draganddrop",[]),angular.module("activityLog",[]),angular.module("translation",[]),angular.module("HelpEditorApp",[]),angular.module("helpEditorDirective",[]),angular.module("selectLevelHelp",[]),angular.module("cache",[]),angular.module("file",[]),angular.module("treeresize",[]),angular.module("test",[]),angular.module("guide",[]),angular.module("PlatformsApp",[]),angular.module("accessories",[]);var defaultModules=["ui.bootstrap","ngResource","ngCookies","ngFileUpload","ngRoute","toggle-switch","ngImgCrop","ngTable","user","role","permission","multiSelect","ticket","type","dataOption","nlcFilter","file","xeditable","timer","AppLanguage","TemplateManagerApp","RegionApp","campaignApp","campaignDetailApp","MarketsegmentApp","notification","transApp","assetManager","BlockApp","ChannelPartnersApp","roleGroup1","filedType","filed","term","ui-iconpicker","customFormatDate","SeoAnalysisApp","pageApp","treeresizer","CreatePageApp","EditDraftApp","fomatHtml","colorpicker.module","formBuilderDirectiveApp","appManageTerm","TermTemplateManagerApp","mgo-angular-wizard","configurator","TemplateContentManager","cmsContentFolderApp","lowercaseCharater","selectLevel","configField","cmsContentInsertApp","confirmDirective","CmsApp","checkLimitAndChangeDateTimeDirectiveApp","tagContentApp","tagContentDirective","cmsContentTagApp","viewDraft","modalSelectLevel","databaseManager","selectLevelDatabase","modalSelectPage","configFormDatabaseApp","historyApp","BlockNestedApp","selectLevelAsset","MaterialApp","ui.sortable","activityLog","translation","HelpEditorApp","helpEditorDirective","selectLevelHelp","cache","file","treeresize","guide","PlatformsApp","accessories"];"undefined"!=typeof modules&&(defaultModules=defaultModules.concat(modules));var myApp=angular.module("uls",defaultModules);angular.module("uls").run(["editableOptions",function(e){e.theme="bs3"}]),angular.module("uls").config(["$logProvider",function(e){e.debugEnabled(window.debug)}]),"undefined"!=typeof angularMock&&(defaultModules=defaultModules.concat(angularMock));var goTo=function(e){window.location.href="#_"+e,$("#fix-modal-top").scrollTop(0),$("#"+e).hasClass("in")||$("#"+e).prev().trigger("click")};myApp.config(["$httpProvider",function(e){e.interceptors.push(["$q",function(e){e.defer();return{responseError:function(t){var n=angular.element(".butterbar-container");switch(t.status){case 401:return void(window.location.href=window.baseUrl);case 404:n.hasClass("hidden")&&n.removeClass("hidden");break;case 500:n.hasClass("hidden")&&n.removeClass("hidden")}return e.reject(t)}}}])}]),function(e){function t(){var t=window.innerHeight;screen.height;e(".table-responsive.set-height, .table-responsive#tb-group-user").css({height:t-170+"px"}),e(".table-animate").css({height:t-170+"px"}),e("#search-page,.box-maps").css({height:t-105+"px"}),e(".box-list-rep").css({height:t-100+"px"}),e("#load-maps").css({height:t-185+"px"})}e(document).ready(t),e(window).resize(t),e(document).ready(function(){e(".dropdown-menu table tr td button").removeAttr("style")}),e(document).ready(function(){setTimeout(function(){var t=e("#frame_html").contents().find("head");t.append('<style type="text/css">.area_toolbar{background-color:#f1f1f1;}#editor{border:solid #ccc 1px}#result{border-top:solid #ccc 1px;border-bottom: solid #ccc 1px}.editarea_popup{box-shadow: 0px 4px 36px rgba(177, 177, 177, 0.75);border: solid 1px #CCCCCC;background-color: #FFFFFF;}.area_toolbar select{font-size:9pt;background-color:#fff}</style>')},1e3)}),e(window).load(function(){e(".step3 .show-more").click(function(){e(".step3 .wrap-more-product").toggleClass("show")})}),e(document).ready(function(){e(".nav-icon").click(function(){e(this).toggleClass("open"),e("#pagehome").toggleClass("on-off")})});var n,a,i,o,r,l,s;e(".next").click(function(){return s?!1:(s=!0,n=e(this).parent(),a=e(this).parent().next(),a.show(),void n.animate({opacity:0},{step:function(e,t){l=1-.2*(1-e),o=50*e+"%",r=1-e,n.css({transform:"scale("+l+")"}),a.css({left:o,opacity:r})},duration:800,complete:function(){n.hide(),s=!1},easing:"easeInOutBack"}))}),e(".previous").click(function(){return s?!1:(s=!0,n=e(this).parent(),i=e(this).parent().prev(),i.show(),void n.animate({opacity:0},{step:function(e,t){l=.8+.2*(1-e),o=50*(1-e)+"%",r=1-e,n.css({left:o}),i.css({transform:"scale("+l+")",opacity:r})},duration:800,complete:function(){n.hide(),s=!1},easing:"easeInOutBack"}))}),e(".submit").click(function(){return!1})}(jQuery),angular.module("uls").controller("BaseController",["$scope","$parse","$timeout","$modal","UserService","AssetManagerService",function(e,t,n,a,i,o){if(angular.element(".wrapper").removeClass("hidden"),i.setData(window.usersMap),n(function(){"undefined"!=typeof e.callbackLoadUserFinish&&(e.callbackLoadUserFinish(),e.users_map=i.getUsersMap())}),e.testFuture=window.testFuture,1==e.testFuture&&angular.element(".test").removeClass("hidden"),e.windowType=window.info,"undefined"!=typeof window.info)for(var r in window.info){var l=t(r);l.assign(e,window.info[r])}e.initDate=function(){angular.element(".date").bdatepicker({format:"yyyy-mm-dd"})},e.viewModalImage=function(e){var t=a.open({templateUrl:baseUrl+"/app/components/termTemplateManager/views/modal/viewImage.html",controller:"ModalViewPictureCtrl",size:void 0,windowClass:"show-img",resolve:{fileId:function(){return e}}});t.result.then(function(e){},function(){})},e.urlForm=[],e.getUrlImageAssetForm=function(t,n){"undefined"==typeof e.urlForm[t]&&(e.urlForm[t]=[]),o.getUrlImageAsset(t).then(function(a){e.urlForm[t][n]=a.url})},e.removeThumbnailAssertForm=function(t,n){e.urlForm[t][n]=""},e.initTooltip=function(e){$('[data-toggle="tooltip"]').tooltip()}}]).controller("ModalViewPictureCtrl",["$scope","$modalInstance","fileId",function(e,t,n){e.fileId=n,e.baseUrl=baseUrl,e.cancel=function(){t.dismiss("cancel")}}]);var userModule=angular.module("user");userModule.factory("UserResource",["$resource",function(e){return e("/api/user/:method/:id",{method:"@method",id:"@id"},{add:{method:"post"},save:{method:"post"},update:{method:"put"}})}]).factory("UserService",["$q","$filter","UserResource",function(e,t,n){var a=[],i=[],o=[],r=this,l={},s={};return this.setHashData=function(e){l=e},this.create=function(t){if("undefined"!=typeof t.id)return r.update(t);var i=e.defer(),o=new n(t);return o.$save({},function(e){e.status&&e.item&&(a.push(e.item),"undefined"==typeof e.item.last_login&&(e.item.last_login="0000-00-00 00:00:00")),i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.changePassword=function(t){var a=e.defer(),i=new n(t);return i.$save({method:"change-password",id:t.id},function(e){e.status?a.resolve(e):a.reject(e)},function(e){a.reject(e.data)}),a.promise},this.changeRoles=function(t){var a=e.defer(),i=new n(t);return i.$save({method:"change-roles"},function(e){e?a.resolve(e):a.reject(e)},function(e){a.reject(e.data)}),a.promise},this.update=function(t){var i=e.defer(),o=new n(t);return o.$update({id:t.id},function(e){if(e.status)for(var t in a)if(a[t].id==e.item.id){a[t]=e.item;break}i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.get=function(t){var a=e.defer();return n.get({id:t},function(e){a.resolve(e)}),a.promise},this.query=function(){var t=e.defer();return n.query(function(e){a=e,t.resolve(e)}),t.promise},this.queryUsersManager=function(){var t=e.defer();return n.query({method:"get-all-user-manager"},function(e){a=e,t.resolve(e)}),t.promise},this.remove=function(t){var i=e.defer();return n["delete"]({id:t},function(e){if(e.status)for(var n in a)if(a[n].id==t){a[n].status="no";break}i.resolve(e)}),i.promise},this.pushUser=function(e){a.push(e)},this.updateUser=function(e){for(var t in a)if(a[t].id==e.id){e.status="yes",a[t]=e;break}},this.changeAvatar=function(t,a){var i=e.defer();return n.save({method:"change-avatar",file:a,id:t},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.resetPassword=function(t){var a=e.defer();return n.save({method:"email",entity:"password",email:t},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.getUsers=function(){return a},this.getUserById=function(e){return s[e]},this.getUsersMap=function(){return s},this.listMap=function(e,t){if("role"==t)for(var n in e)i[e[n].id]=e[n];else for(var n in e)o[e[n].id]=e[n]},this.getMap=function(e){return"role"==e?i:o},this.userBranchManager=function(t){var a=e.defer();return n.query({id:t,method:"get-users-branch-manager"},function(e){a.resolve(e)}),a.promise},this.updatePermissions=function(t,a){var i=e.defer();return n.save({id:t,permissionIds:a,method:"update-permission"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.updateGroup=function(t,a){var i=e.defer();return n.save({id:t,groupIds:a,method:"update-group"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.updateRoles=function(t,a){var i=e.defer();return n.save({id:t,roleIds:a,method:"update-role"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.changeStatus=function(t){var i=e.defer();return n["delete"]({id:t,method:"change-status"},function(e){if(e.status)for(var n in a)if(a[n].id==t){a[n].status="yes";break}i.resolve(e)}),i.promise},this.setData=function(e){a=e;for(var t in e)s[e[t].id]=e[t];return a},this.updateShowDueDateUser=function(t){var a=e.defer(),i=new n(t);return i.$save({method:"update-show-due-date-user"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this}]);var assetmanagerApp=angular.module("assetManager",["ngResource","ui.bootstrap","ngSanitize","ngTable"]);assetmanagerApp.factory("AssetManagerResource",["$resource",function(e){return e("/api/asset-manager/:method/:id",{method:"@method",id:"@id"},{add:{method:"post"},save:{method:"post"},update:{method:"put"},editNameFolder:{method:"edit-name-folder"}})}]).service("AssetManagerService",["AssetManagerResource","$q",function(e,t){var n=this,a=[];this.createFolderProvider=function(a){if("undefined"!=typeof a.id)return n.editFolderAndFile(a);var i=t.defer(),o=new e(a);return o.$save({method:"create-folder"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.uploadNewAsset=function(n){var i=t.defer(),o=new e(n);return o.$save({method:"upload-new-asset"},function(e){0!=e.status&&a.push(e.item),i.resolve(e.item)},function(e){i.resolve(e.data)}),i.promise},this.createNewAsset=function(n){var i=t.defer(),o=new e(n);return o.$save({method:"create-new-asset"},function(e){0!=e.status&&a.push(e.item),i.resolve(e.item)},function(e){i.resolve(e.data)}),i.promise},this.saveFieldFile=function(n){var a=t.defer(),i=new e(n);return i.$save({method:"save-file-asset"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.editFile=function(n){var a=t.defer(),i=new e(n);return i.$save({method:"edit-file"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.crop=function(n){var a=t.defer(),i=new e(n);return i.$save({method:"crop"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.addTagsForPage=function(n,a){var i=t.defer(),o=new e(a);return o.$save({id:n,method:"add-tags"},function(e){0!=e.status,i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.getAssetManagerById=function(n){var a=t.defer(),i=new e;return i.$get({id:n},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.setAssetManagers=function(e){return a=e},this.getAssetManagers=function(){return a},this.getUrlImageAsset=function(n){var a=t.defer();return e.get({id:n,method:"get-url-image-asset"},function(e){a.resolve(e)}),a.promise},this.deleteFolderAndAsset=function(n){var a=t.defer(),i=new e;return i.$delete({id:n},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.deleteAssetFile=function(n){var a=t.defer(),i=new e;return i.$get({id:n,method:"delete-file"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.editNameFolder=function(n){var a=t.defer(),i=new e(n);return i.$save({id:n.id,method:"edit-name-folder"},function(e){0!=e.status&&a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.updateContentFile=function(n,a){var i=t.defer(),o=new e(a);return o.$save({id:n,method:"update-content-file"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise}}]),angular.module("uls").controller("NotificationController",["$scope","$filter","NotificationService","$controller","$timeout",function(e,t,n,a,i){function o(){}function r(){if(f=!1,u.length>0){var e=u.shift();s(e)}}function l(){}function s(t){if(f)return void u.push(t);if(f=!0,-1==t.data.sender_id)var n=e.baseUrl+"/160x160_avatar_default.png?t=1";else var n=e.users_map[t.data.sender_id].avatar;var a=new Notify("Notification",{icon:n,body:t.data.message,tag:t.data.sender_id,notifyShow:o,notifyClose:r,notifyClick:function(){window.location.href="/"+t.data.href},notifyError:l,timeout:5});a.show()}a("BaseController",{$scope:e}),e.callbackLoadUserFinish=function(){},angular.element("#notification-top").removeClass("hidden"),e.baseUrl=window.baseUrl;var d=10;e.limitTo=d;var c=1;e.notifications=[];var u=[],f=!1;e.amount=0,$(".scroll-noti1").scroll(function(){$(this)[0].scrollHeight-$(this).scrollTop()===$(this).outerHeight()&&e.$apply(function(){e.limitTo=e.limitTo+d})});var p=RowboatPusher.subscribe("notification_ticket");p.bind("Rowboat\\Notification\\Events\\Notifications\\Broadcast\\NotificationTicket",function(t){e.$apply(function(){"undefined"!=typeof t.data.user_id&&-1!=t.data.user_id.indexOf(window.userId)&&(s(t),c=1,e.amount++)})}),e.getNotifications=function(){n.query(c).then(function(t){c&&e.setUserReadThisNotification(),e.notifications=t,e.hightlight=angular.copy(e.amount),e.amount=0,c=0})},e.setUserReadThisNotification=function(){n.setRead().then(function(){})},n.getAmountNotificationsNotRead().then(function(t){e.amount=t.result})}]);var permissionModule=angular.module("notification");permissionModule.factory("NotificationResource",["$resource",function(e){return e("/api/notification/:method/:id",{},{add:{method:"post"},save:{method:"post"}})}]).service("NotificationService",["$q","$filter","NotificationResource",function(e,t,n){var a=[];this.getAmountNotificationsNotRead=function(t){var a=e.defer();return n.get({method:"amount-notifications-not-read"},function(e){a.resolve(e)}),a.promise},this.query=function(t){var i=e.defer();return t?n.query().$promise.then(function(e){a=e,i.resolve(a)}):i.resolve(a),i.promise},this.notificationInvite=function(t){var a=e.defer(),i=new n(t);return i.$save({data:t,method:"invite"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.setRead=function(){var t=e.defer(),a=new n;return a.$save({method:"set-read"},function(e){t.resolve(e)},function(e){t.resolve(e.data)}),t.promise}}]),notificationModule=angular.module("notification"),notificationModule.directive("notification",[function(){return{restrict:"AE",scope:{item:"="},replace:!0,templateUrl:baseUrl+"/app/shared/notification/views/notification.html",link:function(){}}}]);var module=angular.module("uls");module.directive("rowboatRequired",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,a){"undefined"==typeof e.$eval(n.ngModel)&&a.$setValidity("rowboatRequired",!1),t.on("focus",function(i){e.$watch(n.ngModel,function(e){var n="undefined"!=typeof e&&0!=e.length;if(n)t.parent().find("span").remove(),t.parent().removeClass("error"),a.$setValidity("rowboatRequired",n);else if(0==t.parent().find("span").length){t.parent().addClass("error");var i='<span class="control-label">It is required</span>';t.parent().append(i),a.$setValidity("rowboatRequired",n)}})})}}}),module.directive("rowboatLength",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,a){"undefined"!=typeof e.$eval(n.ngModel)&&e.$eval(n.ngModel).length!=n.rowboatLength&&a.$setValidity("rowboatLength",!1),t.on("focus",function(i){e.$watch(n.ngModel,function(e){var i=n.rowboatLength,o="undefined"!=typeof e&&e.length==i;if(o)t.parent().find("span").remove(),t.parent().removeClass("error"),a.$setValidity("rowboatLength",o);else if(0==t.parent().find("span").length){t.parent().addClass("error");var r='<span class="control-label">Length is '+i+"</span>";t.parent().append(r),a.$setValidity("rowboatLength",o)}})})}}}),module.directive("rowboatMinLength",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,a){"undefined"!=typeof e.$eval(n.ngModel)&&e.$eval(n.ngModel).length<n.rowboatMinLength&&a.$setValidity("rowboatMinLength",!1),t.on("focus",function(i){e.$watch(n.ngModel,function(e){var i=n.rowboatMinLength,o="undefined"!=typeof e&&e.length>=i;if(o)t.parent().find("span").remove(),t.parent().removeClass("error"),a.$setValidity("rowboatMinLength",o);else if(0==t.parent().find("span").length){t.parent().addClass("error");var r='<span class="control-label">Min length is '+i+"</span>";t.parent().append(r),a.$setValidity("rowboatMinLength",o)}})})}}}),module.directive("rowboatMaxLength",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,a){"undefined"!=typeof e.$eval(n.ngModel)&&e.$eval(n.ngModel).length>n.rowboatMaxLength&&a.$setValidity("rowboatMaxLength",!1),t.on("focus",function(i){e.$watch(n.ngModel,function(e){var i=n.rowboatMaxLength,o="undefined"!=typeof e&&e.length<=i;if(o)t.parent().find("span").remove(),t.parent().removeClass("error"),a.$setValidity("rowboatMaxLength",o);else if(0==t.parent().find("span").length){t.parent().addClass("error");var r='<span class="control-label">Max length is '+i+"</span>";t.parent().append(r),a.$setValidity("rowboatMaxLength",o)}})})}}}),module.directive("rowboatEmailPattern",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,a){$pattern=/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/,"undefined"==typeof e.$eval(n.ngModel)&&a.$setValidity("rowboatEmailPattern",!1),t.on("blur",function(i){e.$watch(n.ngModel,function(e){var n="undefined"!=typeof e&&$pattern.test(e);if(n)t.parent().find("span").remove(),t.parent().removeClass("error"),a.$setValidity("rowboatEmailPattern",n);else if(0==t.parent().find("span").length){t.parent().addClass("error");var i='<span class="control-label">Email Invalid</span>';t.parent().append(i),a.$setValidity("rowboatEmailPattern",n)}})})}}});var filterDate=angular.module("customFormatDate",[]);filterDate.filter("myDate",["$filter",function(e){return function(t,n){if(null==t)return"";if("Invalid Date"==new Date(t))for(;-1!=String(t).indexOf("-");)t=t.replace("-","/");if("Invalid Date"==new Date(t))return"";var a=e("date")(new Date(String(t)),angular.isUndefined(n)?"MM-dd-yyyy":n);return String(a)}}]).filter("myDateL",["$filter",function(e){return function(t){if(null==t)return"";if("Invalid Date"==new Date(t))for(;-1!=String(t).indexOf("-");)t=t.replace("-","/");if("Invalid Date"==new Date(t))return"";var n=e("date")(new Date(String(t)),"MMMM d, y");return String(n)}}]).filter("myDateTime",["$filter",function(e){return function(t){if(null==t)return"";if("0000-00-00 00:00:00"==t)return"";if("Invalid Date"==new Date(t))for(;-1!=String(t).indexOf("-");)t=t.replace("-","/");if("Invalid Date"==new Date(t))return"";var n=e("date")(new Date(String(t)),"MM-dd-yyyy HH:mm:ss");return String(n)}}]).filter("myDateShortTime",["$filter",function(e){return function(t){if(null==t)return"";if("0000-00-00 00:00:00"==t)return"";if("Invalid Date"==new Date(t))for(;-1!=String(t).indexOf("-");)t=t.replace("-","/");if("Invalid Date"==new Date(t))return"";var n=e("date")(new Date(String(t)),"MM-dd-yyyy h:mma");return String(n)}}]).filter("clientDate",["$filter",function(e){return function(t,n){if(null==t)return"";if("0000-00-00 00:00:00"==t)return"";if("Invalid Date"==new Date(t))for(;-1!=String(t).indexOf("-");)t=t.replace("-","/");if("Invalid Date"==new Date(t))return"";t=new Date(t),t=new Date(parseInt(new Date(t).getTime())-60*parseInt((new Date).getTimezoneOffset())*1e3);var a=e("date")(new Date(String(t)),angular.isUndefined(n)?"MM-dd-yyyy":n);return String(a)}}]).filter("clientDateTime",["$filter",function(e){return function(t){return e("date")(checkInvalid(t),window.dateTimeFormat)}}]).filter("clientLogDate",["$filter",function(e){return function(t){return e("date")(checkInvalid(t),window.logDate)}}]).filter("clientMediumDate",["$filter",function(e){return function(t){return e("date")(checkInvalid(t),window.mediumDate)}}]).filter("clientShortTime",["$filter",function(e){return function(t){return e("date")(checkInvalid(t),window.shortTime)}}]).filter("clientShortTimeFollowTimezone",["$filter",function(e){return function(t,n){if(null==t)return"";if("Invalid Date"==new Date(t))for(;-1!=String(t).indexOf("-");)t=t.replace("-","/");if("Invalid Date"==new Date(t))return"";var a=e("date")(new Date(String(t)),window.shortTime);return String(a)}}]).filter("formatCurrentDate",["$filter",function(e){return function(e){if(e=checkInvalid(e),!e)return"";e=new Date(e);var t=e.getMonth()+"-"+e.getDate()+"-"+e.getFullYear();return String(t)}}]).filter("formatCurrentTime",["$filter",function(e){return function(e){if(e=checkInvalid(e),!e)return"";e=new Date(e);var t=e.getHours()>=12?"pm":"am",n=parseInt(e.getHours())%12;n=n?10>n?"0"+n:n:12;var a=parseInt(e.getMinutes())<10?"0"+e.getMinutes():e.getMinutes(),i=parseInt(e.getSeconds())<10?"0"+e.getSeconds():e.getSeconds(),o=n+"-"+a+"-"+i+" "+t;return String(o)}}]).filter("formatCurrentShortTime",["$filter",function(e){return function(e){if(e=checkInvalid(e),!e)return"";e=new Date(e);var t=e.getHours()>=12?"pm":"am",n=parseInt(e.getHours())%12;n=n?10>n?"0"+n:n:12;var a=parseInt(e.getMinutes())<10?"0"+e.getMinutes():e.getMinutes(),i=n+":"+a+" "+t;return String(i)}}]);var checkInvalid=function(e,t){if(null==e)return"";if("Invalid Date"==new Date(e))for(;-1!=String(e).indexOf("-");)e=e.replace("-","/");return"Invalid Date"==new Date(e)?"":(e=new Date(e),e=new Date(parseInt(new Date(e).getTime())-60*parseInt((new Date).getTimezoneOffset())*1e3),new Date(String(e)))};angular.module("nlcFilter").filter("elapsedtime",function(){return function(e){return humanized_time_span(e)}});var translation=angular.module("translation",[]);translation.filter("trans",["$filter",function(e){return function(e,t){return null==e?"":window.translations[t][e]}}]);var selectLevel=angular.module("helpEditorDirective",[]),version=5;selectLevel.directive("helpEditorDirective",["$timeout","$filter",function(e,t){return{require:"?ngModel",restrict:"EA",scope:{items:"=",text:"@",selectedItems:"=selectedItem",onClick:"&"},replace:!0,templateUrl:baseUrl+"/app/components/user/help-editor/view/view-help.html?v="+(new Date).getTime(),link:function(t,n,a,i){t.description="",t.recursiveGetDescription=function(e){angular.forEach(e,function(e,n){e.parent=!1,t.description+='<strong class="space-topic" id="_'+e._id+'">'+e.name+"</strong>"+e.description,e.subFolder.length>0&&t.recursiveGetDescription(e.subFolder)})},t.getDesctiption=function(){angular.forEach(t.items,function(e,n){e.parent=!0,t.description+='<h4 id="_'+e._id+'" class="c-primary">'+e.name+'</h4><div class="space-area user-ad-area">'+e.description,t.recursiveGetDescription(e.subFolder),t.description+="</div>"})},t.getDesctiption(),t.goToAnchorWithId=function(e){window.location.href="#"+e,$("#fix-modal-top").scrollTop(0)},e(function(){$(".sub-select-"+t.items[0]._id).addClass("in")})}}}]);var pageApp=angular.module("pageApp");pageApp.factory("PageResource",["$resource",function(e){return e("/api/pages/:method/:id",{method:"@method",id:"@id"},{add:{method:"post"},save:{method:"post"},update:{method:"put"},check:{method:"post"},editNameFolder:{method:"edit-name-folder"},deleteContent:{method:"delete-content"}})}]).service("PageService",["PageResource","$q",function(e,t){var n=[];this.createPageProvider=function(a){var i=t.defer(),o=new e(a);return o.$save({},function(e){0!=e.status&&n.push(e.page),i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.editPageProvider=function(a,i){var o=t.defer(),r=new e(i);return r.$update({id:a},function(e){for(var t in n)if(n[t].key==e.page.key){n[t]=e.page;break}o.resolve(e)},function(e){o.resolve(e.data)}),o.promise},this.movePage=function(n){var a=t.defer(),i=new e(n);return i.$save({method:"move-page"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.getItemByCategoryId=function(a){var i=t.defer(),o=new e;return o.$get({id:a},function(e){n=e.items,i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.checkUrlExists=function(n,a){var i=t.defer(),o=new e(a);return o.$check({id:n,method:"check-url"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.getTemplatePosition=function(n){var a=t.defer();return e.get({method:"get-position",id:n},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.getTemplate=function(){var n=t.defer();if(angular.isUndefined(window.hashData.cms_content)||1!=window.hashData.cms_content)e.get({method:"get-template"},function(e){localStorage.setItem("tempate",JSON.stringify(e)),n.resolve(e)},function(e){n.resolve(e.data)});else{var a=JSON.parse(localStorage.getItem("tempate"));n.resolve(a)}return n.promise},this.addTagsForPage=function(n,a){var i=t.defer(),o=new e(a);return o.$save({id:n,method:"add-tags"},function(e){0!=e.status,i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.createFolder=function(n){var a=t.defer(),i=new e(n);return i.$save({method:"folder-create"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.setPages=function(e){return n=e},this.getPages=function(){return n},this.formatContentWithTemplatePosition=function(e){var t={};for(var n in e)angular.isUndefined(t[e[n].template_id])&&(t[e[n].template_id]={}),t[e[n].template_id][e[n].position_id]=e[n].content;return t},this.deletePage=function(n){var a=t.defer(),i=new e;return i.$delete({id:n},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.deleteContentPage=function(n){var a=t.defer(),i=new e;return i.$get({id:n,method:"delete-content"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.editNameFolder=function(n){var a=t.defer(),i=new e(n);return i.$save({id:n.id,method:"edit-name-folder"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise}}]);var pageApp=angular.module("pageApp");pageApp.controller("PageController",["$scope","$modal","$filter","ngTableParams","$http","PageService","$window","$timeout","$filter","$cookieStore","CmsContentFolderService","$templateCache","CmsService",function(e,t,n,a,o,r,l,s,n,d,c,u,f){function p(e){$listStatus=[];for(i in e.contents)$listStatus.push(e.contents[i].status);return $listStatus.indexOf("Not Started")>-1?e.status="Not Started":$listStatus.indexOf("In Process")>-1?e.status="In Process":$listStatus.indexOf("Approved")>-1?e.status="Approved":$listStatus.indexOf("Overdue")>-1?e.status="Overdue":e.status="live",e}e.size=function(){f.setHeightTable()},e.isShowNested=!0,e.isShowBtnDelete=!1,e.isShowBtnEditNameFolder=!1,u.remove("cms/pages/template"),c.setContents(angular.copy(window.pages),window.currentPage),e.pageSelected=angular.copy(window.idOfPageSelected),e.contentHideOrShowAllNestedContent="Show All Nested Content",angular.isUndefined(e.pages)&&(e.pages=[]),e.tagsContent=angular.copy(window.tagsContent),e.allTags=angular.copy(window.allTags),e.currentFolderId=0,e.listFolderSelected=[],e.baseUrl=window.baseUrl,e.labels=window.labels,e.isSearch=!1,e.btnSearch=function(){e.isSearch=!e.isSearch},0!=e.pageSelected&&c.setActiveNode(e.pageSelected);var m=function(t){1==e.toggleChild?t.data.openChild=!0:t.data.openChild=!1;var n=t.data;return n.title=t.title,n.parent_title=t.parent.title,n};e.historyPage=function(e){window.location.href=window.baseUrl+"/cms/pages/history/"+e},e.hideOrShowAllNestedContent=function(){e.pages=[],c.changeStatusHideOrShowAllNestedContent().then(function(t){if(e.contentHideOrShowAllNestedContent=t.textButton,"Hide All Nested Content"==e.contentHideOrShowAllNestedContent)e.isShowNested=!1,"Pages"!=t.nodeActive.title&&e.pages.push(m(t.nodeActive)),e.showAllChild(t.nodeActive.children),e.tableParams.reload();else if("Show All Nested Content"==e.contentHideOrShowAllNestedContent){e.isShowNested=!0,"Pages"!=t.nodeActive.title&&e.pages.push(m(t.nodeActive));for(var n in t.nodeActive.children)e.pages.push(m(t.nodeActive.children[n]));e.tableParams.reload()}})},e.$watch("tableParams",function(t,n){if(angular.isDefined(window.status)&&""!=window.status&&"false"!=window.status){window.status;e.tableParams.filter().status=angular.copy(window.status),window.status="",s(function(){e.tableParams.reload()}),e.isSearch=!0}angular.isDefined(window.clickUpdate)&&"false"!=window.clickUpdate&&window.clickUpdate&&(e.tableParams.sorting({
updated_at:"desc"}),window.clickUpdate=!1,s(function(){e.tableParams.reload()}),e.isSearch=!0)}),c.initTree(function(t,i){if(e.pages=[],"0"==i.data.parent_id?e.titleItemSelected="Pages":1==i.folder?e.titleItemSelected=i.title:angular.isUndefined(i.parent.data.name)?e.titleItemSelected="Pages":e.titleItemSelected=i.parent.data.name,"0"!=i.data.parent_id?e.isShowBtnDelete=!0:e.isShowBtnDelete=!1,1==i.folder&&"0"!=i.data.parent_id?e.isShowBtnEditNameFolder=!0:e.isShowBtnEditNameFolder=!1,e.isShowNested)var o=c.getDataFromActiveNode(!0);else var o=c.getDataNestedFromActiveNode();e.toggleChild=!1,angular.isDefined(o)&&1==o.length&&(e.toggleChild=!0);for(var r in o)e.pages.push(m(o[r]));angular.isUndefined(e.tableParams)?e.tableParams=new a({page:1,count:100,sorting:{title:"asc"},filter:{title:""}},{total:e.pages.length,getData:function(t,a){var i=a.filter()?n("filter")(e.pages,a.filter()):e.pages,o=a.sorting()?n("orderBy")(i,a.orderBy()):i;a.total(i.length),t.resolve(o.slice((a.page()-1)*a.count(),a.page()*a.count()))}}):e.tableParams.reload()}),(!angular.isUndefined(window.status)&&"false"!=window.status||!angular.isUndefined(window.clickUpdate)&&"false"!=window.clickUpdate&&window.clickUpdate)&&(e.contentHideOrShowAllNestedContent="Hide All Nested Content",e.hideOrShowAllNestedContent()),e.getParentFolder=function(){var t=$("#tree").fancytree("getTree"),n=t.getActiveNode();n&&(e.selectedItemName=n.title,e.selectedItemId=n.key)},e.showAllChild=function(t){for(var n in t)null!=t[n].children&&e.showAllChild(t[n].children),e.pages.push(m(t[n]))},e.deletePage=function(){e.dsbBtnDelete=!0;var t=$("#tree").fancytree("getTree"),a=t.getActiveNode(),i=t.getRootNode();if(1==a.folder)var o=confirm(n("trans")("confirm-delete-folder","golbal"));else var o=confirm(n("trans")("confirm-delete-content","golbal"));return 1!=o?void(e.dsbBtnDelete=!1):void("0"!=a.data.parent_id&&r.deletePage(a.data._id).then(function(t){var n=a.getParent();a.remove(),null==n.children&&(n.folder=!1,n.render()),rootNodeOfNodeActive=_.find(i.children,function(e){return"Pages"==e.title}),rootNodeOfNodeActive.setActive(),rootNodeOfNodeActive.render(),e.dsbBtnDelete=!1}))},e.deleteContent=function(t,n){r.deleteContentPage(t).then(function(a){0!=a.status&&(angular.isUndefined(a.result)||(n.region=a.result.countUniqueRegion,n.language=a.result.countUniqueLanguage),angular.forEach(n.contents,function(e,a){return e._id==t?(n.contents.splice(a,1),void(n=p(n))):void 0}),e.tableParams.reload())})},e.editNameFolder=function(){var n=$("#tree").fancytree("getTree"),a=n.getActiveNode();if(a){var i="/cms/pages/edit-name-folder/"+a.data._id+"?"+(new Date).getTime(),o=t.open({animation:e.animationsEnabled,templateUrl:window.baseUrl+i,controller:"editNameFolderPageCtrl",size:null,resolve:{}});o.result.then(function(t){a.setTitle(t.folder.name),a.setActive(),a.getParent().sortChildren(null,!0),e.tableParams.reload(),e.titleItemSelected=t.folder.name},function(){})}},e.showGroup=function(e){var t=($(".group-btn-ac").outerHeight(),$(window).outerWidth()),n=$(window).outerHeight(),a=e.pageY,i=n-a;300>i&&$(".wrap-ac-group").each(function(e){$(this).addClass("show-top")}),$(".wrap-ac-group").each(function(e){$(this).removeClass("ac-up")}),$(e.target).parent().toggleClass("ac-up"),$(".group-btn-ac").hasClass("fix-missing-li")?$(".group-btn-ac").css({top:e.pageY-65+"px",right:t-e.pageX-30+"px"}):$(".group-btn-ac").css({top:e.pageY-200+"px",right:t-e.pageX-30+"px"}),$(document).on("click",function o(e){$(e.target).closest("tr").siblings().find(".wrap-ac-group").removeClass("ac-up"),0===$(".wrap-ac-group").has(e.target).length?($(".wrap-ac-group").removeClass("ac-up"),$(".wrap-ac-group").removeClass("show-top")):$(document).one("click",o)}),angular.element(".table-responsive").addClass("fix-height")},e.addTagsForPage=function(t,n){$("#page-loading").css("display","block"),e.tagId=n,r.addTagsForPage(t,{tags:e.tagId}).then(function(t){for(var n in e.pages)if(e.pages[n]._id==t.item._id){e.pages[n].tags=t.item.tags;break}$("#page-loading").css("display","none"),e.tableParams.reload()})};var g=!1;e.getModalCreatePage=function(){if(!g){e.getParentFolder();var n="/cms/pages/create?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName+"&&v="+(new Date).getTime(),a=t.open({templateUrl:window.baseUrl+n,controller:"CreatePageController",size:void 0,resolve:{content_id:function(){return null}}});g=!0,a.result.then(function(e){if(g=!1,angular.isDefined(e)){var t=$("#tree").fancytree("getTree");if("0"==e.parent_id)var n=t.getNodeByKey("root");else var n=t.getNodeByKey(e.parent_id);var a=n.addChildren(e);a.setExpanded(),"0"!=e.parent_id&&(n.folder=!0),n.setActive(!1),n.setActive(),n.sortChildren(null,!0)}},function(){g=!1})}},e.getModalRequestTranslation=function(n){if(!g){e.getParentFolder();var a="/cms/pages/request-translation/"+n+"?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName+"&&v="+(new Date).getTime(),i=t.open({templateUrl:window.baseUrl+a,controller:"CreatePageController",size:void 0,resolve:{content_id:function(){return n}}});g=!0,i.result.then(function(t){g=!1;var n=$("#tree").fancytree("getTree"),a=n.getNodeByKey(t.key);angular.isUndefined(a)||null==a||a.remove(),node=$("#tree").fancytree("getTree").getNodeByKey(t.parent_id),nodeAdd=node.addChildren(t),nodeAdd.setActive(),node.sortChildren(null,!0),e.tableParams.reload()},function(){g=!1})}},e.getModalRequestRegion=function(n){if(!g){e.getParentFolder();var a="/cms/pages/request-region/"+n+"?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName+"&&v="+(new Date).getTime(),i=t.open({templateUrl:window.baseUrl+a,controller:"CreatePageController",size:void 0,resolve:{content_id:function(){return n}}});g=!0,i.result.then(function(e){g=!1;var t=$("#tree").fancytree("getTree"),n=t.getNodeByKey(e.key);angular.isUndefined(n)||null==n||n.remove(),node=$("#tree").fancytree("getTree").getNodeByKey(e.parent_id),nodeAdd=node.addChildren(e),nodeAdd.setActive(),node.sortChildren(null,!0)},function(){g=!1})}},e.getModalRequestRevision=function(n){if(!g){e.getParentFolder();var a="/cms/pages/request-revision/"+n+"?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName+"&&v="+(new Date).getTime(),i=t.open({templateUrl:window.baseUrl+a,controller:"CreatePageController",size:void 0,resolve:{content_id:function(){return n}}});g=!0,i.result.then(function(e){g=!1;var t=$("#tree").fancytree("getTree"),n=t.getNodeByKey(e.key);angular.isUndefined(n)||null==n||n.remove(),node=$("#tree").fancytree("getTree").getNodeByKey(e.parent_id),nodeAdd=node.addChildren(e),nodeAdd.setActive(),node.sortChildren(null,!0)},function(){g=!1})}},e.movePage=function(n){var a="/cms/pages/move-page/"+n._id+"?v="+(new Date).getTime(),i=t.open({animation:e.animationsEnabled,templateUrl:window.baseUrl+a,controller:"movePageCtrl",size:null,resolve:{page:function(){return n}}});i.result.then(function(e){var t=$("#tree").fancytree("getTree"),n=t.getNodeByKey(e.key);if(!angular.isUndefined(n)&&null!=n){var a=n.getParent();n.remove(),a.hasChildren()||(a.folder=!1,a.setActive())}node=$("#tree").fancytree("getTree").getNodeByKey(e.parent_id),node.folder=!0,nodeAdd=node.addChildren(e),nodeAdd.setActive(),node.sortChildren(null,!0)},function(){})}}]).controller("ModalCreteFolderCtrl",["$scope","$modalInstance","PageService",function(e,t,n){e.submit=function(a){return e.submitted=!0,a?void $(".ng-invalid:eq(1)").focus():void n.createFolder(e.folder).then(function(n){0==n.status?e.error="Folder exist":t.close(n)})},e.cancel=function(){t.dismiss("cancel")}}]).filter("lowercase",function(){return function(e){return e?e.replace(/\s+/g,"").toLowerCase():void 0}}).controller("editNameFolderPageCtrl",["$scope","$modalInstance","PageService","$http","$q",function(e,t,n,a,i){e.checkEmtypeName=function(n){if(e.checkName=!1,""==n)return"The folder name is a required field";e.folder.name=n;var o=i.defer();return a.post("/api/pages/edit-name-folder",{data:e.folder}).success(function(e){e=e||{},e.status?(o.resolve(),t.close(e)):o.resolve("Name has already been taken.")}).error(function(e){o.reject("Server error!")}),o.promise}}]).controller("movePageCtrl",["$scope","$modalInstance","PageService","$http","$q","page",function(e,t,n,a,i,o){e.$watch("parent._id",function(t,n){e.error=!1}),e.submit=function(a){a==o.parent_id&&t.dismiss("cancel");var i=[];i.pageId=o._id,i.parentID=a,angular.element("#page-loading").css("display","block"),n.movePage(i).then(function(n){angular.element("#page-loading").css("display","none"),0==n.status?e.error="Name Page has already been taken":t.close(n.page)})},e.cancel=function(){t.dismiss("cancel")}}]);var createPageApp=angular.module("pageApp");createPageApp.controller("CreatePageController",["$scope","$modalInstance","$modal","$filter","ngTableParams","$http","$window","$timeout","CreatePageService","content_id",function(e,t,n,a,i,o,r,l,s,d){e.page=angular.copy(window.page),e.minDate=new Date,e.open=function(t,n){t.preventDefault(),t.stopPropagation(),e.opened={},e.opened[n]=!0},e.languages_selected={},e.requiredLanguage=!0,e.requiredRegion=!0,e.regions_selected={},e.format="MM-dd-yyyy",e.checkName=!1,e.checkUrl=!1,e.validatedue_date=!1,e.initRedactor=function(){$("#content").redactor({plugins:["table","insertpage","insertlink",1==window.isAdvancedEditingFeatures?"source":""],imageUpload:"/content/upload",callbacks:{modalOpened:function(e,t){if("link"!=e||this.observe.isCurrent("a")){if("link"==e){var n=this.link.$node.attr("rel");"undefined"==typeof n?$('<label><input type="checkbox" id="redactor-link-no-follow"> No Follow</label>').insertAfter($("#redactor-link-blank").parent()):$('<label><input type="checkbox" checked id="redactor-link-no-follow"> No Follow</label>').insertAfter($("#redactor-link-blank").parent())}}else $("#redactor-link-blank").attr("checked","true"),$('<label><input type="checkbox" checked id="redactor-link-no-follow"> No Follow</label>').insertAfter($("#redactor-link-blank").parent())},insertedLink:function(e){var t=$(e).attr("href");"http"!=t.substring(0,4)&&"https"!=t.substring(0,5)&&"ftp"!=t.substring(0,3)&&$(e).attr("href","http://"+t),$("#redactor-link-no-follow").prop("checked")?e.attr("rel","nofollow"):e.removeAttr("rel")},linkify:function(e){e.attr("target","_blank")},change:function(){$content=$("#content").redactor("code.get"),e.$apply(function(){"<div></div>"==$content||""==$content||"<br>"==$content||"<div><strong></strong></div>"==$content||"<div><em></em><strong></strong></div>"==$content||"<div><em><del></del></em></div>"==$content?e.requiredDescription=!0:e.requiredDescription=!1})}},linkSize:1e3,minHeight:200})},$("#content").redactor("core.destroy"),e.changeName=function(){e.checkName=!1,e.checkUrl=!1},e.changeDate=function(){e.validatedue_date=!1},e.submit=function(n){if(e.submitted=!0,$content=$("#content").redactor("code.get"),"<div></div>"==$content||""==$content||"<br>"==$content||"<div><strong></strong></div>"==$content||"<div><em></em><strong></strong></div>"==$content||"<div><em><del></del></em></div>"==$content?e.requiredDescription=!0:e.requiredDescription=!1,n||e.requiredDescription)return void $(".ng-invalid:eq(1)").focus();if("request_translation"==e.page.modal&&e.requiredLanguage)return void $(".ng-invalid:eq(1)").focus();if("request_region"==e.page.modal&&e.requiredRegion)return void $(".ng-invalid:eq(1)").focus();var i=new Date;if("undefined"==typeof e.page.due_date)e.validatedue_date=!0;else{var i=new Date;e.page.due_date<i&&a("date")(i,"MM-dd-yyyy")!=a("date")(e.page.due_date,"MM-dd-yyyy")&&(e.validatedue_date=!0)}e.validatedue_date||(files_id=[],"undefined"!=typeof e.filesUpload&&(files_id=e.filesUpload.ids),e.page.files_id=files_id,$("#btnSubmit").attr("disabled","true"),e.page.description=$("#content").redactor("code.get"),e.page._id&&"request_translation"==e.page.modal&&(e.page.languages=e.languages_selected),e.page._id&&"request_region"==e.page.modal&&(e.page.regions=e.regions_selected),"undefined"==typeof e.page.parent_id&&(e.page.parent_id="0"),null!=d&&(e.page.content_id=d),s.createPageProvider(e.page).then(function(n){n.status?t.close(n.page):($("#btnSubmit").removeAttr("disabled"),n.checkName&&(e.checkName=!0),n.checkUrl&&(e.checkUrl=!0),$(".name").focus())}))},e.cancel=function(){t.dismiss("cancel")}}]);var createPageApp=angular.module("CreatePageApp");createPageApp.factory("CreatePageResource",["$resource",function(e){return e("/api/pages/:method/:id",{method:"@method",id:"@id"},{add:{method:"post"},save:{method:"post"},update:{method:"put"},check:{method:"post"}})}]).service("CreatePageService",["CreatePageResource","$q",function(e,t){var n=this,a=[];this.createPageProvider=function(i){if("undefined"!=typeof i._id&&"request_translation"==i.modal)return n.requestTranslation(i);if("undefined"!=typeof i._id&&"request_region"==i.modal)return n.requestRegion(i);if("undefined"!=typeof i._id&&"request_revision"==i.modal)return n.requestRevision(i);var o=t.defer(),r=new e(i);return r.$save({},function(e){0!=e.status&&a.push(e.page),o.resolve(e)},function(e){o.resolve(e.data)}),o.promise},this.requestTranslation=function(n){var i=t.defer(),o=new e(n);return o.$save({method:"request-translation"},function(e){0!=e.status&&a.push(e.page),i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.requestRegion=function(n){var a=t.defer(),i=new e(n);return i.$save({method:"request-region"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.requestRevision=function(n){var a=t.defer(),i=new e(n);return i.$save({method:"request-revision"},function(e){0!=e.status&&a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.editPageProvider=function(n,i){var o=t.defer(),r=new e(i);return r.$update({id:n},function(e){for(var t in a)if(a[t].key==e.page.key){a[t]=e.page;break}o.resolve(e)},function(e){o.resolve(e.data)}),o.promise},this.checkUrlExists=function(n,a){var i=t.defer(),o=new e(a);return o.$check({id:n,method:"check-url"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.getTemplatePosition=function(n){var a=t.defer();return e.get({method:"get-position",id:n},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.formatContentWithTemplatePosition=function(e){var t={};for(var n in e)angular.isUndefined(t[e[n].template_id])&&(t[e[n].template_id]={}),t[e[n].template_id][e[n].position_id]=e[n].content;return t}}]),assetmanagerApp.controller("AssetManagerController",["$scope","$modal","ngTableParams","$timeout","AssetManagerService","CmsContentFolderService","$filter","$templateCache","CmsService",function(e,t,n,a,i,o,r,l,s){e.size=function(){s.setHeightTable()},e.isShowNested=!0,e.isShowBtnDelete=!1,e.isShowBtnEditNameFolder=!1,l.remove("cms/asset-manager/template"),e.assetManagers=o.setContents(angular.copy(window.folders),window.currentPage),e.allTags=angular.copy(window.allTags),e.contentHideOrShowAllNestedContent="Show All Nested Content",angular.isUndefined(e.assets)&&(e.assets=[]),0!=window.idOfAssetSelected&&o.setActiveNode(window.idOfAssetSelected),e.tagsContent=angular.copy(window.tagsContent),e.labels=window.labels,e.titleItemSelected="root",e.isSearch=!1,e.btnSearch=function(){e.isSearch=!e.isSearch},e.tableParams=new n({page:1,count:100,sorting:{title:"asc"},filter:{}},{total:e.assets.length,getData:function(t,n){var a=n.filter()?r("filter")(e.assets,n.filter()):e.assets,i=n.sorting()?r("orderBy")(a,n.orderBy()):a;n.total(a.length),t.resolve(i.slice((n.page()-1)*n.count(),n.page()*n.count()))}}),e.getChildrenPages=function(t){var n=[];for(var a in t){if(angular.isUndefined(t[a].data))return;"root"==t[a].key?(n.push(t[a]),delete t[a]):angular.isUndefined(t[a].folder)||(n.push(t[a]),delete t[a])}e.assetManagers=t,e.tableParams.reload()},o.initTree(function(t,n){e.assets=[],"Assets"==n.key?e.titleItemSelected="Assets":1==n.folder?e.titleItemSelected=n.title:angular.isUndefined(n.parent.data.name)?e.titleItemSelected="Assets":e.titleItemSelected=n.parent.data.name,angular.isDefined(t)&&1==t.length&&1!=n.folder?(t[0].expanded=!0,e.assets=t):angular.forEach(t,function(t,n){t.expanded=!1,e.assets.push(t)}),e.tableParams.reload(),angular.isDefined(e.tableParams.$params)&&(e.tableParams.$params.page=1);var a=$("#tree").fancytree("getTree"),i=_.find(a.getRootNode().children,function(e){return"assets"==e.data.type});if("0"!=n.data.parent_id&&n.data.parent_id!=i.data._id?(e.isShowBtnDelete=!0,1==n.folder?e.isShowBtnEditNameFolder=!0:e.isShowBtnEditNameFolder=!1):(e.isShowBtnDelete=!1,e.isShowBtnEditNameFolder=!1),1==n.folder)"css"==window.folderType[n.data._id]||"js"==window.folderType[n.data._id]?e.isShowBtnCreateNewAsset=!0:e.isShowBtnCreateNewAsset=!1;else{var o=n.getParent();"css"==window.folderType[o.data._id]||"js"==window.folderType[o.data._id]?e.isShowBtnCreateNewAsset=!0:e.isShowBtnCreateNewAsset=!1}}),e.hideOrShowAllNestedContent=function(){o.changeStatusHideOrShowAllNestedContent().then(function(t){e.contentHideOrShowAllNestedContent=t.textButton,"Show All Nested Content"==e.contentHideOrShowAllNestedContent?e.isShowNested=!0:e.isShowNested=!1,e.assets=t.contents,e.tableParams.reload()})},e.deleteFolderAndAsset=function(){e.dsbBtnDelete=!0;var t=$("#tree").fancytree("getTree"),n=t.getActiveNode(),a=t.getRootNode();if(1==n.folder)var o=confirm(r("trans")("confirm-delete-folder","golbal"));else var o=confirm(r("trans")("confirm-delete-content","golbal"));return 1!=o?void(e.dsbBtnDelete=!1):void("0"!=n.data.parent_id&&i.deleteFolderAndAsset(n.data._id).then(function(t){n.remove(),rootNodeOfNodeActive=_.find(a.children,function(e){return"Assets"==e.title}),rootNodeOfNodeActive.setActive(),e.dsbBtnDelete=!1}))},e.deleteFileAsset=function(t,n){i.deleteAssetFile(t).then(function(a){0!=a.status&&(angular.isUndefined(a.result)||(n.region=a.result.countUniqueRegion,n.language=a.result.countUniqueLanguage,n.status=a.result.status),angular.forEach(n.subFiles,function(e,a){e._id==t&&n.subFiles.splice(a,1)}),e.tableParams.reload())})},e.editNameFolder=function(){var n=$("#tree").fancytree("getTree"),a=n.getActiveNode();if(a){var i="/cms/asset-manager/edit-name-folder/"+a.data._id+"?"+(new Date).getTime(),o=t.open({animation:e.animationsEnabled,templateUrl:window.baseUrl+i,controller:"editNameFolderAssetCtrl",size:null,resolve:{}});o.result.then(function(t){a.setTitle(t.folder.name),a.setActive(),a.getParent().sortChildren(null,!0),e.tableParams.reload(),e.titleItemSelected=t.folder.name},function(){})}},e.createNewAsset=function(){if(!d){e.getParentFolder();var n="/cms/asset-manager/create-new-asset/?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName+"&&v="+(new Date).getTime(),a=t.open({animation:e.animationsEnabled,templateUrl:window.baseUrl+n,controller:"CreateNewAssetCtrl",size:null,resolve:{}});a.result.then(function(e){d=!1,e.title=e.name,e.key=e._id,node=$("#tree").fancytree("getTree").getNodeByKey(e.folder_id),null!=node&&(node.addChildren(e),nodeAdded=$("#tree").fancytree("getTree").getNodeByKey(e._id),nodeAdded.setActive(),node.sortChildren(null,!0))},function(){})}},e.showGroup=function(e,t){var n=($(".group-btn-ac").outerHeight(),$(window).outerWidth()),a=$(window).outerHeight(),i=e.pageY,o=a-i;if(300>o&&$(".wrap-ac-group").each(function(e){$(this).addClass("show-top")}),$(".wrap-ac-group").each(function(e){$(this).removeClass("ac-up")}),$(e.target).parent().toggleClass("ac-up"),$(".group-btn-ac").hasClass("fix-missing-li")?$(".group-btn-ac").css({top:e.pageY-65+"px",right:n-e.pageX-30+"px"}):$(".group-btn-ac").css({top:e.pageY-200+"px",right:n-e.pageX-30+"px"}),$(document).on("click",function c(e){$(e.target).closest("tr").siblings().find(".wrap-ac-group").removeClass("ac-up"),0===$(".wrap-ac-group").has(e.target).length?($(".wrap-ac-group").removeClass("ac-up"),$(".wrap-ac-group").removeClass("show-top")):$(document).one("click",c)}),"undefined"!=typeof t){var r=["png","jpg","jpeg","gif","tiff","bmp"];if(t.filename){var l=t.filename.split("."),s=l[l.length-1],d=$("#viewFile-"+t._id);-1==r.indexOf(s.toLowerCase())?(d.attr("href",baseUrl+"/cms/asset-manager/file/download/"+t._id),d.attr("target","_self")):(d.removeAttr("target"),d.attr("href","script:void(0)"))}}angular.element(".table-responsive").addClass("fix-height")},e.getParentFolder=function(){var t=$("#tree").fancytree("getTree"),n=t.getActiveNode();n&&(0==n.folder||angular.isUndefined(n.folder)?(e.selectedItemName=n.getParent().title,e.selectedItemId=n.getParent().key):"0"==n.data.parent_id?(e.selectedItemName="",e.selectedItemId=""):(e.selectedItemName=n.title,e.selectedItemId=n.key))},e.addTagsForPage=function(t,n){$("#page-loading").css("display","block"),e.tagId=n,i.addTagsForPage(t,{tags:e.tagId}).then(function(t){for(var n in e.assets)if(e.assets[n].data._id==t.item._id){e.assets[n].data.tags=t.item.tags;break}$("#page-loading").css("display","none"),e.tableParams.reload()})};var d=!1;e.createFolderAsset=function(){if(!d){e.getParentFolder();var n="/cms/asset-manager/create-folder?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName+"&&v="+(new Date).getTime(),i=t.open({templateUrl:window.baseUrl+n,controller:"ModalCreateFolderAssetCtrl",size:void 0,resolve:{}});d=!0,i.result.then(function(e){window.folderType=e.folderType;var e=e.item;d=!1;var t=$("#tree").fancytree("getTree"),n=t.getNodeByKey(e.parent_id);n.addChildren(e);var i=t.getNodeByKey(e._id);i.setActive(),a(function(){n.sortChildren(null,!0)})},function(){d=!1})}},e.getModalEditFile=function(n){if(!d){e.getParentFolder();var a="/cms/asset-manager/edit-file/"+n+"?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName+"&&v="+(new Date).getTime(),i=t.open({templateUrl:window.baseUrl+a,controller:"ModalEditFileAssetCtrl",size:void 0,resolve:{}});d=!0,i.result.then(function(e){d=!1;var t=e,n=$("#tree").fancytree("getTree"),a=n.getNodeByKey(t._id);angular.isUndefined(a)||null==a||a.remove(),t.title=t.name,t.key=t._id,node=$("#tree").fancytree("getTree").getNodeByKey(t.folder_id),nodeAdd=node.addChildren(t),nodeAdd.setActive(),node.sortChildren(null,!0)},function(){d=!1})}},e.uploadNewAssets=function(){if(!d){e.getParentFolder();var n="/cms/asset-manager/upload-new-asset?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName+"&&v="+(new Date).getTime(),a=t.open({templateUrl:window.baseUrl+n,controller:"ModalUploadNewAssetCtrl",size:void 0,resolve:{tagsContent:function(){return e.tagsContent},allTags:function(){return e.allTags}}});d=!0,a.result.then(function(e){d=!1;var t=e;t.title=t.name,t.key=t._id,node=$("#tree").fancytree("getTree").getNodeByKey(t.folder_id),null!=node&&(node.addChildren(t),nodeAdded=$("#tree").fancytree("getTree").getNodeByKey(t._id),nodeAdded.setActive(),node.sortChildren(null,!0))},function(){d=!1})}},e.viewFile=function(e){var n=["png","jpg","jpeg","gif","tiff","bmp"];if(e.filename){var a=e.filename.split("."),i=a[a.length-1];if(n.indexOf(i.toLowerCase())>-1){t.open({templateUrl:baseUrl+"/app/shared/assetmanagers/views/viewPicture.html?v="+(new Date).getTime(),controller:"viewFileController",size:void 0,windowClass:"show-img",resolve:{asset:function(){return e}}})}}},e.checkFileType=function(e){if(e.filename){var t=String(e.filename).split(".");if(angular.isArray(t)&&t.length>1&&("js"==t[t.length-1]||"css"==t[t.length-1]||"html"==t[t.length-1]))return!0}return!1},e.getModalUploadNewVersion=function(t){if(!d){e.getParentFolder();var n="/cms/asset-manager/get-content-file/"+t+"?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName;window.location.href=window.baseUrl+n}}}]).controller("viewFileController",["$scope","$modalInstance","asset",function(e,t,n){e.asset=n,e.baseUrl=baseUrl,e.cancel=function(){t.dismiss("cancel")},e.v=(new Date).getTime()}]).controller("ModalCreateFolderAssetCtrl",["$scope","$modalInstance","AssetManagerService",function(e,t,n){e.showLoad=!1,e.changeName=function(){e.nameExists=!1},e.submit=function(a){return e.submitted=!0,e.nameExists=!1,a?void $(".ng-invalid:eq(1)").focus():"undefined"==typeof e.assetManager.parent_id||""==e.assetManager.parent_id?void $(".ng-invalid:eq(1)").focus():(e.showLoad=!0,void n.createFolderProvider(e.assetManager).then(function(n){return e.showLoad=!1,0==n.status?($(".ng-invalid:eq(1)").focus(),void(e.nameExists=!0)):(e.nameExists=!1,void t.close(n))}))},e.cancel=function(){t.dismiss("cancel")}}]).controller("ModalUploadNewAssetCtrl",["$scope","$modalInstance","$timeout","Upload","$filter","AssetManagerService","tagsContent","allTags",function(e,t,n,a,i,o,r,l){e.format="MM-dd-yyyy",e.minDate=new Date,e.submitted=!1,e.showField=!1,e.showLoad=!1,e.tagsContent=r,e.allTags=l,e.teamplateThumb=window.baseUrl+"/app/components/assetmanagers/views/thumbnails.html",e.tagsSelected=[],e.itemsSelected=[],e.selectTags=function(t,n){-1==e.tagsSelected.indexOf(n)?e.tagsSelected.push(n):angular.forEach(e.tagsSelected,function(t,a){t==n&&e.tagsSelected.splice(a,1)}),e.itemsSelected=e.tagsSelected};e.open=function(t,n){t.preventDefault(),t.stopPropagation(),e.opened={},e.opened[n]=!0},t.result.then(function(){},function(n){t.close(e.assetUpload)}),e.$watch("filesUpload",function(t,n){angular.isUndefined(e.filesUpload)?e.checkUpload=!0:angular.isUndefined(e.filesUpload.listsFiles)?e.checkUpload=!0:0==e.filesUpload.listsFiles.length?e.checkUpload=!0:(e.asset.altTag=null,e.asset.description=null,e.asset.nameNewFile=null,e.asset.title=null,angular.isUndefined(e.filesUpload.checkImage)?e.asset.type=e.folderType[e.asset.folder]:(e.asset.nameNewFile=e.filesUpload.listsFiles[0].name,e.asset.type="image",e.checkWithHeightValidate(e.filesUpload.listsFiles)),e.checkUpload=!1)}),e.submit=function(n){if(e.submitted=!0,angular.isUndefined(e.filesUpload))return void(e.checkUpload=!0);if(n||e.checkUpload)return $(".ng-invalid:eq(1)").focus(),void(!e.asset.thumbnailsCustom||"undefined"!=typeof e.asset.thumbnailsWidth&&null!=e.asset.thumbnailsWidth&&"undefined"!=typeof e.asset.thumbnailsHeight&&null!=e.asset.thumbnailsHeight||alert("Min height is 1 pixels and min width is 1 pixels"));if("undefined"!=typeof e.asset.folder&&(angular.isUndefined(e.filesUpload.checkImage)||"undefined"!=typeof e.asset.nameNewFile&&null!=e.asset.nameNewFile&&e.asset.nameNewFile)){if("image"==e.asset.type&&e.asset.withFile&&e.asset.heightFile){if(e.asset.thumbnailsMedium&&e.asset.withFile<100&&e.asset.heightFile<100)return void alert("Max height is "+e.asset.heightFile+" pixels and Max width is "+e.asset.withFile+" pixels");if(e.asset.thumbnailsProduct&&e.asset.withFile<82&&e.asset.heightFile<82)return void alert("Max height is "+e.asset.heightFile+" pixels and Max width is "+e.asset.withFile+" pixels");if(e.asset.thumbnailsMaterial&&e.asset.withFile<75&&e.asset.heightFile<75)return void alert("Max height is "+e.asset.heightFile+" pixels and Max width is "+e.asset.withFile+" pixels");if(e.asset.thumbnailsSmall&&e.asset.withFile<64&&e.asset.heightFile<64)return void alert("Max height is "+e.asset.heightFile+" pixels and Max width is "+e.asset.withFile+" pixels");if(e.asset.thumbnailsCustom&&(!e.asset.thumbnailsHeight||!e.asset.thumbnailsWidth))return void alert("Height and width is a required field");if(e.asset.thumbnailsCustom&&(e.asset.withFile<e.asset.thumbnailsWidth||e.asset.heightFile<e.asset.thumbnailsHeight))return void alert("Max height is "+e.asset.heightFile+" pixels and Max width is "+e.asset.withFile+" pixels")}e.showLoad=!0,e.asset.tags=e.itemsSelected,$("#page-loading").css("display","block"),a.upload({method:"POST",url:baseUrl+"/api/asset-manager/upload-new-asset",file:e.filesUpload.listsFiles,data:e.asset}).success(function(n,a,i,o){$("#page-loading").css("display","none"),e.showLoad=!1,t.close(n.item)})}},e.cancel=function(){t.dismiss("cancel")},e.checkWithHeightValidate=function(t){var n=new FileReader;n.readAsDataURL(t[0]),n.onload=function(t){var n=new Image;n.src=t.target.result,n.onload=function(){e.asset.withFile=this.width,e.asset.heightFile=this.height}}}}]).controller("ModalEditFileAssetCtrl",["$scope","$modalInstance","$timeout","Upload","$filter","AssetManagerService",function(e,t,n,a,i,o){e.format="MM-dd-yyyy",e.minDate=new Date,e.submitted=!1,e.showField=!1,e.showLoad=!1,e.teamplateThumb=window.baseUrl+"/app/components/assetmanagers/views/thumbnails.html";e.open=function(t,n){t.preventDefault(),t.stopPropagation(),e.opened={},e.opened[n]=!0},t.result.then(function(){},function(n){t.close(e.assetUpload)}),e.$watch("filesUpload",function(t,n){angular.isUndefined(e.filesUpload)?e.checkUpload=!0:angular.isUndefined(e.filesUpload.listsFiles)?e.checkUpload=!0:0==e.filesUpload.listsFiles.length?e.checkUpload=!0:(angular.isUndefined(e.filesUpload.checkImage)?(e.asset.type=e.folderType[e.asset.folder],e.asset.filename=e.filesUpload.listsFiles[0].name):(e.asset.type="image",e.asset.filename=e.filesUpload.listsFiles[0].name,e.asset.height&&e.asset.width?(e.asset.withFile=angular.copy(e.asset.width),e.asset.heightFile=angular.copy(e.asset.height),e.asset.height=!1,e.asset.width=!1):e.checkWithHeightValidate(e.filesUpload.listsFiles)),e.checkUpload=!1)}),e.submit=function(n){if(e.assetUpload=[],e.submitted=!0,angular.isUndefined(e.filesUpload)||angular.isUndefined(e.filesUpload.listsFiles))return void(e.checkUpload=!0);if(0==e.filesUpload.listsFiles.length)return void(e.checkUpload=!0);if(n||e.checkUpload)return $(".ng-invalid:eq(1)").focus(),void(!e.asset.thumbnailsCustom||"undefined"!=typeof e.asset.thumbnailsWidth&&null!=e.asset.thumbnailsWidth&&"undefined"!=typeof e.asset.thumbnailsHeight&&null!=e.asset.thumbnailsHeight||alert("Min height is 1 pixels and min width is 1 pixels"));if(!e.filesUpload.checkImage||"undefined"!=typeof e.asset.filename&&null!=e.asset.filename&&e.asset.filename){if(e.filesUpload.checkImage||(e.asset.alt_tag=null,e.asset.description=null,e.asset.title=null),"image"==e.asset.type&&e.asset.withFile&&e.asset.heightFile){if(e.asset.thumbnailsMedium&&e.asset.withFile<100&&e.asset.heightFile<100)return void alert("Max height is "+e.asset.heightFile+" pixels and Max width is "+e.asset.withFile+" pixels");if(e.asset.thumbnailsProduct&&e.asset.withFile<82&&e.asset.heightFile<82)return void alert("Max height is "+e.asset.heightFile+" pixels and Max width is "+e.asset.withFile+" pixels");if(e.asset.thumbnailsMaterial&&e.asset.withFile<75&&e.asset.heightFile<75)return void alert("Max height is "+e.asset.heightFile+" pixels and Max width is "+e.asset.withFile+" pixels");if(e.asset.thumbnailsSmall&&e.asset.withFile<64&&e.asset.heightFile<64)return void alert("Max height is "+e.asset.heightFile+" pixels and Max width is "+e.asset.withFile+" pixels");if(e.asset.thumbnailsCustom&&(!e.asset.thumbnailsHeight||!e.asset.thumbnailsWidth))return void alert("Height and width is a required field");if(e.asset.thumbnailsCustom&&(e.asset.withFile<e.asset.thumbnailsWidth||e.asset.heightFile<e.asset.thumbnailsHeight))return void alert("Max height is "+e.asset.heightFile+" pixels and Max width is "+e.asset.withFile+" pixels")}e.showLoad=!0,$("#page-loading").css("display","block"),a.upload({method:"POST",url:baseUrl+"/api/asset-manager/edit-file",file:e.filesUpload.listsFiles,data:e.asset}).success(function(n,a,i,o){e.showLoad=!1,$("#page-loading").css("display","none"),t.close(n.item)})}},e.cancel=function(){t.dismiss("cancel")},e.checkWithHeightValidate=function(t){var n=new FileReader;n.readAsDataURL(t[0]),n.onload=function(t){var n=new Image;n.src=t.target.result,n.onload=function(){e.asset.withFile=this.width,e.asset.heightFile=this.height}}}}]).controller("ModalViewAssetManagerCtrl",["$scope","$modalInstance",function(e,t){e.cancel=function(){t.dismiss("cancel")}}]).controller("CreateNewAssetCtrl",["$scope","$modalInstance","AssetManagerService",function(e,t,n){e.showLoad=!1,e.submit=function(a){return e.submitted=!0,a?void $(".ng-invalid:eq(1)").focus():void("undefined"!=typeof e.asset.folder&&(e.showLoad=!0,e.asset.type=e.folderType[e.asset.folder],n.createNewAsset(e.asset).then(function(n){
e.showLoad=!1,t.close(n)})))},e.cancel=function(){t.dismiss("cancel")}}]).controller("editNameFolderAssetCtrl",["$scope","$modalInstance","AssetManagerService","$http","$q",function(e,t,n,a,i){e.checkFirstName=function(t){return""==t?"The first name is a required field":(e.userProfile.first_name=t,void e.updateUser())},e.checkEmtypeName=function(n){if(""==n)return"The folder name is a required field";e.folder.name=n;var o=i.defer();return a.post("/api/asset-manager/edit-name-folder",{data:e.folder}).success(function(e){e=e||{},e.status?(o.resolve(),t.close(e)):o.resolve("Name has already been taken.")}).error(function(e){o.reject("Server error!")}),o.promise}}]).controller("ModalUploadNewVersion",["$scope","$modalInstance","AssetManagerService",function(e,t,n){e.showLoad=!1,e.cancel=function(){t.dismiss("cancel")},e.updateNewVerSionFile=function(){e.showLoad=!0,n.updateContentFile(e.asset).then(function(n){e.showLoad=!1,t.close(n)})}}]);var requestAsset=angular.module("assetManager");requestAsset.factory("RequestAssetResource",["$resource",function(e){return e("/api/asset-manager/:method/:id",{method:"@method",id:"@id"},{add:{method:"post"},save:{method:"post"},update:{method:"put"}})}]),requestAsset.service("RequestAssetService",["RequestAssetResource","$q",function(e,t){var n=this,a=[];this.requestAssetFile=function(a){if("undefined"!=typeof a._id&&"request_translation"==a.modal)return n.requestTranslation(a);if("undefined"!=typeof a._id&&"request_region"==a.modal)return n.requestRegion(a);var i=t.defer(),o=new e(a);return o.$save({},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.requestTranslation=function(n){var i=t.defer(),o=new e(n);return o.$save({method:"request-translation"},function(e){0!=e.status&&a.push(e.page),i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.requestRegion=function(n){var a=t.defer(),i=new e(n);return i.$save({method:"request-region"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.requestRevision=function(n){var a=t.defer(),i=new e(n);return i.$save({method:"request-revision"},function(e){0!=e.status&&a.resolve(e)},function(e){a.resolve(e.data)}),a.promise}}]);var requestAsset=angular.module("assetManager");requestAsset.controller("RequestAssetController",["$scope","$modal","ngTableParams","$filter","$timeout",function(e,t,n,a,o){e.getParentFolder=function(){var t=$("#tree").fancytree("getTree"),n=t.getActiveNode();n&&(0==n.folder||angular.isUndefined(n.folder)?(e.selectedItemName=n.getParent().title,e.selectedItemId=n.getParent().key):"0"==n.data.parent_id?(e.selectedItemName="",e.selectedItemId=""):(e.selectedItemName=n.title,e.selectedItemId=n.key))};var r=!1;e.getModalRequestNewAsset=function(){if(!r){nodeSelected=$("#tree").fancytree("getTree").getSelectedNodes();var n="";nodeSelected.length>0&&(n=nodeSelected[0].key),e.getParentFolder();var a=t.open({animation:e.animationsEnabled,templateUrl:window.baseUrl+"/cms/asset-manager/create?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName+"&&v="+(new Date).getTime(),controller:"ModalRequestAssetController",size:null,resolve:{folder_id:function(){return n}}});r=!0,a.result.then(function(t){var n=t.asset;n.title=n.name,n.key=n._id,r=!1,node=$("#tree").fancytree("getTree").getNodeByKey(n.folder_id),n=e.addSummaryNameForNode(n),null!=node&&(node.addChildren(n),nodeAdded=$("#tree").fancytree("getTree").getNodeByKey(n._id),nodeAdded.setActive(),node.sortChildren(null,!0))},function(){r=!1})}},e.addSummaryNameForNode=function(e){if($data=e,angular.isUndefined($data.name))var t=$data.title.split(" ");else var t=$data.name.split(" ");return t.length>=2?$data.summaryName=t[0]+" "+t[1]:$data.summaryName=t[0],$data},e.getModalRequestTranslationAsset=function(n){if(!r){e.getParentFolder();var a="/cms/asset-manager/request-translation/"+n+"?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName+"&&v="+(new Date).getTime(),o=t.open({templateUrl:window.baseUrl+a,controller:"ModalRequestAssetController",size:void 0,resolve:{folder_id:function(){return null}}});r=!0,o.result.then(function(t){r=!1;for(i in t.asset)node=$("#tree").fancytree("getTree").getNodeByKey(t.asset[i].file_id),node.data.subFiles.push(t.asset[i]),"n/a"==node.data.language?node.data.language=1:node.data.language=parseInt(node.data.language)+1,"n/a"==node.data.due_date||"undefined"==typeof node.data.due_date?node.data.due_date=t.asset[i].due_date:node.data.due_date>t.asset[i].due_date&&(node.data.due_date=t.asset[i].due_date),node.data.status="waiting-approve",e.tableParams.reload()},function(){r=!1})}},e.getModalRequestRegionAsset=function(n){if(!r){e.getParentFolder();var a="/cms/asset-manager/request-region/"+n+"?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName+"&&v="+(new Date).getTime(),o=t.open({templateUrl:window.baseUrl+a,controller:"ModalRequestAssetController",size:void 0,resolve:{folder_id:function(){return null}}});r=!0,o.result.then(function(t){r=!1;for(i in t.assets)node=$("#tree").fancytree("getTree").getNodeByKey(t.assets[i].file_id),node.data.region=t.countUniqueRegion,node.data.subFiles.push(t.assets[i]),"n/a"==node.data.due_date||"undefined"==typeof node.data.due_date?node.data.due_date=t.assets[i].due_date:node.data.due_date>t.assets[i].due_date&&(node.data.due_date=t.assets[i].due_date),node.data.status="waiting-approve",e.tableParams.reload()},function(){r=!1})}}}]),requestAsset.controller("ModalRequestAssetController",["$scope","$modal","$filter","$modalInstance","folder_id","RequestAssetService",function(e,t,n,a,i,o){e.languages_selected={},e.requiredLanguage=!0,e.requiredRegion=!0,e.regions_selected={},"undefined"==typeof e.asset&&(e.asset={},e.asset.folder_id="root"==i?"":i),e.format="MM-dd-yyyy",e.minDate=new Date,e.open=function(t,n){t.preventDefault(),t.stopPropagation(),e.opened={},e.opened[n]=!0},e.initRedactor=function(){$("#content").redactor({plugins:["table",1==window.isAdvancedEditingFeatures?"source":""],imageUpload:"/content/upload",callbacks:{modalOpened:function(e,t){if("link"!=e||this.observe.isCurrent("a")){if("link"==e){var n=this.link.$node.attr("rel");"undefined"==typeof n?$('<label><input type="checkbox" id="redactor-link-no-follow"> No Follow</label>').insertAfter($("#redactor-link-blank").parent()):$('<label><input type="checkbox" checked id="redactor-link-no-follow"> No Follow</label>').insertAfter($("#redactor-link-blank").parent())}}else $("#redactor-link-blank").attr("checked","true"),$('<label><input type="checkbox" checked id="redactor-link-no-follow"> No Follow</label>').insertAfter($("#redactor-link-blank").parent())},insertedLink:function(e){var t=$(e).attr("href");"http"!=t.substring(0,4)&&"https"!=t.substring(0,5)&&"ftp"!=t.substring(0,3)&&$(e).attr("href","http://"+t),$("#redactor-link-no-follow").prop("checked")?e.attr("rel","nofollow"):e.removeAttr("rel")},linkify:function(e){e.attr("target","_blank")},change:function(){$content=$("#content").redactor("code.get"),e.$apply(function(){"<div></div>"==$content||""==$content||"<br>"==$content||"<div><strong></strong></div>"==$content||"<div><em></em><strong></strong></div>"==$content||"<div><em><del></del></em></div>"==$content?e.requiredDescription=!0:e.requiredDescription=!1})}},linkSize:1e3,minHeight:200})},e.submit=function(t){return e.requiredDescription=!1,e.submitted=!0,$content=$("#content").redactor("code.get"),"<div></div>"!=$content&&""!=$content&&"<br>"!=$content&&"<div><strong></strong></div>"!=$content&&"<div><em></em><strong></strong></div>"!=$content&&"<div><em><del></del></em></div>"!=$content||(e.requiredDescription=!0),t||e.requiredDescription||!e.asset.folder_id?void $(".ng-invalid:eq(1)").focus():"request_translation"==e.asset.modal&&e.requiredLanguage?void $(".ng-invalid:eq(1)").focus():"request_region"==e.asset.modal&&e.requiredRegion?void $(".ng-invalid:eq(1)").focus():(files_id=[],"undefined"!=typeof e.filesUpload&&(files_id=e.filesUpload.ids),e.asset.files_id=files_id,$("#btnSubmit").attr("disabled","true"),e.asset.description=$content,e.asset.meta=$content,e.asset._id&&"request_translation"==e.asset.modal&&(e.asset.languages=e.languages_selected),e.asset._id&&"request_region"==e.asset.modal&&(e.asset.regions=e.regions_selected),e.asset.status="waiting-approve",void o.requestAssetFile(e.asset).then(function(t){0==t.status?($("#btnSubmit").removeAttr("disabled"),e.checkName=!0,$(".name").focus()):a.close(t)}))},e.cancel=function(){a.dismiss("cancel")}}]),assetmanagerApp.directive("uploadFileAsset",["$timeout","Upload",function(e,t){return{restrict:"EA",require:"^ngModel",scope:{files:"=",fileIds:"=",openPicture:"&",disabled:"=",accept:"=",folder:"=",assetEdit:"="},replace:!0,transclude:!0,templateUrl:baseUrl+"/app/components/assetmanagers/views/file-upload.html?v="+(new Date).getTime(),link:function(e,n,a,i){function o(e){var t=["png","gif","jpg","jpeg","jpe"],n=["css"],a=["video"],i=["javascript"];if("undefined"!=typeof e){if(-1!=t.indexOf(e.split("/")[1]))return"images";if(-1!=n.indexOf(e.split("/")[1]))return"css";if(-1!=a.indexOf(e.split("/")[0]))return"video";if(-1!=i.indexOf(e.split("/")[1]))return"js";switch(e.split("/")[1]){case"zip":return"zip";case"pdf":return"pdf";case"msword":return"msword";default:return"other"}}}function r(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}"one"==a.ngMultiple&&(e.uploadMultiple="one");e.$watch("assetEdit",function(t,n){if(!angular.isUndefined(t)&&!angular.isUndefined(t.filename)){var a=[];e.listsFiles=[];var o=[];if(a.uniId=r(),a.proccess=100,a.error=0,e.checkCurrent=!1,a.name=t.filename,a.file_name=t.filename,e.fileUpload[a.uniId]=a,e.fileUploadIds=a.uniId,o._id=t._id,o.name=t.filename,e.listsFiles[0]=o,"image"===t.type&&(t.type="images"),"images"===t.type){var l=!0;i.$setViewValue({fileUploadIds:e.fileUploadIds,listsFiles:e.listsFiles,finished:e.uploadFinish,checkImage:l})}else i.$setViewValue({fileUploadIds:e.fileUploadIds,listsFiles:e.listsFiles,finished:e.uploadFinish})}});var l=0;e.baseUrl=baseUrl,e.fileUpload={},e.fileUploaded=[],e.fileUploadIds=[],e.listsFiles=[],e.fileError={},e.uploadFinish=!0,i.$setViewValue({finished:e.uploadFinish}),e.numberFileUpload=[],e.upload=function(n){if(n&&n.length){l++;for(var a=0;a<n.length;a++)!function(a){var l=["txt","htm","html","php","css","js","json","xml","swf","flv","png","jpe","jpeg","jpg","gif","bmp","ico","tiff","tif","svg","svgz","zip","rar","exe","msi","cab","mp3","mp4","qt","mov","pdf","psd","ai","eps","ps","doc","docx","rtf","xls","ppt","pptx","odt","ods"],s=n[a],d=s.name.split("."),c=d.slice(-1).pop();return-1==l.indexOf(c.toLowerCase())||"php"==c.toLowerCase()?void alert("System dont support this type file"):angular.isUndefined(e.folder)?void alert("chosse folder"):"other"!=e.folder&&e.folder!=o(s.type)?void alert("chosse file    "+e.folder):(e.uploadFinished=!1,i.$setViewValue({finished:e.uploadFinished,checkImage:!1}),e.listsFiles=[],s.size>0&&(e.checkCurrent=!0),s.size>window.maxUpload.size?(e.fileUpload={},s.uniId=r(),s.proccess=100,s.error=1,s.status=0,e.fileUpload[s.uniId]=s,e.fileUpload[s.uniId].error="Max file size is "+window.maxUpload.name,e.fileError[s.uniId]=s,void i.$setViewValue({finished:!0})):(s.uniId=r(),s.proccess=0,s.error="",e.fileUpload={},e.listsFiles.push(s),i.$setViewValue({listsFiles:e.listsFiles}),e.fileUpload[s.uniId]=s,void t.upload({method:"POST",url:baseUrl+"/upload-new-asset/file",file:s,data:e.listsFiles}).progress(function(t){var n=parseInt(100*t.loaded/t.total);e.fileIsUploading=!0,angular.isDefined(e.fileUpload[s.uniId])&&(e.fileUpload[s.uniId].proccess=n,e.uploadFinished=!1,i.$setViewValue({finished:e.uploadFinished}))}).error(function(t,i,o,r){n.splice(1,a);for(var l in e.listsFiles)s.uniId==e.listsFiles[l].uniId&&e.listsFiles.splice(l,1);angular.isDefined(e.fileUpload[s.uniId])&&(angular.isDefined(t.message)&&(e.fileUpload[s.uniId].error=t.message),e.fileError[r.file.uniId]=r.file,e.fileError[r.file.uniId].status=t.status)}).success(function(t,n,a,o){e.uploadFinished=!0,i.$setViewValue({finished:e.uploadFinished}),e.fileUploaded=o.file.uniId,e.fileUploadIds=o.file})["finally"](function(){if(e.uploadFinished=!0,"images"==o(e.listsFiles[0].type))var t=!0;i.$setViewValue({fileUploadIds:e.fileUploadIds,listsFiles:e.listsFiles,finished:e.uploadFinish,checkImage:t})})))}(a)}},i.$render=function(){e.filesUpload=i.$viewValue},e.checkFile=function(e){return o(e)},e.$on("emptyFiles",function(t,n){e.fileUpload={},e.listsFiles=[],e.fileUploaded=[],e.fileUploadIds=[]})}}}]).filter("bytes",function(){return function(e,t){if(isNaN(parseFloat(e))||!isFinite(e))return"-";"undefined"==typeof t&&(t=1);var n=["bytes","kB","MB","GB","TB","PB"],a=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,Math.floor(a))).toFixed(t)+" "+n[a]}});var TemplateContentManagerModule=angular.module("TemplateContentManager",["toggle-switch"]);TemplateContentManagerModule.controller("TemplateContentManagerCtr",["$scope","$modal","$filter","$timeout","ngTableParams","TemplateContentManagerService","CmsContentFolderService","$templateCache","CmsService",function(e,t,n,a,o,r,l,s,d){e.size=function(){d.setHeightTable()},e.isShowNested=!0,e.isShowBtnDelete=!1,e.isShowBtnEditNameFolder=!1,s.remove("cms/template-content-manager/template"),e.baseUrl=window.baseUrl,e.pageSelected=window.idOfTemplateSelected,e.tagsContent=angular.copy(window.tagsContent),e.allTags=angular.copy(window.allTags),e.templates=l.setContents(angular.copy(window.folders),window.currentPage),e.contentHideOrShowAllNestedContent="Show All Nested Content",angular.isUndefined(e.templates)&&(e.templates=[]),e.tableParams=new o({page:1,count:100,sorting:{id:"desc"},filter:{}},{total:e.templates.length,getData:function(t,a){var i=a.sorting()?n("orderBy")(e.templates,a.orderBy()):e.templates;i=a.filter()?n("filter")(i,a.filter()):i,a.total(i.length),t.resolve(i.slice((a.page()-1)*a.count(),a.page()*a.count()))}}),0!=e.pageSelected&&l.setActiveNode(e.pageSelected),l.initTree(function(t,n){e.templates=[],"Templates"==n.key?e.titleItemSelected="Templates":1==n.folder?e.titleItemSelected=n.title:angular.isUndefined(n.parent.data.name)?e.titleItemSelected="Templates":e.titleItemSelected=n.parent.data.name,angular.isDefined(t)&&1==t.length&&1!=n.folder?(t[0].expanded=!0,e.templates=t):angular.forEach(t,function(t,n){t.expanded=!1,e.templates.push(t)}),e.tableParams.reload(),angular.isDefined(e.tableParams.$params)&&(e.tableParams.$params.page=1),"0"!=n.data.parent_id?e.isShowBtnDelete=!0:e.isShowBtnDelete=!1,1==n.folder&&"0"!=n.data.parent_id?e.isShowBtnEditNameFolder=!0:e.isShowBtnEditNameFolder=!1}),e.btnSearch=function(){e.isSearch=!e.isSearch},e.hideOrShowAllNestedContent=function(){l.changeStatusHideOrShowAllNestedContent().then(function(t){e.contentHideOrShowAllNestedContent=t.textButton,"Show All Nested Content"==e.contentHideOrShowAllNestedContent?e.isShowNested=!0:e.isShowNested=!1,e.templates=t.contents,e.tableParams.reload()})},e.deleteFolderAndTemplate=function(){e.dsbBtnDelete=!0;var t=$("#tree").fancytree("getTree"),a=t.getActiveNode(),i=t.getRootNode();if(1==a.folder)var o=confirm(n("trans")("confirm-delete-folder","golbal"));else var o=confirm(n("trans")("confirm-delete-content","golbal"));return 1!=o?void(e.dsbBtnDelete=!1):void("0"!=a.data.parent_id&&r.deleteFolderAndTemplate(a.data._id).then(function(t){a.remove(),rootNodeOfNodeActive=_.find(i.children,function(e){return"Templates"==e.title}),rootNodeOfNodeActive.setActive(),e.dsbBtnDelete=!1}))},e.deleteFileTemplate=function(t,n){r.deleteTemplateFile(t).then(function(a){0!=a.status&&(angular.isUndefined(a.result)||(n.region=a.result.countUniqueRegion,n.language=a.result.countUniqueLanguage,n.status=a.result.status),angular.forEach(n.subFiles,function(e,a){e._id==t&&n.subFiles.splice(a,1)}),e.tableParams.reload())})},e.editNameFolder=function(){var n=$("#tree").fancytree("getTree"),a=n.getActiveNode();if(a){var i="/cms/template-content-manager/edit-name-folder/"+a.data._id+"?v="+(new Date).getTime(),o=t.open({animation:e.animationsEnabled,templateUrl:window.baseUrl+i,controller:"editNameFolderTemplateCtrl",size:null,resolve:{}});o.result.then(function(t){a.setTitle(t.folder.name),a.setActive(),a.getParent().sortChildren(null,!0),e.tableParams.reload(),e.titleItemSelected=t.folder.name},function(){})}},e.showGroup=function(e,t){var n=($(".group-btn-ac").outerHeight(),$(window).outerWidth()),a=$(window).outerHeight(),i=e.pageY,o=a-i;300>o&&$(".wrap-ac-group").each(function(e){$(this).addClass("show-top")}),$(".wrap-ac-group").each(function(e){$(this).removeClass("ac-up")}),$(e.target).parent().toggleClass("ac-up"),$(".group-btn-ac").hasClass("fix-missing-li")?$(".group-btn-ac").css({top:e.pageY-65+"px",right:n-e.pageX-30+"px"}):$(".group-btn-ac").css({top:e.pageY-200+"px",right:n-e.pageX-30+"px"}),$(document).on("click",function r(e){$(e.target).closest("tr").siblings().find(".wrap-ac-group").removeClass("ac-up"),0===$(".wrap-ac-group").has(e.target).length?($(".wrap-ac-group").removeClass("ac-up"),$(".wrap-ac-group").removeClass("show-top")):$(document).one("click",r)}),angular.element(".table-responsive").addClass("fix-height")},e.getParentFolder=function(){var t=$("#tree").fancytree("getTree"),n=t.getActiveNode();n&&(0==n.folder||angular.isUndefined(n.folder)?(e.selectedItemName=n.getParent().title,e.selectedItemId=n.getParent().key):(e.selectedItemName=n.title,e.selectedItemId=n.key))};var c=!1;e.getModalCreateTemplateContentManager=function(n){if(!c){e.getParentFolder();var a="/cms/template-content-manager/new?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName+"&&v="+(new Date).getTime();if("undefined"!=typeof n)var a="/cms/template-content-manager/update-template/"+n+"?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName+"&&v="+(new Date).getTime();var i=t.open({templateUrl:a,controller:"ModalCreateUseCreateTemplateContentManager",size:void 0,resolve:{listCheckBox:function(){return e.listCheckBox},maxUpload:function(){return window.maxUpload},listIdCheck:function(){return e.listIdCheck}}});c=!0,i.result.then(function(e){c=!1,e.title=e.name,e.key=e._id,node=$("#tree").fancytree("getTree").getNodeByKey(String(e.folder_id)),null!=node&&(node.addChildren(e),node.setActive(!1),node.setActive(),node.sortChildren(null,!0))},function(){c=!1})}},e.addTagsForPage=function(t,n){$("#page-loading").css("display","block"),e.tagId=n,r.addTagsForPage(t,{tags:e.tagId}).then(function(t){for(var n in e.templates)if(e.templates[n].data._id==t.item._id){e.templates[n].data.tags=t.item.tags;break}$("#page-loading").css("display","none"),e.tableParams.reload()})},e.getModalRequestProposeNewTemplate=function(){if(!c){e.getParentFolder();var n="/cms/template-content-manager/request-propose-new-template?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName+"&&v="+(new Date).getTime(),a=t.open({templateUrl:window.baseUrl+n,controller:"ModalRequestProposeNewTemplate",size:void 0,resolve:{}});c=!0,a.result.then(function(e){c=!1,e.title=e.name,e.key=e._id,node=$("#tree").fancytree("getTree").getNodeByKey(e.folder_id),null!=node&&(node.addChildren(e),node.setActive(!1),node.setActive(),node.sortChildren(null,!0))},function(){c=!1})}},e.createFolderTemplate=function(){if(!c){e.getParentFolder();var n="/cms/template-content-manager/create-folder?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName+"&&v="+(new Date).getTime(),a=t.open({templateUrl:window.baseUrl+n,controller:"ModalCreateFolderTemplateCtrl",size:void 0,resolve:{}});c=!0,a.result.then(function(e){c=!1;var t=$("#tree").fancytree("getTree");if("0"==e.parent_id)var n=t.getNodeByKey("0");else var n=t.getNodeByKey(e.parent_id);var a=n.addChildren(e);a.setExpanded(),n.sortChildren(null,!0)},function(){c=!1})}},e.viewThumbnail=function(n){var a=window.baseUrl+"/app/components/template-content-manager/modal/viewImage.html?v="+(new Date).getTime();t.open({animation:e.animationsEnabled,templateUrl:a,controller:"viewThumbnail",size:null,resolve:{path:function(){return window.baseUrl+"/admin/file/"+n}}})},e.getModalRequestTranslationTemplate=function(n,a){var o=[];if(!c){e.getParentFolder(),angular.forEach(a,function(e,t){"en"==e.language&&null==e.region&&(o=e)});var r="/cms/template-content-manager/request-translation/"+n+"?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName+"&&v="+(new Date).getTime(),l=t.open({templateUrl:window.baseUrl+r,controller:"ModalRequesTemplatetController",size:void 0,resolve:{folder_id:function(){return null},subFile:function(){return o}}});c=!0,l.result.then(function(t){c=!1;for(i in t.templates)node=$("#tree").fancytree("getTree").getNodeByKey(t.templates[i].base_id),node.data.subFiles.push(t.templates[i]),"n/a"==node.data.language?node.data.language=1:node.data.language=parseInt(node.data.language)+1,"n/a"==node.data.due_date||"undefined"==typeof node.data.due_date?node.data.due_date=t.templates[i].due_date:node.data.due_date>t.templates[i].due_date&&(node.data.due_date=t.templates[i].due_date),node.data.status="waiting-approve",e.tableParams.reload()},function(){c=!1})}},e.getModalRequestRegionTemplate=function(n,a){if(!c){e.getParentFolder();var o="/cms/template-content-manager/request-region/"+n+"?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName+"&&v="+(new Date).getTime(),r=t.open({templateUrl:window.baseUrl+o,controller:"ModalRequesTemplatetController",size:void 0,resolve:{folder_id:function(){return null},subFile:function(){return a}}});c=!0,r.result.then(function(t){c=!1;for(i in t.templates)node=$("#tree").fancytree("getTree").getNodeByKey(t.templates[i].base_id),node.data.region=t.countUniqueRegion,node.data.subFiles.push(t.templates[i]),"n/a"==node.data.due_date||"undefined"==typeof node.data.due_date?node.data.due_date=t.templates[i].due_date:node.data.due_date>t.templates[i].due_date&&(node.data.due_date=t.templates[i].due_date),node.data.status="waiting-approve",e.tableParams.reload()},function(){c=!1})}}}]).controller("ModalCreateFolderTemplateCtrl",["$scope","$modalInstance","TemplateContentManagerService",function(e,t,n){e.changeName=function(){e.nameExists=!1},e.submit=function(a){e.submitted=!0,e.nameExists=!1,a||(angular.element("#page-loading").css("display","block"),n.createFolderProvider(e.folder).then(function(n){return angular.element("#page-loading").css("display","none"),0==n.status?void(e.nameExists=!0):(e.nameExists=!1,void t.close(n.item))}))},e.cancel=function(){t.dismiss("cancel")}}]).controller("ModalRequesTemplatetController",["$scope","$modal","$filter","$modalInstance","folder_id","TemplateContentManagerService","subFile","$timeout",function(e,t,n,a,i,o,r,l){e.languages_selected={},e.requiredLanguage=!0,e.requiredRegion=!0,e.regions_selected={},l(function(){e.template=window.template,e.folders=window.folders},500),e.format="MM-dd-yyyy",e.minDate=new Date,e.open=function(t,n){t.preventDefault(),t.stopPropagation(),e.opened={},e.opened[n]=!0},e.initRedactor=function(){$("#content").redactor({plugins:["table",1==window.isAdvancedEditingFeatures?"source":""],imageUpload:"/content/upload",callbacks:{modalOpened:function(e,t){if("link"!=e||this.observe.isCurrent("a")){if("link"==e){var n=this.link.$node.attr("rel");"undefined"==typeof n?$('<label><input type="checkbox" id="redactor-link-no-follow"> No Follow</label>').insertAfter($("#redactor-link-blank").parent()):$('<label><input type="checkbox" checked id="redactor-link-no-follow"> No Follow</label>').insertAfter($("#redactor-link-blank").parent())}}else $("#redactor-link-blank").attr("checked","true"),$('<label><input type="checkbox" checked id="redactor-link-no-follow"> No Follow</label>').insertAfter($("#redactor-link-blank").parent())},insertedLink:function(e){var t=$(e).attr("href");"http"!=t.substring(0,4)&&"https"!=t.substring(0,5)&&"ftp"!=t.substring(0,3)&&$(e).attr("href","http://"+t),$("#redactor-link-no-follow").prop("checked")?e.attr("rel","nofollow"):e.removeAttr("rel")},linkify:function(e){e.attr("target","_blank")},change:function(){$content=$("#content").redactor("code.get"),e.$apply(function(){"<div></div>"==$content||""==$content||"<br>"==$content||"<div><strong></strong></div>"==$content||"<div><em></em><strong></strong></div>"==$content||"<div><em><del></del></em></div>"==$content?e.requiredDescription=!0:e.requiredDescription=!1})}},linkSize:1e3,minHeight:200})},e.submit=function(t){return e.requiredDescription=!1,e.submitted=!0,$content=$("#content").redactor("code.get"),"<div></div>"!=$content&&""!=$content&&"<br>"!=$content&&"<div><strong></strong></div>"!=$content&&"<div><em></em><strong></strong></div>"!=$content&&"<div><em><del></del></em></div>"!=$content||(e.requiredDescription=!0),t||e.requiredDescription?void $(".ng-invalid:eq(1)").focus():"request_translation"==e.template.modal&&e.requiredLanguage?void $(".ng-invalid:eq(1)").focus():"request_region"==e.template.modal&&e.requiredRegion?void $(".ng-invalid:eq(1)").focus():e.template.parent_id?void $(".ng-intemplatevalid:eq(0)").focus():(files_id=[],"undefined"!=typeof e.filesUpload&&(files_id=e.filesUpload.ids),e.template.files_id=files_id,$("#btnSubmit").attr("disabled","true"),e.template.description=$content,e.template.meta=$content,e.template._id&&"request_translation"==e.template.modal&&(e.template.languages=e.languages_selected),e.template._id&&"request_region"==e.template.modal&&(e.template.regions=e.regions_selected),e.template.status="waiting-approve",e.template.copyTemplate=r._id,angular.element("#page-loading").css("display","block"),void o.requestTemplate(e.template).then(function(t){angular.element("#page-loading").css("display","none"),0==t.status?($("#btnSubmit").removeAttr("disabled"),e.checkName=!0,$(".name").focus()):a.close(t)}))},e.cancel=function(){a.dismiss("cancel")}}]).controller("ModalCreateUseCreateTemplateContentManager",["$scope","$modalInstance","$controller","Upload","TemplateContentManagerService","listCheckBox","maxUpload","listIdCheck",function(e,t,n,a,i,o,r,l){e.template={},e.listCheckBox=o,e.listIdCheck=l,e.stepFirst=!0,e.sectionLengh=0,e.stepSection=0,e.template.sections=[],e.submittedSection=[],e.listMapType=window.listMapType,e.extError=!1,e.uploadFileTemplate=function(t){if(e.extError=!1,t&&t.length){var n=t[0].name.split("."),i=n.pop(),o=["txt","php","html"],l=o.indexOf(i);if(-1==l)return void(e.extError=!0);if(t[0].size>r.size)return void(e.error="Max file size is "+r.name);e.wating="uploading file",a.upload({url:baseUrl+"/cms/template-content-manager/parsing-file",file:t}).progress(function(t){e.isErrorUploadFile=!0}).success(function(n,a,i,o){e.wating=t[0].name,e.isErrorUploadFile=!1,e.error="",e.result=n}).error(function(t){e.template.reciept_file_name="",e.error=t.message,e.isErrorUploadFile=!0})}},e.uploadThumbnail=function(t){if(t&&t.length){if(t[0].size>r.size)return void(e.errorThumbnail="Max file size is "+r.name);e.reciept_file_name="uploading file",a.upload({url:baseUrl+"/admin/file",method:"POST",file:t,fields:{store:"template-content-manager"}}).progress(function(t){e.isErrorUploadFile=!0}).success(function(n,a,i,o){e.isErrorUploadFile=!1,e.template.thumbnail=n.item.id,e.reciept_file_name=t[0].name,e.errorThumbnail=""}).error(function(t){e.template.reciept_file_name="",e.errorThumbnail=t.message,e.isErrorUploadFile=!0})}},e.loadingFile=[],e.errorThumbnailSection=[],e.uploadThumbnailSection=function(t,n){if(t&&t.length){if(t[0].size>r.size)return void(e.errorThumbnailSection[n]="Max file size is "+r.name);e.loadingFile[n]="uploading file",a.upload({url:baseUrl+"/admin/file",method:"POST",file:t,fields:{store:"template-content-manager"}}).progress(function(t){e.isErrorUploadFile=!0}).success(function(a,i,o,r){e.isErrorUploadFile=!1,e.template.sections[n].thumbnail=a.item.id,e.loadingFile[n]=t[0].name,e.errorThumbnailSection[n]=""}).error(function(t){e.loadingFile[n]="",e.errorThumbnailSection[n]=t.message})}},e.eventNextStepSecond=function(t){e.submitStepSecond=!0,t||!e.result||0==e.result.status||0==e.result.fields.length&&0==e.result.sections.length||!e.template.folder_id||(0==e.result.sections.length?(e.stepFirst=!1,e.eventNextStepThird()):(e.stepFirst=!1,e.stepSecond=!0,e.sectionLenght=e.result.sections.length))},e.eventNextStepSection=function(t){e.submittedSection[e.stepSection]=!0,!t&&e.template.sections[e.stepSection].thumbnail&&(e.stepSection<e.sectionLenght-1?e.stepSection++:e.eventNextStepThird())},e.prevStepSection=function(){e.stepSection>0?e.stepSection--:e.prevStepFirst()},e.eventNextStepThird=function(){angular.element("#model-template-content").hide(),e.configFields(function(n){angular.isUndefined(n)?t.dismiss("cancel"):(e.template.fields=n,e.createTemplateContentManager(2))},e.result.fields)},e.hiddenE=function(){e.errorMax=""},e.prevStepFileld=function(t){e.curStepField=t-1},e.eventPrevStepSecond=function(){0==e.result.sections.length?(e.stepFirst=!0,e.stepThird=!1):(e.stepSecond=!0,e.stepThird=!1)},e.prevStepFirst=function(){e.stepFirst=!0,e.stepSecond=!1},e.createTemplateContentManager=function(n,a){return e.submitStepSecond=!1,a||!e.template.folder_id?void(e.submitStepSecond=!0):(angular.element("#page-loading").css("display","block"),void i.create(e.template).then(function(e){angular.element("#page-loading").css("display","none"),e.status&&t.close(e.template)}))},e.cancel=function(){t.dismiss("cancel")},e.checkIterable=function(t,n){t||(delete e.template.fields[n].min_field,delete e.template.fields[n].max_field)}}]).controller("ModalRequestProposeNewTemplate",["$scope","$modalInstance","$timeout","Upload","$filter","TemplateContentManagerService",function(e,t,n,a,i,o){e.template={},e.format="MM-dd-yyyy",e.minDate=new Date,e.open=function(t,n){t.preventDefault(),t.stopPropagation(),e.opened={},e.opened[n]=!0},e.initRedactor=function(){$("#content").redactor({plugins:["table",1==window.isAdvancedEditingFeatures?"source":""],imageUpload:"/content/upload",callbacks:{modalOpened:function(e,t){if("link"!=e||this.observe.isCurrent("a")){if("link"==e){var n=this.link.$node.attr("rel");"undefined"==typeof n?$('<label><input type="checkbox" id="redactor-link-no-follow"> No Follow</label>').insertAfter($("#redactor-link-blank").parent()):$('<label><input type="checkbox" checked id="redactor-link-no-follow"> No Follow</label>').insertAfter($("#redactor-link-blank").parent())}}else $("#redactor-link-blank").attr("checked","true"),$('<label><input type="checkbox" checked id="redactor-link-no-follow"> No Follow</label>').insertAfter($("#redactor-link-blank").parent())},insertedLink:function(e){var t=$(e).attr("href");"http"!=t.substring(0,4)&&"https"!=t.substring(0,5)&&"ftp"!=t.substring(0,3)&&$(e).attr("href","http://"+t),$("#redactor-link-no-follow").prop("checked")?e.attr("rel","nofollow"):e.removeAttr("rel")},linkify:function(e){e.attr("target","_blank")},change:function(){$content=$("#content").redactor("code.get"),e.$apply(function(){"<div></div>"==$content||""==$content||"<br>"==$content||"<div><strong></strong></div>"==$content||"<div><em></em><strong></strong></div>"==$content||"<div><em><del></del></em></div>"==$content?e.requiredDescription=!0:e.requiredDescription=!1})}},linkSize:1e3,minHeight:200})},e.submitRequest=function(n){return e.requiredDescription=!1,e.submitted=!0,$content=$("#content").redactor("code.get"),"<div></div>"!=$content&&""!=$content&&"<br>"!=$content&&"<div><strong></strong></div>"!=$content&&"<div><em></em><strong></strong></div>"!=$content&&"<div><em><del></del></em></div>"!=$content||(e.requiredDescription=!0),n||e.requiredDescription?void $(".ng-invalid:eq(1)").focus():void("undefined"!=typeof e.template.folder_id&&(files_id=[],"undefined"!=typeof e.filesUpload&&(files_id=e.filesUpload.ids),e.template.files_id=files_id,$("#btnSubmit").attr("disabled","true"),e.template.description=$content,e.template.status="waiting-approve",angular.element("#page-loading").css("display","block"),o.requestProposeNewTemplate(e.template).then(function(n){
angular.element("#page-loading").css("display","none"),0==n.status?($("#btnSubmit").removeAttr("disabled"),e.checkName=!0,$(".name").focus()):t.close(n.template)})))},e.cancel=function(){t.dismiss("cancel")}}]).controller("viewThumbnail",["$scope","$modalInstance","path",function(e,t,n){e.path=n,e.cancel=function(){t.dismiss("cancel")}}]).controller("editNameFolderTemplateCtrl",["$scope","$modalInstance","TemplateContentManagerService","$http","$q",function(e,t,n,a,i){e.checkFirstName=function(e){return""==e?"The first name is a required field":void 0},e.checkEmtypeName=function(n){if(""==n)return"The folder name is a required field";e.folder.name=n;var o=i.defer();return a.post("/api/template-content-manager/edit-name-folder",{data:e.folder}).success(function(e){e=e||{},e.status?(o.resolve(),t.close(e)):o.resolve("Name has already been taken.")}).error(function(e){o.reject("Server error!")}),o.promise}}]);var TemplateContentManagerModule=angular.module("TemplateContentManager");TemplateContentManagerModule.factory("TemplateContentManagerResource",["$resource",function(e){return e("/api/template-content-manager/:method/:id",{},{add:{method:"post"},save:{method:"post"},update:{method:"put"},editNameFolder:{method:"edit-name-folder"}})}]).service("TemplateContentManagerService",["$q","$filter","TemplateContentManagerResource",function(e,t,n){var a=[],i=[],o=this;this.createFolderProvider=function(t){var a=e.defer(),i=new n(t);return i.$save({method:"create-folder"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.setData=function(e){a=e},this.getData=function(){return a},this.setTemplateManagers=function(e){return i=e},this.setFiles=function(e){for(var t in e)files[e[t].id]=e[t]},this.addTagsForPage=function(t,a){var i=e.defer(),o=new n(a);return o.$save({id:t,method:"add-tags"},function(e){0!=e.status,i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.create=function(t){if("undefined"!=typeof t._id)return o.update(t);var i=e.defer(),r=new n(t);return r.$save({method:"upload-new-template"},function(e){e.status&&a.push(e.template),i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.update=function(t){var a=e.defer(),i=new n(t);return i.$update({id:t._id},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.requestProposeNewTemplate=function(t){var i=e.defer(),o=new n(t);return o.$save({},function(e){e.status&&a.push(e.template),i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.requestTemplate=function(e){return"undefined"!=typeof e._id&&"request_translation"==e.modal?o.requestTranslation(e):"undefined"!=typeof e._id&&"request_region"==e.modal?o.requestRegion(e):void 0},this.requestTranslation=function(t){var a=e.defer(),i=new n(t);return i.$save({method:"request-translation"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.requestRegion=function(t){var a=e.defer(),i=new n(t);return i.$save({method:"request-region"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.requestTranslation=function(t){var a=e.defer(),i=new n(t);return i.$save({method:"request-translation"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.parseContentConfigTemplate=function(t){var a=e.defer(),i=new n(t);return i.$save({method:"parse-content-config"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.deleteFolderAndTemplate=function(t){var a=e.defer(),i=new n;return i.$delete({id:t},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.deleteTemplateFile=function(t){var a=e.defer(),i=new n;return i.$get({id:t,method:"delete-file"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.editNameFolder=function(t){var a=e.defer(),i=new n(t);return i.$save({id:t.id,method:"edit-name-folder"},function(e){0!=e.status&&a.resolve(e)},function(e){a.resolve(e.data)}),a.promise}}]),TemplateContentManagerModule.directive("multiSelectTemplate",["$timeout",function(e){return{restrict:"EA",scope:{items:"=",itemsAssigned:"=",requiredItem:"=",placeholder:"@"},templateUrl:"/app/components/assetmanagers/views/view.html?v=2",link:function(e,t,n){e.assignItem=function(){if(e.test={},"undefined"!=e.selectedItemFrom){for(var t in e.selectedItemFrom){var n=e.selectedItemFrom[t];e.itemsAssigned[n]=e.items[n],delete e.items[n]}(1==e.requiredItem||angular.isUndefined(e.requiredItem))&&(angular.equals(e.itemsAssigned,e.test)||(e.requiredItem=!1)),e.selectedItemFrom=[]}},e.undoItem=function(){if(angular.isArray(e.items)&&(e.items={}),angular.isDefined(e.selectedItemTo)){if(0==e.selectedItemTo.length)return;for(var t in e.selectedItemTo){var n=e.selectedItemTo[t];e.items[n]=e.itemsAssigned[n],delete e.itemsAssigned[n]}(0==e.requiredItem||angular.isUndefined(e.requiredItem))&&angular.equals(e.itemsAssigned,e.test)&&(e.requiredItem=!0),e.selectedItemTo=[]}}}}}]);var blockApp=angular.module("BlockApp");blockApp.factory("BlockManagerResource",["$resource",function(e){return e("/api/block-manager/:method/:id",{method:"@method",id:"@id"},{add:{method:"post"},save:{method:"post"},update:{method:"put"},editNameFolder:{method:"edit-name-folder"}})}]).service("BlockManagerService",["BlockManagerResource","$q",function(e,t){var n=this;this.createFolderProvider=function(n){var a=t.defer(),i=new e(n);return i.$save({method:"create-folder"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.addNew=function(a){if(angular.isDefined(a._id))return n.editBlock(a);var i=t.defer(),o=new e(a);return o.$save({method:"add-new"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.reviewContentBlock=function(n){var a=t.defer(),i=new e(n);return i.$save({method:"review-content-block"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.editBlock=function(n){var a=t.defer(),i=new e(n);return i.$update({id:n._id,method:"edit-block"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.parseContentBlock=function(n){var a=t.defer(),i=new e(n);return i.$save({method:"parse-content-config"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.getHtmlFieldsCms=function(n){var a=t.defer(),i=new e(n);return i.$save({method:"get-htm-fields-cms"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.addTagsForPage=function(n,a){var i=t.defer(),o=new e(a);return o.$save({id:n,method:"add-tags"},function(e){0!=e.status,i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.parseContentConfigBlock=function(n){var a=t.defer(),i=new e(n);return i.$save({method:"parse-content-config"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.getContentForIframe=function(){var n=t.defer(),a=new e(data);return a.$save({method:"get-content-iframe"},function(e){n.resolve(e)},function(e){n.resolve(e.data)}),n.promise},this.deleteFolderAndBlock=function(n){var a=t.defer(),i=new e;return i.$delete({id:n},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.deleteBlockFile=function(n){var a=t.defer(),i=new e;return i.$get({id:n,method:"delete-file"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.editNameFolder=function(n){var a=t.defer(),i=new e(n);return i.$save({id:n.id,method:"edit-name-folder"},function(e){0!=e.status&&a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.getDataBlock=function(n){var a=t.defer(),i=new e(n);return i.$save({method:"get-data-block"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise}}]),blockApp.controller("BlockManagerController",["$scope","$modal","ngTableParams","$timeout","BlockManagerService","CmsContentFolderService","$filter","$templateCache","CmsService",function(e,t,n,a,i,o,r,l,s){e.size=function(){s.setHeightTable()},e.isShowNested=!0,e.isShowBtnDelete=!1,e.isShowBtnEditNameFolder=!1,l.remove("cms/block-manager/template"),l.remove("cms/block-manager/template-manage-block"),e.blockManagers=o.setContents(window.folders,window.currentPage),e.allTags=angular.copy(window.allTags),e.tagsContent=angular.copy(window.tagsContent),e.pageSelected=window.idOfBlockSelected,e.contentHideOrShowAllNestedContent="Show All Nested Content",angular.isUndefined(e.blocks)&&(e.blocks=[]),e.isSearch=!1,e.btnSearch=function(){e.isSearch=!e.isSearch},e.tableParams=new n({page:1,count:100,sorting:{title:"asc"},filter:{}},{total:e.blocks.length,getData:function(t,n){var a=n.filter()?r("filter")(e.blocks,n.filter()):e.blocks,i=n.sorting()?r("orderBy")(a,n.orderBy()):a;n.total(a.length),t.resolve(i.slice((n.page()-1)*n.count(),n.page()*n.count()))}}),0!=e.pageSelected&&o.setActiveNode(e.pageSelected),o.initTree(function(t,n){e.blocks=[],"Blocks"==n.key?e.titleItemSelected="Blocks":1==n.folder?e.titleItemSelected=n.title:angular.isUndefined(n.parent.data.name)?e.titleItemSelected="Blocks":e.titleItemSelected=n.parent.data.name,angular.isDefined(t)&&1==t.length&&1!=n.folder?(t[0].expanded=!0,e.blocks=t):angular.forEach(t,function(t,n){t.expanded=!1,e.blocks.push(t)}),e.blocks=t,e.tableParams.reload(),angular.isDefined(e.tableParams.$params)&&(e.tableParams.$params.page=1),"0"!=n.data.parent_id?e.isShowBtnDelete=!0:e.isShowBtnDelete=!1,1==n.folder&&"0"!=n.data.parent_id?e.isShowBtnEditNameFolder=!0:e.isShowBtnEditNameFolder=!1}),e.hideOrShowAllNestedContent=function(){o.changeStatusHideOrShowAllNestedContent().then(function(t){e.contentHideOrShowAllNestedContent=t.textButton,"Show All Nested Content"==e.contentHideOrShowAllNestedContent?e.isShowNested=!0:e.isShowNested=!1,e.blocks=t.contents,e.tableParams.reload()})},e.checkPermission=function(t){var n=e.types_map[t.asset_id],a=window.editAssetPermission&&(window.jsPermission&&"javascript"==n||window.cssPermission&&"css"==n||window.imagePermission&&"image"==n||window.videoPermission&&"video"==n);return a},e.getChildrenPages=function(t){var n=[];for(var a in t){if(angular.isUndefined(t[a].data))return;"0"==t[a].key?(n.push(t[a]),delete t[a]):angular.isUndefined(t[a].folder)||(n.push(t[a]),delete t[a])}e.blockManagers=t,e.tableParams.reload()},e.deleteFolderAndBlock=function(){e.dsbBtnDelete=!0;var t=$("#tree").fancytree("getTree"),n=t.getActiveNode(),a=t.getRootNode();if(1==n.folder)var o=confirm(r("trans")("confirm-delete-folder","golbal"));else var o=confirm(r("trans")("confirm-delete-content","golbal"));return 1!=o?void(e.dsbBtnDelete=!1):void("0"!=n.data.parent_id&&i.deleteFolderAndBlock(n.data._id).then(function(t){t.status&&(n.remove(),rootNodeOfNodeActive=_.find(a.children,function(e){return"Blocks"==e.title}),rootNodeOfNodeActive.setActive()),e.dsbBtnDelete=!1}))},e.deleteFileBlock=function(t,n){i.deleteBlockFile(t).then(function(a){0!=a.status&&(angular.isUndefined(a.result)||(n.region=a.result.countUniqueRegion,n.language=a.result.countUniqueLanguage,n.status=a.result.status),angular.forEach(n.subBlocks,function(e,a){e._id==t&&n.subBlocks.splice(a,1)}),e.tableParams.reload())})},e.editNameFolder=function(){var n=$("#tree").fancytree("getTree"),a=n.getActiveNode();if(a){var i="/cms/block-manager/edit-name-folder/"+a.data._id+"?"+(new Date).getTime(),o=t.open({animation:e.animationsEnabled,templateUrl:window.baseUrl+i,controller:"editNameFolderBlockCtrl",size:null,resolve:{}});o.result.then(function(t){a.setTitle(t.folder.name),a.setActive(),a.getParent().sortChildren(null,!0),e.tableParams.reload(),e.titleItemSelected=t.folder.name},function(){})}},e.showGroup=function(e,t){var n=($(".group-btn-ac").outerHeight(),$(window).outerWidth()),a=$(window).outerHeight(),i=e.pageY,o=a-i;300>o&&$(".wrap-ac-group").each(function(e){$(this).addClass("show-top")}),$(".wrap-ac-group").each(function(e){$(this).removeClass("ac-up")}),$(e.target).parent().toggleClass("ac-up"),$(".group-btn-ac").hasClass("fix-missing-li")?$(".group-btn-ac").css({top:e.pageY-65+"px",right:n-e.pageX-30+"px"}):$(".group-btn-ac").css({top:e.pageY-200+"px",right:n-e.pageX-30+"px"}),$(document).on("click",function r(e){$(e.target).closest("tr").siblings().find(".wrap-ac-group").removeClass("ac-up"),0===$(".wrap-ac-group").has(e.target).length?($(".wrap-ac-group").removeClass("ac-up"),$(".wrap-ac-group").removeClass("show-top")):$(document).one("click",r)}),angular.element(".table-responsive").addClass("fix-height")},e.addTagsForPage=function(t,n){$("#page-loading").css("display","block"),e.tagId=n,i.addTagsForPage(t,{tags:e.tagId}).then(function(t){for(var n in e.blocks)if(e.blocks[n].data._id==t.item._id){e.blocks[n].data.tags=t.item.tags;break}$("#page-loading").css("display","none"),e.tableParams.reload()})},e.getParentFolder=function(){var t=$("#tree").fancytree("getTree"),n=t.getActiveNode();n&&(0==n.folder||angular.isUndefined(n.folder)?(e.selectedItemName=n.getParent().title,e.selectedItemId=n.getParent().key):(e.selectedItemName=n.title,e.selectedItemId=n.key))};var d=!1;e.createFolderBlock=function(){if(!d){e.getParentFolder();var n="/cms/block-manager/create-folder?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName+"&&v="+(new Date).getTime(),a=t.open({templateUrl:window.baseUrl+n,controller:"ModalCreateFolderBlockCtrl",size:void 0,resolve:{}});d=!0,a.result.then(function(e){d=!1;var t=$("#tree").fancytree("getTree");if("0"==e.parent_id)var n=t.getNodeByKey("0");else var n=t.getNodeByKey(e.parent_id);window.folderType[e.key]=window.folderType[n.key];var a=n.addChildren(e);a.setExpanded(),n.sortChildren(null,!0)},function(){d=!1})}},e.getModalEditBlock=function(t){e.getParentFolder(),window.location.href=window.baseUrl+"/cms/block-manager/edit-block/"+t+"?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName+"&&v="+(new Date).getTime()},e.uploadNewBlock=function(){return e.getParentFolder(),angular.isUndefined(window.folderType[e.selectedItemId])?void(window.location.href=window.baseUrl+"/cms/block-manager/create-new-block?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName+"&&v="+(new Date).getTime()):void(-1!=window.folderType[e.selectedItemId].indexOf("managed_block")?window.location.href=window.baseUrl+"/cms/block-manager/create-new-block-manage?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName+"&&v="+(new Date).getTime():window.location.href=window.baseUrl+"/cms/block-manager/create-new-block?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName+"&&v="+(new Date).getTime())},e.getEditBlock=function(t){return e.getParentFolder(),angular.isUndefined(window.folderType[e.selectedItemId])?void(window.location=window.baseUrl+"/cms/block-manager/edit-block/"+t+"?v="+(new Date).getTime()):void(-1!=window.folderType[e.selectedItemId].indexOf("managed_block")?window.location=window.baseUrl+"/cms/block-manager/edit-block-manage/"+t+"?v="+(new Date).getTime():window.location=window.baseUrl+"/cms/block-manager/edit-block/"+t+"?v="+(new Date).getTime())}}]).controller("ModalCreateFolderBlockCtrl",["$scope","$modalInstance","BlockManagerService",function(e,t,n){e.blockFolder={},e.submit=function(a){return e.submitted=!0,e.nameExists=!1,a?!0:angular.isUndefined(e.blockFolder.parent_id)?!0:void n.createFolderProvider(e.blockFolder).then(function(n){return 0==n.status?(e.nameExists=!0,!0):(e.nameExists=!1,void t.close(n.item))})},e.cancel=function(){t.dismiss("cancel")}}]).controller("editNameFolderBlockCtrl",["$scope","$modalInstance","BlockManagerService","$http","$q",function(e,t,n,a,i){e.checkEmtypeName=function(n){if(""==n)return"The folder name is a required field";e.folder.name=n;var o=i.defer();return a.post("/api/block-manager/edit-name-folder/"+e.folder._id,e.folder).success(function(e){e=e||{},e.status?(o.resolve(),t.close(e)):o.resolve("Name has already been taken.")}).error(function(e){e.errors?o.resolve(e.errors[0]):o.reject("Server error!")}),o.promise}}]);var requestBlock=angular.module("BlockApp");requestBlock.controller("RequestBlockController",["$scope","$modal","ngTableParams","$filter","$timeout",function(e,t,n,a,o){e.getParentFolder=function(){var t=$("#tree").fancytree("getTree"),n=t.getActiveNode();n&&(0==n.folder||angular.isUndefined(n.folder)?(e.selectedItemName=n.getParent().title,e.selectedItemId=n.getParent().key):(e.selectedItemName=n.title,e.selectedItemId=n.key))};var r=!1;e.getModalRequestNewBlock=function(){if(!r){e.getParentFolder();var n=e.selectedItemId,a=t.open({animation:e.animationsEnabled,templateUrl:window.baseUrl+"/cms/block-manager/create?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName+"&&v="+(new Date).getTime(),controller:"ModalRequestBlockController",size:null,resolve:{folder_id:function(){return n}}});r=!0,a.result.then(function(e){r=!1,e.block.title=e.block.name,e.block.key=e.block._id,node=$("#tree").fancytree("getTree").getNodeByKey(e.block.folder_id),node.addChildren(e.block),node.setActive(!1),node.setActive(),node.sortChildren(null,!0)},function(){r=!1})}},e.getModalRequestTranslation=function(n){if(!r){e.getParentFolder();var a="/cms/block-manager/request-translation/"+n+"?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName+"&&v="+(new Date).getTime(),o=t.open({templateUrl:window.baseUrl+a,controller:"ModalRequestBlockController",size:void 0,resolve:{folder_id:function(){return null}}});r=!0,o.result.then(function(t){r=!1;for(i in t.blocks)node=$("#tree").fancytree("getTree").getNodeByKey(t.blocks[i].base_id),node.data.subBlocks.push(t.blocks[i]),"n/a"==node.data.language?node.data.language=1:node.data.language=parseInt(node.data.language)+1,"n/a"==node.data.due_date||"undefined"==typeof node.data.due_date?node.data.due_date=t.blocks[i].due_date:node.data.due_date>t.blocks[i].due_date&&(node.data.due_date=t.blocks[i].due_date),node.data.status="draft",e.tableParams.reload()},function(){r=!1})}},e.getModalRequestRegion=function(n){if(!r){e.getParentFolder();var a="/cms/block-manager/request-region/"+n+"?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName+"&&v="+(new Date).getTime(),o=t.open({templateUrl:window.baseUrl+a,controller:"ModalRequestBlockController",size:void 0,resolve:{folder_id:function(){return null}}});r=!0,o.result.then(function(t){r=!1;for(i in t.blocks)node=$("#tree").fancytree("getTree").getNodeByKey(t.blocks[i].base_id),node.data.region=t.countUniqueRegion,node.data.subBlocks.push(t.blocks[i]),"n/a"==node.data.due_date||"undefined"==typeof node.data.due_date?node.data.due_date=t.blocks[i].due_date:node.data.due_date>t.blocks[i].due_date&&(node.data.due_date=t.blocks[i].due_date),node.data.status="draft",e.tableParams.reload()},function(){r=!1})}}}]),requestBlock.controller("ModalRequestBlockController",["$scope","$modal","$filter","$modalInstance","folder_id","RequestBlockService","Upload","$timeout",function(e,t,n,a,i,o,r,l){e.languages_selected={},e.requiredLanguage=!0,e.requiredRegion=!0,e.regions_selected={},l(function(){e.block=angular.copy(window.block),e.folders=window.folders,"undefined"==typeof e.block.modal&&(e.block.folder_id="root"==i?"0":i)},500),e.format="MM-dd-yyyy",e.minDate=new Date,e.open=function(t,n){t.preventDefault(),t.stopPropagation(),e.opened={},e.opened[n]=!0},e.removeThumbnail=function(t){confirm("Do you want delete this image?")&&e.block.thumbnail.splice(t,1)},e.initRedactor=function(){$("#description").redactor({plugins:["table",1==window.isAdvancedEditingFeatures?"source":""],imageUpload:"/content/upload",callbacks:{modalOpened:function(e,t){if("link"!=e||this.observe.isCurrent("a")){if("link"==e){var n=this.link.$node.attr("rel");"undefined"==typeof n?$('<label><input type="checkbox" id="redactor-link-no-follow"> No Follow</label>').insertAfter($("#redactor-link-blank").parent()):$('<label><input type="checkbox" checked id="redactor-link-no-follow"> No Follow</label>').insertAfter($("#redactor-link-blank").parent())}}else $("#redactor-link-blank").attr("checked","true"),$('<label><input type="checkbox" checked id="redactor-link-no-follow"> No Follow</label>').insertAfter($("#redactor-link-blank").parent())},insertedLink:function(e){var t=$(e).attr("href");"http"!=t.substring(0,4)&&"https"!=t.substring(0,5)&&"ftp"!=t.substring(0,3)&&$(e).attr("href","http://"+t),$("#redactor-link-no-follow").prop("checked")?e.attr("rel","nofollow"):e.removeAttr("rel")},linkify:function(e){e.attr("target","_blank")},change:function(){$description=$("#description").redactor("code.get"),e.$apply(function(){"<div></div>"==$description||""==$description||"<br>"==$description||"<div><strong></strong></div>"==$description||"<div><em></em><strong></strong></div>"==$description||"<div><em><del></del></em></div>"==$description?e.requiredDescription=!0:e.requiredDescription=!1})}},linkSize:1e3,minHeight:200})},e.submit=function(t){return delete e.errors,e.requiredDescription=!1,e.submitted=!0,angular.isDefined(e.folderType)&&"managed_block"==e.folderType[e.block.folder_id]&&(e.block.type="managed_block"),$description=$("#description").redactor("code.get"),"<div></div>"!=$description&&""!=$description&&"<br>"!=$description&&"<div><strong></strong></div>"!=$description&&"<div><em></em><strong></strong></div>"!=$description&&"<div><em><del></del></em></div>"!=$description||(e.requiredDescription=!0),t||e.requiredDescription?($(".ng-invalid:eq(1)").focus(),!0):"undefined"==typeof e.block.folder_id&&"request_translation"!=e.block.modal&&"request_region"!=e.block.modal?!0:"request_translation"==e.block.modal&&e.requiredLanguage?($(".ng-invalid:eq(1)").focus(),!0):"request_region"==e.block.modal&&e.requiredRegion?($(".ng-invalid:eq(1)").focus(),!0):(files_id=[],"undefined"!=typeof e.filesUpload&&(files_id=e.filesUpload.ids),e.block.files_id=files_id,$("#btnSubmit").attr("disabled","true"),e.block.description=$description,e.block._id&&"request_translation"==e.block.modal&&(e.block.languages=e.languages_selected),e.block._id&&"request_region"==e.block.modal&&(e.block.contentId=e.block._id,e.block._id=e.block.base_id,e.block.regions=e.regions_selected),void o.requestBlock(e.block).then(function(t){if(0==t.status)$("#btnSubmit").removeAttr("disabled"),e.checkName=!0,t.errors?e.errors=t.errors:$(".name").focus();else{if("undefined"!=typeof e.block.thumbnail){var n="propose_new";"undefined"!=typeof e.block.modal&&(n=e.block.modal);for(var i=0;i<e.block.thumbnail.length;i++){var o=e.block.thumbnail[i];r.upload({url:window.baseUrl+"/api/block-manager/change-thumbnail",fields:{modal:n,data:t},file:o}).progress(function(e){}).success(function(e,t,n,a){!e.status})}}a.close(t)}}))},e.cancel=function(){a.dismiss("cancel")}}]);var blockApp=angular.module("BlockApp");blockApp.factory("RequestBlockResource",["$resource",function(e){return e("/api/block-manager/:method/:id",{method:"@method",id:"@id"},{add:{method:"post"},save:{method:"post"},update:{method:"put"}})}]),blockApp.service("RequestBlockService",["RequestBlockResource","$q",function(e,t){var n=this;this.requestBlock=function(a){if("undefined"!=typeof a._id&&"request_translation"==a.modal)return n.requestTranslation(a);if("undefined"!=typeof a._id&&"request_region"==a.modal)return n.requestRegion(a);var i=t.defer(),o=new e(a);return o.$save({},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.requestTranslation=function(n){var a=t.defer(),i=new e(n);return i.$save({method:"request-translation"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.requestRegion=function(n){var a=t.defer(),i=new e(n);return i.$save({method:"request-region"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.requestRevision=function(n){var a=t.defer(),i=new e(n);return i.$save({method:"request-revision"},function(e){0!=e.status&&a.resolve(e)},function(e){a.resolve(e.data)}),a.promise}}]);var blockApp=angular.module("BlockApp");blockApp.controller("EditBlockCtrl",["$scope","$modal","$timeout","Upload","$filter","ngTableParams","BlockManagerService","CmsService","$controller",function(e,t,n,a,i,o,r,l,s){e.blockContent=angular.copy(window.blockContent),e.baseUrl=window.baseUrl,e.usages=window.usages,null!=e.blockContent.content&&$('#mytab a[href="#content1"]').tab("show"),n(function(){$(document).ready(function(){e.setDIVHeight()}),$(window).resize(function(){e.setDIVHeight()})}),e.loadDataUsage=function(){e.tableParams=new o({page:1,count:50,sorting:{name:"desc"}},{total:e.usages.length,getData:function(t,n){var a=n.sorting()?i("orderBy")(e.usages,n.orderBy()):e.usages;a=n.filter()?i("filter")(a,n.filter()):a,n.total(a.length),t.resolve(a.slice((n.page()-1)*n.count(),n.page()*n.count()))}})},e.loadDataUsage(),e.clickable=function(e,t,n,a){switch(n){case"template":window.open(baseUrl+"/cms/template-content-manager/update-template/"+t,"_blank");break;case"page":window.open(baseUrl+"/cms/pages/edit-page/"+t,"_blank");break;case"block":window.open(baseUrl+"/cms/block-manager/edit-block/"+t,"_blank")}},e.setDIVHeight=function(){var e=$(".assets .fix-tab #code"),t=$(".assets .fix-tab #review"),n=$(".assets .fix-tab").offset(),a=n.top,i=screen.height,o=i-a-315;e.attr("style","height: "+o+"px!important;overflow:auto"),t.attr("style","height: "+o+"px!important;overflow:auto")},s("ConfigController",{$scope:e}),l.setFieldsContent(window.blockContent.fields),n(function(){e.editableCodeMirror=CodeMirror.fromTextArea(document.getElementById("editor"),{mode:"htmlmixed",theme:"night",styleActiveLine:!0,lineNumbers:!0,onChange:function(){}}),null==e.blockContent.content&&(e.blockContent.content=""),e.editableCodeMirror.setValue(e.blockContent.content),e.editableCodeMirror.on("change",function(){var t=e.editableCodeMirror.getValue();"<div></div>"==t||""==t||"<br>"==t||"<div><strong></strong></div>"==t||"<div><em></em><strong></strong></div>"==t||"<div><em><del></del></em></div>"==t?e.$apply(function(){e.requiredEditorContent=!0}):e.$apply(function(){e.requiredEditorContent=!1})})},700),e.showValueContent=function(){n(function(){e.editableCodeMirror.refresh()},200)},e.format="MM-dd-yyyy",e.minDate=new Date,e.submitted=!1,e.showField=!1,e.showLoad=!1;e.open=function(t,n){t.preventDefault(),t.stopPropagation(),e.opened={},e.opened[n]=!0},e.callModalInsert=function(a,i,o,r,l){var s="/cms/block-manager/insert?language="+i+"&&region="+o+"&&type="+a+"&&notShowFieldBlock="+r+"&&id="+l,d=t.open({templateUrl:window.baseUrl+s,controller:"ModalInsertCms",size:void 0,resolve:{blockId:function(){},language:function(){return i},region:function(){return o},listField:function(){}}});d.result.then(function(t){n(function(){e.editableCodeMirror.replaceSelection(t)})})},CodeMirror.markClean=function(){alert("Content Changed")},e.isShowCode=!0,e.showCodeBlock=function(){e.isShowCode=!0,e.isShowReView=!1},e.reViewBlock=function(){angular.element("#page-loading").css("display","block");var t;t="undefined"==typeof e.blockContent.type?"html":e.blockContent.type,data={content:JSON.stringify(e.editableCodeMirror.getValue()),type:t,language:e.blockContent.language,region:e.blockContent.region},r.reviewContentBlock(data).then(function(t){t.status&&e.refreshIframe()})},e.iframeLoaded=function(){e.isShowCode=!1,e.isShowReView=!0},e.refreshIframe=function(){r.getContentForIframe().then(function(t){e.iframeLoaded(),$("#frameBlock").contents().find("body").html(t.content),angular.element("#page-loading").css("display","none")})},e.removeThumbnail=function(t){confirm("Do you want delete this image?")&&(e.blockContent.thumbnail=null)},e.removeAddThumbnail=function(t){confirm("Do you want delete this image?")&&delete e.blockContent.addThumbnail},e.parseBlockontent=function(t){l.setFieldsOld(),e.errorContentTemplate="",e.blockContent.content=e.editableCodeMirror.getValue(),e.requiredEditorContent=!1,e.submitted=!0;var a=e.editableCodeMirror.getValue(),a=e.editableCodeMirror.getValue();return t?($(".ng-invalid:eq(1)").focus(),void $('#mytab a[href="#detail"]').tab("show")):"<div></div>"==a||""==a||"<br>"==a||"<div><strong></strong></div>"==a||"<div><em></em><strong></strong></div>"==a||"<div><em><del></del></em></div>"==a?(e.requiredEditorContent=!0,$('#mytab a[href="#content1"]').tab("show"),n(function(){e.editableCodeMirror.refresh()},200),void(e.saving=!1)):e.requiredEditorContent?void $('#mytab a[href="#content1"]').tab("show"):void r.parseContentConfigBlock({content:e.blockContent.content,type:"block"}).then(function(t){if(e.blockContent.injects=t.blocks,e.blockContent.links=t.links,e.blockContent.assets=t.assets,t.status){var n=l.getFieldsNew(t.fields);n.length>0?e.configFields(function(t){"undefined"!=typeof t&&(dataFields=l.mapDataFields(t),e.getModalShowListConfigFields(function(t){"undefined"!=typeof t&&(e.blockContent.fields=dataFields,d(e.blockContent))},dataFields))},n):(dataFields=l.mapDataFields([]),dataFields.length>0?e.getModalShowListConfigFields(function(t){"undefined"!=typeof t&&(e.blockContent.fields=dataFields,d(e.blockContent))},dataFields):(e.blockContent.fields=dataFields,d(e.blockContent)))}else e.errorContentTemplate=t.message})};var d=function(){angular.element("#page-loading").css("display","block"),e.saving=!0,delete e.errors,r.editBlock(e.blockContent).then(function(t){if(t.status)if(angular.isDefined(e.blockContent.addThumbnail))for(var n="propose_new",i=0;i<e.blockContent.addThumbnail.length;i++){var o=e.blockContent.addThumbnail[i];a.upload({url:window.baseUrl+"/api/block-manager/update-thumbnail",fields:{modal:n,data:t},file:o}).progress(function(e){}).success(function(t,n,a,i){return t.status?void(window.location=window.baseUrl+"/cms/block-manager/set-block-selected/"+e.blockContent.folder_id):void(e.saving=!1)})}else window.location=window.baseUrl+"/cms/block-manager/set-block-selected/"+e.blockContent.folder_id;else e.saving=!1,t.errors&&(e.errors=t.errors),angular.element("#page-loading").css("display","none")})};e.cancel=function(){window.location.href=window.baseUrl+"/cms/block-manager"}}]),requestBlock.directive("multiSelectBlock",["$timeout",function(e){return{restrict:"EA",scope:{items:"=",itemsAssigned:"=",requiredItem:"=",placeholder:"@"},templateUrl:"/app/components/blocks/views/view.html?v=2",link:function(e,t,n){e.assignItem=function(){if(e.test={},"undefined"!=e.selectedItemFrom){for(var t in e.selectedItemFrom){var n=e.selectedItemFrom[t];e.itemsAssigned[n]=e.items[n],delete e.items[n]}(1==e.requiredItem||angular.isUndefined(e.requiredItem))&&(angular.equals(e.itemsAssigned,e.test)||(e.requiredItem=!1)),e.selectedItemFrom=[]}},e.undoItem=function(){if(angular.isArray(e.items)&&(e.items={}),angular.isDefined(e.selectedItemTo)){if(0==e.selectedItemTo.length)return;for(var t in e.selectedItemTo){var n=e.selectedItemTo[t];e.items[n]=e.itemsAssigned[n],delete e.itemsAssigned[n]}(0==e.requiredItem||angular.isUndefined(e.requiredItem))&&angular.equals(e.itemsAssigned,e.test)&&(e.requiredItem=!0),e.selectedItemTo=[]}}}}}]),requestBlock.directive("codeMirror",function(){return{restrict:"A",link:function(e,t,n){CodeMirror.fromTextArea(document.getElementById("code"),{lineNumbers:!0,theme:"night",extraKeys:{F11:function(e){e.setOption("fullScreen",!e.getOption("fullScreen"))},Esc:function(e){e.getOption("fullScreen")&&e.setOption("fullScreen",!1)}}})}}});var databasemanagerApp=angular.module("databaseManager",["ngResource","ui.bootstrap","ngSanitize","ngTable"]);databasemanagerApp.factory("DatabaseManagerResource",["$resource",function(e){return e("/api/database-manager/:method/:id/:title",{method:"@method",id:"@id",title:"@title"},{add:{method:"post"},save:{method:"post"},update:{method:"put"},show:{method:"get"},editNameFolder:{method:"edit-name-folder"}})}]).service("DatabaseManagerService",["DatabaseManagerResource","$q",function(e,t){var n=this;this.createFolderProvider=function(n){var a=t.defer(),i=new e(n);return i.$save({method:"create-folder"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.createCategory=function(a){if("undefined"!=typeof a.id)return n.editCategory(a);var i=t.defer(),o=new e(a);return o.$save({method:"create-category"},function(e){i.resolve(e)},function(e){
i.resolve(e.data)}),i.promise},this.editCategory=function(n){var a=t.defer(),i=new e(n);return i.$save({id:n.id,method:"edit-category"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.requestTranslation=function(n){var a=t.defer(),i=new e(n);return i.$save({method:"request-translation-material"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.requestRegion=function(n){var a=t.defer(),i=new e(n);return i.$save({method:"request-region-material"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.editNameCategory=function(n){var a=t.defer(),i=new e(n);return i.$save({id:n.id,method:"edit-name-category"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.deleteCategoryAndMaterial=function(n){var a=t.defer(),i=new e;return i.$delete({id:n.id,type:n.type},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.deleteMaterial=function(n,a){var i=t.defer(),o=new e;return o.$delete({id:n,type:a},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise}}]),databasemanagerApp.controller("DatabaseManagerController",["$scope","$modal","ngTableParams","$timeout","DatabaseManagerService","CmsContentFolderService","$filter","$templateCache","CmsService",function(e,t,n,a,i,o,r,l,s){e.currentNode="",e.size=function(){s.setHeightTable()},e.isShowNested=!0,e.isShowBtnDelete=!1,e.isShowBtnEditNameFolder=!1,e.isShowCreateFolder=!0,l.remove("cms/database/template"),o.setContents(angular.copy(window.folders),window.currentPage),e.pageSelected=window.idOfDatabaseSelected,e.allTags=angular.copy(window.allTags);var d;e.contentHideOrShowAllNestedContent="Show All Nested Content",angular.isUndefined(e.database)&&(e.database=[]),e.tagsContent=angular.copy(window.tagsContent),e.titleItemSelected="Database",e.isSearch=!1,e.btnSearch=function(){e.isSearch=!e.isSearch},0!=e.pageSelected&&o.setActiveNode(e.pageSelected),o.initTree(function(t,a){angular.element("#page-loading").css("display","block"),e.database=[],d=a,e.isShowBtnCreateMaterial=!1,e.isShowBtnCreateCategory=!1,e.isShowBtnPlatform=!1,e.isShowBtnCreateLaser=!1,e.isDatabase=!1,e.currentNode=d.key,"root_material"==d.key&&(e.currentNode="materials",e.isShowBtnCreateCategory=!0,e.isShowBtnCreateMaterial=!0,e.templateTable=window.baseUrl+"/app/components/database/partials/table-materials.html?v="+(new Date).getTime(),e.database=d.data.materials),"root_platform"==d.key&&(e.database=d.data.content,e.isShowBtnPlatform=!0,e.templateTable=window.baseUrl+"/app/components/database/partials/table-platforms.html?v="+(new Date).getTime()),"root_accessories"==d.key&&(e.currentNode="accessories",e.isShowBtnCreateCategory=!0,e.isShowBtnCreateMaterial=!0,e.database=d.data.content,e.templateTable=window.baseUrl+"/app/components/database/partials/table-accessories.html?v="+(new Date).getTime()),"root_lasers"==d.key&&(e.isShowBtnCreateLaser=!0,e.database=d.data.content,e.templateTable=window.baseUrl+"/app/components/database/partials/table-lasers.html?v="+(new Date).getTime()),"root_products"==d.key&&(e.database=d.data.content,e.templateTable=window.baseUrl+"/app/components/database/partials/table-products.html?v="+(new Date).getTime()),"root_database"==d.key&&(e.isDatabase=!0),0!=e.database.length&&(e.tableParams=new n({page:1,count:100,sorting:{title:"asc"},filter:{}},{total:e.database.length,getData:function(t,n){var a=n.filter()?r("filter")(e.database,n.filter()):e.database,i=n.sorting()?r("orderBy")(a,n.orderBy()):a;n.total(a.length),t.resolve(i.slice((n.page()-1)*n.count(),n.page()*n.count()))}})),angular.isDefined(e.tableParams)&&(e.tableParams.reload(),e.titleItemSelected=d.title),angular.element("#page-loading").css("display","none")}),e.hideOrShowAllNestedContent=function(){o.changeStatusHideOrShowAllNestedContent().then(function(t){e.contentHideOrShowAllNestedContent=t.textButton,"Show All Nested Content"==e.contentHideOrShowAllNestedContent?e.isShowNested=!0:e.isShowNested=!1,e.database=t.contents,e.tableParams.reload()})},e.showGroup=function(e){var t=($(".group-btn-ac").outerHeight(),$(window).outerWidth()),n=$(window).outerHeight(),a=e.pageY,i=n-a;300>i&&$(".wrap-ac-group").each(function(e){$(this).addClass("show-top")}),$(".wrap-ac-group").each(function(e){$(this).removeClass("ac-up")}),$(e.target).parent().toggleClass("ac-up"),$(".group-btn-ac").hasClass("fix-missing-li")?$(".group-btn-ac").css({top:e.pageY-45+"px",right:t-e.pageX-30+"px"}):$(".group-btn-ac").css({top:e.pageY-140+"px",right:t-e.pageX-30+"px"}),$(document).on("click",function o(e){$(e.target).closest("tr").siblings().find(".wrap-ac-group").removeClass("ac-up"),0===$(".wrap-ac-group").has(e.target).length?($(".wrap-ac-group").removeClass("ac-up"),$(".wrap-ac-group").removeClass("show-top")):$(document).one("click",o)}),angular.element(".table-responsive").addClass("fix-height")},e.createNewMaterial=function(){window.location.href=window.baseUrl+"/cms/database-manager/create-new-material?type="+e.currentNode},e.createLaser=function(){window.location.href=window.baseUrl+"/cms/database-manager/create-laser"},e.editNameCategory=function(){if(d){var n="/cms/database-manager/edit-name-category/"+d.data.id+"?v="+(new Date).getTime(),a=t.open({animation:e.animationsEnabled,templateUrl:window.baseUrl+n,controller:"editNameCategoryCtr",size:null,resolve:{}});a.result.then(function(t){d.setTitle(t.category.name),angular.isDefined(e.tableParams)&&e.tableParams.reload(),e.titleItemSelected=t.category.name},function(){})}},e.createCategory=function(n){var a=0;if(angular.isDefined(d.data.id))var a=d.data.id;if("undefined"==typeof n)var i="/cms/database-manager/create-category?selectedItemId="+a+"&&v="+(new Date).getTime()+"&&type="+e.currentNode;else var i="/cms/database-manager/edit-category?selectedItemId="+a+"&&v="+(new Date).getTime()+"&&type="+e.currentNode+"&&id="+n;var o=t.open({templateUrl:window.baseUrl+i,controller:"ModalCreateCategoryDatabaseCtrl",size:void 0,resolve:{}});o.result.then(function(t){if("undefined"!=typeof n){for(var a in e.database)if(parseInt(e.database[a].id)==parseInt(t.id)){e.database[a]=t;break}e.tableParams.reload()}})},e.deleteCategoryAndMaterial=function(t){var n=confirm("Are you sure you want to delete this material?"),a="material";"accessories"==e.currentNode?a="accessories":"root_lasers"==e.currentNode&&(a="laser"),1==n&&i.deleteMaterial(t,a).then(function(n){n.status&&(angular.forEach(e.database,function(n,a){n.id==t&&e.database.splice(a,1)}),e.tableParams.reload())})},e.getModalRequestTranslationTemplate=function(n,a){var i=[];angular.forEach(a,function(e,t){"en"!=e.language||null!=e.region&&e.region||(i=e)});var o="/cms/database-manager/request-translation-material/"+n+"?v="+(new Date).getTime(),r=t.open({templateUrl:window.baseUrl+o,controller:"ModalRequesDatabasetController",size:void 0,resolve:{folder_id:function(){return null},subFile:function(){return i}}});r.result.then(function(t){var n=$("#tree").fancytree("getTree"),a=n.getNodeByKey(t.key);angular.isUndefined(a)||null==a||a.remove(),node=$("#tree").fancytree("getTree").getNodeByKey("category_"+t.category_id),nodeAdd=node.addChildren(t),nodeAdd.setActive(),node.sortChildren(null,!0),e.tableParams.reload()},function(){})},e.getModalRequestRegionTemplate=function(n,a){var i="/cms/database-manager/request-region-material/"+n+"?v="+(new Date).getTime(),o=t.open({templateUrl:window.baseUrl+i,controller:"ModalRequesDatabasetController",size:void 0,resolve:{folder_id:function(){return null},subFile:function(){return a}}});o.result.then(function(t){var n=$("#tree").fancytree("getTree"),a=n.getNodeByKey(t.key);angular.isUndefined(a)||null==a||a.remove(),node=$("#tree").fancytree("getTree").getNodeByKey("category_"+t.category_id),nodeAdd=node.addChildren(t),nodeAdd.setActive(),node.sortChildren(null,!0),e.tableParams.reload()},function(){})},e.createGroupAccesstories=function(){var e=t.open({templateUrl:window.baseUrl+"/cms/accessories/create-folder",controller:"ModalCreateGroupAccesstoriesCtrl",size:void 0,resolve:{}});e.result.then(function(e){var e=e.item,t=$("#tree").fancytree("getTree"),n=t.getNodeByKey("root_accessories");n.addChildren(e);var i=t.getNodeByKey(e.key);i.setActive(),a(function(){n.sortChildren(null,!0)})},function(){})}}]).controller("ModalCreateGroupAccesstoriesCtrl",["$scope","$modalInstance","DatabaseManagerService","AccessoriesService",function(e,t,n,a){e.submit=function(n){a.createFolderProvider(e.accestories).then(function(e){t.close(e)})},e.cancel=function(){t.dismiss("cancel")}}]).controller("ModalCreateCategoryDatabaseCtrl",["$scope","$modalInstance","DatabaseManagerService",function(e,t,n){e.exists=!1,e.submit=function(a){e.submitted=!0,e.nameExists=!1,a||angular.isUndefined(e.category.parent_id)&&"material"===e.type||("accessories"==e.type&&(e.category.parent_id=0,e.category.type="accessories"),n.createCategory(e.category).then(function(n){return 0==n.status?n.errors?(e.error=n.errors,!0):void(n.item.checkName?alert("Not exist table name is "+n.item.name+" in category!"):e.nameExists=!0):(e.nameExists=!1,void t.close(n.item))}))},e.cancel=function(){t.dismiss("cancel")}}]).controller("editNameCategoryCtr",["$scope","$modalInstance","DatabaseManagerService",function(e,t,n){e.checkEmtypeName=function(a){return""==a?"The category name is a required field":(e.category.name=a,void n.editNameCategory(e.category).then(function(n){0!=n.status?t.close(n):e.nameExists=!0}))}}]).controller("ModalRequesDatabasetController",["$scope","$modal","$filter","$modalInstance","folder_id","DatabaseManagerService","subFile","$timeout",function(e,t,n,a,i,o,r,l){e.languages_selected={},e.requiredLanguage=!0,e.requiredRegion=!0,e.regions_selected={},e.submit=function(t){return e.submitted=!0,t?void $(".ng-invalid:eq(1)").focus():"request_translation"==e.material.modal&&e.requiredLanguage?void $(".ng-invalid:eq(1)").focus():"request_region"==e.material.modal&&e.requiredRegion?void $(".ng-invalid:eq(1)").focus():($("#btnSubmit").attr("disabled","true"),e.material.copyContent=r.id,e.material.id&&"request_translation"==e.material.modal&&(e.material.languages=e.languages_selected,o.requestTranslation(e.material).then(function(e){a.close(e.item)})),void(e.material.id&&"request_region"==e.material.modal&&(e.material.regions=e.regions_selected,o.requestRegion(e.material).then(function(e){a.close(e.item)}))))},e.cancel=function(){a.dismiss("cancel")}}]);var fileModule=angular.module("file");fileModule.factory("FileResource",["$resource",function(e){return e("/admin/document-manager/:method/:id",{},{add:{method:"post"},save:{method:"post"},update:{method:"put"}})}]).factory("shareDataFactory",["$rootScope",function(e){var t={};return t.data="",t.prepForBroadcase=function(e,t){this.data=e,this.broadcastItem(t)},t.broadcastItem=function(t){e.$broadcast(t)},t}]).service("FileService",["$q","$filter","FileResource",function(e,t,n){var a=[],i=[],o=[],r=[],l=[],s=[],d=[];this.create=function(t){var a=e.defer(),i=new n(t);return i.$save({},function(e){e.status?a.resolve(e):a.resolve(null)},function(e){a.resolve(null)}),a.promise},this.fileShare=function(t){var a=e.defer(),i=new n(t);return i.$save({id:t.fileId,method:"file-share"},function(e){a.resolve(e)},function(e){a.resolve(null)}),a.promise},this.deleteFileUserShare=function(t){var a=t.folder_id;"undefined"!=typeof t.file_id&&(a=t.file_id);var i=e.defer();return n["delete"]({id:a,method:"delete-file-user-share",userShareId:t.user_id,group:t.group},function(e){i.resolve(e)}),i.promise},this.getChildFolders=function(t){var a=e.defer();return n.query({id:t,method:"get-child-folders"},function(e){a.resolve(e)}),a.promise},this.getFilesFolder=function(){return i},this.getFiles=function(){return a},this.update=function(t){var a=e.defer(),i=new n(t);return i.$save({id:t._id},function(e){e.status?a.resolve(e):a.resolve(null)},function(e){a.resolve(null)}),a.promise},this.get=function(t,a){var i=e.defer();return n.get({id:t,prefix:a},function(e){i.resolve(e)}),i.promise},this.getAllOfUser=function(t){var a=e.defer();return n.query({created_at:t,method:"file-all"},function(e){for(var t in e)r[e[t].id]=e[t];a.resolve(e)}),a.promise},this.pushFilesOfUser=function(e){filesFormat=[];for(var t in e)r.push(e[t]);return r},this.getFilesOfUser=function(){return r},this.query=function(){var t=e.defer();return a&&a.length?t.resolve(a):n.query().$promise.then(function(e){a=e,t.resolve(a)}),t.promise},this.remove=function(t){var i=e.defer();new n(t);return n["delete"]({id:t},function(e){if(e.status){for(var n in d)if(d[n].id==t){d.splice(n,1);break}for(var n in a)if(a[n].id==t){a.splice(n,1);break}}i.resolve(e)}),i.promise},this.visibleFolder=function(t){var i=e.defer(),o=new n(t);return o.$save({id:t,method:"visible-folder"},function(e){if(e.status){for(var n in d)if(d[n].id==t){d[n].visible=e.visible;break}for(var n in a)if(a[n].id==t){a.splice(n,1);break}}i.resolve(e)}),i.promise},this.deleteFolder=function(t){var a=e.defer();return n["delete"]({id:t,method:"delete-folder"},function(e){if(e)for(var n in d)if(d[n].id==t){d.splice(n,1);break}a.resolve(e)}),a.promise},this.setFiles=function(e){a=e},this.pushFiles=function(e){a.push(e)},this.setFilesCurrentFolder=function(e){d=e},this.getFilesCurrentFolder=function(e){return d},this.pushFile=function(e){l=[],l.push(e),a.push(e)},this.pushFileFoler=function(e){i=[],l=[];for(var t in a)i[t]=a[t];i.push(e),l.push(e),a=i},this.getFileUpload=function(){return l},this.editFile=function(e){o=e},this.getDataFileEdit=function(){return o},this.getData=function(){return a},this.addFolder=function(t){var a=e.defer(),i=new n(t);return i.$save({method:"add-folder"},function(e){a.resolve(e)},function(e){a.resolve(null)}),a.promise},this.checkFile=function(e){var t=["png","gif","jpg","jpeg"];if("undefined"!=typeof e){if(-1!=t.indexOf(e.split("/")[1]))return"image";switch(e.split("/")[1]){case"zip":return"zip";case"pdf":return"pdf";case"msword":return"msword";default:return"other"}}},this.formatFilesWitFolderId=function(){var e=[];for(var t in a)angular.isArray(e[a[t].folder_id])||(e[a[t].folder_id]=[]),e[a[t].folder_id].push(a[t]);s=e},this.getFileFolderMap=function(){return s},this.filesMap=function(e){var t=[];for(var n in e)t[e[n].id]=e[n];return t},this.download=function(t){var a=e.defer(),i=new n;return i.$get({id:t,method:"download"},function(e){a.resolve(e)},function(e){a.resolve(null)}),a.promise},this.editFileName=function(t){var i=e.defer(),o=new n(t);return o.$update({id:t.id,method:"edit-file-name"},function(e){for(var t in a)if(a[t].id==e.id&&a[t].group==e.group){a[t]=e;break}if(e.folder_id>0||e.parent_id>0)for(var t in d)if(d[t].id==e.id){d[t]=e;break}i.resolve(e)},function(e){i.resolve(null)}),i.promise}}]),createPageApp.directive("multiSelect",["$timeout",function(e){return{restrict:"EA",scope:{items:"=",itemsAssigned:"=",requiredItem:"=",placeholder:"@"},templateUrl:"/app/components/pages/views/view.html?v=2",link:function(e,t,n){e.assignItem=function(){if(e.test={},"undefined"!=e.selectedItemFrom){for(var t in e.selectedItemFrom){var n=e.selectedItemFrom[t];e.itemsAssigned[n]=e.items[n],delete e.items[n]}(1==e.requiredItem||angular.isUndefined(e.requiredItem))&&(angular.equals(e.itemsAssigned,e.test)||(e.requiredItem=!1)),e.selectedItemFrom=[]}},e.undoItem=function(){if(angular.isArray(e.items)&&(e.items={}),angular.isDefined(e.selectedItemTo)){if(0==e.selectedItemTo.length)return;for(var t in e.selectedItemTo){var n=e.selectedItemTo[t];e.items[n]=e.itemsAssigned[n],delete e.itemsAssigned[n]}(0==e.requiredItem||angular.isUndefined(e.requiredItem))&&angular.equals(e.itemsAssigned,e.test)&&(e.requiredItem=!0),e.selectedItemTo=[]}}}}}]),requestAsset.directive("multiSelectAsset",["$timeout",function(e){return{restrict:"EA",scope:{items:"=",itemsAssigned:"=",requiredItem:"=",placeholder:"@"},templateUrl:"/app/components/assetmanagers/views/view.html?v=2",link:function(e,t,n){e.assignItem=function(){if(e.test={},"undefined"!=e.selectedItemFrom){for(var t in e.selectedItemFrom){var n=e.selectedItemFrom[t];e.itemsAssigned[n]=e.items[n],delete e.items[n]}(1==e.requiredItem||angular.isUndefined(e.requiredItem))&&(angular.equals(e.itemsAssigned,e.test)||(e.requiredItem=!1)),e.selectedItemFrom=[]}},e.undoItem=function(){if(angular.isArray(e.items)&&(e.items={}),angular.isDefined(e.selectedItemTo)){if(0==e.selectedItemTo.length)return;for(var t in e.selectedItemTo){var n=e.selectedItemTo[t];e.items[n]=e.itemsAssigned[n],delete e.itemsAssigned[n]}(0==e.requiredItem||angular.isUndefined(e.requiredItem))&&angular.equals(e.itemsAssigned,e.test)&&(e.requiredItem=!0),e.selectedItemTo=[]}}}}}]);var cmsConfigApp=angular.module("CmsApp");cmsConfigApp.controller("ConfigController",["$scope","$modal","$filter",function(e,t,n){e.configSection=function(e,n){var a=window.baseUrl+"/app/shared/cms/cms-config/modal/view-config-section.html?"+(new Date).getTime(),i=t.open({templateUrl:a,controller:"ModalConfigSection",size:void 0,resolve:{sections:function(){return n}}});i.result.then(function(t){var n=e.call(n,t)},function(){var t=e.call(t)})},e.listFields=[],e.setData=function(){angular.isDefined(data.fields)&&(e.listFields=angular.copy(data.fields))},e.configFields=function(e,n){var a=window.baseUrl+"/app/shared/cms/cms-config/modal/view-config-field.html?"+(new Date).getTime(),i=t.open({templateUrl:a,controller:"ModelConfigField",size:void 0,resolve:{item:function(){return n}}});i.result.then(function(t){var n=e.call(n,t)},function(){var t=e.call(t)})},e.getModalShowListConfigFields=function(e,n){if(n.length<0||angular.isUndefined(n.length)&&Object.keys(n).length<0)return void e.call(!0,data);var a=t.open({templateUrl:window.baseUrl+"/app/shared/cms/cms-config/modal/list-field-config.html?v="+(new Date).getTime(),controller:"ModalShowListConfigFields",size:void 0,windowClass:"update-template",resolve:{fields:function(){return n}}});a.result.then(function(t){var n=e.call(n,t)},function(){var t=e.call(t)})}}]).controller("ModalConfigSection",["$scope","$modalInstance","Upload","sections",function(e,t,n,a){e.stepSection=0,e.sectionsConfig=a,e.sections=[],e.sectionLenght=a.length,e.loadingFile=[],e.errorThumbnailSection=[],e.submittedSection=[],e.uploadThumbnailSection=function(t,a){t&&t.length&&(e.loadingFile[a]="uploading file",n.upload({url:baseUrl+"/admin/file",method:"POST",file:t,fields:{store:"template-content-manager"}}).progress(function(t){e.isErrorUploadFile=!0}).success(function(n,i,o,r){e.isErrorUploadFile=!1,e.sections[a].thumbnail=n.item.id,e.loadingFile[a]=t[0].name,e.errorThumbnailSection[a]=""}).error(function(t){e.loadingFile[a]="",e.errorThumbnailSection[a]=t.message}))},e.eventNextStepSection=function(n){e.submittedSection[e.stepSection]=!0,!n&&e.sections[e.stepSection].thumbnail&&(e.stepSection<e.sectionLenght-1?e.stepSection++:t.close(e.sections))},e.prevStepSection=function(){e.stepSection>0&&e.stepSection--},e.cancel=function(){t.dismiss("cancel")}}]).controller("ModelConfigField",["$scope","item","$modalInstance",function(e,t,n){e.listFields=[],e.listFieldType=window.listFieldType,e.attributeDataOption=window.listAttributeDataOption,e.listIdCheck=angular.copy(window.listIdCheck),e.listMapType=window.listMapType,e.listFieldNameMap=window.listFieldNameMap,e.listMapTypeTextSpecial=window.listMapTypeTextSpecial,e.listBlocks=window.listBlocks,e.curStepField=0,e.stepThird=!0,angular.isDefined(t)&&(e.listFields=angular.copy(t)),e.nextStepFileld=function(t,a){if($(".ng-invalid:eq(0)").focus(),e.submitted=!0,e.errorMax="",a)return void $(".ng-invalid:eq(1)").focus();if("field_title"==e.listFields[t].variable&&(e.listFields[t].field_type="text",e.listFields[t].type="text"),e.listFields[t].multiple){var i=e.listFields[t].min_field,o=e.listFields[t].max_field;if(angular.isDefined(i)&&angular.isDefined(o)&&o&&i&&i>o)return e.errorMax="Max is invalid",void angular.element("#max-field-in").focus()}return e.submitted=!1,angular.isDefined(window.listMapType[e.listFields[t].field_type])?e.listFields[t].type=angular.copy(window.listMapType[e.listFields[t].field_type]):e.listFields[t].type=angular.copy(e.listFields[t].field_type),e.curStepField==e.listFields.length-1?void n.close(e.listFields):void(e.curStepField=t+1)},e.hiddenE=function(){e.errorMax=""},e.prevStepFileld=function(t){e.curStepField=t-1},e.eventPrevStepSecond=function(){0==e.result.sections.length?(e.stepFirst=!0,e.stepThird=!1):(e.stepSecond=!0,e.stepThird=!1)},e.cancel=function(){angular.element("#model-template-content").show(),n.dismiss("cancel")}}]).controller("ModalShowListConfigFields",["$scope","$modalInstance","$timeout","fields","$filter",function(e,t,n,a,i){e.listFieldType=window.listFieldType,e.listMapType=window.listMapType,e.mapListType=[];for(var o in e.listFieldType)e.mapListType[e.listFieldType[o]._id]=e.listFieldType[o].name;e.attributeDataOption=window.listAttributeDataOption,e.listIdCheck=angular.copy(window.listIdCheck),e.fields=a,e.fieldsRollback=angular.copy(e.fields),e.edit=[],e.validate=[],e.listBlocks=window.listBlocks,e.blockMapFields=[];for(var o in e.listBlocks){e.blockMapFields[o]=[];for(var r in e.listBlocks[o].fields){var l=e.listBlocks[o].fields[r].variable;e.blockMapFields[o][l]=e.listBlocks[o].fields[r].name}}e.mapSort={"":"None",asc:"Asc",desc:"Desc"},e.orderBySort=function(t,n){t||(e.fields[n].order_by="asc")},e.showEditField=function(t){e.edit[t]=!0},e.editField=function(t,n){isValidate=e.validateFields(t,n),isValidate||(angular.isDefined(window.listMapType[e.fields[t].field_type])?e.fields[t].type=angular.copy(window.listMapType[e.fields[t].field_type]):e.fields[t].type=angular.copy(e.fields[t].field_type),n.multiple&&null==n.min_field&&(e.fields[t].min_field=1),e.edit[t]=!1,e.fieldsRollback=angular.copy(e.fields))},e.rollbackItemField=function(t,n){e.validate[t]=[];for(var a in e.fieldsRollback)if(e.fieldsRollback[a].variable===n){e.fields[t]=angular.copy(e.fieldsRollback[a]);break}e.edit[t]=!1},e.checkValidateFields=function(){for(var t in e.fields){if(isValidate=e.validateFields(t,e.fields[t]),isValidate)return;angular.isDefined(window.listMapType[e.fields[t].field_type])?e.fields[t].type=angular.copy(window.listMapType[e.fields[t].field_type]):e.fields[t].type=angular.copy(e.fields[t].field_type),e.fields[t].multiple&&null==e.fields[t].min_field&&(e.fields[t].min_field=1)}n(function(){angular.element("#submit-field").trigger("click")},10)},e.hideValidate=function(t,n){"undefined"!=typeof e.validate[t]&&"undefined"!=typeof e.validate[t][n]&&(e.validate[t][n]="")},e.updateTitleCheck=function(t){("checkbox"!=e.fields[t].field_type&&"radio"!=e.fields[t].field_type||"checkbox"!=window.listMapType[e.fields[t].field_type]||"radio"!=window.listMapType[e.fields[t].field_type])&&"undefined"!=typeof e.fields[t].ra_check_title&&(e.fields[t].ra_check_title="")},e.updateContentField=function(){t.close(e.fields)},e.cancel=function(){t.dismiss("cancel")},e.validateFields=function(t,n){var a=!1;return e.validate[t]=[],0==n.name.length&&(e.validate[t].name=i("trans")("name","directive-cms-config")+" "+i("trans")("required","validate"),a=!0),n.max_field<0?(e.validate[t].max_field=i("trans")("max","golbal")+" "+i("trans")("invalid","validate"),a=!0):n.max_field&&n.max_field<n.min_field&&n.min_field>0&&(e.validate[t].max_field=i("trans")("max","golbal")+" "+i("trans")("invalid","validate"),a=!0),n.min_field<0?(e.validate[t].min_field=i("trans")("min","golbal")+i("trans")("invalid","validate"),a=!0):n.min_field>n.max_field&&n.max_field>0&&(e.validate[t].min_field=i("trans")("min","golbal")+" "+i("trans")("invalid","validate"),a=!0),"checkbox"!=n.field_type&&"radio"!=n.field_type&&"checkbox"!=window.listMapType[n.field_type]&&"radio"!=window.listMapType[n.field_type]||"undefined"!=typeof n.ra_check_title&&0!=n.ra_check_title.length||(e.validate[t].ra_check_title=i("trans")("title","golbal")+" "+i("trans")("required","validate"),a=!0),"select"!=n.field_type&&"select"!=window.listMapType[n.field_type]||"undefined"!=typeof n.option_id&&n.option_id||(e.validate[t]["data-option"]=i("trans")("option","golbal")+" "+i("trans")("required","validate"),a=!0),a}}]).directive("formatNumber",["$filter","$timeout",function(e,t){return{restrict:"A",require:"?ngModel",scope:{listTypes:"="},link:function(e,t,n,a){a.$viewChangeListeners.push(function(){var e=t.val();!e||isNaN(e)?(a.$setViewValue(null),a.$render()):String(e).length>=9&&!isNaN(e)&&(e=e.substr(0,9),a.$setViewValue(e),a.$render(),event.preventDefault())})}}}]);var fileUpload=angular.module("uls");fileUpload.directive("fileUpload",["FileService","Upload","$timeout",function(e,t,n){return{restrict:"EA",require:"^ngModel",scope:{files:"=",fileIds:"=",openPicture:"&",disabled:"=",control:"="},replace:!0,transclude:!0,templateUrl:baseUrl+"/app/shared/file-upload/views/file-upload.html?v=1",link:function(a,i,o,r){function l(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}var s=0;a.baseUrl=baseUrl,a.fileUpload={},a.fileUploaded=[],a.fileUploadIds=[],a.fileError={},a.uploadFinish=!0,r.$setViewValue({finished:a.uploadFinish}),a.numberFileUpload=[],a.upload=function(e){if(e&&e.length){s++,angular.isUndefined(a.numberFileUpload[s])&&(a.numberFileUpload[s]=[]);for(var i=0;i<e.length;i++)r.$setViewValue({finished:!1}),function(i){r.$setViewValue({finished:!1});var o=e[i];return angular.isDefined(window.maxUpload)&&o.size>window.maxUpload.size?(o.uniId=l(),o.proccess=100,o.error=1,o.status=0,a.fileUpload[o.uniId]=o,a.fileUpload[o.uniId].error="Max file size is "+window.maxUpload.name,a.fileError[o.uniId]=o,void r.$setViewValue({finished:!0})):(o.uniId=l(),o.proccess=0,o.error="",a.fileUpload[o.uniId]=o,void t.upload({url:baseUrl+"/support/file",file:o}).progress(function(e){if(r.$setViewValue({finished:!1}),angular.isDefined(a.fileUpload[o.uniId]))var t=parseInt(100*e.loaded/e.total);else{var t=100;a.uploadFinished=!0,r.$setViewValue({finished:a.uploadFinished})}angular.isDefined(a.fileUpload[o.uniId])&&(a.fileUpload[o.uniId].proccess=t,a.uploadFinished=!1,r.$setViewValue({finished:a.uploadFinished}))}).error(function(t,n,r,l){e.splice(1,i),angular.isDefined(a.fileUpload[o.uniId])&&(angular.isDefined(t.message)&&(a.fileUpload[o.uniId].error=t.message),a.fileError[l.file.uniId]=t)}).success(function(e,t,n,i){a.uploadFinished=!0,r.$setViewValue({finished:a.uploadFinished}),angular.isDefined(a.fileUpload[i.file.uniId])&&(e.item.uniId=i.file.uniId,a.fileUploaded.push(e.item),a.fileUploadIds.push(e.item.id))})["finally"](function(){a.uploadFinished=!0,n(function(){r.$setViewValue({ids:a.fileUploadIds,files:a.fileUploaded,finished:a.uploadFinished})})}))}(i)}},r.$render=function(){n(function(){a.filesUpload=r.$viewValue})},a.checkFile=function(t){return e.checkFile(t)},a.internalControl=a.control||{},a.internalControl.deleteAllFileUploaded=function(){delete a.fileUpload,a.fileUpload={},a.uploadFinished=!0,r.$setViewValue({ids:a.fileUploadIds,files:a.fileUploaded,finished:a.uploadFinished})},a.deleteFile=function(e){delete a.fileUpload[e];for(var t in a.fileUploaded)if(e==a.fileUploaded[t].uniId){var i=a.fileUploadIds.indexOf(a.fileUploaded[t].id);delete a.fileUploaded[t],a.fileUploadIds.splice(i,1)}a.uploadFinished=!0,n(function(){r.$setViewValue({ids:a.fileUploadIds,files:a.fileUploaded,finished:a.uploadFinished})})},a.$on("emptyFiles",function(e,t){a.fileUpload={},a.fileUploaded=[],a.fileUploadIds=[]})}}}]).filter("bytes",function(){return function(e,t){if(isNaN(parseFloat(e))||!isFinite(e))return"-";"undefined"==typeof t&&(t=1);var n=["bytes","kB","MB","GB","TB","PB"],a=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,Math.floor(a))).toFixed(t)+" "+n[a]}});var tagContentDirective=angular.module("tagContentDirective",[]),version=1;tagContentDirective.directive("tagContentDirective",["$timeout","$filter",function(e,t){return{require:"?ngModel",restrict:"EA",scope:{items:"=",text:"@",title:"@",textFilter:"@",index:"=",itemChoose:"=",currentPage:"=",selectedItems:"=selectedItems",allTags:"=",onClick:"&",itemSelected:"="},replace:!0,templateUrl:baseUrl+"/app/shared/tag-content-directive/view/view.html?v=7",link:function(t,n,a,i){var o=t.items;t.placeholder="Search Tag...","undefined"==typeof t.index&&(t.index=0),e(function(){$(document).on("click",function(e){$("#select-level-modal-"+t.index).hasClass("in")&&!$(".js-filterable-field").is(":focus")&&($("#select-level-modal-"+t.index).collapse("hide"),$("#select-level-modal-"+t.index).removeClass("opened"),$(".show-sub-tag-select i").removeClass("ti-minus").addClass("ti-plus"))}),$("#select-level-tag li:has(ul)").children("ul").addClass("off"),$("#select-level-tag li a i").addClass("ti-plus"),t.showSubSelect=function(e,t){e.preventDefault(),$(e.currentTarget).parent().parent().find("ul:first").toggleClass("off"),$(e.currentTarget).addClass("ti-plus"),$(e.currentTarget).toggleClass("ti-minus"),e.stopPropagation()}}),t.$watch("searchName",function(n,a){var i=[],r=[];if(angular.isDefined(n)&&""!=n){var l=".*"+n+".*",s=new RegExp(l,"gi");for(var d in allTags)allTags[d].name.match(s)&&i.push(allTags[d]);r=t.getFirstLevelOfTagSearched(i),t.itemsTmp={},t.itemsTmp=_.uniq(r),t.setValueDefaultForTag(),angular.forEach(i,function(e,n){t.expandAllChildTagWithTagIds(e.ancestor_ids)}),angular.forEach(t.tags,function(t,n){e(function(){$(".tag-content-"+t).prop("checked",!0),$(".show-sub-tag-select-"+t).addClass("active")})})}else""==n&&(t.itemsTmp=o,t.setValueDefaultForTag(),t.toggleTags())}),t.getFirstLevelOfTagSearched=function(e){var t=[];return angular.forEach(e,function(e,n){0==e.parent_id?t.push(_.find(o,function(t){return t._id==e._id})):t.push(_.find(o,function(t){return t._id==e.ancestor_ids[e.ancestor_ids.length-2]}))}),t},t.selectedItem=function(e,n){i.$setViewValue(e._id),itemIdNeedActived=e,$(".show-sub-tag-select-"+itemIdNeedActived._id).hasClass("active")?($(".show-sub-tag-select-"+itemIdNeedActived._id).removeClass("active"),$(".tag-content-"+itemIdNeedActived._id).prop("checked",!1)):($(".show-sub-tag-select-"+itemIdNeedActived._id).addClass("active"),$(".tag-content-"+itemIdNeedActived._id).prop("checked",!0)),t.onClick({pageId:t.currentPage._id,tagId:e._id}),n.stopPropagation()},t.SelectedCheckbox=function(e,n){t.selectedItem(e,n)},t.toggleSelectMenu=function(e){t.setValueDefaultForTag(),angular.isDefined(t.selectedItems)&&t.selectedItems.length>0&&t.activeTagAngParentWithTagIds(t.selectedItems),$("#select-level-modal-"+t.index).collapse("toggle"),$("#select-level-modal-"+t.index).hasClass("opened")?($("#select-level-modal-"+t.index).removeClass("opened"),t.itemsTmp=[]):($("#select-level-modal-"+t.index).addClass("opened"),t.itemsTmp=angular.copy(t.items)),t.searchName="",t.toggleTags()},t.setValueDefaultForTag=function(){e(function(){$(".show-sub-tag-select").removeClass("active"),$(".parrent-select").addClass("off"),$(".toggle-child-tag").removeClass("ti-minus").addClass("ti-plus")})},t.toggleTags=function(){e(function(){var e=[];e=angular.isDefined(t.currentPage.data)?t.currentPage.data.tags:t.currentPage.tags,angular.forEach(e,function(e,n){$(".tag-content-"+e).prop("checked",!0),$(".show-sub-tag-select-"+e).addClass("active");var a=_.find(t.allTags,function(t){return t._id==e});t.expandAllChildTagWithTagIds(a.ancestor_ids)})})},t.activeTagAngParentWithTagIds=function(n){e(function(){angular.forEach(n,function(e,n){$(".tag-content-"+e).prop("checked",!0),$(".show-sub-tag-select-"+e).addClass("active");var a=_.find(t.allTags,function(t){return t._id==e});t.expandAllChildTagWithTagIds(a.ancestor_ids)})})},t.expandAllChildTagWithTagIds=function(t){e(function(){for(var e in t)$(".show-sub-tag-select-"+t[e]).find("i:first").addClass("ti-minus"),$(".parrent-select-"+t[e]).removeClass("off")})}}}}]);var selectLevel=angular.module("selectLevel",[]),version=5;selectLevel.directive("selectLevel",["$timeout","$filter",function(e,t){return{require:"?ngModel",restrict:"EA",scope:{items:"=",text:"@",title:"@",textFilter:"@",index:"=",key:"=",itemChoose:"=",selectedItems:"=selectedItem",
onClick:"&",currentPage:"=",showIcon:"=",typeSelect:"=",disableClick:"=",notSelectCurrent:"=",chageType:"=",type:"=",canChooseFolder:"="},replace:!0,templateUrl:baseUrl+"/app/shared/select-level/view.html?v="+(new Date).getTime(),link:function(n,a,i,o){function r(e){var t={};return angular.forEach(e,function(e,n){t[e]=n}),t}n.currentIndex={value:0},"Asset"==n.type&&(n.items=window.assets),n.$watch("selectedItems",function(t,a){angular.isDefined(t)&&null!=t&&e(function(){var e={_id:t.selectedItemId,name:t.selectedItemName,parentIds:t.parentIds};n.selectedItem(e)})});var l="";"undefined"==typeof n.index&&(n.index=0),"undefined"==typeof n.key&&(n.key=0),e(function(){$(document).on("click",function(e){$("#select-level-modal-"+n.key+"-"+n.index).hasClass("in")&&!$(".js-filterable-field").is(":focus")&&($("#select-level-modal-"+n.key+"-"+n.index).collapse("hide"),$(".show-sub-select i").removeClass("fa fa-folder-open fa").addClass("fa fa-folder"))}),$("#select-level li:has(ul)").children("ul").addClass("off"),$("#select-level li a i").addClass("fa fa-folder"),n.listsId=[],n.showSubSelect=function(e,t){e.preventDefault(),$(e.currentTarget).parent().find("ul:first").toggleClass("off"),$(e.currentTarget).find("i").addClass("fa fa-folder"),$(e.currentTarget).find("i").toggleClass("fa fa-folder-open fa"),e.stopPropagation()},"undefined"!=typeof n.itemChoose&&d(n.items)}),n.focusInput=function(e){e.stopPropagation()};var s=0;n.selectedItem=function(e,a){""!=e._id&&"Assets"==n.typeSelect&&2>=s&&(1==Object.keys(e.parentIds).length?angular.forEach(n.items,function(t,a){t._id==e._id&&(n.items=[],n.items.push(t))}):angular.forEach(n.items,function(t,a){t._id==e.parentIds[Object.keys(e.parentIds).length-1]&&(n.items=[],n.items.push(t))})),s+=1,angular.isDefined(n.currentPage)&&angular.isDefined(e)&&e._id==n.currentPage._id||(angular.isDefined(a)&&a.preventDefault(),(angular.isDefined(e.parentIds)||angular.isDefined(e.parentId)||angular.isDefined(e.parent_id))&&""!=e.name?n.text=e.name:n.text=t("trans")("select-folder","directive-select-level"),o.$setViewValue(e._id),n.chageType&&n.onClick({pageId:e._id}),$("#select-level-modal-"+n.key+"-"+n.index).find(".name-select.active").removeClass("active"),l=e,$("#select-level-modal-"+n.key+"-"+n.index).find(".item-"+l._id).addClass("active"),angular.isDefined(a)&&$("#select-level-modal-"+n.key+"-"+n.index).collapse("hide"))},n.toggleSelectMenu=function(t){e(function(){n.itemsTmp=n.items}),"disabled"!=n.disableClick&&e(function(){if($(".show-sub-select").removeClass("active"),$("#select-level li a i").removeClass("fa fa-folder-open fa").addClass("fa fa-folder"),$(".parrent-select").addClass("off"),l)if(angular.forEach($(".item-"+l._id).parents("ul"),function(e,t){$(e).removeClass("off")}),$(".show-sub-select-"+l._id).addClass("active"),"Link"==n.type){var e=r(window.listsIdsMapPageAndContent);angular.forEach(l.parentIds,function(t,n){$(".show-sub-select-"+e[t]).find("i").removeClass("fa fa-folder").addClass("fa fa-folder-open fa")})}else angular.forEach(l.parentIds,function(e,t){l._id!=e&&$(".show-sub-select-"+e).find("i").removeClass("fa fa-folder").addClass("fa fa-folder-open fa")});$("#select-level-modal-"+n.key+"-"+n.index).collapse("toggle")})},n.closed=function(e){$("#select-level-modal-"+n.key+"-"+n.index).collapse("hide")};var d=function(e){for(var t in e)if(e[t].subFolder&&d(e[t].subFolder),e[t]._id==n.itemChoose){n.text=e[t].name;break}}}}}]);var cmsApp=angular.module("cmsContentFolderApp");cmsApp.service("CmsContentFolderService",["$q",function(e){var t,n=this,a=[],i=!1,o="",r="",l="";this.changeStatusHideOrShowAllNestedContent=function(){a=[],i=!i,0==i?(t.isFolder()?this.showFirstLevelOfChildPages(t.children):a.push(t),o="Show All Nested Content"):(t.isFolder()?this.showAllLevelOfChildPages(t.children):a.push(t),o="Hide All Nested Content");var n={textButton:o,contents:a,nodeActive:t},r=e.defer();return r.resolve(n),r.promise},this.getDataNestedFromActiveNode=function(){return a=[],t.isFolder()?this.showAllLevelOfChildPages(t.children):(t.openChild=!0,a.push(t)),a},this.getDataFromActiveNode=function(e){var n=["blocks","assets","templates"];if(!(n.indexOf(t.data.type)>-1)){if(a=[],t.isFolder()){e&&0!=t.data.parent_id&&a.push(t);for(var i in t.children)a.push(t.children[i])}else t.openChild=!0,a.push(t);return a}},this.reloadTree=function(){var e=$("#tree").fancytree("getTree");e.reload()},this.initTree=function(e){i=!1,$("#tree").fancytree({extensions:["glyph"],source:a,autoScroll:!0,activate:function(o,l){var s=$("#tree").fancytree("getTree"),d=$("#tree").fancytree("getActiveNode");d.sortChildren(null,!0),t=s.getNodeByKey(String(r)),null!=t?(t.setActive(),r=""):t=d,n.expandAllChildNodes(t);var c=t.getChildren();a=[],t.isFolder()&&!angular.isUndefined(t.folder)||a.push(t),0==i?n.showFirstLevelOfChildPages(c):n.showAllLevelOfChildPages(c);var u=e.call(u,a,t)},click:function(e,t){var n=t.node;if(!n.isExpanded()&&angular.isDefined(n.data.type))switch(n.data.type){case"assets":n.data.type!=l&&$("#page-loading").css("display","block"),$("#click-asset").click();break;case"templates":n.data.type!=l&&$("#page-loading").css("display","block"),$("#click-template").click();break;case"pages":n.data.type!=l&&$("#page-loading").css("display","block"),$("#click-page").click();break;case"blocks":n.data.type!=l&&$("#page-loading").css("display","block"),$("#click-block").click();break;case"database":n.data.type!=l&&$("#page-loading").css("display","block"),$("#click-database").click();break;case"accessories":1!=n.isActive()&&$("#page-loading").css("display","block");break;case"lasers":1!=n.isActive()&&$("#page-loading").css("display","block");break;case"material":1!=n.isActive()&&$("#page-loading").css("display","block");break;case"platform":1!=n.isActive()&&$("#page-loading").css("display","block");break;case"product":1!=n.isActive()&&$("#page-loading").css("display","block")}}}),n.expandedRootNode()},this.expandAllChildNodes=function(e){"0"!=e.data.parent_id&&(e.setExpanded(!0),e.visit(function(e){e.setExpanded(!0)}))},this.cosllapseAllNodeNotActive=function(){},this.showFirstLevelOfChildPages=function(e){null==e||"Loading..."==e[0].title?e=[]:angular.forEach(e,function(e,t){e.isFolder()||a.push(e)})},this.showAllLevelOfChildPages=function(e){null==e||"Loading..."==e[0].title?e=[]:angular.forEach(e,function(e,t){e.hasChildren()?n.showAllLevelOfChildPages(e.children):e.isFolder()||a.push(e)})},this.expandedRootNode=function(){var e=$("#tree").fancytree("getTree"),t=e.getRootNode().children;for(var n in t)if(t[n].data.type==l)var a=n;var i=e.getRootNode().children[a];angular.isDefined(i)&&i.setActive(),i.hasChildren()&&i.setExpanded()},this.setActiveNode=function(e){r=e},this.setContents=function(e,t){return l=t,a=e},this.getContents=function(){return a}}]);var cmsApp=angular.module("CmsApp",[]);cmsApp.service("CmsService",["$q","$filter",function(e,t){var n=[],a=[],i=[],o=[];this.setHeightTable=function(){var e=window.innerHeight;$(".table-animate").css({height:e-170+"px"})},this.setFieldsContent=function(e){if("undefined"!=typeof e)for(var t in e)n[e[t].variable]=e[t]},this.setSectionsContent=function(e){if("undefined"!=typeof e)for(var t in e)a[e[t].variable]=e[t]},this.getFieldsNew=function(e){var t=[];for(var a in e)"undefined"==typeof n[e[a].variable]?t.push(e[a]):i.push(e[a]);return t},this.setFieldsOld=function(){i=[]},this.getSectionsNew=function(e){var t=[];for(var n in e)"undefined"==typeof a[e[n].variable]?t.push(e[n]):o.push(e[n]);return t},this.setSectionsOld=function(){o=[]},this.mapDataFields=function(e){for(var t in i)"undefined"!=typeof n[i[t].variable]&&(i[t].multiple!=n[i[t].variable].multiple&&(n[i[t].variable].multiple=i[t].multiple),i[t]=n[i[t].variable]);for(var t in e)i.push(e[t]);return i},this.mapDataSections=function(e){for(var t in o)"undefined"!=typeof a[o[t].variable]&&(o[t]=a[o[t].variable]);for(var t in e)o.push(e[t]);return o}}]),angular.module("treeresizer",[]).directive("resizer",["$document",function(e){return function(t,n,a){function i(){var e=$(window).outerHeight(),t=$(".navibar-uls").outerHeight(),n=$(".top-content").outerHeight();$(".content").height(e-(t+n+19))}function o(e){var t=$("#sidebar").outerWidth();$("#resize-left").unbind();var i=e.pageX-t;a.resizerMax&&i>a.resizerMax&&(i=parseInt(a.resizerMax)),n.css({left:i+"px"}),$(a.resizerLeft).css({width:i+"px"}),$(a.resizerRight).css({left:i+parseInt(a.resizerWidth)+"px"})}function r(){e.unbind("mousemove",o),e.unbind("mouseup",r)}i(),$(window).resize(i),n.on("mousedown",function(t){t.preventDefault(),e.on("mousemove",o),e.on("mouseup",r)})}}]);