function humanized_time_span(e,t,i,n){function a(){for(var e=0;e<i[d].length;e++)if(null==i[d][e].ceiling||l<=i[d][e].ceiling)return i[d][e];return null}function s(){for(var e=l,t={},i=0;i<n.length;i++){var a=Math.floor(e/n[i][0]);e-=n[i][0]*a,t[n[i][1]]=a}return t}function r(e){var t=s(),i=e.text.replace(/\$(\w+)/g,function(){return t[arguments[1]]});return o(i,t)}function o(e,t){for(var i in t)if(1==t[i]){var n=new RegExp("\\b"+i+"\\b");e=e.replace(n,function(){return arguments[0].replace(/s\b/g,"")})}return e}if(i=i||{past:[{ceiling:60,text:"$seconds seconds ago"},{ceiling:3600,text:"$minutes minutes ago"},{ceiling:86400,text:"$hours hours ago"},{ceiling:2629744,text:"$days days ago"},{ceiling:31556926,text:"$months months ago"},{ceiling:null,text:"$years years ago"}],future:[{ceiling:60,text:"in $seconds seconds"},{ceiling:3600,text:"in $minutes minutes"},{ceiling:86400,text:"in $hours hours"},{ceiling:2629744,text:"in $days days"},{ceiling:31556926,text:"in $months months"},{ceiling:null,text:"in $years years"}]},n=n||[[31556926,"years"],[2629744,"months"],[86400,"days"],[3600,"hours"],[60,"minutes"],[1,"seconds"]],"Invalid Date"==new Date(e))for(;-1!=String(e).indexOf("-");)e=e.replace("-","/");e=new Date(e),t=t?new Date(t):new Date;var l=(t-e)/1e3,d="past";return 0>l&&(d="future",l=0-l),r(a())}angular.module("user",[]),angular.module("permission",[]),angular.module("role",[]),angular.module("multiSelect",[]),angular.module("ticket",[]),angular.module("type",[]),angular.module("dataOption",[]),angular.module("nlcFilter",[]),angular.module("file",[]),angular.module("AppLanguage",[]),angular.module("TemplateManagerApp",[]),angular.module("RegionApp",[]),angular.module("campaignApp",[]),angular.module("campaignDetailApp",[]),angular.module("MarketsegmentApp",[]),angular.module("notification",[]),angular.module("transApp",[]),angular.module("assetManager",[]),angular.module("BlockApp",[]),angular.module("ChannelPartnersApp",[]),angular.module("roleGroup1",[]),angular.module("filedType",[]),angular.module("filed",[]),angular.module("term",[]),angular.module("customFormatDate",[]),angular.module("SeoAnalysisApp",[]),angular.module("pageApp",[]),angular.module("treeresizer",[]),angular.module("CreatePageApp",[]),angular.module("EditDraftApp",[]),angular.module("fomatHtml",[]),angular.module("colorpicker.module",[]),angular.module("formBuilderDirectiveApp",[]),angular.module("appManageTerm",[]),angular.module("TermTemplateManagerApp",[]),angular.module("configurator",[]),angular.module("TemplateContentManager",[]),angular.module("cmsContentFolderApp",[]),angular.module("lowercaseCharater",[]),angular.module("selectLevel",[]),angular.module("modalSelectLevel",[]),angular.module("configField",[]),angular.module("cmsContentInsertApp",[]),angular.module("confirmDirective",[]),angular.module("CmsApp",[]),angular.module("checkLimitAndChangeDateTimeDirectiveApp",[]),angular.module("tagContentApp",[]),angular.module("tagContentDirective",[]),angular.module("cmsContentTagApp",[]),angular.module("viewDraft",[]),angular.module("databaseManager",[]),angular.module("selectLevelDatabase",[]),angular.module("modalSelectPage",[]),angular.module("configFormDatabaseApp",[]),angular.module("historyApp",[]),angular.module("BlockNestedApp",[]),angular.module("selectLevelAsset",[]),angular.module("MaterialApp",[]),angular.module("draganddrop",[]),angular.module("activityLog",[]),angular.module("translation",[]),angular.module("HelpEditorApp",[]),angular.module("helpEditorDirective",[]),angular.module("selectLevelHelp",[]),angular.module("cache",[]),angular.module("file",[]),angular.module("treeresize",[]),angular.module("test",[]),angular.module("guide",[]),angular.module("PlatformsApp",[]),angular.module("accessories",[]);var defaultModules=["ui.bootstrap","ngResource","ngCookies","ngFileUpload","ngRoute","toggle-switch","ngImgCrop","ngTable","user","role","permission","multiSelect","ticket","type","dataOption","nlcFilter","file","xeditable","timer","AppLanguage","TemplateManagerApp","RegionApp","campaignApp","campaignDetailApp","MarketsegmentApp","notification","transApp","assetManager","BlockApp","ChannelPartnersApp","roleGroup1","filedType","filed","term","ui-iconpicker","customFormatDate","SeoAnalysisApp","pageApp","treeresizer","CreatePageApp","EditDraftApp","fomatHtml","colorpicker.module","formBuilderDirectiveApp","appManageTerm","TermTemplateManagerApp","mgo-angular-wizard","configurator","TemplateContentManager","cmsContentFolderApp","lowercaseCharater","selectLevel","configField","cmsContentInsertApp","confirmDirective","CmsApp","checkLimitAndChangeDateTimeDirectiveApp","tagContentApp","tagContentDirective","cmsContentTagApp","viewDraft","modalSelectLevel","databaseManager","selectLevelDatabase","modalSelectPage","configFormDatabaseApp","historyApp","BlockNestedApp","selectLevelAsset","MaterialApp","ui.sortable","activityLog","translation","HelpEditorApp","helpEditorDirective","selectLevelHelp","cache","file","treeresize","guide","PlatformsApp","accessories"];"undefined"!=typeof modules&&(defaultModules=defaultModules.concat(modules));var myApp=angular.module("uls",defaultModules);angular.module("uls").run(["editableOptions",function(e){e.theme="bs3"}]),angular.module("uls").config(["$logProvider",function(e){e.debugEnabled(window.debug)}]),"undefined"!=typeof angularMock&&(defaultModules=defaultModules.concat(angularMock));var goTo=function(e){window.location.href="#_"+e,$("#fix-modal-top").scrollTop(0),$("#"+e).hasClass("in")||$("#"+e).prev().trigger("click")};myApp.config(["$httpProvider",function(e){e.interceptors.push(["$q",function(e){e.defer();return{responseError:function(t){var i=angular.element(".butterbar-container");switch(t.status){case 401:return void(window.location.href=window.baseUrl);case 404:i.hasClass("hidden")&&i.removeClass("hidden");break;case 500:i.hasClass("hidden")&&i.removeClass("hidden")}return e.reject(t)}}}])}]),function(e){function t(){var t=window.innerHeight;screen.height;e(".table-responsive.set-height, .table-responsive#tb-group-user").css({height:t-170+"px"}),e(".table-animate").css({height:t-170+"px"}),e("#search-page,.box-maps").css({height:t-105+"px"}),e(".box-list-rep").css({height:t-100+"px"}),e("#load-maps").css({height:t-185+"px"})}e(document).ready(t),e(window).resize(t),e(document).ready(function(){e(".dropdown-menu table tr td button").removeAttr("style")}),e(document).ready(function(){setTimeout(function(){var t=e("#frame_html").contents().find("head");t.append('<style type="text/css">.area_toolbar{background-color:#f1f1f1;}#editor{border:solid #ccc 1px}#result{border-top:solid #ccc 1px;border-bottom: solid #ccc 1px}.editarea_popup{box-shadow: 0px 4px 36px rgba(177, 177, 177, 0.75);border: solid 1px #CCCCCC;background-color: #FFFFFF;}.area_toolbar select{font-size:9pt;background-color:#fff}</style>')},1e3)}),e(window).load(function(){e(".step3 .show-more").click(function(){e(".step3 .wrap-more-product").toggleClass("show")})}),e(document).ready(function(){e(".nav-icon").click(function(){e(this).toggleClass("open"),e("#pagehome").toggleClass("on-off")})});var i,n,a,s,r,o,l;e(".next").click(function(){return l?!1:(l=!0,i=e(this).parent(),n=e(this).parent().next(),n.show(),void i.animate({opacity:0},{step:function(e,t){o=1-.2*(1-e),s=50*e+"%",r=1-e,i.css({transform:"scale("+o+")"}),n.css({left:s,opacity:r})},duration:800,complete:function(){i.hide(),l=!1},easing:"easeInOutBack"}))}),e(".previous").click(function(){return l?!1:(l=!0,i=e(this).parent(),a=e(this).parent().prev(),a.show(),void i.animate({opacity:0},{step:function(e,t){o=.8+.2*(1-e),s=50*(1-e)+"%",r=1-e,i.css({left:s}),a.css({transform:"scale("+o+")",opacity:r})},duration:800,complete:function(){i.hide(),l=!1},easing:"easeInOutBack"}))}),e(".submit").click(function(){return!1})}(jQuery),angular.module("uls").controller("BaseController",["$scope","$parse","$timeout","$modal","UserService","AssetManagerService",function(e,t,i,n,a,s){if(angular.element(".wrapper").removeClass("hidden"),a.setData(window.usersMap),i(function(){"undefined"!=typeof e.callbackLoadUserFinish&&(e.callbackLoadUserFinish(),e.users_map=a.getUsersMap())}),e.testFuture=window.testFuture,1==e.testFuture&&angular.element(".test").removeClass("hidden"),e.windowType=window.info,"undefined"!=typeof window.info)for(var r in window.info){var o=t(r);o.assign(e,window.info[r])}e.initDate=function(){angular.element(".date").bdatepicker({format:"yyyy-mm-dd"})},e.viewModalImage=function(e){var t=n.open({templateUrl:baseUrl+"/app/components/termTemplateManager/views/modal/viewImage.html",controller:"ModalViewPictureCtrl",size:void 0,windowClass:"show-img",resolve:{fileId:function(){return e}}});t.result.then(function(e){},function(){})},e.urlForm=[],e.getUrlImageAssetForm=function(t,i){"undefined"==typeof e.urlForm[t]&&(e.urlForm[t]=[]),s.getUrlImageAsset(t).then(function(n){e.urlForm[t][i]=n.url})},e.removeThumbnailAssertForm=function(t,i){e.urlForm[t][i]=""},e.initTooltip=function(e){$('[data-toggle="tooltip"]').tooltip()}}]).controller("ModalViewPictureCtrl",["$scope","$modalInstance","fileId",function(e,t,i){e.fileId=i,e.baseUrl=baseUrl,e.cancel=function(){t.dismiss("cancel")}}]);var userModule=angular.module("user");userModule.factory("UserResource",["$resource",function(e){return e("/api/user/:method/:id",{method:"@method",id:"@id"},{add:{method:"post"},save:{method:"post"},update:{method:"put"}})}]).factory("UserService",["$q","$filter","UserResource",function(e,t,i){var n=[],a=[],s=[],r=this,o={},l={};return this.setHashData=function(e){o=e},this.create=function(t){if("undefined"!=typeof t.id)return r.update(t);var a=e.defer(),s=new i(t);return s.$save({},function(e){e.status&&e.item&&(n.push(e.item),"undefined"==typeof e.item.last_login&&(e.item.last_login="0000-00-00 00:00:00")),a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.changePassword=function(t){var n=e.defer(),a=new i(t);return a.$save({method:"change-password",id:t.id},function(e){e.status?n.resolve(e):n.reject(e)},function(e){n.reject(e.data)}),n.promise},this.changeRoles=function(t){var n=e.defer(),a=new i(t);return a.$save({method:"change-roles"},function(e){e?n.resolve(e):n.reject(e)},function(e){n.reject(e.data)}),n.promise},this.update=function(t){var a=e.defer(),s=new i(t);return s.$update({id:t.id},function(e){if(e.status)for(var t in n)if(n[t].id==e.item.id){n[t]=e.item;break}a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.get=function(t){var n=e.defer();return i.get({id:t},function(e){n.resolve(e)}),n.promise},this.query=function(){var t=e.defer();return i.query(function(e){n=e,t.resolve(e)}),t.promise},this.queryUsersManager=function(){var t=e.defer();return i.query({method:"get-all-user-manager"},function(e){n=e,t.resolve(e)}),t.promise},this.remove=function(t){var a=e.defer();return i["delete"]({id:t},function(e){if(e.status)for(var i in n)if(n[i].id==t){n[i].status="no";break}a.resolve(e)}),a.promise},this.pushUser=function(e){n.push(e)},this.updateUser=function(e){for(var t in n)if(n[t].id==e.id){e.status="yes",n[t]=e;break}},this.changeAvatar=function(t,n){var a=e.defer();return i.save({method:"change-avatar",file:n,id:t},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.resetPassword=function(t){var n=e.defer();return i.save({method:"email",entity:"password",email:t},function(e){n.resolve(e)},function(e){n.resolve(e.data)}),n.promise},this.getUsers=function(){return n},this.getUserById=function(e){return l[e]},this.getUsersMap=function(){return l},this.listMap=function(e,t){if("role"==t)for(var i in e)a[e[i].id]=e[i];else for(var i in e)s[e[i].id]=e[i]},this.getMap=function(e){return"role"==e?a:s},this.userBranchManager=function(t){var n=e.defer();return i.query({id:t,method:"get-users-branch-manager"},function(e){n.resolve(e)}),n.promise},this.updatePermissions=function(t,n){var a=e.defer();return i.save({id:t,permissionIds:n,method:"update-permission"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.updateGroup=function(t,n){var a=e.defer();return i.save({id:t,groupIds:n,method:"update-group"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.updateRoles=function(t,n){var a=e.defer();return i.save({id:t,roleIds:n,method:"update-role"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.changeStatus=function(t){var a=e.defer();return i["delete"]({id:t,method:"change-status"},function(e){if(e.status)for(var i in n)if(n[i].id==t){n[i].status="yes";break}a.resolve(e)}),a.promise},this.setData=function(e){n=e;for(var t in e)l[e[t].id]=e[t];return n},this.updateShowDueDateUser=function(t){var n=e.defer(),a=new i(t);return a.$save({method:"update-show-due-date-user"},function(e){n.resolve(e)},function(e){n.resolve(e.data)}),n.promise},this}]);var assetmanagerApp=angular.module("assetManager",["ngResource","ui.bootstrap","ngSanitize","ngTable"]);assetmanagerApp.factory("AssetManagerResource",["$resource",function(e){return e("/api/asset-manager/:method/:id",{method:"@method",id:"@id"},{add:{method:"post"},save:{method:"post"},update:{method:"put"},editNameFolder:{method:"edit-name-folder"}})}]).service("AssetManagerService",["AssetManagerResource","$q",function(e,t){var i=this,n=[];this.createFolderProvider=function(n){if("undefined"!=typeof n.id)return i.editFolderAndFile(n);var a=t.defer(),s=new e(n);return s.$save({method:"create-folder"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.uploadNewAsset=function(i){var a=t.defer(),s=new e(i);return s.$save({method:"upload-new-asset"},function(e){0!=e.status&&n.push(e.item),a.resolve(e.item)},function(e){a.resolve(e.data)}),a.promise},this.createNewAsset=function(i){var a=t.defer(),s=new e(i);return s.$save({method:"create-new-asset"},function(e){0!=e.status&&n.push(e.item),a.resolve(e.item)},function(e){a.resolve(e.data)}),a.promise},this.saveFieldFile=function(i){var n=t.defer(),a=new e(i);return a.$save({method:"save-file-asset"},function(e){n.resolve(e)},function(e){n.resolve(e.data)}),n.promise},this.editFile=function(i){var n=t.defer(),a=new e(i);return a.$save({method:"edit-file"},function(e){n.resolve(e)},function(e){n.resolve(e.data)}),n.promise},this.crop=function(i){var n=t.defer(),a=new e(i);return a.$save({method:"crop"},function(e){n.resolve(e)},function(e){n.resolve(e.data)}),n.promise},this.addTagsForPage=function(i,n){var a=t.defer(),s=new e(n);return s.$save({id:i,method:"add-tags"},function(e){0!=e.status,a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.getAssetManagerById=function(i){var n=t.defer(),a=new e;return a.$get({id:i},function(e){n.resolve(e)},function(e){n.resolve(e.data)}),n.promise},this.setAssetManagers=function(e){return n=e},this.getAssetManagers=function(){return n},this.getUrlImageAsset=function(i){var n=t.defer();return e.get({id:i,method:"get-url-image-asset"},function(e){n.resolve(e)}),n.promise},this.deleteFolderAndAsset=function(i){var n=t.defer(),a=new e;return a.$delete({id:i},function(e){n.resolve(e)},function(e){n.resolve(e.data)}),n.promise},this.deleteAssetFile=function(i){var n=t.defer(),a=new e;return a.$get({id:i,method:"delete-file"},function(e){n.resolve(e)},function(e){n.resolve(e.data)}),n.promise},this.editNameFolder=function(i){var n=t.defer(),a=new e(i);return a.$save({id:i.id,method:"edit-name-folder"},function(e){0!=e.status&&n.resolve(e)},function(e){n.resolve(e.data)}),n.promise},this.updateContentFile=function(i,n){var a=t.defer(),s=new e(n);return s.$save({id:i,method:"update-content-file"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise}}]),angular.module("uls").controller("NotificationController",["$scope","$filter","NotificationService","$controller","$timeout",function(e,t,i,n,a){function s(){}function r(){if(f=!1,c.length>0){var e=c.shift();l(e)}}function o(){}function l(t){if(f)return void c.push(t);if(f=!0,-1==t.data.sender_id)var i=e.baseUrl+"/160x160_avatar_default.png?t=1";else var i=e.users_map[t.data.sender_id].avatar;var n=new Notify("Notification",{icon:i,body:t.data.message,tag:t.data.sender_id,notifyShow:s,notifyClose:r,notifyClick:function(){window.location.href="/"+t.data.href},notifyError:o,timeout:5});n.show()}n("BaseController",{$scope:e}),e.callbackLoadUserFinish=function(){},angular.element("#notification-top").removeClass("hidden"),e.baseUrl=window.baseUrl;var d=10;e.limitTo=d;var u=1;e.notifications=[];var c=[],f=!1;e.amount=0,$(".scroll-noti1").scroll(function(){$(this)[0].scrollHeight-$(this).scrollTop()===$(this).outerHeight()&&e.$apply(function(){e.limitTo=e.limitTo+d})});var p=RowboatPusher.subscribe("notification_ticket");p.bind("Rowboat\\Notification\\Events\\Notifications\\Broadcast\\NotificationTicket",function(t){e.$apply(function(){"undefined"!=typeof t.data.user_id&&-1!=t.data.user_id.indexOf(window.userId)&&(l(t),u=1,e.amount++)})}),e.getNotifications=function(){i.query(u).then(function(t){u&&e.setUserReadThisNotification(),e.notifications=t,e.hightlight=angular.copy(e.amount),e.amount=0,u=0})},e.setUserReadThisNotification=function(){i.setRead().then(function(){})},i.getAmountNotificationsNotRead().then(function(t){e.amount=t.result})}]);var permissionModule=angular.module("notification");permissionModule.factory("NotificationResource",["$resource",function(e){return e("/api/notification/:method/:id",{},{add:{method:"post"},save:{method:"post"}})}]).service("NotificationService",["$q","$filter","NotificationResource",function(e,t,i){var n=[];this.getAmountNotificationsNotRead=function(t){var n=e.defer();return i.get({method:"amount-notifications-not-read"},function(e){n.resolve(e)}),n.promise},this.query=function(t){var a=e.defer();return t?i.query().$promise.then(function(e){n=e,a.resolve(n)}):a.resolve(n),a.promise},this.notificationInvite=function(t){var n=e.defer(),a=new i(t);return a.$save({data:t,method:"invite"},function(e){n.resolve(e)},function(e){n.resolve(e.data)}),n.promise},this.setRead=function(){var t=e.defer(),n=new i;return n.$save({method:"set-read"},function(e){t.resolve(e)},function(e){t.resolve(e.data)}),t.promise}}]),notificationModule=angular.module("notification"),notificationModule.directive("notification",[function(){return{restrict:"AE",scope:{item:"="},replace:!0,templateUrl:baseUrl+"/app/shared/notification/views/notification.html",link:function(){}}}]);var module=angular.module("uls");module.directive("rowboatRequired",function(){return{restrict:"A",require:"ngModel",link:function(e,t,i,n){"undefined"==typeof e.$eval(i.ngModel)&&n.$setValidity("rowboatRequired",!1),t.on("focus",function(a){e.$watch(i.ngModel,function(e){var i="undefined"!=typeof e&&0!=e.length;if(i)t.parent().find("span").remove(),t.parent().removeClass("error"),n.$setValidity("rowboatRequired",i);else if(0==t.parent().find("span").length){t.parent().addClass("error");var a='<span class="control-label">It is required</span>';t.parent().append(a),n.$setValidity("rowboatRequired",i)}})})}}}),module.directive("rowboatLength",function(){return{restrict:"A",require:"ngModel",link:function(e,t,i,n){"undefined"!=typeof e.$eval(i.ngModel)&&e.$eval(i.ngModel).length!=i.rowboatLength&&n.$setValidity("rowboatLength",!1),t.on("focus",function(a){e.$watch(i.ngModel,function(e){var a=i.rowboatLength,s="undefined"!=typeof e&&e.length==a;if(s)t.parent().find("span").remove(),t.parent().removeClass("error"),n.$setValidity("rowboatLength",s);else if(0==t.parent().find("span").length){t.parent().addClass("error");var r='<span class="control-label">Length is '+a+"</span>";t.parent().append(r),n.$setValidity("rowboatLength",s)}})})}}}),module.directive("rowboatMinLength",function(){return{restrict:"A",require:"ngModel",link:function(e,t,i,n){"undefined"!=typeof e.$eval(i.ngModel)&&e.$eval(i.ngModel).length<i.rowboatMinLength&&n.$setValidity("rowboatMinLength",!1),t.on("focus",function(a){e.$watch(i.ngModel,function(e){var a=i.rowboatMinLength,s="undefined"!=typeof e&&e.length>=a;if(s)t.parent().find("span").remove(),t.parent().removeClass("error"),n.$setValidity("rowboatMinLength",s);else if(0==t.parent().find("span").length){t.parent().addClass("error");var r='<span class="control-label">Min length is '+a+"</span>";t.parent().append(r),n.$setValidity("rowboatMinLength",s)}})})}}}),module.directive("rowboatMaxLength",function(){return{restrict:"A",require:"ngModel",link:function(e,t,i,n){"undefined"!=typeof e.$eval(i.ngModel)&&e.$eval(i.ngModel).length>i.rowboatMaxLength&&n.$setValidity("rowboatMaxLength",!1),t.on("focus",function(a){e.$watch(i.ngModel,function(e){var a=i.rowboatMaxLength,s="undefined"!=typeof e&&e.length<=a;if(s)t.parent().find("span").remove(),t.parent().removeClass("error"),n.$setValidity("rowboatMaxLength",s);else if(0==t.parent().find("span").length){t.parent().addClass("error");var r='<span class="control-label">Max length is '+a+"</span>";t.parent().append(r),n.$setValidity("rowboatMaxLength",s)}})})}}}),module.directive("rowboatEmailPattern",function(){return{restrict:"A",require:"ngModel",link:function(e,t,i,n){$pattern=/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/,"undefined"==typeof e.$eval(i.ngModel)&&n.$setValidity("rowboatEmailPattern",!1),t.on("blur",function(a){e.$watch(i.ngModel,function(e){var i="undefined"!=typeof e&&$pattern.test(e);if(i)t.parent().find("span").remove(),t.parent().removeClass("error"),n.$setValidity("rowboatEmailPattern",i);else if(0==t.parent().find("span").length){t.parent().addClass("error");var a='<span class="control-label">Email Invalid</span>';t.parent().append(a),n.$setValidity("rowboatEmailPattern",i)}})})}}});var filterDate=angular.module("customFormatDate",[]);filterDate.filter("myDate",["$filter",function(e){return function(t,i){if(null==t)return"";if("Invalid Date"==new Date(t))for(;-1!=String(t).indexOf("-");)t=t.replace("-","/");if("Invalid Date"==new Date(t))return"";var n=e("date")(new Date(String(t)),angular.isUndefined(i)?"MM-dd-yyyy":i);return String(n)}}]).filter("myDateL",["$filter",function(e){return function(t){if(null==t)return"";if("Invalid Date"==new Date(t))for(;-1!=String(t).indexOf("-");)t=t.replace("-","/");if("Invalid Date"==new Date(t))return"";var i=e("date")(new Date(String(t)),"MMMM d, y");return String(i)}}]).filter("myDateTime",["$filter",function(e){return function(t){if(null==t)return"";if("0000-00-00 00:00:00"==t)return"";if("Invalid Date"==new Date(t))for(;-1!=String(t).indexOf("-");)t=t.replace("-","/");if("Invalid Date"==new Date(t))return"";var i=e("date")(new Date(String(t)),"MM-dd-yyyy HH:mm:ss");return String(i)}}]).filter("myDateShortTime",["$filter",function(e){return function(t){if(null==t)return"";if("0000-00-00 00:00:00"==t)return"";if("Invalid Date"==new Date(t))for(;-1!=String(t).indexOf("-");)t=t.replace("-","/");if("Invalid Date"==new Date(t))return"";var i=e("date")(new Date(String(t)),"MM-dd-yyyy h:mma");return String(i)}}]).filter("clientDate",["$filter",function(e){return function(t,i){if(null==t)return"";if("0000-00-00 00:00:00"==t)return"";if("Invalid Date"==new Date(t))for(;-1!=String(t).indexOf("-");)t=t.replace("-","/");if("Invalid Date"==new Date(t))return"";t=new Date(t),t=new Date(parseInt(new Date(t).getTime())-60*parseInt((new Date).getTimezoneOffset())*1e3);var n=e("date")(new Date(String(t)),angular.isUndefined(i)?"MM-dd-yyyy":i);return String(n)}}]).filter("clientDateTime",["$filter",function(e){return function(t){return e("date")(checkInvalid(t),window.dateTimeFormat)}}]).filter("clientLogDate",["$filter",function(e){return function(t){return e("date")(checkInvalid(t),window.logDate)}}]).filter("clientMediumDate",["$filter",function(e){return function(t){return e("date")(checkInvalid(t),window.mediumDate)}}]).filter("clientShortTime",["$filter",function(e){return function(t){return e("date")(checkInvalid(t),window.shortTime)}}]).filter("clientShortTimeFollowTimezone",["$filter",function(e){return function(t,i){if(null==t)return"";if("Invalid Date"==new Date(t))for(;-1!=String(t).indexOf("-");)t=t.replace("-","/");if("Invalid Date"==new Date(t))return"";var n=e("date")(new Date(String(t)),window.shortTime);return String(n)}}]).filter("formatCurrentDate",["$filter",function(e){return function(e){if(e=checkInvalid(e),!e)return"";e=new Date(e);var t=e.getMonth()+"-"+e.getDate()+"-"+e.getFullYear();return String(t)}}]).filter("formatCurrentTime",["$filter",function(e){return function(e){if(e=checkInvalid(e),!e)return"";e=new Date(e);var t=e.getHours()>=12?"pm":"am",i=parseInt(e.getHours())%12;i=i?10>i?"0"+i:i:12;var n=parseInt(e.getMinutes())<10?"0"+e.getMinutes():e.getMinutes(),a=parseInt(e.getSeconds())<10?"0"+e.getSeconds():e.getSeconds(),s=i+"-"+n+"-"+a+" "+t;return String(s)}}]).filter("formatCurrentShortTime",["$filter",function(e){return function(e){if(e=checkInvalid(e),!e)return"";e=new Date(e);var t=e.getHours()>=12?"pm":"am",i=parseInt(e.getHours())%12;i=i?10>i?"0"+i:i:12;var n=parseInt(e.getMinutes())<10?"0"+e.getMinutes():e.getMinutes(),a=i+":"+n+" "+t;return String(a)}}]);var checkInvalid=function(e,t){if(null==e)return"";if("Invalid Date"==new Date(e))for(;-1!=String(e).indexOf("-");)e=e.replace("-","/");return"Invalid Date"==new Date(e)?"":(e=new Date(e),e=new Date(parseInt(new Date(e).getTime())-60*parseInt((new Date).getTimezoneOffset())*1e3),new Date(String(e)))};angular.module("nlcFilter").filter("elapsedtime",function(){return function(e){return humanized_time_span(e)}});var translation=angular.module("translation",[]);translation.filter("trans",["$filter",function(e){return function(e,t){return null==e?"":window.translations[t][e]}}]);var selectLevel=angular.module("helpEditorDirective",[]),version=5;selectLevel.directive("helpEditorDirective",["$timeout","$filter",function(e,t){return{require:"?ngModel",restrict:"EA",scope:{items:"=",text:"@",selectedItems:"=selectedItem",onClick:"&"},replace:!0,templateUrl:baseUrl+"/app/components/user/help-editor/view/view-help.html?v="+(new Date).getTime(),link:function(t,i,n,a){t.description="",t.recursiveGetDescription=function(e){angular.forEach(e,function(e,i){e.parent=!1,t.description+='<strong class="space-topic" id="_'+e._id+'">'+e.name+"</strong>"+e.description,e.subFolder.length>0&&t.recursiveGetDescription(e.subFolder)})},t.getDesctiption=function(){angular.forEach(t.items,function(e,i){e.parent=!0,t.description+='<h4 id="_'+e._id+'" class="c-primary">'+e.name+'</h4><div class="space-area user-ad-area">'+e.description,t.recursiveGetDescription(e.subFolder),t.description+="</div>"})},t.getDesctiption(),t.goToAnchorWithId=function(e){window.location.href="#"+e,$("#fix-modal-top").scrollTop(0)},e(function(){$(".sub-select-"+t.items[0]._id).addClass("in")})}}}]),angular.module("treeresizer",[]).directive("resizer",["$document",function(e){return function(t,i,n){function a(){var e=$(window).outerHeight(),t=$(".navibar-uls").outerHeight(),i=$(".top-content").outerHeight();$(".content").height(e-(t+i+19))}function s(e){var t=$("#sidebar").outerWidth();$("#resize-left").unbind();var a=e.pageX-t;n.resizerMax&&a>n.resizerMax&&(a=parseInt(n.resizerMax)),i.css({left:a+"px"}),$(n.resizerLeft).css({width:a+"px"}),$(n.resizerRight).css({left:a+parseInt(n.resizerWidth)+"px"})}function r(){e.unbind("mousemove",s),e.unbind("mouseup",r)}a(),$(window).resize(a),i.on("mousedown",function(t){t.preventDefault(),e.on("mousemove",s),e.on("mouseup",r)})}}]),assetmanagerApp.controller("AssetManagerController",["$scope","$modal","ngTableParams","$timeout","AssetManagerService","CmsContentFolderService","$filter","$templateCache","CmsService",function(e,t,i,n,a,s,r,o,l){e.size=function(){l.setHeightTable()},e.isShowNested=!0,e.isShowBtnDelete=!1,e.isShowBtnEditNameFolder=!1,o.remove("cms/asset-manager/template"),e.assetManagers=s.setContents(angular.copy(window.folders),window.currentPage),e.allTags=angular.copy(window.allTags),e.contentHideOrShowAllNestedContent="Show All Nested Content",angular.isUndefined(e.assets)&&(e.assets=[]),0!=window.idOfAssetSelected&&s.setActiveNode(window.idOfAssetSelected),e.tagsContent=angular.copy(window.tagsContent),e.labels=window.labels,e.titleItemSelected="root",e.isSearch=!1,e.btnSearch=function(){e.isSearch=!e.isSearch},e.tableParams=new i({page:1,count:100,sorting:{title:"asc"},filter:{}},{total:e.assets.length,getData:function(t,i){var n=i.filter()?r("filter")(e.assets,i.filter()):e.assets,a=i.sorting()?r("orderBy")(n,i.orderBy()):n;i.total(n.length),t.resolve(a.slice((i.page()-1)*i.count(),i.page()*i.count()))}}),e.getChildrenPages=function(t){var i=[];for(var n in t){if(angular.isUndefined(t[n].data))return;"root"==t[n].key?(i.push(t[n]),delete t[n]):angular.isUndefined(t[n].folder)||(i.push(t[n]),delete t[n])}e.assetManagers=t,e.tableParams.reload()},s.initTree(function(t,i){e.assets=[],"Assets"==i.key?e.titleItemSelected="Assets":1==i.folder?e.titleItemSelected=i.title:angular.isUndefined(i.parent.data.name)?e.titleItemSelected="Assets":e.titleItemSelected=i.parent.data.name,angular.isDefined(t)&&1==t.length&&1!=i.folder?(t[0].expanded=!0,e.assets=t):angular.forEach(t,function(t,i){t.expanded=!1,e.assets.push(t)}),e.tableParams.reload(),angular.isDefined(e.tableParams.$params)&&(e.tableParams.$params.page=1);var n=$("#tree").fancytree("getTree"),a=_.find(n.getRootNode().children,function(e){return"assets"==e.data.type});if("0"!=i.data.parent_id&&i.data.parent_id!=a.data._id?(e.isShowBtnDelete=!0,1==i.folder?e.isShowBtnEditNameFolder=!0:e.isShowBtnEditNameFolder=!1):(e.isShowBtnDelete=!1,e.isShowBtnEditNameFolder=!1),1==i.folder)"css"==window.folderType[i.data._id]||"js"==window.folderType[i.data._id]?e.isShowBtnCreateNewAsset=!0:e.isShowBtnCreateNewAsset=!1;else{var s=i.getParent();"css"==window.folderType[s.data._id]||"js"==window.folderType[s.data._id]?e.isShowBtnCreateNewAsset=!0:e.isShowBtnCreateNewAsset=!1}}),e.hideOrShowAllNestedContent=function(){s.changeStatusHideOrShowAllNestedContent().then(function(t){e.contentHideOrShowAllNestedContent=t.textButton,"Show All Nested Content"==e.contentHideOrShowAllNestedContent?e.isShowNested=!0:e.isShowNested=!1,e.assets=t.contents,e.tableParams.reload()})},e.deleteFolderAndAsset=function(){e.dsbBtnDelete=!0;var t=$("#tree").fancytree("getTree"),i=t.getActiveNode(),n=t.getRootNode();if(1==i.folder)var s=confirm(r("trans")("confirm-delete-folder","golbal"));else var s=confirm(r("trans")("confirm-delete-content","golbal"));return 1!=s?void(e.dsbBtnDelete=!1):void("0"!=i.data.parent_id&&a.deleteFolderAndAsset(i.data._id).then(function(t){i.remove(),rootNodeOfNodeActive=_.find(n.children,function(e){return"Assets"==e.title}),rootNodeOfNodeActive.setActive(),e.dsbBtnDelete=!1}))},e.deleteFileAsset=function(t,i){a.deleteAssetFile(t).then(function(n){0!=n.status&&(angular.isUndefined(n.result)||(i.region=n.result.countUniqueRegion,i.language=n.result.countUniqueLanguage,i.status=n.result.status),angular.forEach(i.subFiles,function(e,n){e._id==t&&i.subFiles.splice(n,1)}),e.tableParams.reload())})},e.editNameFolder=function(){var i=$("#tree").fancytree("getTree"),n=i.getActiveNode();if(n){var a="/cms/asset-manager/edit-name-folder/"+n.data._id+"?"+(new Date).getTime(),s=t.open({animation:e.animationsEnabled,templateUrl:window.baseUrl+a,controller:"editNameFolderAssetCtrl",size:null,resolve:{}});s.result.then(function(t){n.setTitle(t.folder.name),n.setActive(),n.getParent().sortChildren(null,!0),e.tableParams.reload(),e.titleItemSelected=t.folder.name},function(){})}},e.createNewAsset=function(){if(!d){e.getParentFolder();var i="/cms/asset-manager/create-new-asset/?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName+"&&v="+(new Date).getTime(),n=t.open({animation:e.animationsEnabled,templateUrl:window.baseUrl+i,controller:"CreateNewAssetCtrl",size:null,resolve:{}});n.result.then(function(e){d=!1,e.title=e.name,e.key=e._id,node=$("#tree").fancytree("getTree").getNodeByKey(e.folder_id),null!=node&&(node.addChildren(e),nodeAdded=$("#tree").fancytree("getTree").getNodeByKey(e._id),nodeAdded.setActive(),
node.sortChildren(null,!0))},function(){})}},e.showGroup=function(e,t){var i=($(".group-btn-ac").outerHeight(),$(window).outerWidth()),n=$(window).outerHeight(),a=e.pageY,s=n-a;if(300>s&&$(".wrap-ac-group").each(function(e){$(this).addClass("show-top")}),$(".wrap-ac-group").each(function(e){$(this).removeClass("ac-up")}),$(e.target).parent().toggleClass("ac-up"),$(".group-btn-ac").hasClass("fix-missing-li")?$(".group-btn-ac").css({top:e.pageY-65+"px",right:i-e.pageX-30+"px"}):$(".group-btn-ac").css({top:e.pageY-200+"px",right:i-e.pageX-30+"px"}),$(document).on("click",function u(e){$(e.target).closest("tr").siblings().find(".wrap-ac-group").removeClass("ac-up"),0===$(".wrap-ac-group").has(e.target).length?($(".wrap-ac-group").removeClass("ac-up"),$(".wrap-ac-group").removeClass("show-top")):$(document).one("click",u)}),"undefined"!=typeof t){var r=["png","jpg","jpeg","gif","tiff","bmp"];if(t.filename){var o=t.filename.split("."),l=o[o.length-1],d=$("#viewFile-"+t._id);-1==r.indexOf(l.toLowerCase())?(d.attr("href",baseUrl+"/cms/asset-manager/file/download/"+t._id),d.attr("target","_self")):(d.removeAttr("target"),d.attr("href","script:void(0)"))}}angular.element(".table-responsive").addClass("fix-height")},e.getParentFolder=function(){var t=$("#tree").fancytree("getTree"),i=t.getActiveNode();i&&(0==i.folder||angular.isUndefined(i.folder)?(e.selectedItemName=i.getParent().title,e.selectedItemId=i.getParent().key):"0"==i.data.parent_id?(e.selectedItemName="",e.selectedItemId=""):(e.selectedItemName=i.title,e.selectedItemId=i.key))},e.addTagsForPage=function(t,i){$("#page-loading").css("display","block"),e.tagId=i,a.addTagsForPage(t,{tags:e.tagId}).then(function(t){for(var i in e.assets)if(e.assets[i].data._id==t.item._id){e.assets[i].data.tags=t.item.tags;break}$("#page-loading").css("display","none"),e.tableParams.reload()})};var d=!1;e.createFolderAsset=function(){if(!d){e.getParentFolder();var i="/cms/asset-manager/create-folder?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName+"&&v="+(new Date).getTime(),a=t.open({templateUrl:window.baseUrl+i,controller:"ModalCreateFolderAssetCtrl",size:void 0,resolve:{}});d=!0,a.result.then(function(e){window.folderType=e.folderType;var e=e.item;d=!1;var t=$("#tree").fancytree("getTree"),i=t.getNodeByKey(e.parent_id);i.addChildren(e);var a=t.getNodeByKey(e._id);a.setActive(),n(function(){i.sortChildren(null,!0)})},function(){d=!1})}},e.getModalEditFile=function(i){if(!d){e.getParentFolder();var n="/cms/asset-manager/edit-file/"+i+"?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName+"&&v="+(new Date).getTime(),a=t.open({templateUrl:window.baseUrl+n,controller:"ModalEditFileAssetCtrl",size:void 0,resolve:{}});d=!0,a.result.then(function(e){d=!1;var t=e,i=$("#tree").fancytree("getTree"),n=i.getNodeByKey(t._id);angular.isUndefined(n)||null==n||n.remove(),t.title=t.name,t.key=t._id,node=$("#tree").fancytree("getTree").getNodeByKey(t.folder_id),nodeAdd=node.addChildren(t),nodeAdd.setActive(),node.sortChildren(null,!0)},function(){d=!1})}},e.uploadNewAssets=function(){if(!d){e.getParentFolder();var i="/cms/asset-manager/upload-new-asset?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName+"&&v="+(new Date).getTime(),n=t.open({templateUrl:window.baseUrl+i,controller:"ModalUploadNewAssetCtrl",size:void 0,resolve:{tagsContent:function(){return e.tagsContent},allTags:function(){return e.allTags}}});d=!0,n.result.then(function(e){d=!1;var t=e;t.title=t.name,t.key=t._id,node=$("#tree").fancytree("getTree").getNodeByKey(t.folder_id),null!=node&&(node.addChildren(t),nodeAdded=$("#tree").fancytree("getTree").getNodeByKey(t._id),nodeAdded.setActive(),node.sortChildren(null,!0))},function(){d=!1})}},e.viewFile=function(e){var i=["png","jpg","jpeg","gif","tiff","bmp"];if(e.filename){var n=e.filename.split("."),a=n[n.length-1];if(i.indexOf(a.toLowerCase())>-1){t.open({templateUrl:baseUrl+"/app/shared/assetmanagers/views/viewPicture.html?v="+(new Date).getTime(),controller:"viewFileController",size:void 0,windowClass:"show-img",resolve:{asset:function(){return e}}})}}},e.checkFileType=function(e){if(e.filename){var t=String(e.filename).split(".");if(angular.isArray(t)&&t.length>1&&("js"==t[t.length-1]||"css"==t[t.length-1]||"html"==t[t.length-1]))return!0}return!1},e.getModalUploadNewVersion=function(t){if(!d){e.getParentFolder();var i="/cms/asset-manager/get-content-file/"+t+"?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName;window.location.href=window.baseUrl+i}}}]).controller("viewFileController",["$scope","$modalInstance","asset",function(e,t,i){e.asset=i,e.baseUrl=baseUrl,e.cancel=function(){t.dismiss("cancel")},e.v=(new Date).getTime()}]).controller("ModalCreateFolderAssetCtrl",["$scope","$modalInstance","AssetManagerService",function(e,t,i){e.showLoad=!1,e.changeName=function(){e.nameExists=!1},e.submit=function(n){return e.submitted=!0,e.nameExists=!1,n?void $(".ng-invalid:eq(1)").focus():"undefined"==typeof e.assetManager.parent_id||""==e.assetManager.parent_id?void $(".ng-invalid:eq(1)").focus():(e.showLoad=!0,void i.createFolderProvider(e.assetManager).then(function(i){return e.showLoad=!1,0==i.status?($(".ng-invalid:eq(1)").focus(),void(e.nameExists=!0)):(e.nameExists=!1,void t.close(i))}))},e.cancel=function(){t.dismiss("cancel")}}]).controller("ModalUploadNewAssetCtrl",["$scope","$modalInstance","$timeout","Upload","$filter","AssetManagerService","tagsContent","allTags",function(e,t,i,n,a,s,r,o){e.format="MM-dd-yyyy",e.minDate=new Date,e.submitted=!1,e.showField=!1,e.showLoad=!1,e.tagsContent=r,e.allTags=o,e.teamplateThumb=window.baseUrl+"/app/components/assetmanagers/views/thumbnails.html",e.tagsSelected=[],e.itemsSelected=[],e.selectTags=function(t,i){-1==e.tagsSelected.indexOf(i)?e.tagsSelected.push(i):angular.forEach(e.tagsSelected,function(t,n){t==i&&e.tagsSelected.splice(n,1)}),e.itemsSelected=e.tagsSelected};e.open=function(t,i){t.preventDefault(),t.stopPropagation(),e.opened={},e.opened[i]=!0},t.result.then(function(){},function(i){t.close(e.assetUpload)}),e.$watch("filesUpload",function(t,i){angular.isUndefined(e.filesUpload)?e.checkUpload=!0:angular.isUndefined(e.filesUpload.listsFiles)?e.checkUpload=!0:0==e.filesUpload.listsFiles.length?e.checkUpload=!0:(e.asset.altTag=null,e.asset.description=null,e.asset.nameNewFile=null,e.asset.title=null,angular.isUndefined(e.filesUpload.checkImage)?e.asset.type=e.folderType[e.asset.folder]:(e.asset.nameNewFile=e.filesUpload.listsFiles[0].name,e.asset.type="image",e.checkWithHeightValidate(e.filesUpload.listsFiles)),e.checkUpload=!1)}),e.submit=function(i){if(e.submitted=!0,angular.isUndefined(e.filesUpload))return void(e.checkUpload=!0);if(i||e.checkUpload)return $(".ng-invalid:eq(1)").focus(),void(!e.asset.thumbnailsCustom||"undefined"!=typeof e.asset.thumbnailsWidth&&null!=e.asset.thumbnailsWidth&&"undefined"!=typeof e.asset.thumbnailsHeight&&null!=e.asset.thumbnailsHeight||alert("Min height is 1 pixels and min width is 1 pixels"));if("undefined"!=typeof e.asset.folder&&(angular.isUndefined(e.filesUpload.checkImage)||"undefined"!=typeof e.asset.nameNewFile&&null!=e.asset.nameNewFile&&e.asset.nameNewFile)){if("image"==e.asset.type&&e.asset.withFile&&e.asset.heightFile){if(e.asset.thumbnailsMedium&&e.asset.withFile<100&&e.asset.heightFile<100)return void alert("Max height is "+e.asset.heightFile+" pixels and Max width is "+e.asset.withFile+" pixels");if(e.asset.thumbnailsProduct&&e.asset.withFile<82&&e.asset.heightFile<82)return void alert("Max height is "+e.asset.heightFile+" pixels and Max width is "+e.asset.withFile+" pixels");if(e.asset.thumbnailsMaterial&&e.asset.withFile<75&&e.asset.heightFile<75)return void alert("Max height is "+e.asset.heightFile+" pixels and Max width is "+e.asset.withFile+" pixels");if(e.asset.thumbnailsSmall&&e.asset.withFile<64&&e.asset.heightFile<64)return void alert("Max height is "+e.asset.heightFile+" pixels and Max width is "+e.asset.withFile+" pixels");if(e.asset.thumbnailsCustom&&(!e.asset.thumbnailsHeight||!e.asset.thumbnailsWidth))return void alert("Height and width is a required field");if(e.asset.thumbnailsCustom&&(e.asset.withFile<e.asset.thumbnailsWidth||e.asset.heightFile<e.asset.thumbnailsHeight))return void alert("Max height is "+e.asset.heightFile+" pixels and Max width is "+e.asset.withFile+" pixels")}e.showLoad=!0,e.asset.tags=e.itemsSelected,$("#page-loading").css("display","block"),n.upload({method:"POST",url:baseUrl+"/api/asset-manager/upload-new-asset",file:e.filesUpload.listsFiles,data:e.asset}).success(function(i,n,a,s){$("#page-loading").css("display","none"),e.showLoad=!1,t.close(i.item)})}},e.cancel=function(){t.dismiss("cancel")},e.checkWithHeightValidate=function(t){var i=new FileReader;i.readAsDataURL(t[0]),i.onload=function(t){var i=new Image;i.src=t.target.result,i.onload=function(){e.asset.withFile=this.width,e.asset.heightFile=this.height}}}}]).controller("ModalEditFileAssetCtrl",["$scope","$modalInstance","$timeout","Upload","$filter","AssetManagerService",function(e,t,i,n,a,s){e.format="MM-dd-yyyy",e.minDate=new Date,e.submitted=!1,e.showField=!1,e.showLoad=!1,e.teamplateThumb=window.baseUrl+"/app/components/assetmanagers/views/thumbnails.html";e.open=function(t,i){t.preventDefault(),t.stopPropagation(),e.opened={},e.opened[i]=!0},t.result.then(function(){},function(i){t.close(e.assetUpload)}),e.$watch("filesUpload",function(t,i){angular.isUndefined(e.filesUpload)?e.checkUpload=!0:angular.isUndefined(e.filesUpload.listsFiles)?e.checkUpload=!0:0==e.filesUpload.listsFiles.length?e.checkUpload=!0:(angular.isUndefined(e.filesUpload.checkImage)?(e.asset.type=e.folderType[e.asset.folder],e.asset.filename=e.filesUpload.listsFiles[0].name):(e.asset.type="image",e.asset.filename=e.filesUpload.listsFiles[0].name,e.asset.height&&e.asset.width?(e.asset.withFile=angular.copy(e.asset.width),e.asset.heightFile=angular.copy(e.asset.height),e.asset.height=!1,e.asset.width=!1):e.checkWithHeightValidate(e.filesUpload.listsFiles)),e.checkUpload=!1)}),e.submit=function(i){if(e.assetUpload=[],e.submitted=!0,angular.isUndefined(e.filesUpload)||angular.isUndefined(e.filesUpload.listsFiles))return void(e.checkUpload=!0);if(0==e.filesUpload.listsFiles.length)return void(e.checkUpload=!0);if(i||e.checkUpload)return $(".ng-invalid:eq(1)").focus(),void(!e.asset.thumbnailsCustom||"undefined"!=typeof e.asset.thumbnailsWidth&&null!=e.asset.thumbnailsWidth&&"undefined"!=typeof e.asset.thumbnailsHeight&&null!=e.asset.thumbnailsHeight||alert("Min height is 1 pixels and min width is 1 pixels"));if(!e.filesUpload.checkImage||"undefined"!=typeof e.asset.filename&&null!=e.asset.filename&&e.asset.filename){if(e.filesUpload.checkImage||(e.asset.alt_tag=null,e.asset.description=null,e.asset.title=null),"image"==e.asset.type&&e.asset.withFile&&e.asset.heightFile){if(e.asset.thumbnailsMedium&&e.asset.withFile<100&&e.asset.heightFile<100)return void alert("Max height is "+e.asset.heightFile+" pixels and Max width is "+e.asset.withFile+" pixels");if(e.asset.thumbnailsProduct&&e.asset.withFile<82&&e.asset.heightFile<82)return void alert("Max height is "+e.asset.heightFile+" pixels and Max width is "+e.asset.withFile+" pixels");if(e.asset.thumbnailsMaterial&&e.asset.withFile<75&&e.asset.heightFile<75)return void alert("Max height is "+e.asset.heightFile+" pixels and Max width is "+e.asset.withFile+" pixels");if(e.asset.thumbnailsSmall&&e.asset.withFile<64&&e.asset.heightFile<64)return void alert("Max height is "+e.asset.heightFile+" pixels and Max width is "+e.asset.withFile+" pixels");if(e.asset.thumbnailsCustom&&(!e.asset.thumbnailsHeight||!e.asset.thumbnailsWidth))return void alert("Height and width is a required field");if(e.asset.thumbnailsCustom&&(e.asset.withFile<e.asset.thumbnailsWidth||e.asset.heightFile<e.asset.thumbnailsHeight))return void alert("Max height is "+e.asset.heightFile+" pixels and Max width is "+e.asset.withFile+" pixels")}e.showLoad=!0,$("#page-loading").css("display","block"),n.upload({method:"POST",url:baseUrl+"/api/asset-manager/edit-file",file:e.filesUpload.listsFiles,data:e.asset}).success(function(i,n,a,s){e.showLoad=!1,$("#page-loading").css("display","none"),t.close(i.item)})}},e.cancel=function(){t.dismiss("cancel")},e.checkWithHeightValidate=function(t){var i=new FileReader;i.readAsDataURL(t[0]),i.onload=function(t){var i=new Image;i.src=t.target.result,i.onload=function(){e.asset.withFile=this.width,e.asset.heightFile=this.height}}}}]).controller("ModalViewAssetManagerCtrl",["$scope","$modalInstance",function(e,t){e.cancel=function(){t.dismiss("cancel")}}]).controller("CreateNewAssetCtrl",["$scope","$modalInstance","AssetManagerService",function(e,t,i){e.showLoad=!1,e.submit=function(n){return e.submitted=!0,n?void $(".ng-invalid:eq(1)").focus():void("undefined"!=typeof e.asset.folder&&(e.showLoad=!0,e.asset.type=e.folderType[e.asset.folder],i.createNewAsset(e.asset).then(function(i){e.showLoad=!1,t.close(i)})))},e.cancel=function(){t.dismiss("cancel")}}]).controller("editNameFolderAssetCtrl",["$scope","$modalInstance","AssetManagerService","$http","$q",function(e,t,i,n,a){e.checkFirstName=function(t){return""==t?"The first name is a required field":(e.userProfile.first_name=t,void e.updateUser())},e.checkEmtypeName=function(i){if(""==i)return"The folder name is a required field";e.folder.name=i;var s=a.defer();return n.post("/api/asset-manager/edit-name-folder",{data:e.folder}).success(function(e){e=e||{},e.status?(s.resolve(),t.close(e)):s.resolve("Name has already been taken.")}).error(function(e){s.reject("Server error!")}),s.promise}}]).controller("ModalUploadNewVersion",["$scope","$modalInstance","AssetManagerService",function(e,t,i){e.showLoad=!1,e.cancel=function(){t.dismiss("cancel")},e.updateNewVerSionFile=function(){e.showLoad=!0,i.updateContentFile(e.asset).then(function(i){e.showLoad=!1,t.close(i)})}}]);var requestAsset=angular.module("assetManager");requestAsset.factory("RequestAssetResource",["$resource",function(e){return e("/api/asset-manager/:method/:id",{method:"@method",id:"@id"},{add:{method:"post"},save:{method:"post"},update:{method:"put"}})}]),requestAsset.service("RequestAssetService",["RequestAssetResource","$q",function(e,t){var i=this,n=[];this.requestAssetFile=function(n){if("undefined"!=typeof n._id&&"request_translation"==n.modal)return i.requestTranslation(n);if("undefined"!=typeof n._id&&"request_region"==n.modal)return i.requestRegion(n);var a=t.defer(),s=new e(n);return s.$save({},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.requestTranslation=function(i){var a=t.defer(),s=new e(i);return s.$save({method:"request-translation"},function(e){0!=e.status&&n.push(e.page),a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.requestRegion=function(i){var n=t.defer(),a=new e(i);return a.$save({method:"request-region"},function(e){n.resolve(e)},function(e){n.resolve(e.data)}),n.promise},this.requestRevision=function(i){var n=t.defer(),a=new e(i);return a.$save({method:"request-revision"},function(e){0!=e.status&&n.resolve(e)},function(e){n.resolve(e.data)}),n.promise}}]);var requestAsset=angular.module("assetManager");requestAsset.controller("RequestAssetController",["$scope","$modal","ngTableParams","$filter","$timeout",function(e,t,n,a,s){e.getParentFolder=function(){var t=$("#tree").fancytree("getTree"),i=t.getActiveNode();i&&(0==i.folder||angular.isUndefined(i.folder)?(e.selectedItemName=i.getParent().title,e.selectedItemId=i.getParent().key):"0"==i.data.parent_id?(e.selectedItemName="",e.selectedItemId=""):(e.selectedItemName=i.title,e.selectedItemId=i.key))};var r=!1;e.getModalRequestNewAsset=function(){if(!r){nodeSelected=$("#tree").fancytree("getTree").getSelectedNodes();var i="";nodeSelected.length>0&&(i=nodeSelected[0].key),e.getParentFolder();var n=t.open({animation:e.animationsEnabled,templateUrl:window.baseUrl+"/cms/asset-manager/create?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName+"&&v="+(new Date).getTime(),controller:"ModalRequestAssetController",size:null,resolve:{folder_id:function(){return i}}});r=!0,n.result.then(function(t){var i=t.asset;i.title=i.name,i.key=i._id,r=!1,node=$("#tree").fancytree("getTree").getNodeByKey(i.folder_id),i=e.addSummaryNameForNode(i),null!=node&&(node.addChildren(i),nodeAdded=$("#tree").fancytree("getTree").getNodeByKey(i._id),nodeAdded.setActive(),node.sortChildren(null,!0))},function(){r=!1})}},e.addSummaryNameForNode=function(e){if($data=e,angular.isUndefined($data.name))var t=$data.title.split(" ");else var t=$data.name.split(" ");return t.length>=2?$data.summaryName=t[0]+" "+t[1]:$data.summaryName=t[0],$data},e.getModalRequestTranslationAsset=function(n){if(!r){e.getParentFolder();var a="/cms/asset-manager/request-translation/"+n+"?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName+"&&v="+(new Date).getTime(),s=t.open({templateUrl:window.baseUrl+a,controller:"ModalRequestAssetController",size:void 0,resolve:{folder_id:function(){return null}}});r=!0,s.result.then(function(t){r=!1;for(i in t.asset)node=$("#tree").fancytree("getTree").getNodeByKey(t.asset[i].file_id),node.data.subFiles.push(t.asset[i]),"n/a"==node.data.language?node.data.language=1:node.data.language=parseInt(node.data.language)+1,"n/a"==node.data.due_date||"undefined"==typeof node.data.due_date?node.data.due_date=t.asset[i].due_date:node.data.due_date>t.asset[i].due_date&&(node.data.due_date=t.asset[i].due_date),node.data.status="waiting-approve",e.tableParams.reload()},function(){r=!1})}},e.getModalRequestRegionAsset=function(n){if(!r){e.getParentFolder();var a="/cms/asset-manager/request-region/"+n+"?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName+"&&v="+(new Date).getTime(),s=t.open({templateUrl:window.baseUrl+a,controller:"ModalRequestAssetController",size:void 0,resolve:{folder_id:function(){return null}}});r=!0,s.result.then(function(t){r=!1;for(i in t.assets)node=$("#tree").fancytree("getTree").getNodeByKey(t.assets[i].file_id),node.data.region=t.countUniqueRegion,node.data.subFiles.push(t.assets[i]),"n/a"==node.data.due_date||"undefined"==typeof node.data.due_date?node.data.due_date=t.assets[i].due_date:node.data.due_date>t.assets[i].due_date&&(node.data.due_date=t.assets[i].due_date),node.data.status="waiting-approve",e.tableParams.reload()},function(){r=!1})}}}]),requestAsset.controller("ModalRequestAssetController",["$scope","$modal","$filter","$modalInstance","folder_id","RequestAssetService",function(e,t,i,n,a,s){e.languages_selected={},e.requiredLanguage=!0,e.requiredRegion=!0,e.regions_selected={},"undefined"==typeof e.asset&&(e.asset={},e.asset.folder_id="root"==a?"":a),e.format="MM-dd-yyyy",e.minDate=new Date,e.open=function(t,i){t.preventDefault(),t.stopPropagation(),e.opened={},e.opened[i]=!0},e.initRedactor=function(){$("#content").redactor({plugins:["table",1==window.isAdvancedEditingFeatures?"source":""],imageUpload:"/content/upload",callbacks:{modalOpened:function(e,t){if("link"!=e||this.observe.isCurrent("a")){if("link"==e){var i=this.link.$node.attr("rel");"undefined"==typeof i?$('<label><input type="checkbox" id="redactor-link-no-follow"> No Follow</label>').insertAfter($("#redactor-link-blank").parent()):$('<label><input type="checkbox" checked id="redactor-link-no-follow"> No Follow</label>').insertAfter($("#redactor-link-blank").parent())}}else $("#redactor-link-blank").attr("checked","true"),$('<label><input type="checkbox" checked id="redactor-link-no-follow"> No Follow</label>').insertAfter($("#redactor-link-blank").parent())},insertedLink:function(e){var t=$(e).attr("href");"http"!=t.substring(0,4)&&"https"!=t.substring(0,5)&&"ftp"!=t.substring(0,3)&&$(e).attr("href","http://"+t),$("#redactor-link-no-follow").prop("checked")?e.attr("rel","nofollow"):e.removeAttr("rel")},linkify:function(e){e.attr("target","_blank")},change:function(){$content=$("#content").redactor("code.get"),e.$apply(function(){"<div></div>"==$content||""==$content||"<br>"==$content||"<div><strong></strong></div>"==$content||"<div><em></em><strong></strong></div>"==$content||"<div><em><del></del></em></div>"==$content?e.requiredDescription=!0:e.requiredDescription=!1})}},linkSize:1e3,minHeight:200})},e.submit=function(t){return e.requiredDescription=!1,e.submitted=!0,$content=$("#content").redactor("code.get"),"<div></div>"!=$content&&""!=$content&&"<br>"!=$content&&"<div><strong></strong></div>"!=$content&&"<div><em></em><strong></strong></div>"!=$content&&"<div><em><del></del></em></div>"!=$content||(e.requiredDescription=!0),t||e.requiredDescription||!e.asset.folder_id?void $(".ng-invalid:eq(1)").focus():"request_translation"==e.asset.modal&&e.requiredLanguage?void $(".ng-invalid:eq(1)").focus():"request_region"==e.asset.modal&&e.requiredRegion?void $(".ng-invalid:eq(1)").focus():(files_id=[],"undefined"!=typeof e.filesUpload&&(files_id=e.filesUpload.ids),e.asset.files_id=files_id,$("#btnSubmit").attr("disabled","true"),e.asset.description=$content,e.asset.meta=$content,e.asset._id&&"request_translation"==e.asset.modal&&(e.asset.languages=e.languages_selected),e.asset._id&&"request_region"==e.asset.modal&&(e.asset.regions=e.regions_selected),e.asset.status="waiting-approve",void s.requestAssetFile(e.asset).then(function(t){0==t.status?($("#btnSubmit").removeAttr("disabled"),e.checkName=!0,$(".name").focus()):n.close(t)}))},e.cancel=function(){n.dismiss("cancel")}}]);var fileModule=angular.module("file");fileModule.factory("FileResource",["$resource",function(e){return e("/admin/document-manager/:method/:id",{},{add:{method:"post"},save:{method:"post"},update:{method:"put"}})}]).factory("shareDataFactory",["$rootScope",function(e){var t={};return t.data="",t.prepForBroadcase=function(e,t){this.data=e,this.broadcastItem(t)},t.broadcastItem=function(t){e.$broadcast(t)},t}]).service("FileService",["$q","$filter","FileResource",function(e,t,i){var n=[],a=[],s=[],r=[],o=[],l=[],d=[];this.create=function(t){var n=e.defer(),a=new i(t);return a.$save({},function(e){e.status?n.resolve(e):n.resolve(null)},function(e){n.resolve(null)}),n.promise},this.fileShare=function(t){var n=e.defer(),a=new i(t);return a.$save({id:t.fileId,method:"file-share"},function(e){n.resolve(e)},function(e){n.resolve(null)}),n.promise},this.deleteFileUserShare=function(t){var n=t.folder_id;"undefined"!=typeof t.file_id&&(n=t.file_id);var a=e.defer();return i["delete"]({id:n,method:"delete-file-user-share",userShareId:t.user_id,group:t.group},function(e){a.resolve(e)}),a.promise},this.getChildFolders=function(t){var n=e.defer();return i.query({id:t,method:"get-child-folders"},function(e){n.resolve(e)}),n.promise},this.getFilesFolder=function(){return a},this.getFiles=function(){return n},this.update=function(t){var n=e.defer(),a=new i(t);return a.$save({id:t._id},function(e){e.status?n.resolve(e):n.resolve(null)},function(e){n.resolve(null)}),n.promise},this.get=function(t,n){var a=e.defer();return i.get({id:t,prefix:n},function(e){a.resolve(e)}),a.promise},this.getAllOfUser=function(t){var n=e.defer();return i.query({created_at:t,method:"file-all"},function(e){for(var t in e)r[e[t].id]=e[t];n.resolve(e)}),n.promise},this.pushFilesOfUser=function(e){filesFormat=[];for(var t in e)r.push(e[t]);return r},this.getFilesOfUser=function(){return r},this.query=function(){var t=e.defer();return n&&n.length?t.resolve(n):i.query().$promise.then(function(e){n=e,t.resolve(n)}),t.promise},this.remove=function(t){var a=e.defer();new i(t);return i["delete"]({id:t},function(e){if(e.status){for(var i in d)if(d[i].id==t){d.splice(i,1);break}for(var i in n)if(n[i].id==t){n.splice(i,1);break}}a.resolve(e)}),a.promise},this.visibleFolder=function(t){var a=e.defer(),s=new i(t);return s.$save({id:t,method:"visible-folder"},function(e){if(e.status){for(var i in d)if(d[i].id==t){d[i].visible=e.visible;break}for(var i in n)if(n[i].id==t){n.splice(i,1);break}}a.resolve(e)}),a.promise},this.deleteFolder=function(t){var n=e.defer();return i["delete"]({id:t,method:"delete-folder"},function(e){if(e)for(var i in d)if(d[i].id==t){d.splice(i,1);break}n.resolve(e)}),n.promise},this.setFiles=function(e){n=e},this.pushFiles=function(e){n.push(e)},this.setFilesCurrentFolder=function(e){d=e},this.getFilesCurrentFolder=function(e){return d},this.pushFile=function(e){o=[],o.push(e),n.push(e)},this.pushFileFoler=function(e){a=[],o=[];for(var t in n)a[t]=n[t];a.push(e),o.push(e),n=a},this.getFileUpload=function(){return o},this.editFile=function(e){s=e},this.getDataFileEdit=function(){return s},this.getData=function(){return n},this.addFolder=function(t){var n=e.defer(),a=new i(t);return a.$save({method:"add-folder"},function(e){n.resolve(e)},function(e){n.resolve(null)}),n.promise},this.checkFile=function(e){var t=["png","gif","jpg","jpeg"];if("undefined"!=typeof e){if(-1!=t.indexOf(e.split("/")[1]))return"image";switch(e.split("/")[1]){case"zip":return"zip";case"pdf":return"pdf";case"msword":return"msword";default:return"other"}}},this.formatFilesWitFolderId=function(){var e=[];for(var t in n)angular.isArray(e[n[t].folder_id])||(e[n[t].folder_id]=[]),e[n[t].folder_id].push(n[t]);l=e},this.getFileFolderMap=function(){return l},this.filesMap=function(e){var t=[];for(var i in e)t[e[i].id]=e[i];return t},this.download=function(t){var n=e.defer(),a=new i;return a.$get({id:t,method:"download"},function(e){n.resolve(e)},function(e){n.resolve(null)}),n.promise},this.editFileName=function(t){var a=e.defer(),s=new i(t);return s.$update({id:t.id,method:"edit-file-name"},function(e){for(var t in n)if(n[t].id==e.id&&n[t].group==e.group){n[t]=e;break}if(e.folder_id>0||e.parent_id>0)for(var t in d)if(d[t].id==e.id){d[t]=e;break}a.resolve(e)},function(e){a.resolve(null)}),a.promise}}]);var fileUpload=angular.module("uls");fileUpload.directive("fileUpload",["FileService","Upload","$timeout",function(e,t,i){return{restrict:"EA",require:"^ngModel",scope:{files:"=",fileIds:"=",openPicture:"&",disabled:"=",control:"="},replace:!0,transclude:!0,templateUrl:baseUrl+"/app/shared/file-upload/views/file-upload.html?v=1",link:function(n,a,s,r){function o(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}var l=0;n.baseUrl=baseUrl,n.fileUpload={},n.fileUploaded=[],n.fileUploadIds=[],n.fileError={},n.uploadFinish=!0,r.$setViewValue({finished:n.uploadFinish}),n.numberFileUpload=[],n.upload=function(e){if(e&&e.length){l++,angular.isUndefined(n.numberFileUpload[l])&&(n.numberFileUpload[l]=[]);for(var a=0;a<e.length;a++)r.$setViewValue({finished:!1}),function(a){r.$setViewValue({finished:!1});var s=e[a];return angular.isDefined(window.maxUpload)&&s.size>window.maxUpload.size?(s.uniId=o(),s.proccess=100,s.error=1,s.status=0,n.fileUpload[s.uniId]=s,n.fileUpload[s.uniId].error="Max file size is "+window.maxUpload.name,n.fileError[s.uniId]=s,void r.$setViewValue({finished:!0})):(s.uniId=o(),s.proccess=0,s.error="",n.fileUpload[s.uniId]=s,void t.upload({url:baseUrl+"/support/file",file:s}).progress(function(e){if(r.$setViewValue({finished:!1}),angular.isDefined(n.fileUpload[s.uniId]))var t=parseInt(100*e.loaded/e.total);else{var t=100;n.uploadFinished=!0,r.$setViewValue({finished:n.uploadFinished})}angular.isDefined(n.fileUpload[s.uniId])&&(n.fileUpload[s.uniId].proccess=t,n.uploadFinished=!1,r.$setViewValue({finished:n.uploadFinished}))}).error(function(t,i,r,o){e.splice(1,a),angular.isDefined(n.fileUpload[s.uniId])&&(angular.isDefined(t.message)&&(n.fileUpload[s.uniId].error=t.message),n.fileError[o.file.uniId]=t)}).success(function(e,t,i,a){n.uploadFinished=!0,r.$setViewValue({finished:n.uploadFinished}),angular.isDefined(n.fileUpload[a.file.uniId])&&(e.item.uniId=a.file.uniId,n.fileUploaded.push(e.item),n.fileUploadIds.push(e.item.id))})["finally"](function(){n.uploadFinished=!0,i(function(){r.$setViewValue({ids:n.fileUploadIds,files:n.fileUploaded,finished:n.uploadFinished})})}))}(a)}},r.$render=function(){i(function(){n.filesUpload=r.$viewValue})},n.checkFile=function(t){return e.checkFile(t)},n.internalControl=n.control||{},n.internalControl.deleteAllFileUploaded=function(){delete n.fileUpload,n.fileUpload={},n.uploadFinished=!0,r.$setViewValue({ids:n.fileUploadIds,files:n.fileUploaded,finished:n.uploadFinished})},n.deleteFile=function(e){delete n.fileUpload[e];for(var t in n.fileUploaded)if(e==n.fileUploaded[t].uniId){var a=n.fileUploadIds.indexOf(n.fileUploaded[t].id);delete n.fileUploaded[t],n.fileUploadIds.splice(a,1)}n.uploadFinished=!0,i(function(){r.$setViewValue({ids:n.fileUploadIds,files:n.fileUploaded,finished:n.uploadFinished})})},n.$on("emptyFiles",function(e,t){n.fileUpload={},n.fileUploaded=[],n.fileUploadIds=[]})}}}]).filter("bytes",function(){return function(e,t){if(isNaN(parseFloat(e))||!isFinite(e))return"-";"undefined"==typeof t&&(t=1);var i=["bytes","kB","MB","GB","TB","PB"],n=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,Math.floor(n))).toFixed(t)+" "+i[n]}}),assetmanagerApp.directive("uploadFileAsset",["$timeout","Upload",function(e,t){return{restrict:"EA",require:"^ngModel",scope:{files:"=",fileIds:"=",openPicture:"&",disabled:"=",accept:"=",folder:"=",assetEdit:"="},replace:!0,transclude:!0,templateUrl:baseUrl+"/app/components/assetmanagers/views/file-upload.html?v="+(new Date).getTime(),link:function(e,i,n,a){function s(e){var t=["png","gif","jpg","jpeg","jpe"],i=["css"],n=["video"],a=["javascript"];if("undefined"!=typeof e){if(-1!=t.indexOf(e.split("/")[1]))return"images";if(-1!=i.indexOf(e.split("/")[1]))return"css";if(-1!=n.indexOf(e.split("/")[0]))return"video";if(-1!=a.indexOf(e.split("/")[1]))return"js";switch(e.split("/")[1]){case"zip":return"zip";case"pdf":return"pdf";case"msword":return"msword";default:return"other"}}}function r(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}"one"==n.ngMultiple&&(e.uploadMultiple="one");e.$watch("assetEdit",function(t,i){if(!angular.isUndefined(t)&&!angular.isUndefined(t.filename)){var n=[];e.listsFiles=[];var s=[];if(n.uniId=r(),n.proccess=100,n.error=0,e.checkCurrent=!1,n.name=t.filename,n.file_name=t.filename,e.fileUpload[n.uniId]=n,e.fileUploadIds=n.uniId,s._id=t._id,s.name=t.filename,e.listsFiles[0]=s,"image"===t.type&&(t.type="images"),"images"===t.type){var o=!0;a.$setViewValue({fileUploadIds:e.fileUploadIds,listsFiles:e.listsFiles,finished:e.uploadFinish,checkImage:o})}else a.$setViewValue({fileUploadIds:e.fileUploadIds,listsFiles:e.listsFiles,finished:e.uploadFinish})}});var o=0;e.baseUrl=baseUrl,e.fileUpload={},e.fileUploaded=[],e.fileUploadIds=[],e.listsFiles=[],e.fileError={},e.uploadFinish=!0,a.$setViewValue({finished:e.uploadFinish}),e.numberFileUpload=[],e.upload=function(i){if(i&&i.length){o++;for(var n=0;n<i.length;n++)!function(n){var o=["txt","htm","html","php","css","js","json","xml","swf","flv","png","jpe","jpeg","jpg","gif","bmp","ico","tiff","tif","svg","svgz","zip","rar","exe","msi","cab","mp3","mp4","qt","mov","pdf","psd","ai","eps","ps","doc","docx","rtf","xls","ppt","pptx","odt","ods"],l=i[n],d=l.name.split("."),u=d.slice(-1).pop();return-1==o.indexOf(u.toLowerCase())||"php"==u.toLowerCase()?void alert("System don’t support this type file"):angular.isUndefined(e.folder)?void alert("chosse folder"):"other"!=e.folder&&e.folder!=s(l.type)?void alert("chosse file    "+e.folder):(e.uploadFinished=!1,a.$setViewValue({finished:e.uploadFinished,checkImage:!1}),e.listsFiles=[],l.size>0&&(e.checkCurrent=!0),l.size>window.maxUpload.size?(e.fileUpload={},l.uniId=r(),l.proccess=100,l.error=1,l.status=0,e.fileUpload[l.uniId]=l,e.fileUpload[l.uniId].error="Max file size is "+window.maxUpload.name,e.fileError[l.uniId]=l,void a.$setViewValue({finished:!0})):(l.uniId=r(),l.proccess=0,l.error="",e.fileUpload={},e.listsFiles.push(l),a.$setViewValue({listsFiles:e.listsFiles}),e.fileUpload[l.uniId]=l,void t.upload({method:"POST",url:baseUrl+"/upload-new-asset/file",file:l,data:e.listsFiles}).progress(function(t){var i=parseInt(100*t.loaded/t.total);e.fileIsUploading=!0,
angular.isDefined(e.fileUpload[l.uniId])&&(e.fileUpload[l.uniId].proccess=i,e.uploadFinished=!1,a.$setViewValue({finished:e.uploadFinished}))}).error(function(t,a,s,r){i.splice(1,n);for(var o in e.listsFiles)l.uniId==e.listsFiles[o].uniId&&e.listsFiles.splice(o,1);angular.isDefined(e.fileUpload[l.uniId])&&(angular.isDefined(t.message)&&(e.fileUpload[l.uniId].error=t.message),e.fileError[r.file.uniId]=r.file,e.fileError[r.file.uniId].status=t.status)}).success(function(t,i,n,s){e.uploadFinished=!0,a.$setViewValue({finished:e.uploadFinished}),e.fileUploaded=s.file.uniId,e.fileUploadIds=s.file})["finally"](function(){if(e.uploadFinished=!0,"images"==s(e.listsFiles[0].type))var t=!0;a.$setViewValue({fileUploadIds:e.fileUploadIds,listsFiles:e.listsFiles,finished:e.uploadFinish,checkImage:t})})))}(n)}},a.$render=function(){e.filesUpload=a.$viewValue},e.checkFile=function(e){return s(e)},e.$on("emptyFiles",function(t,i){e.fileUpload={},e.listsFiles=[],e.fileUploaded=[],e.fileUploadIds=[]})}}}]).filter("bytes",function(){return function(e,t){if(isNaN(parseFloat(e))||!isFinite(e))return"-";"undefined"==typeof t&&(t=1);var i=["bytes","kB","MB","GB","TB","PB"],n=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,Math.floor(n))).toFixed(t)+" "+i[n]}}),requestAsset.directive("multiSelectAsset",["$timeout",function(e){return{restrict:"EA",scope:{items:"=",itemsAssigned:"=",requiredItem:"=",placeholder:"@"},templateUrl:"/app/components/assetmanagers/views/view.html?v=2",link:function(e,t,i){e.assignItem=function(){if(e.test={},"undefined"!=e.selectedItemFrom){for(var t in e.selectedItemFrom){var i=e.selectedItemFrom[t];e.itemsAssigned[i]=e.items[i],delete e.items[i]}(1==e.requiredItem||angular.isUndefined(e.requiredItem))&&(angular.equals(e.itemsAssigned,e.test)||(e.requiredItem=!1)),e.selectedItemFrom=[]}},e.undoItem=function(){if(angular.isArray(e.items)&&(e.items={}),angular.isDefined(e.selectedItemTo)){if(0==e.selectedItemTo.length)return;for(var t in e.selectedItemTo){var i=e.selectedItemTo[t];e.items[i]=e.itemsAssigned[i],delete e.itemsAssigned[i]}(0==e.requiredItem||angular.isUndefined(e.requiredItem))&&angular.equals(e.itemsAssigned,e.test)&&(e.requiredItem=!0),e.selectedItemTo=[]}}}}}]);var selectMenu=angular.module("uls"),version=2;selectMenu.directive("selectMultiLevel",["$timeout","$filter",function(e,t){return{require:"?ngModel",restrict:"E",scope:{items:"=",itemExits:"=",text:"@",title:"@",ngModel:"=",placeholder:"@",index:"="},replace:!0,templateUrl:baseUrl+"/app/shared/select-multi-level/view/view.html?v="+version,link:function(e,t,i,n){e.selections=[],e.toggleSelectLabel=function(t,i,n){angular.element(".icon-"+i).toggleClass("hide"),angular.element(".color-label-"+i).toggleClass("color-label");var a=e.selections.indexOf(t);a>-1?e.selections.splice(a,1):e.selections.push(t),n.stopPropagation()},e.toggleSubLabel=function(t,i,n,a){angular.element(".icon-sub-"+i+"-"+n).toggleClass("hide"),angular.element(".color-label-sub-"+i+"-"+n).toggleClass("color-label");var s=e.selections.indexOf(t);s>-1?e.selections.splice(s,1):e.selections.push(t),a.stopPropagation()},$(document).on("click",function a(t){angular.element(t.target).closest("tr").siblings().find("#select-multil-level-modal-"+e.index).slideUp(),0===angular.element("#select-multil-level-modal-"+e.index).has(t.target).length?(angular.element("#select-multil-level-modal-"+e.index).prev(".text-show-action").removeClass("active"),angular.element("#select-multil-level-modal-"+e.index).slideUp()):angular.element(document).one("click",a)}),e.toggleSelectMenu=function(t){angular.element("#select-multil-level-modal-"+e.index).is(":hidden")?(angular.element("#select-multil-level-modal-"+e.index).show("slow"),angular.element("#select-multil-level-modal-"+e.index).prev(".text-show-action").addClass("active")):(angular.element("#select-multil-level-modal-"+e.index).slideUp(),angular.element("#select-multil-level-modal-"+e.index).prev(".text-show-action").removeClass("active")),t.stopPropagation()},e.closed=function(t){angular.element("#select-multil-level-modal-"+e.index).slideUp(),n.$setViewValue(e.selections),angular.element("#select-multil-level-modal-"+e.index).prev(".text-show-action").removeClass("active"),t.stopPropagation()}}}}]);var selectLevel=angular.module("selectLevel",[]),version=5;selectLevel.directive("selectLevel",["$timeout","$filter",function(e,t){return{require:"?ngModel",restrict:"EA",scope:{items:"=",text:"@",title:"@",textFilter:"@",index:"=",key:"=",itemChoose:"=",selectedItems:"=selectedItem",onClick:"&",currentPage:"=",showIcon:"=",typeSelect:"=",disableClick:"=",notSelectCurrent:"=",chageType:"=",type:"=",canChooseFolder:"="},replace:!0,templateUrl:baseUrl+"/app/shared/select-level/view.html?v="+(new Date).getTime(),link:function(i,n,a,s){function r(e){var t={};return angular.forEach(e,function(e,i){t[e]=i}),t}i.currentIndex={value:0},"Asset"==i.type&&(i.items=window.assets),i.$watch("selectedItems",function(t,n){angular.isDefined(t)&&null!=t&&e(function(){var e={_id:t.selectedItemId,name:t.selectedItemName,parentIds:t.parentIds};i.selectedItem(e)})});var o="";"undefined"==typeof i.index&&(i.index=0),"undefined"==typeof i.key&&(i.key=0),e(function(){$(document).on("click",function(e){$("#select-level-modal-"+i.key+"-"+i.index).hasClass("in")&&!$(".js-filterable-field").is(":focus")&&($("#select-level-modal-"+i.key+"-"+i.index).collapse("hide"),$(".show-sub-select i").removeClass("fa fa-folder-open fa").addClass("fa fa-folder"))}),$("#select-level li:has(ul)").children("ul").addClass("off"),$("#select-level li a i").addClass("fa fa-folder"),i.listsId=[],i.showSubSelect=function(e,t){e.preventDefault(),$(e.currentTarget).parent().find("ul:first").toggleClass("off"),$(e.currentTarget).find("i").addClass("fa fa-folder"),$(e.currentTarget).find("i").toggleClass("fa fa-folder-open fa"),e.stopPropagation()},"undefined"!=typeof i.itemChoose&&d(i.items)}),i.focusInput=function(e){e.stopPropagation()};var l=0;i.selectedItem=function(e,n){""!=e._id&&"Assets"==i.typeSelect&&2>=l&&(1==Object.keys(e.parentIds).length?angular.forEach(i.items,function(t,n){t._id==e._id&&(i.items=[],i.items.push(t))}):angular.forEach(i.items,function(t,n){t._id==e.parentIds[Object.keys(e.parentIds).length-1]&&(i.items=[],i.items.push(t))})),l+=1,angular.isDefined(i.currentPage)&&angular.isDefined(e)&&e._id==i.currentPage._id||(angular.isDefined(n)&&n.preventDefault(),(angular.isDefined(e.parentIds)||angular.isDefined(e.parentId)||angular.isDefined(e.parent_id))&&""!=e.name?i.text=e.name:i.text=t("trans")("select-folder","directive-select-level"),s.$setViewValue(e._id),i.chageType&&i.onClick({pageId:e._id}),$("#select-level-modal-"+i.key+"-"+i.index).find(".name-select.active").removeClass("active"),o=e,$("#select-level-modal-"+i.key+"-"+i.index).find(".item-"+o._id).addClass("active"),angular.isDefined(n)&&$("#select-level-modal-"+i.key+"-"+i.index).collapse("hide"))},i.toggleSelectMenu=function(t){e(function(){i.itemsTmp=i.items}),"disabled"!=i.disableClick&&e(function(){if($(".show-sub-select").removeClass("active"),$("#select-level li a i").removeClass("fa fa-folder-open fa").addClass("fa fa-folder"),$(".parrent-select").addClass("off"),o)if(angular.forEach($(".item-"+o._id).parents("ul"),function(e,t){$(e).removeClass("off")}),$(".show-sub-select-"+o._id).addClass("active"),"Link"==i.type){var e=r(window.listsIdsMapPageAndContent);angular.forEach(o.parentIds,function(t,i){$(".show-sub-select-"+e[t]).find("i").removeClass("fa fa-folder").addClass("fa fa-folder-open fa")})}else angular.forEach(o.parentIds,function(e,t){o._id!=e&&$(".show-sub-select-"+e).find("i").removeClass("fa fa-folder").addClass("fa fa-folder-open fa")});$("#select-level-modal-"+i.key+"-"+i.index).collapse("toggle")})},i.closed=function(e){$("#select-level-modal-"+i.key+"-"+i.index).collapse("hide")};var d=function(e){for(var t in e)if(e[t].subFolder&&d(e[t].subFolder),e[t]._id==i.itemChoose){i.text=e[t].name;break}}}}}]);var cmsApp=angular.module("cmsContentFolderApp");cmsApp.service("CmsContentFolderService",["$q",function(e){var t,i=this,n=[],a=!1,s="",r="",o="";this.changeStatusHideOrShowAllNestedContent=function(){n=[],a=!a,0==a?(t.isFolder()?this.showFirstLevelOfChildPages(t.children):n.push(t),s="Show All Nested Content"):(t.isFolder()?this.showAllLevelOfChildPages(t.children):n.push(t),s="Hide All Nested Content");var i={textButton:s,contents:n,nodeActive:t},r=e.defer();return r.resolve(i),r.promise},this.getDataNestedFromActiveNode=function(){return n=[],t.isFolder()?this.showAllLevelOfChildPages(t.children):(t.openChild=!0,n.push(t)),n},this.getDataFromActiveNode=function(e){var i=["blocks","assets","templates"];if(!(i.indexOf(t.data.type)>-1)){if(n=[],t.isFolder()){e&&0!=t.data.parent_id&&n.push(t);for(var a in t.children)n.push(t.children[a])}else t.openChild=!0,n.push(t);return n}},this.reloadTree=function(){var e=$("#tree").fancytree("getTree");e.reload()},this.initTree=function(e){a=!1,$("#tree").fancytree({extensions:["glyph"],source:n,autoScroll:!0,activate:function(s,o){var l=$("#tree").fancytree("getTree"),d=$("#tree").fancytree("getActiveNode");d.sortChildren(null,!0),t=l.getNodeByKey(String(r)),null!=t?(t.setActive(),r=""):t=d,i.expandAllChildNodes(t);var u=t.getChildren();n=[],t.isFolder()&&!angular.isUndefined(t.folder)||n.push(t),0==a?i.showFirstLevelOfChildPages(u):i.showAllLevelOfChildPages(u);var c=e.call(c,n,t)},click:function(e,t){var i=t.node;if(!i.isExpanded()&&angular.isDefined(i.data.type))switch(i.data.type){case"assets":i.data.type!=o&&$("#page-loading").css("display","block"),$("#click-asset").click();break;case"templates":i.data.type!=o&&$("#page-loading").css("display","block"),$("#click-template").click();break;case"pages":i.data.type!=o&&$("#page-loading").css("display","block"),$("#click-page").click();break;case"blocks":i.data.type!=o&&$("#page-loading").css("display","block"),$("#click-block").click();break;case"database":i.data.type!=o&&$("#page-loading").css("display","block"),$("#click-database").click();break;case"accessories":1!=i.isActive()&&$("#page-loading").css("display","block");break;case"lasers":1!=i.isActive()&&$("#page-loading").css("display","block");break;case"material":1!=i.isActive()&&$("#page-loading").css("display","block");break;case"platform":1!=i.isActive()&&$("#page-loading").css("display","block");break;case"product":1!=i.isActive()&&$("#page-loading").css("display","block")}}}),i.expandedRootNode()},this.expandAllChildNodes=function(e){"0"!=e.data.parent_id&&(e.setExpanded(!0),e.visit(function(e){e.setExpanded(!0)}))},this.cosllapseAllNodeNotActive=function(){},this.showFirstLevelOfChildPages=function(e){null==e||"Loading..."==e[0].title?e=[]:angular.forEach(e,function(e,t){e.isFolder()||n.push(e)})},this.showAllLevelOfChildPages=function(e){null==e||"Loading..."==e[0].title?e=[]:angular.forEach(e,function(e,t){e.hasChildren()?i.showAllLevelOfChildPages(e.children):e.isFolder()||n.push(e)})},this.expandedRootNode=function(){var e=$("#tree").fancytree("getTree"),t=e.getRootNode().children;for(var i in t)if(t[i].data.type==o)var n=i;var a=e.getRootNode().children[n];angular.isDefined(a)&&a.setActive(),a.hasChildren()&&a.setExpanded()},this.setActiveNode=function(e){r=e},this.setContents=function(e,t){return o=t,n=e},this.getContents=function(){return n}}]);