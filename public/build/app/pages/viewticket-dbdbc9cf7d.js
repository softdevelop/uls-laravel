function humanized_time_span(e,t,n,i){function r(){for(var e=0;e<n[d].length;e++)if(null==n[d][e].ceiling||l<=n[d][e].ceiling)return n[d][e];return null}function o(){for(var e=l,t={},n=0;n<i.length;n++){var r=Math.floor(e/i[n][0]);e-=i[n][0]*r,t[i[n][1]]=r}return t}function a(e){var t=o(),n=e.text.replace(/\$(\w+)/g,function(){return t[arguments[1]]});return s(n,t)}function s(e,t){for(var n in t)if(1==t[n]){var i=new RegExp("\\b"+n+"\\b");e=e.replace(i,function(){return arguments[0].replace(/s\b/g,"")})}return e}if(n=n||{past:[{ceiling:60,text:"$seconds seconds ago"},{ceiling:3600,text:"$minutes minutes ago"},{ceiling:86400,text:"$hours hours ago"},{ceiling:2629744,text:"$days days ago"},{ceiling:31556926,text:"$months months ago"},{ceiling:null,text:"$years years ago"}],future:[{ceiling:60,text:"in $seconds seconds"},{ceiling:3600,text:"in $minutes minutes"},{ceiling:86400,text:"in $hours hours"},{ceiling:2629744,text:"in $days days"},{ceiling:31556926,text:"in $months months"},{ceiling:null,text:"in $years years"}]},i=i||[[31556926,"years"],[2629744,"months"],[86400,"days"],[3600,"hours"],[60,"minutes"],[1,"seconds"]],"Invalid Date"==new Date(e))for(;-1!=String(e).indexOf("-");)e=e.replace("-","/");e=new Date(e),t=t?new Date(t):new Date;var l=(t-e)/1e3,d="past";return 0>l&&(d="future",l=0-l),a(r())}angular.module("user",[]),angular.module("permission",[]),angular.module("role",[]),angular.module("multiSelect",[]),angular.module("ticket",[]),angular.module("type",[]),angular.module("dataOption",[]),angular.module("nlcFilter",[]),angular.module("file",[]),angular.module("AppLanguage",[]),angular.module("TemplateManagerApp",[]),angular.module("RegionApp",[]),angular.module("campaignApp",[]),angular.module("campaignDetailApp",[]),angular.module("MarketsegmentApp",[]),angular.module("notification",[]),angular.module("transApp",[]),angular.module("assetManager",[]),angular.module("BlockApp",[]),angular.module("ChannelPartnersApp",[]),angular.module("roleGroup1",[]),angular.module("filedType",[]),angular.module("filed",[]),angular.module("term",[]),angular.module("customFormatDate",[]),angular.module("SeoAnalysisApp",[]),angular.module("pageApp",[]),angular.module("treeresizer",[]),angular.module("CreatePageApp",[]),angular.module("EditDraftApp",[]),angular.module("fomatHtml",[]),angular.module("colorpicker.module",[]),angular.module("formBuilderDirectiveApp",[]),angular.module("appManageTerm",[]),angular.module("TermTemplateManagerApp",[]),angular.module("configurator",[]),angular.module("TemplateContentManager",[]),angular.module("cmsContentFolderApp",[]),angular.module("lowercaseCharater",[]),angular.module("selectLevel",[]),angular.module("modalSelectLevel",[]),angular.module("configField",[]),angular.module("cmsContentInsertApp",[]),angular.module("confirmDirective",[]),angular.module("CmsApp",[]),angular.module("checkLimitAndChangeDateTimeDirectiveApp",[]),angular.module("tagContentApp",[]),angular.module("tagContentDirective",[]),angular.module("cmsContentTagApp",[]),angular.module("viewDraft",[]),angular.module("databaseManager",[]),angular.module("selectLevelDatabase",[]),angular.module("modalSelectPage",[]),angular.module("configFormDatabaseApp",[]),angular.module("historyApp",[]),angular.module("BlockNestedApp",[]),angular.module("selectLevelAsset",[]),angular.module("MaterialApp",[]),angular.module("draganddrop",[]),angular.module("activityLog",[]),angular.module("translation",[]),angular.module("HelpEditorApp",[]),angular.module("helpEditorDirective",[]),angular.module("selectLevelHelp",[]),angular.module("cache",[]),angular.module("file",[]),angular.module("treeresize",[]),angular.module("test",[]),angular.module("guide",[]),angular.module("PlatformsApp",[]),angular.module("accessories",[]);var defaultModules=["ui.bootstrap","ngResource","ngCookies","ngFileUpload","ngRoute","toggle-switch","ngImgCrop","ngTable","user","role","permission","multiSelect","ticket","type","dataOption","nlcFilter","file","xeditable","timer","AppLanguage","TemplateManagerApp","RegionApp","campaignApp","campaignDetailApp","MarketsegmentApp","notification","transApp","assetManager","BlockApp","ChannelPartnersApp","roleGroup1","filedType","filed","term","ui-iconpicker","customFormatDate","SeoAnalysisApp","pageApp","treeresizer","CreatePageApp","EditDraftApp","fomatHtml","colorpicker.module","formBuilderDirectiveApp","appManageTerm","TermTemplateManagerApp","mgo-angular-wizard","configurator","TemplateContentManager","cmsContentFolderApp","lowercaseCharater","selectLevel","configField","cmsContentInsertApp","confirmDirective","CmsApp","checkLimitAndChangeDateTimeDirectiveApp","tagContentApp","tagContentDirective","cmsContentTagApp","viewDraft","modalSelectLevel","databaseManager","selectLevelDatabase","modalSelectPage","configFormDatabaseApp","historyApp","BlockNestedApp","selectLevelAsset","MaterialApp","ui.sortable","activityLog","translation","HelpEditorApp","helpEditorDirective","selectLevelHelp","cache","file","treeresize","guide","PlatformsApp","accessories"];"undefined"!=typeof modules&&(defaultModules=defaultModules.concat(modules));var myApp=angular.module("uls",defaultModules);angular.module("uls").run(["editableOptions",function(e){e.theme="bs3"}]),angular.module("uls").config(["$logProvider",function(e){e.debugEnabled(window.debug)}]),"undefined"!=typeof angularMock&&(defaultModules=defaultModules.concat(angularMock));var goTo=function(e){window.location.href="#_"+e,$("#fix-modal-top").scrollTop(0),$("#"+e).hasClass("in")||$("#"+e).prev().trigger("click")};myApp.config(["$httpProvider",function(e){e.interceptors.push(["$q",function(e){e.defer();return{responseError:function(t){var n=angular.element(".butterbar-container");switch(t.status){case 401:return void(window.location.href=window.baseUrl);case 404:n.hasClass("hidden")&&n.removeClass("hidden");break;case 500:n.hasClass("hidden")&&n.removeClass("hidden")}return e.reject(t)}}}])}]),function(e){function t(){var t=window.innerHeight;screen.height;e(".table-responsive.set-height, .table-responsive#tb-group-user").css({height:t-170+"px"}),e(".table-animate").css({height:t-170+"px"}),e("#search-page,.box-maps").css({height:t-105+"px"}),e(".box-list-rep").css({height:t-100+"px"}),e("#load-maps").css({height:t-185+"px"})}e(document).ready(t),e(window).resize(t),e(document).ready(function(){e(".dropdown-menu table tr td button").removeAttr("style")}),e(document).ready(function(){setTimeout(function(){var t=e("#frame_html").contents().find("head");t.append('<style type="text/css">.area_toolbar{background-color:#f1f1f1;}#editor{border:solid #ccc 1px}#result{border-top:solid #ccc 1px;border-bottom: solid #ccc 1px}.editarea_popup{box-shadow: 0px 4px 36px rgba(177, 177, 177, 0.75);border: solid 1px #CCCCCC;background-color: #FFFFFF;}.area_toolbar select{font-size:9pt;background-color:#fff}</style>')},1e3)}),e(window).load(function(){e(".step3 .show-more").click(function(){e(".step3 .wrap-more-product").toggleClass("show")})}),e(document).ready(function(){e(".nav-icon").click(function(){e(this).toggleClass("open"),e("#pagehome").toggleClass("on-off")})});var n,i,r,o,a,s,l;e(".next").click(function(){return l?!1:(l=!0,n=e(this).parent(),i=e(this).parent().next(),i.show(),void n.animate({opacity:0},{step:function(e,t){s=1-.2*(1-e),o=50*e+"%",a=1-e,n.css({transform:"scale("+s+")"}),i.css({left:o,opacity:a})},duration:800,complete:function(){n.hide(),l=!1},easing:"easeInOutBack"}))}),e(".previous").click(function(){return l?!1:(l=!0,n=e(this).parent(),r=e(this).parent().prev(),r.show(),void n.animate({opacity:0},{step:function(e,t){s=.8+.2*(1-e),o=50*(1-e)+"%",a=1-e,n.css({left:o}),r.css({transform:"scale("+s+")",opacity:a})},duration:800,complete:function(){n.hide(),l=!1},easing:"easeInOutBack"}))}),e(".submit").click(function(){return!1})}(jQuery),angular.module("uls").controller("BaseController",["$scope","$parse","$timeout","$modal","UserService","AssetManagerService",function(e,t,n,i,r,o){if(angular.element(".wrapper").removeClass("hidden"),r.setData(window.usersMap),n(function(){"undefined"!=typeof e.callbackLoadUserFinish&&(e.callbackLoadUserFinish(),e.users_map=r.getUsersMap())}),e.testFuture=window.testFuture,1==e.testFuture&&angular.element(".test").removeClass("hidden"),e.windowType=window.info,"undefined"!=typeof window.info)for(var a in window.info){var s=t(a);s.assign(e,window.info[a])}e.initDate=function(){angular.element(".date").bdatepicker({format:"yyyy-mm-dd"})},e.viewModalImage=function(e){var t=i.open({templateUrl:baseUrl+"/app/components/termTemplateManager/views/modal/viewImage.html",controller:"ModalViewPictureCtrl",size:void 0,windowClass:"show-img",resolve:{fileId:function(){return e}}});t.result.then(function(e){},function(){})},e.urlForm=[],e.getUrlImageAssetForm=function(t,n){"undefined"==typeof e.urlForm[t]&&(e.urlForm[t]=[]),o.getUrlImageAsset(t).then(function(i){e.urlForm[t][n]=i.url})},e.removeThumbnailAssertForm=function(t,n){e.urlForm[t][n]=""},e.initTooltip=function(e){$('[data-toggle="tooltip"]').tooltip()}}]).controller("ModalViewPictureCtrl",["$scope","$modalInstance","fileId",function(e,t,n){e.fileId=n,e.baseUrl=baseUrl,e.cancel=function(){t.dismiss("cancel")}}]);var userModule=angular.module("user");userModule.factory("UserResource",["$resource",function(e){return e("/api/user/:method/:id",{method:"@method",id:"@id"},{add:{method:"post"},save:{method:"post"},update:{method:"put"}})}]).factory("UserService",["$q","$filter","UserResource",function(e,t,n){var i=[],r=[],o=[],a=this,s={},l={};return this.setHashData=function(e){s=e},this.create=function(t){if("undefined"!=typeof t.id)return a.update(t);var r=e.defer(),o=new n(t);return o.$save({},function(e){e.status&&e.item&&(i.push(e.item),"undefined"==typeof e.item.last_login&&(e.item.last_login="0000-00-00 00:00:00")),r.resolve(e)},function(e){r.resolve(e.data)}),r.promise},this.changePassword=function(t){var i=e.defer(),r=new n(t);return r.$save({method:"change-password",id:t.id},function(e){e.status?i.resolve(e):i.reject(e)},function(e){i.reject(e.data)}),i.promise},this.changeRoles=function(t){var i=e.defer(),r=new n(t);return r.$save({method:"change-roles"},function(e){e?i.resolve(e):i.reject(e)},function(e){i.reject(e.data)}),i.promise},this.update=function(t){var r=e.defer(),o=new n(t);return o.$update({id:t.id},function(e){if(e.status)for(var t in i)if(i[t].id==e.item.id){i[t]=e.item;break}r.resolve(e)},function(e){r.resolve(e.data)}),r.promise},this.get=function(t){var i=e.defer();return n.get({id:t},function(e){i.resolve(e)}),i.promise},this.query=function(){var t=e.defer();return n.query(function(e){i=e,t.resolve(e)}),t.promise},this.queryUsersManager=function(){var t=e.defer();return n.query({method:"get-all-user-manager"},function(e){i=e,t.resolve(e)}),t.promise},this.remove=function(t){var r=e.defer();return n["delete"]({id:t},function(e){if(e.status)for(var n in i)if(i[n].id==t){i[n].status="no";break}r.resolve(e)}),r.promise},this.pushUser=function(e){i.push(e)},this.updateUser=function(e){for(var t in i)if(i[t].id==e.id){e.status="yes",i[t]=e;break}},this.changeAvatar=function(t,i){var r=e.defer();return n.save({method:"change-avatar",file:i,id:t},function(e){r.resolve(e)},function(e){r.resolve(e.data)}),r.promise},this.resetPassword=function(t){var i=e.defer();return n.save({method:"email",entity:"password",email:t},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.getUsers=function(){return i},this.getUserById=function(e){return l[e]},this.getUsersMap=function(){return l},this.listMap=function(e,t){if("role"==t)for(var n in e)r[e[n].id]=e[n];else for(var n in e)o[e[n].id]=e[n]},this.getMap=function(e){return"role"==e?r:o},this.userBranchManager=function(t){var i=e.defer();return n.query({id:t,method:"get-users-branch-manager"},function(e){i.resolve(e)}),i.promise},this.updatePermissions=function(t,i){var r=e.defer();return n.save({id:t,permissionIds:i,method:"update-permission"},function(e){r.resolve(e)},function(e){r.resolve(e.data)}),r.promise},this.updateGroup=function(t,i){var r=e.defer();return n.save({id:t,groupIds:i,method:"update-group"},function(e){r.resolve(e)},function(e){r.resolve(e.data)}),r.promise},this.updateRoles=function(t,i){var r=e.defer();return n.save({id:t,roleIds:i,method:"update-role"},function(e){r.resolve(e)},function(e){r.resolve(e.data)}),r.promise},this.changeStatus=function(t){var r=e.defer();return n["delete"]({id:t,method:"change-status"},function(e){if(e.status)for(var n in i)if(i[n].id==t){i[n].status="yes";break}r.resolve(e)}),r.promise},this.setData=function(e){i=e;for(var t in e)l[e[t].id]=e[t];return i},this.updateShowDueDateUser=function(t){var i=e.defer(),r=new n(t);return r.$save({method:"update-show-due-date-user"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this}]);var assetmanagerApp=angular.module("assetManager",["ngResource","ui.bootstrap","ngSanitize","ngTable"]);assetmanagerApp.factory("AssetManagerResource",["$resource",function(e){return e("/api/asset-manager/:method/:id",{method:"@method",id:"@id"},{add:{method:"post"},save:{method:"post"},update:{method:"put"},editNameFolder:{method:"edit-name-folder"}})}]).service("AssetManagerService",["AssetManagerResource","$q",function(e,t){var n=this,i=[];this.createFolderProvider=function(i){if("undefined"!=typeof i.id)return n.editFolderAndFile(i);var r=t.defer(),o=new e(i);return o.$save({method:"create-folder"},function(e){r.resolve(e)},function(e){r.resolve(e.data)}),r.promise},this.uploadNewAsset=function(n){var r=t.defer(),o=new e(n);return o.$save({method:"upload-new-asset"},function(e){0!=e.status&&i.push(e.item),r.resolve(e.item)},function(e){r.resolve(e.data)}),r.promise},this.createNewAsset=function(n){var r=t.defer(),o=new e(n);return o.$save({method:"create-new-asset"},function(e){0!=e.status&&i.push(e.item),r.resolve(e.item)},function(e){r.resolve(e.data)}),r.promise},this.saveFieldFile=function(n){var i=t.defer(),r=new e(n);return r.$save({method:"save-file-asset"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.editFile=function(n){var i=t.defer(),r=new e(n);return r.$save({method:"edit-file"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.crop=function(n){var i=t.defer(),r=new e(n);return r.$save({method:"crop"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.addTagsForPage=function(n,i){var r=t.defer(),o=new e(i);return o.$save({id:n,method:"add-tags"},function(e){0!=e.status,r.resolve(e)},function(e){r.resolve(e.data)}),r.promise},this.getAssetManagerById=function(n){var i=t.defer(),r=new e;return r.$get({id:n},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.setAssetManagers=function(e){return i=e},this.getAssetManagers=function(){return i},this.getUrlImageAsset=function(n){var i=t.defer();return e.get({id:n,method:"get-url-image-asset"},function(e){i.resolve(e)}),i.promise},this.deleteFolderAndAsset=function(n){var i=t.defer(),r=new e;return r.$delete({id:n},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.deleteAssetFile=function(n){var i=t.defer(),r=new e;return r.$get({id:n,method:"delete-file"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.editNameFolder=function(n){var i=t.defer(),r=new e(n);return r.$save({id:n.id,method:"edit-name-folder"},function(e){0!=e.status&&i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.updateContentFile=function(n,i){var r=t.defer(),o=new e(i);return o.$save({id:n,method:"update-content-file"},function(e){r.resolve(e)},function(e){r.resolve(e.data)}),r.promise}}]),angular.module("uls").controller("NotificationController",["$scope","$filter","NotificationService","$controller","$timeout",function(e,t,n,i,r){function o(){}function a(){if(f=!1,c.length>0){var e=c.shift();l(e)}}function s(){}function l(t){if(f)return void c.push(t);if(f=!0,-1==t.data.sender_id)var n=e.baseUrl+"/160x160_avatar_default.png?t=1";else var n=e.users_map[t.data.sender_id].avatar;var i=new Notify("Notification",{icon:n,body:t.data.message,tag:t.data.sender_id,notifyShow:o,notifyClose:a,notifyClick:function(){window.location.href="/"+t.data.href},notifyError:s,timeout:5});i.show()}i("BaseController",{$scope:e}),e.callbackLoadUserFinish=function(){},angular.element("#notification-top").removeClass("hidden"),e.baseUrl=window.baseUrl;var d=10;e.limitTo=d;var u=1;e.notifications=[];var c=[],f=!1;e.amount=0,$(".scroll-noti1").scroll(function(){$(this)[0].scrollHeight-$(this).scrollTop()===$(this).outerHeight()&&e.$apply(function(){e.limitTo=e.limitTo+d})});var p=RowboatPusher.subscribe("notification_ticket");p.bind("Rowboat\\Notification\\Events\\Notifications\\Broadcast\\NotificationTicket",function(t){e.$apply(function(){"undefined"!=typeof t.data.user_id&&-1!=t.data.user_id.indexOf(window.userId)&&(l(t),u=1,e.amount++)})}),e.getNotifications=function(){n.query(u).then(function(t){u&&e.setUserReadThisNotification(),e.notifications=t,e.hightlight=angular.copy(e.amount),e.amount=0,u=0})},e.setUserReadThisNotification=function(){n.setRead().then(function(){})},n.getAmountNotificationsNotRead().then(function(t){e.amount=t.result})}]);var permissionModule=angular.module("notification");permissionModule.factory("NotificationResource",["$resource",function(e){return e("/api/notification/:method/:id",{},{add:{method:"post"},save:{method:"post"}})}]).service("NotificationService",["$q","$filter","NotificationResource",function(e,t,n){var i=[];this.getAmountNotificationsNotRead=function(t){var i=e.defer();return n.get({method:"amount-notifications-not-read"},function(e){i.resolve(e)}),i.promise},this.query=function(t){var r=e.defer();return t?n.query().$promise.then(function(e){i=e,r.resolve(i)}):r.resolve(i),r.promise},this.notificationInvite=function(t){var i=e.defer(),r=new n(t);return r.$save({data:t,method:"invite"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.setRead=function(){var t=e.defer(),i=new n;return i.$save({method:"set-read"},function(e){t.resolve(e)},function(e){t.resolve(e.data)}),t.promise}}]),notificationModule=angular.module("notification"),notificationModule.directive("notification",[function(){return{restrict:"AE",scope:{item:"="},replace:!0,templateUrl:baseUrl+"/app/shared/notification/views/notification.html",link:function(){}}}]);var module=angular.module("uls");module.directive("rowboatRequired",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,i){"undefined"==typeof e.$eval(n.ngModel)&&i.$setValidity("rowboatRequired",!1),t.on("focus",function(r){e.$watch(n.ngModel,function(e){var n="undefined"!=typeof e&&0!=e.length;if(n)t.parent().find("span").remove(),t.parent().removeClass("error"),i.$setValidity("rowboatRequired",n);else if(0==t.parent().find("span").length){t.parent().addClass("error");var r='<span class="control-label">It is required</span>';t.parent().append(r),i.$setValidity("rowboatRequired",n)}})})}}}),module.directive("rowboatLength",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,i){"undefined"!=typeof e.$eval(n.ngModel)&&e.$eval(n.ngModel).length!=n.rowboatLength&&i.$setValidity("rowboatLength",!1),t.on("focus",function(r){e.$watch(n.ngModel,function(e){var r=n.rowboatLength,o="undefined"!=typeof e&&e.length==r;if(o)t.parent().find("span").remove(),t.parent().removeClass("error"),i.$setValidity("rowboatLength",o);else if(0==t.parent().find("span").length){t.parent().addClass("error");var a='<span class="control-label">Length is '+r+"</span>";t.parent().append(a),i.$setValidity("rowboatLength",o)}})})}}}),module.directive("rowboatMinLength",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,i){"undefined"!=typeof e.$eval(n.ngModel)&&e.$eval(n.ngModel).length<n.rowboatMinLength&&i.$setValidity("rowboatMinLength",!1),t.on("focus",function(r){e.$watch(n.ngModel,function(e){var r=n.rowboatMinLength,o="undefined"!=typeof e&&e.length>=r;if(o)t.parent().find("span").remove(),t.parent().removeClass("error"),i.$setValidity("rowboatMinLength",o);else if(0==t.parent().find("span").length){t.parent().addClass("error");var a='<span class="control-label">Min length is '+r+"</span>";t.parent().append(a),i.$setValidity("rowboatMinLength",o)}})})}}}),module.directive("rowboatMaxLength",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,i){"undefined"!=typeof e.$eval(n.ngModel)&&e.$eval(n.ngModel).length>n.rowboatMaxLength&&i.$setValidity("rowboatMaxLength",!1),t.on("focus",function(r){e.$watch(n.ngModel,function(e){var r=n.rowboatMaxLength,o="undefined"!=typeof e&&e.length<=r;if(o)t.parent().find("span").remove(),t.parent().removeClass("error"),i.$setValidity("rowboatMaxLength",o);else if(0==t.parent().find("span").length){t.parent().addClass("error");var a='<span class="control-label">Max length is '+r+"</span>";t.parent().append(a),i.$setValidity("rowboatMaxLength",o)}})})}}}),module.directive("rowboatEmailPattern",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,i){$pattern=/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/,"undefined"==typeof e.$eval(n.ngModel)&&i.$setValidity("rowboatEmailPattern",!1),t.on("blur",function(r){e.$watch(n.ngModel,function(e){var n="undefined"!=typeof e&&$pattern.test(e);if(n)t.parent().find("span").remove(),t.parent().removeClass("error"),i.$setValidity("rowboatEmailPattern",n);else if(0==t.parent().find("span").length){t.parent().addClass("error");var r='<span class="control-label">Email Invalid</span>';t.parent().append(r),i.$setValidity("rowboatEmailPattern",n)}})})}}});var filterDate=angular.module("customFormatDate",[]);filterDate.filter("myDate",["$filter",function(e){return function(t,n){if(null==t)return"";if("Invalid Date"==new Date(t))for(;-1!=String(t).indexOf("-");)t=t.replace("-","/");if("Invalid Date"==new Date(t))return"";var i=e("date")(new Date(String(t)),angular.isUndefined(n)?"MM-dd-yyyy":n);return String(i)}}]).filter("myDateL",["$filter",function(e){return function(t){if(null==t)return"";if("Invalid Date"==new Date(t))for(;-1!=String(t).indexOf("-");)t=t.replace("-","/");if("Invalid Date"==new Date(t))return"";var n=e("date")(new Date(String(t)),"MMMM d, y");return String(n)}}]).filter("myDateTime",["$filter",function(e){return function(t){if(null==t)return"";if("0000-00-00 00:00:00"==t)return"";if("Invalid Date"==new Date(t))for(;-1!=String(t).indexOf("-");)t=t.replace("-","/");if("Invalid Date"==new Date(t))return"";var n=e("date")(new Date(String(t)),"MM-dd-yyyy HH:mm:ss");return String(n)}}]).filter("myDateShortTime",["$filter",function(e){return function(t){if(null==t)return"";if("0000-00-00 00:00:00"==t)return"";if("Invalid Date"==new Date(t))for(;-1!=String(t).indexOf("-");)t=t.replace("-","/");if("Invalid Date"==new Date(t))return"";var n=e("date")(new Date(String(t)),"MM-dd-yyyy h:mma");return String(n)}}]).filter("clientDate",["$filter",function(e){return function(t,n){if(null==t)return"";if("0000-00-00 00:00:00"==t)return"";if("Invalid Date"==new Date(t))for(;-1!=String(t).indexOf("-");)t=t.replace("-","/");if("Invalid Date"==new Date(t))return"";t=new Date(t),t=new Date(parseInt(new Date(t).getTime())-60*parseInt((new Date).getTimezoneOffset())*1e3);var i=e("date")(new Date(String(t)),angular.isUndefined(n)?"MM-dd-yyyy":n);return String(i)}}]).filter("clientDateTime",["$filter",function(e){return function(t){return e("date")(checkInvalid(t),window.dateTimeFormat)}}]).filter("clientLogDate",["$filter",function(e){return function(t){return e("date")(checkInvalid(t),window.logDate)}}]).filter("clientMediumDate",["$filter",function(e){return function(t){return e("date")(checkInvalid(t),window.mediumDate)}}]).filter("clientShortTime",["$filter",function(e){return function(t){return e("date")(checkInvalid(t),window.shortTime)}}]).filter("clientShortTimeFollowTimezone",["$filter",function(e){return function(t,n){if(null==t)return"";if("Invalid Date"==new Date(t))for(;-1!=String(t).indexOf("-");)t=t.replace("-","/");if("Invalid Date"==new Date(t))return"";var i=e("date")(new Date(String(t)),window.shortTime);return String(i)}}]).filter("formatCurrentDate",["$filter",function(e){return function(e){if(e=checkInvalid(e),!e)return"";e=new Date(e);var t=e.getMonth()+"-"+e.getDate()+"-"+e.getFullYear();return String(t)}}]).filter("formatCurrentTime",["$filter",function(e){return function(e){if(e=checkInvalid(e),!e)return"";e=new Date(e);var t=e.getHours()>=12?"pm":"am",n=parseInt(e.getHours())%12;n=n?10>n?"0"+n:n:12;var i=parseInt(e.getMinutes())<10?"0"+e.getMinutes():e.getMinutes(),r=parseInt(e.getSeconds())<10?"0"+e.getSeconds():e.getSeconds(),o=n+"-"+i+"-"+r+" "+t;return String(o)}}]).filter("formatCurrentShortTime",["$filter",function(e){return function(e){if(e=checkInvalid(e),!e)return"";e=new Date(e);var t=e.getHours()>=12?"pm":"am",n=parseInt(e.getHours())%12;n=n?10>n?"0"+n:n:12;var i=parseInt(e.getMinutes())<10?"0"+e.getMinutes():e.getMinutes(),r=n+":"+i+" "+t;return String(r)}}]);var checkInvalid=function(e,t){if(null==e)return"";if("Invalid Date"==new Date(e))for(;-1!=String(e).indexOf("-");)e=e.replace("-","/");return"Invalid Date"==new Date(e)?"":(e=new Date(e),e=new Date(parseInt(new Date(e).getTime())-60*parseInt((new Date).getTimezoneOffset())*1e3),new Date(String(e)))};angular.module("nlcFilter").filter("elapsedtime",function(){return function(e){return humanized_time_span(e)}});var translation=angular.module("translation",[]);translation.filter("trans",["$filter",function(e){return function(e,t){return null==e?"":window.translations[t][e]}}]);var selectLevel=angular.module("helpEditorDirective",[]),version=5;selectLevel.directive("helpEditorDirective",["$timeout","$filter",function(e,t){return{require:"?ngModel",restrict:"EA",scope:{items:"=",text:"@",selectedItems:"=selectedItem",onClick:"&"},replace:!0,templateUrl:baseUrl+"/app/components/user/help-editor/view/view-help.html?v="+(new Date).getTime(),link:function(t,n,i,r){t.description="",t.recursiveGetDescription=function(e){angular.forEach(e,function(e,n){e.parent=!1,t.description+='<strong class="space-topic" id="_'+e._id+'">'+e.name+"</strong>"+e.description,e.subFolder.length>0&&t.recursiveGetDescription(e.subFolder)})},t.getDesctiption=function(){angular.forEach(t.items,function(e,n){e.parent=!0,t.description+='<h4 id="_'+e._id+'" class="c-primary">'+e.name+'</h4><div class="space-area user-ad-area">'+e.description,t.recursiveGetDescription(e.subFolder),t.description+="</div>"})},t.getDesctiption(),t.goToAnchorWithId=function(e){window.location.href="#"+e,$("#fix-modal-top").scrollTop(0)},e(function(){$(".sub-select-"+t.items[0]._id).addClass("in")})}}}]);var ticketModule=angular.module("ticket");ticketModule.controller("TicketController",["$scope","TicketService","$filter","ngTableParams","$controller","$modal","$timeout",function(e,t,n,r,o,a,s){function l(){var e=$(window).height(),t=$(".your-ticket"),n=$(".your-ticket").offset(),i=n.top,r=e-i;t.attr("style","height: "+r+"px!important");var o=$(".your-ticket .content-your-ticket"),a=$(".sidebar-block input").outerHeight(),s=$(".sidebar-block .head-your-ticket").outerHeight(),l=t.outerHeight(),d=l-a-s-29;o.attr("style","height: "+d+"px!important")}o("BaseController",{$scope:e}),e.filterTicketClosed=function(e){var t=[];return angular.forEach(e,function(e,n){"closed"!=e.status&&t.push(e)}),t},angular.element(".wrapper").removeClass("hidden"),e.isSearch=!1,e.message="Hello!",e.baseUrl=baseUrl,dataInternalOld=[],e.userId=window.userId,e.types=window.types,e.states=window.states,e.prioritys=window.prioritys,e.showChild=!0,e.usersSelected=angular.copy(window.usersSelected),e.itemsDefault=angular.copy(window.items),e.parentAndChild=[],e.filterQueue=[],e.returnSearchResultParam=angular.copy(window.returnSearchResultParam),e.formatTicketToParentAndChild=function(t){angular.forEach(t,function(n,i){"deployed"==e.currentState?null==n.base_id&&(n.children=[],_.find(t,function(e){e.base_id==n.id&&n.children.push(e)}),e.parentAndChild.push(n)):null==n.base_id&&"closed"!=n.status&&(n.children=[],_.find(t,function(t){t.base_id==n.id&&"all_open"==e.currentState?n.children.push(t):t.base_id==n.id&&"all_open"!=e.currentState&&"closed"!=t.status&&n.children.push(t)}),e.parentAndChild.push(n))})},$(document).ready(l),$(window).resize(l),e.$watch(function(){return window.innerWidth},function(n){n>1200&&t.query().then(function(t){e.tickets=t})});var d=RowboatPusher.subscribe("notification_ticket");d.bind("Rowboat\\Notification\\Events\\Notifications\\Broadcast\\NotificationTicket",function(t){angular.isDefined(t)&&t.sender_id!=window.userId&&e.$apply(function(){c()})});var u=RowboatPusher.subscribe("ticket");u.bind("Rowboat\\Ticket\\Events\\Ticket\\Broadcast\\TicketCreated",function(t){angular.isDefined(t)&&t.creator.id!=window.userId&&e.$apply(function(){c()})}),u.bind("Rowboat\\Ticket\\Events\\Ticket\\Broadcast\\TicketFolowing",function(t){angular.isDefined(t)&&t.userId!=window.userId&&e.$apply(function(){c()})}),u.bind("Rowboat\\Ticket\\Events\\Ticket\\Broadcast\\TicketAssigned",function(t){angular.isDefined(t)&&t.sender.id!=window.userId&&e.$apply(function(){c()})}),u.bind("Rowboat\\Ticket\\Events\\Ticket\\Broadcast\\TicketInvite",function(t){angular.isDefined(t)&&t.sender.id!=window.userId&&e.$apply(function(){c()})}),u.bind("Rowboat\\Ticket\\Events\\Ticket\\Broadcast\\BroadcastUpdateDueDateListTicket",function(t){angular.isDefined(t)&&t.sender.id!=window.userId&&e.$apply(function(){c()})}),u.bind("Rowboat\\Ticket\\Events\\Ticket\\Broadcast\\BroadcastDeleteListTickets",function(t){angular.isDefined(t)&&t.sender.id!=window.userId&&e.$apply(function(){c()})}),u.bind("Rowboat\\Ticket\\Events\\Ticket\\Broadcast\\BroadCastUpdateNameTicket",function(t){angular.isDefined(t)&&e.$apply(function(){c()})}),e.callbackLoadUserFinish=function(){};var c=function(){t.getTicketGroup(e.currentState).then(function(t){f(),e.itemsDefault=t,e.parentAndChild=[],e.formatTicketToParentAndChild(e.itemsDefault),e.showChild?e.items=e.parentAndChild:e.items=e.filterTicketClosed(e.itemsDefault),e.tableParams.reload()})},f=function(){t.getNumberOfTickets().then(function(t){e.numberOfTickets=t})};e.formatStructChildParentWhenFilter=function(t){angular.forEach(t,function(n,i){null==n.base_id&&(n.children=[],_.find(t,function(e){e.base_id==n.id&&n.children.push(e)}),e.parentAndChild.push(n))})};var p=function(){f(),"undefined"!=typeof e.currentState&&(e.groupName=t.getGroupBaseOnState(e.currentState),e.formatTicketToParentAndChild(e.itemsDefault),"Assigned To Me"==e.groupName?(e.showChild=!1,e.items=e.filterTicketClosed(e.itemsDefault)):e.items=e.parentAndChild,e.$watch("tableParams",function(t,n){if(!angular.isUndefined(t)&&!angular.isUndefined(n)){if(angular.isDefined(window.statusFilter)&&""!=window.statusFilter){var i=window.statusFilter;e.tableParams.filter().status=[],e.tableParams.filter().status.push(i),window.statusFilter="",s(function(){$("#filter-status").select2({tag:!0,value:i})})}angular.isDefined(window.typeFilter)&&""!=window.typeFilter&&s(function(){var t=window.typeFilter;e.tableParams.filter().type_id=[],e.tableParams.filter().type_id.push(t),s(function(){$("#filter-type_id").select2({tag:!0,value:t})})}),angular.isDefined(window.filterIncludeClosed)&&1==window.filterIncludeClosed&&s(function(){var t=["all","closed"];e.tableParams.filter().status=t,s(function(){$("#filter-status").select2({tag:!0,value:t})}),e.showChild=!1}),angular.isDefined(window.returnSearchResultParam)&&null!=window.returnSearchResultParam&&e.returnPreviousSearch(window.returnSearchResultParam)}}),e.tableParams=new r({page:1,count:50,sorting:{id:"desc"},filter:{id:"",percentSearch:"100"}},{total:e.items.length,getData:function(t,i){var r=i.filter();e.filterQueue=angular.copy({filterData:i.filter(),showAllOrShowNested:e.showChild,ticket_state:e.currentState}),e.setSessionToFilter(e.filterQueue),angular.isDefined(window.shouldShowAllTicket)&&window.shouldShowAllTicket&&(e.showChild=!1,
window.shouldShowAllTicket=!1),angular.isDefined(r.status)&&-1!=r.status.indexOf("closed")?e.showChild?(e.parentAndChild=[],e.formatStructChildParentWhenFilter(e.itemsDefault),e.items=e.parentAndChild):e.items=e.itemsDefault:("deployed"!=e.currentState?e.items=e.filterTicketClosed(e.itemsDefault):e.items=e.itemsDefault,e.showChild&&(e.parentAndChild=[],e.formatTicketToParentAndChild(e.itemsDefault),e.items=e.parentAndChild));var o=i.sorting()?n("orderBy")(e.items,i.orderBy()):e.items,a=i.filter();o=i.filter()?n("filter")(o,a,m):o,i.total(o.length),t.resolve(o.slice((i.page()-1)*i.count(),i.page()*i.count())),$("#page-loading").css("display","none")}}))},m=function(e,t){if(""==e||""==t)return e;if(-1!==e.toString().indexOf("%"))var n=e.split("%"),i=parseInt(n[0]),t=parseInt(t);return"array"==typeof t&&angular.forEach(t,function(e,t){"string"==typeof e&&(e=e.toLowerCase())}),"string"==typeof t&&(t=t.toLowerCase()),angular.isArray(t)?-1!==t.indexOf("all")?e:-1!==t.indexOf(e):-1===e.toString().toLowerCase().indexOf("%")?-1!==e.toString().toLowerCase().indexOf(t):-1!==e.toString().toLowerCase().indexOf("%")?t>=i:void 0};e.paramSearch=function(e,t){var n=[];return angular.forEach(t,function(t,i){var r=!0;angular.isDefined(e.type_id)&&t.type_id!=e.type_id&&(r=!1),angular.isDefined(e.assign_id)&&""!=e.assign_id&&t.assign_id!=e.assign_id&&(r=!1),r&&n.push(t)}),n},e.clickable=function(e,t){window.location=baseUrl+"/support/show/"+t},e.typeFilterSelect=function(t){var n=[];return angular.forEach(e.types,function(e,t){n.push({id:e.id,title:e.name})}),n.unshift({id:"all",title:"All"}),n=_.sortBy(n,"title")},e.priorityFilterSelect=function(t){var n=[];return angular.forEach(e.prioritys,function(e,t){n.push({id:t,title:e})}),n.unshift({id:"all",title:"All"}),n=_.sortBy(n,"title")},e.statusFilterSelect=function(t){var n=[];return angular.forEach(e.states,function(e,t){n.push({id:t,title:e})}),n.unshift({id:"all",title:"All"}),n},e.assignFilterData=function(t){var n=[];return angular.forEach(e.usersSelected,function(e,t){n.push({id:e.id,title:e.name})}),n.unshift({id:"unassigned",title:"Unassigned"}),n.unshift({id:"all",title:"All"}),n},e.getTicketGroup=function(){p()},e.deleteTicket=function(n,i){n.stopPropagation();var r=confirm("Are you sure you want to delete this ticket?"),o=i.id;1==r&&t.deleteTicket(i.id).then(function(t){if(1==t.status){if(e.errorDeleted=!1,e.itemsTemp=[],"deployed"!=e.currentState)if(null==i.base_id&&"closed"!=i.status)for(var n in e.itemsDefault)o!=e.itemsDefault[n].id&&e.itemsDefault[n].base_id!=o&&e.itemsTemp.push(e.itemsDefault[n]);else for(var n in e.itemsDefault)i.id!=e.itemsDefault[n].id&&e.itemsTemp.push(e.itemsDefault[n]);else if(null==i.base_id)for(var n in e.itemsDefault)o!=e.itemsDefault[n].id&&e.itemsDefault[n].base_id!=o&&e.itemsTemp.push(e.itemsDefault[n]);else for(var n in e.itemsDefault)i.id!=e.itemsDefault[n].id&&e.itemsTemp.push(e.itemsDefault[n]);e.itemsDefault=e.itemsTemp,e.parentAndChild=[],e.formatTicketToParentAndChild(e.itemsDefault),e.showChild?e.items=e.parentAndChild:e.items=e.filterTicketClosed(e.itemsDefault),e.tableParams.reload()}else e.errorDeleted=!0})},e.shouldShowChild=function(){e.showChild=!e.showChild,e.showChild?e.items=e.parentAndChild:"deployed"==e.currentState?e.items=e.itemsDefault:e.items=e.filterTicketClosed(e.itemsDefault),$("#checkbox").attr("checked",!1),e.tableParams.reload()},e.selectTicket=function(t,n){if(angular.element("#select-menu-modal-assign-list").removeClass("active-navigation-container"),"undefined"==typeof e.ticketSelected&&(e.ticketSelected=[],e.listTicket=[]),1==t.target.checked)-1==e.ticketSelected.indexOf(n.id)&&(n.checked=!0,e.ticketSelected.push(n.id),e.listTicket.push(n));else{var i=e.ticketSelected.indexOf(n.id);i>-1&&(n.checked=!1,e.ticketSelected.splice(i,1),e.listTicket.splice(i,1))}},e.deleteListTickets=function(n){if(angular.isUndefined(n)||n.length<=0)return void alert("Please select one or more tickets to perform this action.");var i=confirm("Are you sure you want to delete tickets?");i&&t.deleteListTickets(n).then(function(t){1==t.status?(angular.forEach(n,function(t,n){e.deleteParentAndChilds(t)}),e.parentAndChild=[],e.formatTicketToParentAndChild(e.itemsDefault),e.showChild?e.items=e.parentAndChild:e.items=e.filterTicketClosed(e.itemsDefault),e.tableParams.reload(),e.ticketSelected=[],e.listTicket=[],e.errorDeleted=!1):e.errorDeleted=!0})},e.deleteParentAndChilds=function(t){var n=_.find(e.itemsDefault,function(e){return e.id==t?e:void 0});if(!angular.isUndefined(n)){var i=[];_.find(e.itemsDefault,function(e){e.base_id==n.id&&i.push(e)}),i.length>0&&angular.forEach(i,function(t,n){var i=[];_.find(e.itemsDefault,function(e){e.base_id==t.id&&i.push(e)}),i.length>0&&e.deleteParentAndChilds(t.id),angular.forEach(e.itemsDefault,function(n,i){t.id==n.id&&e.itemsDefault.splice(i,1)})}),angular.forEach(e.itemsDefault,function(t,i){t.id==n.id&&e.itemsDefault.splice(i,1)})}},e.updateDueDateListTicket=function(t){"undefined"==typeof t||t.length<=0?alert("Please select one or more tickets to perform this action."):e.getModalRequestExtentionListTicket(t)},e.getModalRequestExtentionListTicket=function(t){var n="/support/update-request-extention/",r=a.open({animation:!0,templateUrl:window.baseUrl+n,controller:"ModalUpdateDueDateListTicket",size:null,resolve:{ticketSelected:function(){return t}}});r.result.then(function(t){for(i in e.itemsDefault)t.tickets.indexOf(e.itemsDefault[i].id)>-1&&(e.itemsDefault[i].dueDate=t.due_date,e.itemsDefault[i].due_date=t.due_date);e.parentAndChild=[],e.formatTicketToParentAndChild(e.itemsDefault),e.showChild?e.items=e.parentAndChild:e.items=e.filterTicketClosed(e.itemsDefault),angular.forEach(e.ticketSelected,function(e,t){$("#checkbox-"+e).attr("checked",!1)}),e.ticketSelected=[],e.listTicket=[],e.tableParams.reload()})},e.assignPeopleList=function(n){$("#re-assign").attr("disabled","disabled"),t.assignListTicket(e.ticketSelected,n).then(function(t){angular.forEach(e.itemsDefault,function(t,i){e.ticketSelected.indexOf(t.id)>-1&&(t.status="assigned",t.assign_id=n)}),e.parentAndChild=[],e.formatTicketToParentAndChild(e.itemsDefault),e.showChild?e.items=e.parentAndChild:e.items=e.filterTicketClosed(e.itemsDefault),angular.forEach(e.ticketSelected,function(e,t){$("#checkbox-"+e).attr("checked",!1)}),e.ticketSelected=[],e.listTicket=[],e.tableParams.reload(),$(".mini-show").removeClass("div-mini-show"),$("#re-assign").removeAttr("disabled")})},e.initSelect2=function(e){$("#"+e).select2({tag:!0})},e.returnPreviousSearch=function(t){e.showChild=t.showAllOrShowNested,e.filterWithData(t.filterData)},e.filterWithData=function(t){var n=["assign_id","type_id","status","priority"],i=[];angular.forEach(t,function(e,t){"object"!=typeof e&&"array"!=typeof e||i.push(t)}),minus=_.difference(n,i),e.resetFilter(minus),angular.forEach(t,function(t,n){"object"==typeof t&&s(function(){$("#filter-"+n).select2({tag:!0,value:t})}),e.tableParams.filter()[n]=t})},e.resetFilter=function(t){angular.forEach(t,function(t,n){s(function(){$("#filter-"+t).select2("val","")}),e.tableParams.filter()[t]=[""]}),e.tableParams.filter().percentSearch=100,e.tableParams.filter().title="",e.tableParams.filter().id="",e.tableParams.filter().create="",e.tableParams.filter().dueDate=""},e.filtering=function(){},e.setSessionToFilter=function(e){t.setSessionToFilter(e).then(function(){})}}]),ticketModule.controller("ModalUpdateDueDateListTicket",["$scope","$modalInstance","$filter","ticketSelected","TicketService",function(e,t,n,i,r){e.minDate=e.myDate=n("date")(new Date,"MM-dd-yyyy"),e.myTime=new Date(e.myDate).setHours(17),e.myTime=new Date(e.myTime).setMinutes(0),e.myTime=new Date(e.myTime).setSeconds(0),e.myTime=new Date(e.myTime).setMilliseconds(0),e.ticketSelected=i,e.open=function(t){e.opened=!0},e.changeDateTime=function(){e.errorDateTime=!1},e.updateDueDate=function(i){if($("#btnRequestExtension").attr("disabled","disabled"),"undefined"==typeof e.myDate||"undefined"==typeof e.myTime||null==e.myTime||null==e.myDate)return e.errorDateTime=!0,void $("#btnRequestExtension").removeAttr("disabled");e.dueDate=new Date(e.myDate);var o=n("date")(e.myTime,"HH:mm:ss"),a=o.split(":");e.dueDate.setHours(a[0]),e.dueDate.setMinutes(a[1]),e.dueDate.setSeconds(a[2]),r.updateDueDateListTicket(e.ticketSelected,e.dueDate).then(function(e){e.status&&t.close(e),$("#btnRequestExtension").removeAttr("disabled")})},e.cancel=function(){t.dismiss("cancel")}}]);var userModule=angular.module("ticket",["ngSanitize"]);userModule.controller("TicketController",["$scope","TicketService","$modal","UserService","$timeout","FileService","$controller","Upload","$compile","$q",function(e,t,n,r,o,a,s,l,d,u){function c(){$("#content").redactor({imageUpload:window.baseUrl+"/file-redactor/upload-file-redactor",plugins:["table",1==window.isAdvancedEditingFeatures?"source":""],linebreaks:["<br>"],callbacks:{modalOpened:function(e,t){if("link"!=e||this.observe.isCurrent("a")){if("link"==e){var n=this.link.$node.attr("rel");"undefined"==typeof n?$('<label><input type="checkbox" id="redactor-link-no-follow"> No Follow</label>').insertAfter($("#redactor-link-blank").parent()):$('<label><input type="checkbox" checked id="redactor-link-no-follow"> No Follow</label>').insertAfter($("#redactor-link-blank").parent())}}else $("#redactor-link-blank").attr("checked","true"),$('<label><input type="checkbox" checked id="redactor-link-no-follow"> No Follow</label>').insertAfter($("#redactor-link-blank").parent())},insertedLink:function(e){var t=$(e).attr("href");"http"!=t.substring(0,4)&&"https"!=t.substring(0,5)&&"ftp"!=t.substring(0,3)&&$(e).attr("href","http://"+t),$("#redactor-link-no-follow").prop("checked")?e.attr("rel","nofollow"):e.removeAttr("rel")},linkify:function(e){e.attr("target","_blank")},change:function(){$content=$("#content").redactor("code.get"),e.$apply(function(){"<div></div>"==$content||""==$content||"<br>"==$content||"<div><strong></strong></div>"==$content||"<div><em></em><strong></strong></div>"==$content||"<div><em><del></del></em></div>"==$content?e.validate=!1:e.validate=!0})}},linkSize:1e3})}function f(){var e=$(window).height(),t=$(".your-ticket"),n=$(".your-ticket").offset(),i=n.top,r=e-i;t.attr("style","height: "+r+"px!important");var o=$(".your-ticket .content-your-ticket"),a=$(".sidebar-block input").outerHeight(),s=$(".sidebar-block .head-your-ticket").outerHeight(),l=t.outerHeight(),d=l-a-s-29;o.attr("style","height: "+d+"px!important")}function p(){$("#content-child").redactor({imageUpload:window.baseUrl+"/file-redactor/upload-file-redactor",plugins:["table",1==window.isAdvancedEditingFeatures?"source":""],linebreaks:["<br>"],callbacks:{modalOpened:function(e,t){if("link"!=e||this.observe.isCurrent("a")){if("link"==e){var n=this.link.$node.attr("rel");"undefined"==typeof n?$('<label><input type="checkbox" id="redactor-link-no-follow"> No Follow</label>').insertAfter($("#redactor-link-blank").parent()):$('<label><input type="checkbox" checked id="redactor-link-no-follow"> No Follow</label>').insertAfter($("#redactor-link-blank").parent())}}else $("#redactor-link-blank").attr("checked","true"),$('<label><input type="checkbox" checked id="redactor-link-no-follow"> No Follow</label>').insertAfter($("#redactor-link-blank").parent())},insertedLink:function(e){var t=$(e).attr("href");"http"!=t.substring(0,4)&&"https"!=t.substring(0,5)&&"ftp"!=t.substring(0,3)&&$(e).attr("href","http://"+t),$("#redactor-link-no-follow").prop("checked")?e.attr("rel","nofollow"):e.removeAttr("rel")},linkify:function(e){e.attr("target","_blank")},change:function(){$content=$("#content-child").redactor("code.get"),e.$apply(function(){"<div></div>"==$content||""==$content||"<br>"==$content||"<div><strong></strong></div>"==$content||"<div><em></em><strong></strong></div>"==$content||"<div><em><del></del></em></div>"==$content?e.validateChild=!1:e.validateChild=!0})}},linkSize:1e3})}s("BaseController",{$scope:e}),angular.element(".wrapper").removeClass("hidden"),e.baseUrl=baseUrl,e.focusinControl={},e.childTickets=angular.copy(window.childTickets),e.ticketChild=[],e.arrNull=[],angular.equals(e.childTickets,e.arrNull)||angular.element(".wrap-children-ticket").removeClass("hidden"),e.showSubSelect=function(e){e.preventDefault(),$(e.currentTarget).addClass("fa-plus"),$(e.currentTarget).toggleClass("fa-minus")},$(document).ready(f),$(window).resize(f),e.getChildRedactor=function(){p(),o(function(){$("#content-child").redactor("code.set",""),$(".redactor-box .redactor-editor").addClass("redactor-placeholder")}),e.filesUploadChild.finished=!0,e.submitted=!1,e.isShowAction=!1},dataInternalOld=[],e.userId=window.userId,e.limitStep=2,e.numberLimit=e.limitStep,e.hideLoadMore=!0,e.hideReOpenBtn=!0,e.totalComments=0,e.isSubmit=!1,e.ticketAdmin=window.isAdmin,e.isSysAdmin=window.isSysAdmin,e.ticket=window.ticket,e.ticketChild.title=e.ticket.title,e.lastUpdated=e.ticket.lastUpdated,e.types=window.types,e.listPriorities=window.listPriorities,e.isShowAction=!0,e.checkAssign=!0,e.displaySelect=!1,e.hideDueDate=window.hideDueDate,e.filterDataParam=angular.copy(window.filterDataParam),e.minDate=e.minDate?null:new Date,e.datePicker={opened:!1},e.open=function(t){t.preventDefault(),t.stopPropagation(),e.datePicker.opened=!0},e.updateTitleChild=function(){!angular.isUndefined(e.ticketChild.title)&&e.ticketChild.title.length||(e.ticketChild.title=e.ticket.title)},e.overdue=!1,e.isTime=window.isTime,e.finishCountDown=function(){o(function(){e.$apply(function(){e.overdue=!0})})},e.$watch(function(){return window.innerWidth},function(n){n>1200&&t.query().then(function(t){e.tickets=t})});var m=RowboatPusher.subscribe("notification_ticket");m.bind("Rowboat\\Notification\\Events\\Notifications\\Broadcast\\NotificationTicket",function(t){angular.isDefined(t)&&t.sender_id!=window.userId&&e.$apply(function(){k()})});var m=RowboatPusher.subscribe("ticket");m.bind("Rowboat\\Ticket\\Events\\Ticket\\Broadcast\\TicketFolowing",function(t){angular.isDefined(t)&&t.userId!=window.userId&&e.$apply(function(){k(),D().then(function(){$checkInInvite=e.invites.indexOf(window.userId),!($checkInInvite<0)||e.ticketAdmin||e.isSysAdmin&&"approved"==e.ticket.status||window.userId==e.ticket.user_id||window.userId==e.ticket.assign_id||(window.location.href=window.baseUrl+"/support")}),b(),T()})}),m.bind("Rowboat\\Ticket\\Events\\Ticket\\Broadcast\\TicketAssigned",function(t){angular.isDefined(t)&&t.sender.id!=window.userId&&e.$apply(function(){e.checkAssign=!0,k(),D(),b(),T()})}),m.bind("Rowboat\\Ticket\\Events\\Ticket\\Broadcast\\TicketInvite",function(t){angular.isDefined(t)&&t.sender.id!=window.userId&&e.$apply(function(){k(),D(),b(),T()})}),m.bind("Rowboat\\Ticket\\Events\\Ticket\\Broadcast\\BroadCastUpdateNameTicket",function(t){angular.isDefined(t)&&e.$apply(function(){k()})});var h=RowboatPusher.subscribe("ticket_"+e.ticket.id);h.bind("Rowboat\\Ticket\\Events\\Ticket\\Broadcast\\TicketResponse",function(t){t.sender.id!=window.userId&&angular.isDefined(t.comment)&&e.$apply(function(){y(t.comment)})}),h.bind("Rowboat\\Ticket\\Events\\Ticket\\Broadcast\\TicketPrivate",function(t){t.sender.id!=window.userId&&angular.isDefined(t.comment)&&e.$apply(function(){y(t.comment)})}),h.bind("Rowboat\\Ticket\\Events\\Ticket\\Broadcast\\TicketReadyForReviewed",function(t){angular.isDefined(t)&&(e.ticket.status="reviewed",e.showBoxComment=!0,e.hideReOpenBtn=!0,e.hideCloseBtn=!0,k())}),h.bind("Rowboat\\Ticket\\Events\\Ticket\\Broadcast\\TicketApproved",function(t){angular.isDefined(t)&&(e.ticket.status="approved",e.showBoxComment=!0,e.hideReOpenBtn=!0,e.hideCloseBtn=!0,k())}),h.bind("Rowboat\\Ticket\\Events\\Ticket\\Broadcast\\TicketDeny",function(t){t.sender.id!=window.userId&&angular.isDefined(t)&&(e.ticket.status="assigned",e.showBoxComment=!0,e.hideReOpenBtn=!0,e.hideCloseBtn=!0,k())}),h.bind("Rowboat\\Ticket\\Events\\Ticket\\Broadcast\\TicketClosed",function(t){t.sender.id!=window.userId&&angular.isDefined(t.comment)&&(y(t.comment),e.ticket.status="closed",e.showBoxComment=!0,e.hideReOpenBtn=!1,e.hideCloseBtn=!0,e.$broadcast("timer-stop"),k())}),h.bind("Rowboat\\Ticket\\Events\\Ticket\\Broadcast\\BroadcastUnAssign",function(t){angular.isDefined(t)&&t.sender.id!=window.userId&&(e.ticket.status="new",angular.isDefined(t.comment)&&e.$apply(function(){y(t.comment)}),k())}),e.callbackLoadUserFinish=function(){};var g=RowboatPusher.subscribe("create_child_ticket_"+e.ticket.id);if(g.bind("Rowboat\\Ticket\\Events\\Ticket\\Broadcast\\BroadCastCreateChildTicket",function(t){angular.isDefined(t)&&t.sender.id!=window.userId&&e.$apply(function(){k()})}),angular.isDefined(e.ticket.base_id)){var v=RowboatPusher.subscribe("parent_ticket_detail"+e.ticket.base_id);v.bind("Rowboat\\Ticket\\Events\\Ticket\\Broadcast\\BroadCastCreateChildTicket",function(t){angular.isDefined(t)&&t.sender.id!=window.userId&&e.$apply(function(){k()})})}e.viewModel=function(e){var t=n.open({templateUrl:baseUrl+"/app/components/ticket/views/modal/viewPicture.html",controller:"ModalViewPictureCtrl",size:void 0,windowClass:"show-img",resolve:{fileId:function(){return e}}});t.result.then(function(e){},function(){})},e.checkFile=function(e){return a.checkFile(e)};var w=function(){t.getNumberOfTickets().then(function(t){e.numberOfTickets=t})},k=function(){w(),e.ticket.id&&t.get(e.ticket.id).then(function(t){e.ticket=t,e.lastUpdated=e.ticket.lastUpdated}).then(function(){e.groupName=t.getGroupBaseOnCurrentItem(e.ticketAdmin,e.ticket),e.linkGroupName=angular.lowercase(e.groupName),"responded"==e.linkGroupName&&(e.linkGroupName="updated"),"ready for review"==e.linkGroupName&&(e.linkGroupName="reviewed")})};t.getConfig().then(function(t){e.states=t.states,e.prioritys=t.prioritys});var y=function(n){if(e.items_s=t.pushCommentReadTime(n,e.ticketAdmin,e.isSysAdmin),"undefined"!=typeof e.filesUpload){for(var i in e.filesUpload.files)e.fileAll[e.filesUpload.files[i].id]=e.filesUpload.files[i];e.$broadcast("emptyFiles"),e.filesUpload.ids=[]}"undefined"!=typeof n.files_id&&n.files_id.length>0&&t.getAllOfUser(e.ticket.created_at).then(function(n){e.fileAll=t.getFilesOfUser()}),k(),e.numberLimit+=e.totalComments,angular.element("#page-loading").css("display","none"),angular.element("#respond").removeAttr("disabled"),angular.element("#internal").removeAttr("disabled")};e.getTicket=function(n){t.getAllOfUser(e.ticket.created_at).then(function(n){e.fileAll=t.getFilesOfUser()}),e.currentState=e.ticket.status,e.items_s=t.setComments(angular.copy(ticket),e.ticketAdmin,e.isSysAdmin),"undefined"!=typeof e.items_s.comments&&(e.totalComments=e.items_s.comments.length,e.numberLimit<e.totalComments&&(e.hideLoadMore=!1)),"closed"==e.currentState&&(e.showBoxComment=!0,o(function(){e.$broadcast("timer-stop")},1)),D(),T(),t.getUsersOfTicket(e.ticket.id).then(function(t){e.usersOfTicket=t}),e.TicketType=t.setType(),e.groupName=t.getGroupBaseOnCurrentItem(e.ticketAdmin,e.ticket),e.linkGroupName=angular.lowercase(e.groupName),"responded"==e.linkGroupName&&(e.linkGroupName="updated"),"ready for review"==e.linkGroupName&&(e.linkGroupName="reviewed"),t.query().then(function(t){e.items=t}),"undefined"!=typeof e.ticket.internal&&(dataInternalOld=angular.copy(e.ticket.internal)),w(),b();var i=RowboatPusher.subscribe("ticket_"+n);i.bind("Rowboat\\Ticket\\Events\\Ticket\\Broadcast\\TicketReOpen",function(t){angular.isDefined(t)&&(e.ticket.status="open",e.$broadcast("timer-resume"),e.showBoxComment=!1,e.hideReOpenBtn=!0,e.hideCloseBtn=!1,k())}),e.ticket.assign_id&&(e.checkAssign=!0),"page"==e.ticket.type&&(e.isCms=!0)};var b=function(){t.countFollowing(e.ticket.id).then(function(e){F()}).then(function(){angular.element(".show-follow").removeClass("hidden")})},D=function(){var n=u.defer();return t.getUserInviteOfTicket(e.ticket.id).then(function(e){}).then(function(){n.resolve(C())}),n.promise},C=function(){var n=u.defer();e.invites=t.setUserInvite(),n.resolve(e.invites),e.following=!1,e.userDisplayFollowing=!1,e.userInternal=!1,e.invites[0]&&(e.diplayListUserInvite=!0);for(var i=0;i<e.invites.length;i++)e.invites[i]==userId&&(e.userDisplayFollowing=!0,e.userInternal=!0,e.following=!0);return n.promise},T=function(){t.getUsersOfTicketInvite(e.ticket.id).then(function(t){e.usersOfTicketInvite=t})};e.addInviteUsers=function(n){$("#re-invite").attr("disabled","disabled"),t.addInvite({id:e.ticket.id,user_id:n}).then(function(t){1==t.status&&(C(),k(),F(),y(t.comment),T(e.ticket.id),e.displaySelect=!1),$("#re-invite").removeAttr("disabled")})},e.checkUserAssign=function(t){t&&o(function(){angular.element("#triggerSelect").trigger("click")}),e.displaySelect=!1,e.checkAssign=!t},e.addFollowing=function(n){e.followMe=!0,t.addFollowing(n).then(function(t){1==t.status&&(y(t.comment),F(),C(),k(),T()),e.followMe=!1})},e.removeInvite=function(t,n,i){e.unFollowing(t,n,i)},e.unFollowing=function(n,i,r){e.unFollowMe=!0,t.unFollowing(n,i).then(function(t){1==t.status&&(F(),C().then(function(){$checkInInvite=e.invites.indexOf(window.userId),!($checkInInvite<0)||e.ticketAdmin||e.isSysAdmin&&"approved"==e.ticket.status||window.userId==e.ticket.user_id||window.userId==n||(window.location.href=window.baseUrl+"/support")}),y(t.comment),T(),k()),e.unFollowMe=!1})};var F=function(){e.countFollowing=t.setCountFollowing()};e.userBranchId=function(t){e.nameUserbranchManager="",t&&r.userBranchManager(t).then(function(t){t[0]&&(e.nameUserbranchManager=t[0].first_name+t[0].last_name)})},e.checkDisplayInvite=function(t){t||o(function(){angular.element("#triggerSelect").trigger("click")}),e.checkAssign=!0,e.displaySelect=!t},e.hideSelectInvite=function(){e.hideSelect=!1},e.convetUnixTime=function(e){var t=new Date(e);return t},e.clickable=function(e){window.location=baseUrl+"/support/show/"+e},e["delete"]=function(e,t){e.stopPropagation()},e.assignPeople=function(n,r,o){if("undefined"!=typeof n&&n!=r){$("#re-assign").attr("disabled","disabled");var a={id:e.ticket.id,user_id:n};t.addAssign(a,r,o).then(function(t){if(0==t.status){e.error="";for(var r in t.error)e.error=t.error[r]+"<br/>";e.checkAssign=!0,k()}else{e.ticket.status="assigned",C().then(function(t){$checkInInvite=e.invites.indexOf(window.userId),!($checkInInvite<0)||e.ticketAdmin||e.isSysAdmin&&"approved"==e.ticket.status||window.userId==e.ticket.user_id||window.userId==n||(window.location.href=window.baseUrl+"/support")}),F();for(i in t.comment)y(t.comment[i]);k(),e.ticket.assign_id=n,e.checkAssign=!0,T()}$(".mini-show").removeClass("div-mini-show"),$("#re-assign").removeAttr("disabled")})}},e.assignPeopleChild=function(t,n,i){"undefined"!=typeof t&&t!=n&&(angular.isUndefined(e.ticketChild)&&(e.ticketChild=[]),e.ticketChild.assign_id=t,e.checkAssignChild=!0,$(".mini-show").removeClass("div-mini-show"),$("#re-assign").removeAttr("disabled"))},e.updateShowDueDateUser=function(t){var n={userId:e.userId,type:t};r.updateShowDueDateUser(n).then(function(t){t.status&&("time"==t.type?e.isTime=!0:e.isTime=!1)})};var A=!1;e.addComment=function(t,n){e.response(t,1)},e.hiddentAction=function(t){c(),e.submitted=!1,e.isShowAction=!1,e.typeShow=t},e.showAction=function(){$("#content").val(""),$("#content").redactor("code.set",""),$(".redactor-box .redactor-editor").addClass("redactor-placeholder"),$("#content").redactor("core.destroy"),e.isShowAction=!0},e.showAction1=function(){$("#content-child").redactor("core.destroy"),e.isShowAction=!0,e.filesUploadChild=[],e.submittedChild=!1,e.ticketChild=[],e.ticketChild.title=e.ticket.title},e.getModalUpdatePercent=function(t,i){var r="/support/update-percent-complete/"+t+"?"+(new Date).getTime(),o=n.open({animation:!0,templateUrl:window.baseUrl+r,controller:"ModalUpdatePercentController",size:null,resolve:{ticketId:function(){return t},percent:function(){return e.ticket.percent_complete}}});o.result.then(function(t){e.ticket.percent_complete=t.percent,y(t.comment)})},e.getModalRequestExtention=function(t,i,r){var o="/support/update-request-extention",a=n.open({animation:!0,templateUrl:window.baseUrl+o,controller:"ModalUpdateDueData",size:null,resolve:{ticketId:function(){return t},due_date:function(){return i},checkDueDate:function(){return r}}});a.result.then(function(t){t.check_due_date?(e.ticket.due_date=t.due_date,y(t.comment)):(e.ticket.request_extension=new Date(t.due_date),y(t.comment))})},e.changeDateTimeChildTicket=function(){e.errorDateTime=!1},e.response=function(n,i){if(e.submitted=!0,angular.element("#internal").attr("disabled","true"),angular.element("#respond").attr("disabled","true"),angular.element("#page-loading").css("display","block"),!A&&"undefined"!=e.comment){A=!0,e.numberLimit+=e.limitStep;var r=[];"undefined"!=typeof e.filesUpload&&(r=e.filesUpload.ids),e.isSubmit=!0,$content=$("#content").redactor("code.get");var o={id:n,content:$content,files_id:r};if(e.validate=!0,"<div></div>"==o.content||""==o.content||"<br>"==o.content||"<div><strong></strong></div>"==$content||"<div><em></em><strong></strong></div>"==$content||"<div><em><del></del></em></div>"==$content)return e.validate=!1,A=!1,angular.element("#page-loading").css("display","none"),angular.element("#respond").removeAttr("disabled"),void angular.element("#internal").removeAttr("disabled");i?t.addComment(o).then(function(t){t.status&&y(t.item),A=!1,e.submitted=!1}):t.response(o).then(function(t){y(t),A=!1,e.submitted=!1,e.lastUpdated=t.lastUpdated,$("html, body").animate({scrollTop:$("#endOfPage").offset().top},1e3)}),e.showAction(),angular.element("#collapseExample.ui-create").removeClass("in")}},e.close=function(n){e.numberLimit+=e.limitStep,e.hideLoadMore=!0;var i=!1;if(0==i){"undefined"==typeof e.comment?content="":content=$("#content").redactor("code.get");var r={id:n,content:content};t.close(r).then(function(e){k(),window.location.href=window.baseUrl+"/support"})}},e.reopen=function(e){var n=!1;if(0==n){var i={id:e};t.reopen(i).then(function(e){k()})}},e.newChildTicket=function(n){e.submittedChild=!0;var i=[];"undefined"!=typeof e.filesUploadChild&&(i=e.filesUploadChild.ids),$content=$("#content-child").redactor("code.get"),$content.validate=!0,"<div></div>"!=$content&&""!=$content&&"<br>"!=$content&&"<div><strong></strong></div>"!=$content&&"<div><em></em><strong></strong></div>"!=$content&&"<div><em><del></del></em></div>"!=$content||(e.validateChild=!1),e.ticketChild.description=$content,e.ticketChild.files_id=i,e.ticketChild.base_id=e.ticket.id,e.ticketChild.type=e.ticket.type_id,e.ticketChild.priority=e.ticket.priority,e.ticketChild.url=e.ticket.url,e.ticketChild.ticketType=e.ticket.type,e.errorDateTime=!1,e.hideDueDate||"undefined"!=typeof e.ticketChild.due_date&&"undefined"!=typeof e.ticketChild.due_date&&null!=e.ticketChild.due_date||(e.errorDateTime=!0),!e.validateChild||e.errorDateTime||angular.isUndefined(n.assign_id)||null==n.assign_id||(angular.element("#page-loading").css("display","block"),"undefined"!=typeof e.ticketChild.ticketType&&"page"==e.ticketChild.ticketType&&(delete e.ticketChild.ticketType,delete e.ticketChild.url,delete e.ticketChild.content_id),t.create(e.ticketChild).then(function(t){e.ticket.childTickets.push(t.item),y(t.commentCreate),y(t.commentAssign),angular.element("#page-loading").css("display","none"),$("#collapseExample-child-ticket").removeClass("in"),$("#content-child").redactor("core.destroy"),e.isShowAction=!0,e.filesUploadChild=[],e.filesUpload=[],e.submittedChild=!1,e.ticketChild=[],e.ticketChild.title=e.ticket.title}))},e.close=function(n){e.numberLimit+=e.limitStep,e.hideLoadMore=!0;var i=!1;if(0==i){"undefined"==typeof e.comment?content="":content=$("#content").redactor("code.get");var r={id:n,content:content};t.close(r).then(function(e){k(),window.location.href=window.baseUrl+"/support"})}},e.reopen=function(e){var n=!1;if(0==n){var i={id:e};t.reopen(i).then(function(e){k()})}},e.editDraft=function(e){window.location=window.baseUrl+"/cms/pages/edit-draft/"+window.ticket_content_map[e]._id+"?checkPage=1"},e.viewDraft=function(e){t.getLinkViewDraft(e).then(function(e){e.status&&window.open(window.linkViewDraft+e.url,"_blank")})},e.readyForReviewed=function(n){var i=!1;if(0==i){angular.element("#page-loading").css("display","block"),angular.element("#reviewed").attr("disabled","true");var r={id:n};t.readyForReviewed(r).then(function(t){t.status&&(e.ticket.status="reviewed",e.showBoxComment=!0,e.hideReOpenBtn=!0,e.hideCloseBtn=!0,y(t.comment),k()),angular.element("#reviewed").removeAttr("disabled"),angular.element("#page-loading").css("display","none"),i=!0})}e.submitted=!1},e.approved=function(n){var i=!1;if(0==i){angular.element("#page-loading").css("display","block"),angular.element("#approved").attr("disabled","true");var r={id:n};t.approved(r).then(function(t){t.status&&(e.ticket.status=t.ticketStatus,e.showBoxComment=!0,e.hideReOpenBtn=!0,e.hideCloseBtn=!0,y(t.comment),k()),angular.element("#approved").removeAttr("disabled"),angular.element("#page-loading").css("display","none"),i=!0})}e.submitted=!1},e.deploy=function(n){var i=!1;if(0==i){angular.element("#page-loading").css("display","block"),angular.element("#deploy").attr("disabled","true");var r={id:n};t.deploy(r).then(function(t){t.status&&(y(t.comment),e.ticket.status=t.ticketStatus,e.showBoxComment=!0,e.hideReOpenBtn=!1,e.hideCloseBtn=!0,k(),angular.element("#deploy").removeAttr("disabled"),angular.element("#page-loading").css("display","none"),i=!0)})}e.submitted=!1},e.deny=function(n){var i=!1;if(0==i){angular.element("#page-loading").css("display","block"),angular.element("#deny").attr("disabled","true");var r={id:n};t.deny(r).then(function(t){t.status&&(e.ticket.status="assigned",e.showBoxComment=!0,e.hideReOpenBtn=!0,e.hideCloseBtn=!0,y(t.comment),k()),angular.element("#deny").removeAttr("disabled"),angular.element("#page-loading").css("display","none"),i=!0})}e.submitted=!1},e.getModalAdd=function(t,i){var r="support/add-invite";"assign"==t&&(r="support/add-assign");var o=n.open({templateUrl:r,controller:"ModalCreateAdd",size:void 0,resolve:{ticketId:function(){return i},userSelect:function(){return e.usersOfTicket}}});o.result.then(function(e){k()},function(){})},e.getModalUpdateType=function(i){var r=n.open({templateUrl:"support/update-type/"+i,controller:"ModalUpdateType",size:void 0,resolve:{}});r.result.then(function(n){e.TicketType=t.setType()},function(){})},e.isImage=function(e){return"undefined"!=typeof e?0==e.indexOf("image"):void 0},e.checkImage=function(e){return"undefined"!=typeof e?"jpg"==angular.lowercase(e)||"png"==angular.lowercase(e):void 0},e.approveExtension=function(n){$("#btnApproveExtension").attr("disabled","disabled");var i={id:n};t.approveExtension(i).then(function(t){t.status&&(y(t.comment),e.ticket.request_extension=null,e.overdue=!1,e.ticket.due_date=new Date(t.due_date),o(function(){e.$apply(function(){e.$broadcast("timer-start")})},100)),$("#btnApproveExtension").removeAttr("disabled")})},e.unAssign=function(n){$("#page-loading").css("display","block"),t.unAssign(n).then(function(t){t.status&&(e.ticket.status="new",y(t.comment),k()),$("#page-loading").css("display","none")})},e.selectChild=function(t,n){if("undefined"==typeof e.ticket.childSelected&&(e.ticket.childSelected=[]),1==t.target.checked)-1==e.ticket.childSelected.indexOf(n)&&e.ticket.childSelected.push(n);else{var i=e.ticket.childSelected.indexOf(n);i>-1&&e.ticket.childSelected.splice(i,1)}},e.returnSearchResult=function(){t.returnSearchResult(e.filterDataParam).then(function(e){e.status&&(window.location=window.baseUrl+"/support/state/"+e.ticket_state)})}}]).controller("ModalUpdatePercentController",["$scope","$modalInstance","ticketId","percent","TicketService",function(e,t,n,i,r){e.ticket={},e.ticket.id=n,e.ticket.percent_complete=parseInt(i),e.updatePercentComplete=function(n){return $("#btnUpdatePercent").attr("disabled","disabled"),e.errorPercent=!1,"undefined"==typeof e.ticket.percent_complete||null==e.ticket.percent_complete?(e.errorPercent=!0,void $("#btnUpdatePercent").removeAttr("disabled")):void r.updatePercentComplete(n,e.ticket.percent_complete).then(function(e){
e.status&&t.close(e),$("#btnUpdatePercent").removeAttr("disabled")})},e.cancel=function(){t.dismiss("cancel")}}]).controller("ModalUpdateDueData",["$scope","$modalInstance","$filter","ticketId","due_date","checkDueDate","TicketService",function(e,t,n,i,r,o,a){r=n("date")(new Date(r.replace(/-/g,"/")),"MM/dd/yyyy HH:mm:ss"),e.checkDueDate=o,e.myDate=n("date")(new Date(r),"MM-dd-yyyy"),e.myTime=new Date(r),e.ticket={},e.ticket.id=i,e.open=function(t){e.opened=!0},e.changeDateTime=function(){e.errorDateTime=!1},e.updateDueDate=function(i){if($("#btnRequestExtension").attr("disabled","disabled"),"undefined"==typeof e.myDate||"undefined"==typeof e.myTime||null==e.myTime||null==e.myDate)return e.errorDateTime=!0,void $("#btnRequestExtension").removeAttr("disabled");e.dueDateUpdate=angular.copy(e.myDate),e.dueDate=new Date(e.myDate);var r=n("date")(e.myTime,"HH:mm:ss"),o=r.split(":");e.dueDate.setHours(o[0]),e.dueDate.setMinutes(o[1]),e.dueDate.setSeconds(o[2]),a.updateDueDate(i,e.dueDate,e.checkDueDate).then(function(e){e.status&&t.close(e),$("#btnRequestExtension").removeAttr("disabled")})},e.cancel=function(){t.dismiss("cancel")}}]).controller("ModalViewPictureCtrl",["$scope","$modalInstance","fileId",function(e,t,n){e.fileId=n,e.baseUrl=baseUrl,e.cancel=function(){t.dismiss("cancel")}}]).filter("bytes",function(){return function(e,t){if(isNaN(parseFloat(e))||!isFinite(e))return"-";"undefined"==typeof t&&(t=1);var n=["bytes","kB","MB","GB","TB","PB"],i=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,Math.floor(i))).toFixed(t)+" "+n[i]}}).filter("to_trusted",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]);var branchModule=angular.module("ticket");branchModule.factory("TicketResource",["$resource",function(e){return e("/api/support/:method/:id/:idExpenseReport/:status",{},{add:{method:"post"},save:{method:"post"},update:{method:"put"},get:{method:"get"},deleteTicket:{method:"delete-ticket"}})}]).service("TicketService",["$q","$filter","TicketResource",function(e,t,n){var i,r,o,a,s=[],l=[],d=[],u=[],c=this,f=[],p=[],m=[];this.create=function(t){if("undefined"!=typeof t.id)return c.update(t);var i=e.defer(),r=new n(t);return r.$save({},function(e){e.status&&e.item,i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.updatePercentComplete=function(t,i){var r=e.defer(),o=new n(i);return o.$save({method:"update-percent-complete",id:t,percent:i},function(e){r.resolve(e)},function(e){r.resolve(e.data)}),r.promise},this.updateDueDate=function(t,i,r){var o=e.defer(),a={due_date:i,check_due_date:r},s=new n(a);return s.$save({method:"update-due-date",id:t},function(e){o.resolve(e)},function(e){o.resolve(e.data)}),o.promise},this.addComment=function(t){var i=e.defer(),r=new n(t);return r.$save({id:t.id,method:"add-comment"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.setComments=function(e,t,n){if(window.userId!=e.user_id||t||n)return l=e;var i=[];for(var r in e.comments)"private"!=e.comments[r].ticket_state&&i.push(e.comments[r]);return e.comments=i,l=e},this.getComments=function(){return l},this.pushCommentReadTime=function(e,t,n){"undefined"==typeof l.comments&&(l.comments=[]);for(var i in l.comments)if("undefined"!=l.comments[i]._id){if(l.comments[i]._id==e._id)return l}else if(l.comments[i]._id==e._id)return l;if(window.userId!=l.user_id||t||n)return l.comments.push(e),l;if("private"!=e.ticket_state){for(var i in l.comments)"private"==l.comments[i].ticket_state&&l.comments.splice(i,1);l.comments.push(e)}return l},this.close=function(t){var i=e.defer(),r=new n(t);return r.$save({id:t.id,method:"close"},function(e){e&&(0!=l.length&&"undefined"!=typeof l.comments||(l.comments=[]),l.comments.push(e)),i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.response=function(t){var i=e.defer(),r=new n(t);return r.$save({id:t.id,method:"response"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.reopen=function(t){var i=e.defer(),r=new n(t);return r.$save({id:t.id,method:"reopen"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.readyForReviewed=function(t){var i=e.defer(),r=new n(t);return r.$save({id:t.id,method:"readyforreviewed"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.approved=function(t){var i=e.defer(),r=new n(t);return r.$save({id:t.id,method:"approved"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.deploy=function(t){var i=e.defer(),r=new n(t);return r.$save({id:t.id,method:"close"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.deny=function(t){var i=e.defer(),r=new n(t);return r.$save({id:t.id,method:"deny"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.getFiles=function(t){var i=e.defer();return n.get({id:t,method:"get-files"},function(e){i.resolve(e)}),i.promise},this.update=function(t){var i=e.defer(),o=new n(t);return o.$update({id:t.id},function(e){i.resolve(e),r=e.type},function(e){i.resolve(e.data)}),i.promise},this.get=function(t){var a=e.defer();return n.get({id:t},function(e){i=e,r=e.type,o=e.decision,a.resolve(e)}),a.promise},this.query=function(){var t=e.defer();return s.length>0&&t.resolve(s),s&&s.length?t.resolve(s):n.query().$promise.then(function(e){s=e,t.resolve(s)}),t.promise},this.setData=function(e){return s=e},this.getData=function(){return s},this.remove=function(t){var i=e.defer();return n["delete"]({id:t},function(e){if(e.status)for(var n in s)if(s[n].id==t){s.splice(n,1);break}i.resolve(e)}),i.promise},this.push=function(e){s.push(e)},this.getUserAssign=function(t,i){var r=e.defer();return n.query({id:t,method:"all-user-assign"},function(e){r.resolve(e)}),r.promise},this.getTypesOptions=function(){var e={};return angular.forEach(types,function(t,n){return e[n]=t}),e},this.getStatesOptions=function(){var e={};return angular.forEach(states,function(t,n){return e[n]=t}),e},this.getTicketsByState=function(e){return e?t("filter")(s,{status:e}):[]},this.addAssign=function(t,i,r){var o=e.defer(),s=t.user_id,l=new n(t);return l.$save({id:t.id,method:"add-assign"},function(e){if(e.status){var t=1;if(null!=i){for(var n=0;n<p.length;n++)p[n]==i&&(t=0),p[n]==s&&(p.splice(n,1),a--);1==t&&r!=i&&(p.push(i),a+=1)}}o.resolve(e)},function(e){o.resolve(e.data)}),o.promise},this.getCurrentItem=function(){return i},this.getlistUserInvitation=function(){return d},this.getlistUserAssign=function(e){return u},this.sendMail=function(t,i){var r=e.defer(),o=t.id,a=new n(t);return"createTicket"==i&&(o=t.item.id),a.$save({method:"send-mail",id:o,status:i},function(e){r.resolve(e)}),r.promise},this.getTicketGroup=function(t){var i=e.defer();return n.query({method:"get-group",status:t}).$promise.then(function(e){i.resolve(e)}),i.promise},this.getConfig=function(){var t=e.defer();return localStorage.removeItem("config"),f=localStorage.getItem("config"),f?(f=JSON.parse(f),t.resolve(f)):n.get({method:"get-config"},function(e){localStorage.setItem("config",JSON.stringify(e)),t.resolve(e)}),t.promise},this.getNumberOfTickets=function(){var t=e.defer();return n.query({method:"get-number-of-ticket"}).$promise.then(function(e){t.resolve(e)}),t.promise},this.getGroupBaseOnCurrentItem=function(e,t){var n=t;if("undefined"!=typeof n){if("closed"!=n.status&&n.invitations)for(var i in n.invitations)if(n.invitations[i].user_id==window.userId)return"Following";if("open"==n.status&&n.comments)for(var i in n.comments)if("response"==n.comments[i].ticket_state)return"Responded";return"undefined"==typeof e||e||"answered"!=n.status?"undefined"!=typeof e&&e&&"answered"==n.status?"Responded":"closed"==n.status?"Deployed":"assigned"==n.status?"Assigned":"reviewed"==n.status?"Ready For Review":"approved"==n.status?"Approved":"deploy"==n.status?"Closed":"New":"Updated"}},this.getGroupBaseOnState=function(e){switch(e){case"all_open":return"All Open";case"new":return"New";case"assigned":return"Assigned";case"updated":return"Updated";case"following":return"Following";case"deployed":return"Deployed";case"closed":return"Closed";case"reviewed":return"Ready For Review";case"approved":return"Approved";case"assigned-to-me":return"Assigned To Me";case"opened-by-me":return"Opened By Me"}},this.getUsersOfTicket=function(t){var i=e.defer();return n.query({id:t,method:"get-users-of-ticket"},function(e){i.resolve(e)}),i.promise},this.setType=function(){return r},this.updateDecision=function(t){var i=e.defer(),r=new n(t);return r.$update({id:t.id,method:"update-decision"},function(e){i.resolve(e),o=e.decision},function(e){i.resolve(e.data)}),i.promise},this.getListUserInvite=function(e){var t=[];for(var n in e)t.push(e[n].user_id);return t},this.addFollowing=function(t){var i=e.defer();return n.get({method:"add-following",id:t},function(e){p.push(window.userId),a+=1,i.resolve(e)}),i.promise},this.unFollowing=function(t,i){var r=e.defer();return n.get({method:"un-following",id:t,idExpenseReport:i},function(e){for(var t=0;t<p.length;t++)if(p[t]==i){p.splice(t,1);break}a-=1,r.resolve(e)}),r.promise},this.countFollowing=function(t){var i=e.defer();return n.get({method:"count-following",id:t},function(e){a=e.count,i.resolve(e)}),i.promise},this.getUsersOfTicketInvite=function(t){var i=e.defer();return n.query({id:t,method:"get-users-of-ticket-invite"},function(e){i.resolve(e)}),i.promise},this.getUserInviteOfTicket=function(t){var i=e.defer();return n.query({id:t,method:"get-users-invite-of-ticket"},function(e){p=e,i.resolve(e)}),i.promise},this.addInvite=function(t){var i=e.defer(),r=new n(t);return r.$save({id:t.id,method:"add-intive"},function(e){e.status&&e.userInvite&&(p.push(e.userInvite),a+=1),i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.setUserInvite=function(){return p},this.setCountFollowing=function(){return a},this.getAllOfUser=function(t){var i=e.defer();return n.query({created_at:t,method:"file-all"},function(e){for(var t in e)m[e[t].id]=e[t];i.resolve(e)}),i.promise},this.getFilesOfUser=function(){return m},this.approveExtension=function(t){var i=e.defer(),r=new n(t);return r.$save({id:t.id,method:"approve-extension"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.getLinkViewDraft=function(t){var i=e.defer(),r=new n(t);return r.$get({id:t,method:"get-link-view-draft"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.deleteTicket=function(t){var i=e.defer(),r=new n;return r.$get({id:t,method:"delete-ticket"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.deleteListTickets=function(t){var i=e.defer(),r=new n(t);return r.$save({method:"delete-list-tickets"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.unAssign=function(t){var i=e.defer(),r=new n;return r.$get({id:t,method:"un-assign"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.updateDueDateListTicket=function(t,i){var r=e.defer(),o={tickets:t,due_date:i},a=new n(o);return a.$save({method:"update-due-date-list-ticket"},function(e){r.resolve(e)},function(e){r.resolve(e.data)}),r.promise},this.assignListTicket=function(t,i){var r=e.defer(),o={tickets:t,assign_id:i},a=new n(o);return a.$save({method:"assign-list-ticket"},function(e){r.resolve(e)},function(e){r.resolve(e.data)}),r.promise},this.queryTicket=function(t){var i=e.defer(),r={group:t,query:[]},o=new n(r);return o.$save({method:"query-ticket"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.setSessionToFilter=function(t){var i=e.defer(),r=new n(t);return r.$save({method:"set-session-to-filter"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.returnSearchResult=function(t){var i=e.defer();data={filterDataParam:t};var r=new n(data);return r.$save({method:"return-search-result"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise}}]),angular.module("uls").directive("comments",["FileService",function(e){return{restrict:"E",scope:{usersMap:"=",files:"=",items:"=",totalComments:"=",numberLimit:"=",limitStep:"=",hideLoadMore:"=",openPicture:"&",ticket:"="},templateUrl:baseUrl+"/app/shared/comments/views/index.html?v=1"+(new Date).getTime(),link:function(t,n,i,r){void(t.templateComment=baseUrl+"/app/shared/comments/views/comment.html?v=1"+(new Date).getTime()),t.baseUrl=baseUrl,t.userId=window.userId,t.convetUnixTimeDescription=function(e){var t=new Date(e);return t},t.loadMoreComments=function(e){t.numberLimit+=t.totalComments,t.hideLoadMore=!0},t.convetUnixTime=function(e,t){var n="";n="undefined"!=typeof e?e:t;var i=new Date(1e3*n);return i},t.checkFile=function(t){return e.checkFile(t)}}}}]).filter("to_trusted",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]);var assign=angular.module("uls");assign.directive("choosePeople",["TicketService","$timeout",function(e,t){return{restrict:"EA",require:"?ngModel",scope:{checkAssign:"=",ticketId:"=",userSelect:"="},replace:!0,templateUrl:baseUrl+"/app/shared/assign/views/choose-people.html",link:function(e,t,n,i){var r,o=[];i&&(i.$render=function(){e.userId=i.$modelValue},e.users=e.userSelect,e.getUserId=function(e){r=e.target.value,i.$setViewValue(r)},e.togglepUserids=function(e){var t=o.indexOf(e);t>-1?o.splice(t,1):o.push(e),i.$setViewValue(o)})}}}]);var assign=angular.module("uls");assign.directive("invite",["TicketService","UserService",function(e,t){return{restrict:"EA",require:"?ngModel",scope:{item:"="},replace:!0,transclude:!0,templateUrl:baseUrl+"/app/shared/invite/views/invite.html",link:function(e,n,i,r){t.query().then(function(){e.users_map=t.getUsersMap()}),e.convetUnixTime=function(e,t){var n="";n="undefined"!=typeof e?e:t;var i=new Date(1e3*n);return i}}}}]);var fileModule=angular.module("file");fileModule.controller("FileController",["$scope","FileService","shareDataFactory","$modal","$timeout","$filter",function(e,t,n,i,r,o){e.currentFolderId=0,e.file_data={},e.breadcumb="Graphics",e.items=window.files,e.listNameUser=window.listNameUser,e.nameFolder=[],t.setFiles(angular.copy(e.items)),t.formatFilesWitFolderId(),angular.element(".document-page").removeClass("hidden"),e.$watch(function(){return window.files},function(t){if(angular.isDefined(window.foldersParent))for(var n=0;n<window.foldersParent.length;n++)e.nameFolder[window.foldersParent[n].id]=window.foldersParent[n],e.items.push(window.foldersParent[n])}),e.reload=function(){location.reload()},e.viewModel=function(e){var t=i.open({templateUrl:baseUrl+"/app/shared/file-manager/views/viewPicture.html",controller:"ModalViewPictureCtrl",size:void 0,windowClass:"show-img",resolve:{fileId:function(){return e}}});t.result.then(function(e){},function(){})},e.reloadTree=function(t){e.tree.reload(e.folders).done(t)},e.initTree=function(){var t=angular.element("#tree").fancytree({extensions:["glyph"],glyph:{map:{expanderClosed:"glyphicon glyphicon-plus-sign",expanderLazy:"glyphicon glyphicon-plus-sign",expanderOpen:"glyphicon glyphicon-minus-sign",folder:"glyphicon glyphicon-folder-close",folderOpen:"glyphicon glyphicon-folder-open",loading:"glyphicon glyphicon-refresh"}},autoScroll:!0,source:e.folders,activate:function(t,n){var i=n.node;e.changeBreadcrumb(i),i.setExpanded(!0),e.$$phase?(e.currentFolderId=i.key,e.getFilesByFolderId()):e.$apply(function(){e.currentFolderId=i.key,e.getFilesByFolderId()})},create:function(){"undefined"!=typeof callback&&callback()}});if(e.tree=t.fancytree("getTree"),angular.isDefined(window.folderRootId)){var n=e.tree.getNodeByKey(window.folderRootId.toString());angular.isDefined(n)&&n.setActive(!0)}},e.addFolder=function(t){var n=i.open({templateUrl:baseUrl+"/app/components/file/views/modal/addFolder.html",controller:"ModalAddFolder",size:void 0,resolve:{currentFolderId:function(){return e.currentFolderId},store:function(){return t}}});n.result.then(function(t){if(0==t.newFolder.parent_id){e.folders.push(t.newFolder),e.initTree();var n=e.tree.getNodeByKey(t.newFolder.key.toString());n.setActive(!0)}else{e.tree.getActiveNode().addChildren(t.newFolder);var n=e.tree.getNodeByKey(t.newFolder.key.toString());n.setActive(!0)}},function(){})},e.deleteFolder=function(n,r){e.positionDeleteFolder=r,"undefined"!=typeof n&&(e.currentFolderId=n);var o=i.open({templateUrl:baseUrl+"/app/components/file/views/modal/deleteFolder.html",controller:"ModalDeleteFolder",size:void 0,resolve:{currentFolderId:function(){return e.currentFolderId},name:function(){var t=e.tree.getNodeByKey(e.currentFolderId.toString());return t.title}}});o.result.then(function(n){var i=n.id;if("main"==e.positionDeleteFolder){angular.isDefined(i)||(i=e.currentFolderId);var r=e.tree.getNodeByKey(i);e.currentFolderId=r.data.parent_id,r&&r.remove(),e.items=t.getFilesCurrentFolder()}else{var o=e.tree.getActiveNode(),a=e.tree.getNodeByKey(o.parent.key);e.tree.getActiveNode().remove(),e.items=[],a.setActive(!0)}if("undefined"!=typeof n.files)for(var s in e.items)for(var l in n.files)if(e.items[s].id==n.files[l].id){delete e.items[s];break}if(angular.isDefined(n.folder)&&0==n.folder.parent_id){e.currentFolderId=0;for(var s in e.folders)if(e.folders[s].key==n.folder.id){e.folders.splice(s,1);break}}},function(){})},e.getFilesByFolderId=function(){var n=[],i=e.tree.getActiveNode().getChildren();n=angular.copy(t.getFileFolderMap()[e.currentFolderId]),"undefined"==typeof n&&(n=[]);for(var r in i)n.push({id:i[r].key,file_name:i[r].title,created_at:i[r].data.created_at,group:"folder",user_id:i[r].data.user_id,parent_id:i[r].data.parent_id,visible:i[r].data.visible});e.items=n},e.$on("editFile",function(){if("folder"==n.data.group){var i=e.tree.getNodeByKey(n.data.id.toString());i.setTitle(n.data.name)}if(t.formatFilesWitFolderId(),n.data.folder_id>0||n.data.parent_id>0)e.items=o("orderBy")(t.getFilesCurrentFolder(),"file_name");else if(0==n.data.parent_id){for(var r in window.foldersParent)if(window.foldersParent[r].id==n.data.id){window.foldersParent[r]=n.data;break}e.items=o("orderBy")(t.getData(),"file_name")}}),e.deleteFile=function(n){angular.element("#page-loading").css("display","block"),t.remove(n).then(function(n){return!n.status&&n.error?(alert(n.error+" Refresh this page."),void(window.location.href=window.baseUrl+"/document-manager")):(t.formatFilesWitFolderId(),e.items=t.getFilesCurrentFolder(),void angular.element("#page-loading").css("display","none"))})},e.visibleFolder=function(n){e.idFolderVisible=n,angular.element("#page-loading").css("display","block"),t.visibleFolder(n).then(function(n){if(angular.element("#page-loading").css("display","none"),n.status){if(t.formatFilesWitFolderId(),e.items=t.getFilesCurrentFolder(),angular.isDefined(e.idFolderVisible)){var i=$("#tree").fancytree("getTree"),r=i.getNodeByKey(e.idFolderVisible.toString());angular.isDefined(r)&&(r.data.visible=n.visible)}}else n.error&&(alert(n.error+" Refresh this page."),window.location.href=window.baseUrl+"/document-manager")})},e.activeFolder=function(t){var n=e.tree.getNodeByKey(t.toString());n.parent.setExpanded(!0),e.changeBreadcrumb(n),angular.element(n.li).trigger("click")},e.changeBreadcrumb=function(t){var n=Object.create(t);for(e.breadcumbItems=[],e.breadcumbItems.push(n);t.parent&&"root"!=t.parent.title;)e.breadcumbItems.push(t.parent),t=t.parent;e.breadcumbItems=e.breadcumbItems.reverse()},e.addFile=function(t){var n=angular.copy(e.items);n.push(t),e.items=n}}]).controller("ModalAddFolder",["$scope","$timeout","$modalInstance","FileService","currentFolderId","store",function(e,t,n,i,r,o){e.folder={},e.folder.parent_id=r,"undefined"!=typeof o&&(e.folder.store=o),e.addFolder=function(t){e.submitted=!0,t||(angular.element("#add-folder-graphic").attr("disabled","true"),i.addFolder(e.folder).then(function(e){return e.status?void n.close(e):void(e.error&&(alert(e.error+" Refresh this page."),window.location.href=window.baseUrl+"/document-manager"))}))},e.cancel=function(){n.dismiss("cancel")}}]).controller("ModalDeleteFolder",["$scope","$modalInstance","FileService","currentFolderId","name",function(e,t,n,i,r){e.currentFolderId=i,e.name=r,e.deleteFolder=function(){n.deleteFolder(e.currentFolderId).then(function(e){return e.status?void t.close(e):void(e.error&&(alert(e.error+" Refresh this page."),window.location.href=window.baseUrl+"/document-manager"))})},e.cancel=function(){t.dismiss("cancel")}}]).controller("ModalViewPictureCtrl",["$scope","$modalInstance","fileId",function(e,t,n){e.fileId=n,e.baseUrl=baseUrl,e.cancel=function(){t.dismiss("cancel")}}]);var fileModule=angular.module("file");fileModule.factory("FileResource",["$resource",function(e){return e("/admin/document-manager/:method/:id",{},{add:{method:"post"},save:{method:"post"},update:{method:"put"}})}]).factory("shareDataFactory",["$rootScope",function(e){var t={};return t.data="",t.prepForBroadcase=function(e,t){this.data=e,this.broadcastItem(t)},t.broadcastItem=function(t){e.$broadcast(t)},t}]).service("FileService",["$q","$filter","FileResource",function(e,t,n){var i=[],r=[],o=[],a=[],s=[],l=[],d=[];this.create=function(t){var i=e.defer(),r=new n(t);return r.$save({},function(e){e.status?i.resolve(e):i.resolve(null)},function(e){i.resolve(null)}),i.promise},this.fileShare=function(t){var i=e.defer(),r=new n(t);return r.$save({id:t.fileId,method:"file-share"},function(e){i.resolve(e)},function(e){i.resolve(null)}),i.promise},this.deleteFileUserShare=function(t){var i=t.folder_id;"undefined"!=typeof t.file_id&&(i=t.file_id);var r=e.defer();return n["delete"]({id:i,method:"delete-file-user-share",userShareId:t.user_id,group:t.group},function(e){r.resolve(e)}),r.promise},this.getChildFolders=function(t){var i=e.defer();return n.query({id:t,method:"get-child-folders"},function(e){i.resolve(e)}),i.promise},this.getFilesFolder=function(){return r},this.getFiles=function(){return i},this.update=function(t){var i=e.defer(),r=new n(t);return r.$save({id:t._id},function(e){e.status?i.resolve(e):i.resolve(null)},function(e){i.resolve(null)}),i.promise},this.get=function(t,i){var r=e.defer();return n.get({id:t,prefix:i},function(e){r.resolve(e)}),r.promise},this.getAllOfUser=function(t){var i=e.defer();return n.query({created_at:t,method:"file-all"},function(e){for(var t in e)a[e[t].id]=e[t];i.resolve(e)}),i.promise},this.pushFilesOfUser=function(e){filesFormat=[];for(var t in e)a.push(e[t]);return a},this.getFilesOfUser=function(){return a},this.query=function(){var t=e.defer();return i&&i.length?t.resolve(i):n.query().$promise.then(function(e){i=e,t.resolve(i)}),t.promise},this.remove=function(t){var r=e.defer();new n(t);return n["delete"]({id:t},function(e){if(e.status){for(var n in d)if(d[n].id==t){d.splice(n,1);break}for(var n in i)if(i[n].id==t){i.splice(n,1);break}}r.resolve(e)}),r.promise},this.visibleFolder=function(t){var r=e.defer(),o=new n(t);return o.$save({id:t,method:"visible-folder"},function(e){if(e.status){for(var n in d)if(d[n].id==t){d[n].visible=e.visible;break}for(var n in i)if(i[n].id==t){i.splice(n,1);break}}r.resolve(e)}),r.promise},this.deleteFolder=function(t){var i=e.defer();return n["delete"]({id:t,method:"delete-folder"},function(e){if(e)for(var n in d)if(d[n].id==t){d.splice(n,1);break}i.resolve(e)}),i.promise},this.setFiles=function(e){i=e},this.pushFiles=function(e){i.push(e)},this.setFilesCurrentFolder=function(e){d=e},this.getFilesCurrentFolder=function(e){return d},this.pushFile=function(e){s=[],s.push(e),i.push(e)},this.pushFileFoler=function(e){r=[],s=[];for(var t in i)r[t]=i[t];r.push(e),s.push(e),i=r},this.getFileUpload=function(){return s},this.editFile=function(e){o=e},this.getDataFileEdit=function(){return o},this.getData=function(){return i},this.addFolder=function(t){var i=e.defer(),r=new n(t);return r.$save({method:"add-folder"},function(e){i.resolve(e)},function(e){i.resolve(null)}),i.promise},this.checkFile=function(e){var t=["png","gif","jpg","jpeg"];if("undefined"!=typeof e){if(-1!=t.indexOf(e.split("/")[1]))return"image";switch(e.split("/")[1]){case"zip":return"zip";case"pdf":return"pdf";case"msword":return"msword";default:return"other"}}},this.formatFilesWitFolderId=function(){var e=[];for(var t in i)angular.isArray(e[i[t].folder_id])||(e[i[t].folder_id]=[]),e[i[t].folder_id].push(i[t]);l=e},this.getFileFolderMap=function(){return l},this.filesMap=function(e){var t=[];for(var n in e)t[e[n].id]=e[n];return t},this.download=function(t){var i=e.defer(),r=new n;return r.$get({id:t,method:"download"},function(e){i.resolve(e)},function(e){i.resolve(null)}),i.promise},this.editFileName=function(t){var r=e.defer(),o=new n(t);return o.$update({id:t.id,method:"edit-file-name"},function(e){for(var t in i)if(i[t].id==e.id&&i[t].group==e.group){i[t]=e;break}if(e.folder_id>0||e.parent_id>0)for(var t in d)if(d[t].id==e.id){d[t]=e;break}r.resolve(e)},function(e){r.resolve(null)}),r.promise}}]);var fileUpload=angular.module("uls");fileUpload.directive("fileManager",["FileService","$upload",function(e,t){return{restrict:"EA",scope:{},replace:!0,transclude:!0,templateUrl:baseUrl+"/app/shared/file/views/file.html",require:"?ngModel",link:function(n,i,r,o){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}if(o){o.$render=function(){n.fileIds=o.$modelValue};var s=[];n.baseUrl=baseUrl;n.items_s={},n.upload=function(i,r){if(i&&i.length)for(var o=0;o<i.length;o++)!function(r){var o=i[r];o.id=a(),o.proccess=0,n.items_s[o.id]=o,t.upload({url:baseUrl+"/admin/file",file:o}).progress(function(e){var t=parseInt(100*e.loaded/e.total);n.items_s[o.id].proccess=t+"%"}).success(function(t,i,r,a){s.push(t.item.id),e.pushFile(t.item),n.items=e.getData(),delete n.items_s[o.id],angular.element("#"+o.id).remove()}).error(function(e){angular.element("#"+o.id).addClass("dz-error"),n.error=e.message})}(o)},o.$setViewValue(s),n.deleteFile=function(t){e.remove(t).then(function(t){n.items=e.getData()})},n.showBoxDropFile=function(e){}}}}}]).filter("bytes",function(){return function(e,t){if(isNaN(parseFloat(e))||!isFinite(e))return"-";"undefined"==typeof t&&(t=1);var n=["bytes","kB","MB","GB","TB","PB"],i=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,Math.floor(i))).toFixed(t)+" "+n[i]}});var searchModule=angular.module("uls");searchModule.directive("search",["UserService","$timeout","$filter",function(e,t,n){return{require:"?ngModel",restrict:"EA",scope:{type:"=",userId:"=",component:"@",ngModel:"=",onChange:"&",placeholder:"@",items:"="},replace:!0,templateUrl:baseUrl+"/app/shared/search/views/search.html?v=1",link:function(t,n,i,r){n.find(".search-people").select2({placeholder:t.placeholder,templateResult:function(t){if(!t.id)return"<span>"+t.text+"</span>";var n=t.id.split("number:")[1];if(userInfo=e.getUserById(n),"undefined"!=typeof userInfo&&null==userInfo.deleted_at){var i=$('<span><img style="width:30px; height:30px;" class="img-search img-circle" src="'+userInfo.avatar+'" /> '+t.text+"</span>");return i}}}),t.onChange&&t.$watch("ngModel",function(){t.onChange({value:t.ngModel})}),t.$watch(function(e){return e.placeholder},function(e,t){angular.element(".search-people .select2-chosen").text(e)}),t.changeSelect=function(){angular.element("#search-pw").removeClass("in")},t.showListSelect=function(){n.find(".search-people").select2("open")}}}}]),angular.module("uls").directive("scenarioRequest",["TicketService","$controller",function(e,t){return{restrict:"EA",scope:{item:"="},templateUrl:baseUrl+"/app/components/scenario-request/views/index.html",link:function(e,n,i){t("BaseController",{$scope:e}),e.toogleInternalOnly=function(e){angular.element("#collapse-11").hasClass("in")?angular.element(e.target).text("+"):angular.element(e.target).text("-")}}}}]);var fileUpload=angular.module("uls");fileUpload.directive("fileUpload",["FileService","Upload","$timeout",function(e,t,n){return{restrict:"EA",require:"^ngModel",scope:{files:"=",fileIds:"=",openPicture:"&",disabled:"=",control:"="},replace:!0,transclude:!0,templateUrl:baseUrl+"/app/shared/file-upload/views/file-upload.html?v=1",link:function(i,r,o,a){function s(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}var l=0;i.baseUrl=baseUrl,i.fileUpload={},i.fileUploaded=[],i.fileUploadIds=[],i.fileError={},i.uploadFinish=!0,a.$setViewValue({finished:i.uploadFinish}),i.numberFileUpload=[],i.upload=function(e){if(e&&e.length){l++,angular.isUndefined(i.numberFileUpload[l])&&(i.numberFileUpload[l]=[]);for(var r=0;r<e.length;r++)a.$setViewValue({finished:!1}),function(r){a.$setViewValue({finished:!1});var o=e[r];return angular.isDefined(window.maxUpload)&&o.size>window.maxUpload.size?(o.uniId=s(),o.proccess=100,o.error=1,o.status=0,i.fileUpload[o.uniId]=o,i.fileUpload[o.uniId].error="Max file size is "+window.maxUpload.name,i.fileError[o.uniId]=o,void a.$setViewValue({finished:!0})):(o.uniId=s(),o.proccess=0,o.error="",i.fileUpload[o.uniId]=o,void t.upload({url:baseUrl+"/support/file",file:o}).progress(function(e){if(a.$setViewValue({finished:!1}),angular.isDefined(i.fileUpload[o.uniId]))var t=parseInt(100*e.loaded/e.total);else{var t=100;i.uploadFinished=!0,a.$setViewValue({finished:i.uploadFinished})}angular.isDefined(i.fileUpload[o.uniId])&&(i.fileUpload[o.uniId].proccess=t,i.uploadFinished=!1,a.$setViewValue({finished:i.uploadFinished}))}).error(function(t,n,a,s){e.splice(1,r),angular.isDefined(i.fileUpload[o.uniId])&&(angular.isDefined(t.message)&&(i.fileUpload[o.uniId].error=t.message),i.fileError[s.file.uniId]=t)}).success(function(e,t,n,r){i.uploadFinished=!0,a.$setViewValue({finished:i.uploadFinished}),angular.isDefined(i.fileUpload[r.file.uniId])&&(e.item.uniId=r.file.uniId,i.fileUploaded.push(e.item),i.fileUploadIds.push(e.item.id))})["finally"](function(){i.uploadFinished=!0,n(function(){a.$setViewValue({ids:i.fileUploadIds,files:i.fileUploaded,finished:i.uploadFinished})})}))}(r)}},a.$render=function(){n(function(){i.filesUpload=a.$viewValue})},i.checkFile=function(t){return e.checkFile(t)},i.internalControl=i.control||{},i.internalControl.deleteAllFileUploaded=function(){delete i.fileUpload,i.fileUpload={},i.uploadFinished=!0,a.$setViewValue({ids:i.fileUploadIds,files:i.fileUploaded,finished:i.uploadFinished})},i.deleteFile=function(e){delete i.fileUpload[e];for(var t in i.fileUploaded)if(e==i.fileUploaded[t].uniId){var r=i.fileUploadIds.indexOf(i.fileUploaded[t].id);delete i.fileUploaded[t],i.fileUploadIds.splice(r,1)}i.uploadFinished=!0,n(function(){a.$setViewValue({ids:i.fileUploadIds,files:i.fileUploaded,finished:i.uploadFinished})})},i.$on("emptyFiles",function(e,t){i.fileUpload={},i.fileUploaded=[],i.fileUploadIds=[]})}}}]).filter("bytes",function(){return function(e,t){if(isNaN(parseFloat(e))||!isFinite(e))return"-";"undefined"==typeof t&&(t=1);var n=["bytes","kB","MB","GB","TB","PB"],i=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,Math.floor(i))).toFixed(t)+" "+n[i]}});var selectMenu=angular.module("uls"),version=1;selectMenu.directive("selectMenu",["UserService","$timeout","$filter","TicketService",function(e,t,n,r){return{require:"?ngModel",restrict:"E",scope:{text:"@",icon:"@",type:"@",userId:"=",ngModel:"=",placeholder:"@",items:"=",title:"@",onClick:"&",onChange:"&",listTicket:"="},replace:!0,templateUrl:baseUrl+"/app/shared/select-menu/view/view.html?v="+version,link:function(e,t,o,a){e.toggleSelectMenu=function(t){if("assign"==e.type)angular.element("#select-menu-modal-invite").removeClass("active-navigation-container");else if("assign-list"==e.type){if("undefined"==typeof e.listTicket||e.listTicket.length<=0)return alert(n("trans")("alert-tickets-more","dircetive-select-menu")),void t.preventDefault();var o=e.listTicket[0].type_id;for(i in e.listTicket)if(e.listTicket[i].type_id!=o)return void alert(n("trans")("alert-tickets-reassigned","dircetive-select-menu"))}else angular.element("#select-menu-modal-assign").removeClass("active-navigation-container");angular.element("#select-menu-modal-"+e.type).toggleClass("active-navigation-container"),"assign-list"==e.type&&r.getUsersOfTicket(e.listTicket[0].id).then(function(t){e.items=t}),t.stopPropagation()},$(document).on("click",function(e){
$(e.target).closest("div").siblings().find("#select-menu-modal").removeClass("active-navigation-container"),$(".select-menu-modal-holder").hasClass("active-navigation-container")&&$(".select-menu-modal-holder").removeClass("active-navigation-container")}),$(".select-menu-modal-holder").click(function(e){e.stopPropagation()}),e.assign=function(t,n){angular.element("#select-menu-modal-"+e.type).removeClass("active-navigation-container"),a.$setViewValue(t),e.onClick(),n.stopPropagation()},e.closed=function(t){angular.element("#select-menu-modal-"+e.type).removeClass("active-navigation-container"),t.stopPropagation()}}}}]);