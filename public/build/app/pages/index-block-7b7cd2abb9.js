function humanized_time_span(e,t,n,o){function i(){for(var e=0;e<n[d].length;e++)if(null==n[d][e].ceiling||s<=n[d][e].ceiling)return n[d][e];return null}function r(){for(var e=s,t={},n=0;n<o.length;n++){var i=Math.floor(e/o[n][0]);e-=o[n][0]*i,t[o[n][1]]=i}return t}function a(e){var t=r(),n=e.text.replace(/\$(\w+)/g,function(){return t[arguments[1]]});return l(n,t)}function l(e,t){for(var n in t)if(1==t[n]){var o=new RegExp("\\b"+n+"\\b");e=e.replace(o,function(){return arguments[0].replace(/s\b/g,"")})}return e}if(n=n||{past:[{ceiling:60,text:"$seconds seconds ago"},{ceiling:3600,text:"$minutes minutes ago"},{ceiling:86400,text:"$hours hours ago"},{ceiling:2629744,text:"$days days ago"},{ceiling:31556926,text:"$months months ago"},{ceiling:null,text:"$years years ago"}],future:[{ceiling:60,text:"in $seconds seconds"},{ceiling:3600,text:"in $minutes minutes"},{ceiling:86400,text:"in $hours hours"},{ceiling:2629744,text:"in $days days"},{ceiling:31556926,text:"in $months months"},{ceiling:null,text:"in $years years"}]},o=o||[[31556926,"years"],[2629744,"months"],[86400,"days"],[3600,"hours"],[60,"minutes"],[1,"seconds"]],"Invalid Date"==new Date(e))for(;-1!=String(e).indexOf("-");)e=e.replace("-","/");e=new Date(e),t=t?new Date(t):new Date;var s=(t-e)/1e3,d="past";return 0>s&&(d="future",s=0-s),a(i())}angular.module("user",[]),angular.module("permission",[]),angular.module("role",[]),angular.module("multiSelect",[]),angular.module("ticket",[]),angular.module("type",[]),angular.module("dataOption",[]),angular.module("nlcFilter",[]),angular.module("file",[]),angular.module("AppLanguage",[]),angular.module("TemplateManagerApp",[]),angular.module("RegionApp",[]),angular.module("campaignApp",[]),angular.module("campaignDetailApp",[]),angular.module("MarketsegmentApp",[]),angular.module("notification",[]),angular.module("transApp",[]),angular.module("assetManager",[]),angular.module("BlockApp",[]),angular.module("ChannelPartnersApp",[]),angular.module("roleGroup1",[]),angular.module("filedType",[]),angular.module("filed",[]),angular.module("term",[]),angular.module("customFormatDate",[]),angular.module("SeoAnalysisApp",[]),angular.module("pageApp",[]),angular.module("treeresizer",[]),angular.module("CreatePageApp",[]),angular.module("EditDraftApp",[]),angular.module("fomatHtml",[]),angular.module("colorpicker.module",[]),angular.module("formBuilderDirectiveApp",[]),angular.module("appManageTerm",[]),angular.module("TermTemplateManagerApp",[]),angular.module("configurator",[]),angular.module("TemplateContentManager",[]),angular.module("cmsContentFolderApp",[]),angular.module("lowercaseCharater",[]),angular.module("selectLevel",[]),angular.module("modalSelectLevel",[]),angular.module("configField",[]),angular.module("cmsContentInsertApp",[]),angular.module("confirmDirective",[]),angular.module("CmsApp",[]),angular.module("checkLimitAndChangeDateTimeDirectiveApp",[]),angular.module("tagContentApp",[]),angular.module("tagContentDirective",[]),angular.module("cmsContentTagApp",[]),angular.module("viewDraft",[]),angular.module("databaseManager",[]),angular.module("selectLevelDatabase",[]),angular.module("modalSelectPage",[]),angular.module("configFormDatabaseApp",[]),angular.module("historyApp",[]),angular.module("BlockNestedApp",[]),angular.module("selectLevelAsset",[]),angular.module("MaterialApp",[]),angular.module("draganddrop",[]),angular.module("activityLog",[]),angular.module("translation",[]),angular.module("HelpEditorApp",[]),angular.module("helpEditorDirective",[]),angular.module("selectLevelHelp",[]),angular.module("cache",[]),angular.module("file",[]),angular.module("treeresize",[]),angular.module("test",[]),angular.module("guide",[]),angular.module("PlatformsApp",[]),angular.module("accessories",[]);var defaultModules=["ui.bootstrap","ngResource","ngCookies","ngFileUpload","ngRoute","toggle-switch","ngImgCrop","ngTable","user","role","permission","multiSelect","ticket","type","dataOption","nlcFilter","file","xeditable","timer","AppLanguage","TemplateManagerApp","RegionApp","campaignApp","campaignDetailApp","MarketsegmentApp","notification","transApp","assetManager","BlockApp","ChannelPartnersApp","roleGroup1","filedType","filed","term","ui-iconpicker","customFormatDate","SeoAnalysisApp","pageApp","treeresizer","CreatePageApp","EditDraftApp","fomatHtml","colorpicker.module","formBuilderDirectiveApp","appManageTerm","TermTemplateManagerApp","mgo-angular-wizard","configurator","TemplateContentManager","cmsContentFolderApp","lowercaseCharater","selectLevel","configField","cmsContentInsertApp","confirmDirective","CmsApp","checkLimitAndChangeDateTimeDirectiveApp","tagContentApp","tagContentDirective","cmsContentTagApp","viewDraft","modalSelectLevel","databaseManager","selectLevelDatabase","modalSelectPage","configFormDatabaseApp","historyApp","BlockNestedApp","selectLevelAsset","MaterialApp","ui.sortable","activityLog","translation","HelpEditorApp","helpEditorDirective","selectLevelHelp","cache","file","treeresize","guide","PlatformsApp","accessories"];"undefined"!=typeof modules&&(defaultModules=defaultModules.concat(modules));var myApp=angular.module("uls",defaultModules);angular.module("uls").run(["editableOptions",function(e){e.theme="bs3"}]),angular.module("uls").config(["$logProvider",function(e){e.debugEnabled(window.debug)}]),"undefined"!=typeof angularMock&&(defaultModules=defaultModules.concat(angularMock));var goTo=function(e){window.location.href="#_"+e,$("#fix-modal-top").scrollTop(0),$("#"+e).hasClass("in")||$("#"+e).prev().trigger("click")};myApp.config(["$httpProvider",function(e){e.interceptors.push(["$q",function(e){e.defer();return{responseError:function(t){var n=angular.element(".butterbar-container");switch(t.status){case 401:return void(window.location.href=window.baseUrl);case 404:n.hasClass("hidden")&&n.removeClass("hidden");break;case 500:n.hasClass("hidden")&&n.removeClass("hidden")}return e.reject(t)}}}])}]),function(e){function t(){var t=window.innerHeight;screen.height;e(".table-responsive.set-height, .table-responsive#tb-group-user").css({height:t-170+"px"}),e(".table-animate").css({height:t-170+"px"}),e("#search-page,.box-maps").css({height:t-105+"px"}),e(".box-list-rep").css({height:t-100+"px"}),e("#load-maps").css({height:t-185+"px"})}e(document).ready(t),e(window).resize(t),e(document).ready(function(){e(".dropdown-menu table tr td button").removeAttr("style")}),e(document).ready(function(){setTimeout(function(){var t=e("#frame_html").contents().find("head");t.append('<style type="text/css">.area_toolbar{background-color:#f1f1f1;}#editor{border:solid #ccc 1px}#result{border-top:solid #ccc 1px;border-bottom: solid #ccc 1px}.editarea_popup{box-shadow: 0px 4px 36px rgba(177, 177, 177, 0.75);border: solid 1px #CCCCCC;background-color: #FFFFFF;}.area_toolbar select{font-size:9pt;background-color:#fff}</style>')},1e3)}),e(window).load(function(){e(".step3 .show-more").click(function(){e(".step3 .wrap-more-product").toggleClass("show")})}),e(document).ready(function(){e(".nav-icon").click(function(){e(this).toggleClass("open"),e("#pagehome").toggleClass("on-off")})});var n,o,i,r,a,l,s;e(".next").click(function(){return s?!1:(s=!0,n=e(this).parent(),o=e(this).parent().next(),o.show(),void n.animate({opacity:0},{step:function(e,t){l=1-.2*(1-e),r=50*e+"%",a=1-e,n.css({transform:"scale("+l+")"}),o.css({left:r,opacity:a})},duration:800,complete:function(){n.hide(),s=!1},easing:"easeInOutBack"}))}),e(".previous").click(function(){return s?!1:(s=!0,n=e(this).parent(),i=e(this).parent().prev(),i.show(),void n.animate({opacity:0},{step:function(e,t){l=.8+.2*(1-e),r=50*(1-e)+"%",a=1-e,n.css({left:r}),i.css({transform:"scale("+l+")",opacity:a})},duration:800,complete:function(){n.hide(),s=!1},easing:"easeInOutBack"}))}),e(".submit").click(function(){return!1})}(jQuery),angular.module("uls").controller("BaseController",["$scope","$parse","$timeout","$modal","UserService","AssetManagerService",function(e,t,n,o,i,r){if(angular.element(".wrapper").removeClass("hidden"),i.setData(window.usersMap),n(function(){"undefined"!=typeof e.callbackLoadUserFinish&&(e.callbackLoadUserFinish(),e.users_map=i.getUsersMap())}),e.testFuture=window.testFuture,1==e.testFuture&&angular.element(".test").removeClass("hidden"),e.windowType=window.info,"undefined"!=typeof window.info)for(var a in window.info){var l=t(a);l.assign(e,window.info[a])}e.initDate=function(){angular.element(".date").bdatepicker({format:"yyyy-mm-dd"})},e.viewModalImage=function(e){var t=o.open({templateUrl:baseUrl+"/app/components/termTemplateManager/views/modal/viewImage.html",controller:"ModalViewPictureCtrl",size:void 0,windowClass:"show-img",resolve:{fileId:function(){return e}}});t.result.then(function(e){},function(){})},e.urlForm=[],e.getUrlImageAssetForm=function(t,n){"undefined"==typeof e.urlForm[t]&&(e.urlForm[t]=[]),r.getUrlImageAsset(t).then(function(o){e.urlForm[t][n]=o.url})},e.removeThumbnailAssertForm=function(t,n){e.urlForm[t][n]=""},e.initTooltip=function(e){$('[data-toggle="tooltip"]').tooltip()}}]).controller("ModalViewPictureCtrl",["$scope","$modalInstance","fileId",function(e,t,n){e.fileId=n,e.baseUrl=baseUrl,e.cancel=function(){t.dismiss("cancel")}}]);var userModule=angular.module("user");userModule.factory("UserResource",["$resource",function(e){return e("/api/user/:method/:id",{method:"@method",id:"@id"},{add:{method:"post"},save:{method:"post"},update:{method:"put"}})}]).factory("UserService",["$q","$filter","UserResource",function(e,t,n){var o=[],i=[],r=[],a=this,l={},s={};return this.setHashData=function(e){l=e},this.create=function(t){if("undefined"!=typeof t.id)return a.update(t);var i=e.defer(),r=new n(t);return r.$save({},function(e){e.status&&e.item&&(o.push(e.item),"undefined"==typeof e.item.last_login&&(e.item.last_login="0000-00-00 00:00:00")),i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.changePassword=function(t){var o=e.defer(),i=new n(t);return i.$save({method:"change-password",id:t.id},function(e){e.status?o.resolve(e):o.reject(e)},function(e){o.reject(e.data)}),o.promise},this.changeRoles=function(t){var o=e.defer(),i=new n(t);return i.$save({method:"change-roles"},function(e){e?o.resolve(e):o.reject(e)},function(e){o.reject(e.data)}),o.promise},this.update=function(t){var i=e.defer(),r=new n(t);return r.$update({id:t.id},function(e){if(e.status)for(var t in o)if(o[t].id==e.item.id){o[t]=e.item;break}i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.get=function(t){var o=e.defer();return n.get({id:t},function(e){o.resolve(e)}),o.promise},this.query=function(){var t=e.defer();return n.query(function(e){o=e,t.resolve(e)}),t.promise},this.queryUsersManager=function(){var t=e.defer();return n.query({method:"get-all-user-manager"},function(e){o=e,t.resolve(e)}),t.promise},this.remove=function(t){var i=e.defer();return n["delete"]({id:t},function(e){if(e.status)for(var n in o)if(o[n].id==t){o[n].status="no";break}i.resolve(e)}),i.promise},this.pushUser=function(e){o.push(e)},this.updateUser=function(e){for(var t in o)if(o[t].id==e.id){e.status="yes",o[t]=e;break}},this.changeAvatar=function(t,o){var i=e.defer();return n.save({method:"change-avatar",file:o,id:t},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.resetPassword=function(t){var o=e.defer();return n.save({method:"email",entity:"password",email:t},function(e){o.resolve(e)},function(e){o.resolve(e.data)}),o.promise},this.getUsers=function(){return o},this.getUserById=function(e){return s[e]},this.getUsersMap=function(){return s},this.listMap=function(e,t){if("role"==t)for(var n in e)i[e[n].id]=e[n];else for(var n in e)r[e[n].id]=e[n]},this.getMap=function(e){return"role"==e?i:r},this.userBranchManager=function(t){var o=e.defer();return n.query({id:t,method:"get-users-branch-manager"},function(e){o.resolve(e)}),o.promise},this.updatePermissions=function(t,o){var i=e.defer();return n.save({id:t,permissionIds:o,method:"update-permission"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.updateGroup=function(t,o){var i=e.defer();return n.save({id:t,groupIds:o,method:"update-group"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.updateRoles=function(t,o){var i=e.defer();return n.save({id:t,roleIds:o,method:"update-role"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.changeStatus=function(t){var i=e.defer();return n["delete"]({id:t,method:"change-status"},function(e){if(e.status)for(var n in o)if(o[n].id==t){o[n].status="yes";break}i.resolve(e)}),i.promise},this.setData=function(e){o=e;for(var t in e)s[e[t].id]=e[t];return o},this.updateShowDueDateUser=function(t){var o=e.defer(),i=new n(t);return i.$save({method:"update-show-due-date-user"},function(e){o.resolve(e)},function(e){o.resolve(e.data)}),o.promise},this}]);var assetmanagerApp=angular.module("assetManager",["ngResource","ui.bootstrap","ngSanitize","ngTable"]);assetmanagerApp.factory("AssetManagerResource",["$resource",function(e){return e("/api/asset-manager/:method/:id",{method:"@method",id:"@id"},{add:{method:"post"},save:{method:"post"},update:{method:"put"},editNameFolder:{method:"edit-name-folder"}})}]).service("AssetManagerService",["AssetManagerResource","$q",function(e,t){var n=this,o=[];this.createFolderProvider=function(o){if("undefined"!=typeof o.id)return n.editFolderAndFile(o);var i=t.defer(),r=new e(o);return r.$save({method:"create-folder"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.uploadNewAsset=function(n){var i=t.defer(),r=new e(n);return r.$save({method:"upload-new-asset"},function(e){0!=e.status&&o.push(e.item),i.resolve(e.item)},function(e){i.resolve(e.data)}),i.promise},this.createNewAsset=function(n){var i=t.defer(),r=new e(n);return r.$save({method:"create-new-asset"},function(e){0!=e.status&&o.push(e.item),i.resolve(e.item)},function(e){i.resolve(e.data)}),i.promise},this.saveFieldFile=function(n){var o=t.defer(),i=new e(n);return i.$save({method:"save-file-asset"},function(e){o.resolve(e)},function(e){o.resolve(e.data)}),o.promise},this.editFile=function(n){var o=t.defer(),i=new e(n);return i.$save({method:"edit-file"},function(e){o.resolve(e)},function(e){o.resolve(e.data)}),o.promise},this.crop=function(n){var o=t.defer(),i=new e(n);return i.$save({method:"crop"},function(e){o.resolve(e)},function(e){o.resolve(e.data)}),o.promise},this.addTagsForPage=function(n,o){var i=t.defer(),r=new e(o);return r.$save({id:n,method:"add-tags"},function(e){0!=e.status,i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.getAssetManagerById=function(n){var o=t.defer(),i=new e;return i.$get({id:n},function(e){o.resolve(e)},function(e){o.resolve(e.data)}),o.promise},this.setAssetManagers=function(e){return o=e},this.getAssetManagers=function(){return o},this.getUrlImageAsset=function(n){var o=t.defer();return e.get({id:n,method:"get-url-image-asset"},function(e){o.resolve(e)}),o.promise},this.deleteFolderAndAsset=function(n){var o=t.defer(),i=new e;return i.$delete({id:n},function(e){o.resolve(e)},function(e){o.resolve(e.data)}),o.promise},this.deleteAssetFile=function(n){var o=t.defer(),i=new e;return i.$get({id:n,method:"delete-file"},function(e){o.resolve(e)},function(e){o.resolve(e.data)}),o.promise},this.editNameFolder=function(n){var o=t.defer(),i=new e(n);return i.$save({id:n.id,method:"edit-name-folder"},function(e){0!=e.status&&o.resolve(e)},function(e){o.resolve(e.data)}),o.promise},this.updateContentFile=function(n,o){var i=t.defer(),r=new e(o);return r.$save({id:n,method:"update-content-file"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise}}]),angular.module("uls").controller("NotificationController",["$scope","$filter","NotificationService","$controller","$timeout",function(e,t,n,o,i){function r(){}function a(){if(f=!1,u.length>0){var e=u.shift();s(e)}}function l(){}function s(t){if(f)return void u.push(t);if(f=!0,-1==t.data.sender_id)var n=e.baseUrl+"/160x160_avatar_default.png?t=1";else var n=e.users_map[t.data.sender_id].avatar;var o=new Notify("Notification",{icon:n,body:t.data.message,tag:t.data.sender_id,notifyShow:r,notifyClose:a,notifyClick:function(){window.location.href="/"+t.data.href},notifyError:l,timeout:5});o.show()}o("BaseController",{$scope:e}),e.callbackLoadUserFinish=function(){},angular.element("#notification-top").removeClass("hidden"),e.baseUrl=window.baseUrl;var d=10;e.limitTo=d;var c=1;e.notifications=[];var u=[],f=!1;e.amount=0,$(".scroll-noti1").scroll(function(){$(this)[0].scrollHeight-$(this).scrollTop()===$(this).outerHeight()&&e.$apply(function(){e.limitTo=e.limitTo+d})});var p=RowboatPusher.subscribe("notification_ticket");p.bind("Rowboat\\Notification\\Events\\Notifications\\Broadcast\\NotificationTicket",function(t){e.$apply(function(){"undefined"!=typeof t.data.user_id&&-1!=t.data.user_id.indexOf(window.userId)&&(s(t),c=1,e.amount++)})}),e.getNotifications=function(){n.query(c).then(function(t){c&&e.setUserReadThisNotification(),e.notifications=t,e.hightlight=angular.copy(e.amount),e.amount=0,c=0})},e.setUserReadThisNotification=function(){n.setRead().then(function(){})},n.getAmountNotificationsNotRead().then(function(t){e.amount=t.result})}]);var permissionModule=angular.module("notification");permissionModule.factory("NotificationResource",["$resource",function(e){return e("/api/notification/:method/:id",{},{add:{method:"post"},save:{method:"post"}})}]).service("NotificationService",["$q","$filter","NotificationResource",function(e,t,n){var o=[];this.getAmountNotificationsNotRead=function(t){var o=e.defer();return n.get({method:"amount-notifications-not-read"},function(e){o.resolve(e)}),o.promise},this.query=function(t){var i=e.defer();return t?n.query().$promise.then(function(e){o=e,i.resolve(o)}):i.resolve(o),i.promise},this.notificationInvite=function(t){var o=e.defer(),i=new n(t);return i.$save({data:t,method:"invite"},function(e){o.resolve(e)},function(e){o.resolve(e.data)}),o.promise},this.setRead=function(){var t=e.defer(),o=new n;return o.$save({method:"set-read"},function(e){t.resolve(e)},function(e){t.resolve(e.data)}),t.promise}}]),notificationModule=angular.module("notification"),notificationModule.directive("notification",[function(){return{restrict:"AE",scope:{item:"="},replace:!0,templateUrl:baseUrl+"/app/shared/notification/views/notification.html",link:function(){}}}]);var module=angular.module("uls");module.directive("rowboatRequired",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,o){"undefined"==typeof e.$eval(n.ngModel)&&o.$setValidity("rowboatRequired",!1),t.on("focus",function(i){e.$watch(n.ngModel,function(e){var n="undefined"!=typeof e&&0!=e.length;if(n)t.parent().find("span").remove(),t.parent().removeClass("error"),o.$setValidity("rowboatRequired",n);else if(0==t.parent().find("span").length){t.parent().addClass("error");var i='<span class="control-label">It is required</span>';t.parent().append(i),o.$setValidity("rowboatRequired",n)}})})}}}),module.directive("rowboatLength",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,o){"undefined"!=typeof e.$eval(n.ngModel)&&e.$eval(n.ngModel).length!=n.rowboatLength&&o.$setValidity("rowboatLength",!1),t.on("focus",function(i){e.$watch(n.ngModel,function(e){var i=n.rowboatLength,r="undefined"!=typeof e&&e.length==i;if(r)t.parent().find("span").remove(),t.parent().removeClass("error"),o.$setValidity("rowboatLength",r);else if(0==t.parent().find("span").length){t.parent().addClass("error");var a='<span class="control-label">Length is '+i+"</span>";t.parent().append(a),o.$setValidity("rowboatLength",r)}})})}}}),module.directive("rowboatMinLength",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,o){"undefined"!=typeof e.$eval(n.ngModel)&&e.$eval(n.ngModel).length<n.rowboatMinLength&&o.$setValidity("rowboatMinLength",!1),t.on("focus",function(i){e.$watch(n.ngModel,function(e){var i=n.rowboatMinLength,r="undefined"!=typeof e&&e.length>=i;if(r)t.parent().find("span").remove(),t.parent().removeClass("error"),o.$setValidity("rowboatMinLength",r);else if(0==t.parent().find("span").length){t.parent().addClass("error");var a='<span class="control-label">Min length is '+i+"</span>";t.parent().append(a),o.$setValidity("rowboatMinLength",r)}})})}}}),module.directive("rowboatMaxLength",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,o){"undefined"!=typeof e.$eval(n.ngModel)&&e.$eval(n.ngModel).length>n.rowboatMaxLength&&o.$setValidity("rowboatMaxLength",!1),t.on("focus",function(i){e.$watch(n.ngModel,function(e){var i=n.rowboatMaxLength,r="undefined"!=typeof e&&e.length<=i;if(r)t.parent().find("span").remove(),t.parent().removeClass("error"),o.$setValidity("rowboatMaxLength",r);else if(0==t.parent().find("span").length){t.parent().addClass("error");var a='<span class="control-label">Max length is '+i+"</span>";t.parent().append(a),o.$setValidity("rowboatMaxLength",r)}})})}}}),module.directive("rowboatEmailPattern",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,o){$pattern=/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/,"undefined"==typeof e.$eval(n.ngModel)&&o.$setValidity("rowboatEmailPattern",!1),t.on("blur",function(i){e.$watch(n.ngModel,function(e){var n="undefined"!=typeof e&&$pattern.test(e);if(n)t.parent().find("span").remove(),t.parent().removeClass("error"),o.$setValidity("rowboatEmailPattern",n);else if(0==t.parent().find("span").length){t.parent().addClass("error");var i='<span class="control-label">Email Invalid</span>';t.parent().append(i),o.$setValidity("rowboatEmailPattern",n)}})})}}});var filterDate=angular.module("customFormatDate",[]);filterDate.filter("myDate",["$filter",function(e){return function(t,n){if(null==t)return"";if("Invalid Date"==new Date(t))for(;-1!=String(t).indexOf("-");)t=t.replace("-","/");if("Invalid Date"==new Date(t))return"";var o=e("date")(new Date(String(t)),angular.isUndefined(n)?"MM-dd-yyyy":n);return String(o)}}]).filter("myDateL",["$filter",function(e){return function(t){if(null==t)return"";if("Invalid Date"==new Date(t))for(;-1!=String(t).indexOf("-");)t=t.replace("-","/");if("Invalid Date"==new Date(t))return"";var n=e("date")(new Date(String(t)),"MMMM d, y");return String(n)}}]).filter("myDateTime",["$filter",function(e){return function(t){if(null==t)return"";if("0000-00-00 00:00:00"==t)return"";if("Invalid Date"==new Date(t))for(;-1!=String(t).indexOf("-");)t=t.replace("-","/");if("Invalid Date"==new Date(t))return"";var n=e("date")(new Date(String(t)),"MM-dd-yyyy HH:mm:ss");return String(n)}}]).filter("myDateShortTime",["$filter",function(e){return function(t){if(null==t)return"";if("0000-00-00 00:00:00"==t)return"";if("Invalid Date"==new Date(t))for(;-1!=String(t).indexOf("-");)t=t.replace("-","/");if("Invalid Date"==new Date(t))return"";var n=e("date")(new Date(String(t)),"MM-dd-yyyy h:mma");return String(n)}}]).filter("clientDate",["$filter",function(e){return function(t,n){if(null==t)return"";if("0000-00-00 00:00:00"==t)return"";if("Invalid Date"==new Date(t))for(;-1!=String(t).indexOf("-");)t=t.replace("-","/");if("Invalid Date"==new Date(t))return"";t=new Date(t),t=new Date(parseInt(new Date(t).getTime())-60*parseInt((new Date).getTimezoneOffset())*1e3);var o=e("date")(new Date(String(t)),angular.isUndefined(n)?"MM-dd-yyyy":n);return String(o)}}]).filter("clientDateTime",["$filter",function(e){return function(t){return e("date")(checkInvalid(t),window.dateTimeFormat)}}]).filter("clientLogDate",["$filter",function(e){return function(t){return e("date")(checkInvalid(t),window.logDate)}}]).filter("clientMediumDate",["$filter",function(e){return function(t){return e("date")(checkInvalid(t),window.mediumDate)}}]).filter("clientShortTime",["$filter",function(e){return function(t){return e("date")(checkInvalid(t),window.shortTime)}}]).filter("clientShortTimeFollowTimezone",["$filter",function(e){return function(t,n){if(null==t)return"";if("Invalid Date"==new Date(t))for(;-1!=String(t).indexOf("-");)t=t.replace("-","/");if("Invalid Date"==new Date(t))return"";var o=e("date")(new Date(String(t)),window.shortTime);return String(o)}}]).filter("formatCurrentDate",["$filter",function(e){return function(e){if(e=checkInvalid(e),!e)return"";e=new Date(e);var t=e.getMonth()+"-"+e.getDate()+"-"+e.getFullYear();return String(t)}}]).filter("formatCurrentTime",["$filter",function(e){return function(e){if(e=checkInvalid(e),!e)return"";e=new Date(e);var t=e.getHours()>=12?"pm":"am",n=parseInt(e.getHours())%12;n=n?10>n?"0"+n:n:12;var o=parseInt(e.getMinutes())<10?"0"+e.getMinutes():e.getMinutes(),i=parseInt(e.getSeconds())<10?"0"+e.getSeconds():e.getSeconds(),r=n+"-"+o+"-"+i+" "+t;return String(r)}}]).filter("formatCurrentShortTime",["$filter",function(e){return function(e){if(e=checkInvalid(e),!e)return"";e=new Date(e);var t=e.getHours()>=12?"pm":"am",n=parseInt(e.getHours())%12;n=n?10>n?"0"+n:n:12;var o=parseInt(e.getMinutes())<10?"0"+e.getMinutes():e.getMinutes(),i=n+":"+o+" "+t;return String(i)}}]);var checkInvalid=function(e,t){if(null==e)return"";if("Invalid Date"==new Date(e))for(;-1!=String(e).indexOf("-");)e=e.replace("-","/");return"Invalid Date"==new Date(e)?"":(e=new Date(e),e=new Date(parseInt(new Date(e).getTime())-60*parseInt((new Date).getTimezoneOffset())*1e3),new Date(String(e)))};angular.module("nlcFilter").filter("elapsedtime",function(){return function(e){return humanized_time_span(e)}});var translation=angular.module("translation",[]);translation.filter("trans",["$filter",function(e){return function(e,t){return null==e?"":window.translations[t][e]}}]);var selectLevel=angular.module("helpEditorDirective",[]),version=5;selectLevel.directive("helpEditorDirective",["$timeout","$filter",function(e,t){return{require:"?ngModel",restrict:"EA",scope:{items:"=",text:"@",selectedItems:"=selectedItem",onClick:"&"},replace:!0,templateUrl:baseUrl+"/app/components/user/help-editor/view/view-help.html?v="+(new Date).getTime(),link:function(t,n,o,i){t.description="",t.recursiveGetDescription=function(e){angular.forEach(e,function(e,n){e.parent=!1,t.description+='<strong class="space-topic" id="_'+e._id+'">'+e.name+"</strong>"+e.description,e.subFolder.length>0&&t.recursiveGetDescription(e.subFolder)})},t.getDesctiption=function(){angular.forEach(t.items,function(e,n){e.parent=!0,t.description+='<h4 id="_'+e._id+'" class="c-primary">'+e.name+'</h4><div class="space-area user-ad-area">'+e.description,t.recursiveGetDescription(e.subFolder),t.description+="</div>"})},t.getDesctiption(),t.goToAnchorWithId=function(e){window.location.href="#"+e,$("#fix-modal-top").scrollTop(0)},e(function(){$(".sub-select-"+t.items[0]._id).addClass("in")})}}}]),angular.module("treeresizer",[]).directive("resizer",["$document",function(e){return function(t,n,o){function i(){var e=$(window).outerHeight(),t=$(".navibar-uls").outerHeight(),n=$(".top-content").outerHeight();$(".content").height(e-(t+n+19))}function r(e){var t=$("#sidebar").outerWidth();$("#resize-left").unbind();var i=e.pageX-t;o.resizerMax&&i>o.resizerMax&&(i=parseInt(o.resizerMax)),n.css({left:i+"px"}),$(o.resizerLeft).css({width:i+"px"}),$(o.resizerRight).css({left:i+parseInt(o.resizerWidth)+"px"})}function a(){e.unbind("mousemove",r),e.unbind("mouseup",a)}i(),$(window).resize(i),n.on("mousedown",function(t){t.preventDefault(),e.on("mousemove",r),e.on("mouseup",a)})}}]);var blockApp=angular.module("BlockApp");blockApp.factory("BlockManagerResource",["$resource",function(e){return e("/api/block-manager/:method/:id",{method:"@method",id:"@id"},{add:{method:"post"},save:{method:"post"},update:{method:"put"},editNameFolder:{method:"edit-name-folder"}})}]).service("BlockManagerService",["BlockManagerResource","$q",function(e,t){var n=this;this.createFolderProvider=function(n){var o=t.defer(),i=new e(n);return i.$save({method:"create-folder"},function(e){o.resolve(e)},function(e){o.resolve(e.data)}),o.promise},this.addNew=function(o){if(angular.isDefined(o._id))return n.editBlock(o);var i=t.defer(),r=new e(o);return r.$save({method:"add-new"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.reviewContentBlock=function(n){var o=t.defer(),i=new e(n);return i.$save({method:"review-content-block"},function(e){o.resolve(e)},function(e){o.resolve(e.data)}),o.promise},this.editBlock=function(n){var o=t.defer(),i=new e(n);return i.$update({id:n._id,method:"edit-block"},function(e){o.resolve(e)},function(e){o.resolve(e.data)}),o.promise},this.parseContentBlock=function(n){var o=t.defer(),i=new e(n);return i.$save({method:"parse-content-config"},function(e){o.resolve(e)},function(e){o.resolve(e.data)}),o.promise},this.getHtmlFieldsCms=function(n){var o=t.defer(),i=new e(n);return i.$save({method:"get-htm-fields-cms"},function(e){o.resolve(e)},function(e){o.resolve(e.data)}),o.promise},this.addTagsForPage=function(n,o){var i=t.defer(),r=new e(o);return r.$save({id:n,method:"add-tags"},function(e){0!=e.status,i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.parseContentConfigBlock=function(n){var o=t.defer(),i=new e(n);return i.$save({method:"parse-content-config"},function(e){o.resolve(e)},function(e){o.resolve(e.data)}),o.promise},this.getContentForIframe=function(){var n=t.defer(),o=new e(data);return o.$save({method:"get-content-iframe"},function(e){n.resolve(e)},function(e){n.resolve(e.data)}),n.promise},this.deleteFolderAndBlock=function(n){var o=t.defer(),i=new e;return i.$delete({id:n},function(e){o.resolve(e)},function(e){o.resolve(e.data)}),o.promise},this.deleteBlockFile=function(n){var o=t.defer(),i=new e;return i.$get({id:n,method:"delete-file"},function(e){o.resolve(e)},function(e){o.resolve(e.data)}),o.promise},this.editNameFolder=function(n){var o=t.defer(),i=new e(n);return i.$save({id:n.id,method:"edit-name-folder"},function(e){0!=e.status&&o.resolve(e)},function(e){o.resolve(e.data)}),o.promise},this.getDataBlock=function(n){var o=t.defer(),i=new e(n);return i.$save({method:"get-data-block"},function(e){o.resolve(e)},function(e){o.resolve(e.data)}),o.promise}}]),blockApp.controller("BlockManagerController",["$scope","$modal","ngTableParams","$timeout","BlockManagerService","CmsContentFolderService","$filter","$templateCache","CmsService",function(e,t,n,o,i,r,a,l,s){e.size=function(){s.setHeightTable()},e.isShowNested=!0,e.isShowBtnDelete=!1,e.isShowBtnEditNameFolder=!1,l.remove("cms/block-manager/template"),l.remove("cms/block-manager/template-manage-block"),e.blockManagers=r.setContents(window.folders,window.currentPage),e.allTags=angular.copy(window.allTags),e.tagsContent=angular.copy(window.tagsContent),e.pageSelected=window.idOfBlockSelected,e.contentHideOrShowAllNestedContent="Show All Nested Content",angular.isUndefined(e.blocks)&&(e.blocks=[]),e.isSearch=!1,e.btnSearch=function(){e.isSearch=!e.isSearch},e.tableParams=new n({page:1,count:100,sorting:{title:"asc"},filter:{}},{total:e.blocks.length,getData:function(t,n){var o=n.filter()?a("filter")(e.blocks,n.filter()):e.blocks,i=n.sorting()?a("orderBy")(o,n.orderBy()):o;n.total(o.length),t.resolve(i.slice((n.page()-1)*n.count(),n.page()*n.count()))}}),0!=e.pageSelected&&r.setActiveNode(e.pageSelected),r.initTree(function(t,n){e.blocks=[],"Blocks"==n.key?e.titleItemSelected="Blocks":1==n.folder?e.titleItemSelected=n.title:angular.isUndefined(n.parent.data.name)?e.titleItemSelected="Blocks":e.titleItemSelected=n.parent.data.name,angular.isDefined(t)&&1==t.length&&1!=n.folder?(t[0].expanded=!0,e.blocks=t):angular.forEach(t,function(t,n){t.expanded=!1,e.blocks.push(t)}),e.blocks=t,e.tableParams.reload(),angular.isDefined(e.tableParams.$params)&&(e.tableParams.$params.page=1),"0"!=n.data.parent_id?e.isShowBtnDelete=!0:e.isShowBtnDelete=!1,1==n.folder&&"0"!=n.data.parent_id?e.isShowBtnEditNameFolder=!0:e.isShowBtnEditNameFolder=!1}),e.hideOrShowAllNestedContent=function(){r.changeStatusHideOrShowAllNestedContent().then(function(t){e.contentHideOrShowAllNestedContent=t.textButton,"Show All Nested Content"==e.contentHideOrShowAllNestedContent?e.isShowNested=!0:e.isShowNested=!1,
e.blocks=t.contents,e.tableParams.reload()})},e.checkPermission=function(t){var n=e.types_map[t.asset_id],o=window.editAssetPermission&&(window.jsPermission&&"javascript"==n||window.cssPermission&&"css"==n||window.imagePermission&&"image"==n||window.videoPermission&&"video"==n);return o},e.getChildrenPages=function(t){var n=[];for(var o in t){if(angular.isUndefined(t[o].data))return;"0"==t[o].key?(n.push(t[o]),delete t[o]):angular.isUndefined(t[o].folder)||(n.push(t[o]),delete t[o])}e.blockManagers=t,e.tableParams.reload()},e.deleteFolderAndBlock=function(){e.dsbBtnDelete=!0;var t=$("#tree").fancytree("getTree"),n=t.getActiveNode(),o=t.getRootNode();if(1==n.folder)var r=confirm(a("trans")("confirm-delete-folder","golbal"));else var r=confirm(a("trans")("confirm-delete-content","golbal"));return 1!=r?void(e.dsbBtnDelete=!1):void("0"!=n.data.parent_id&&i.deleteFolderAndBlock(n.data._id).then(function(t){t.status&&(n.remove(),rootNodeOfNodeActive=_.find(o.children,function(e){return"Blocks"==e.title}),rootNodeOfNodeActive.setActive()),e.dsbBtnDelete=!1}))},e.deleteFileBlock=function(t,n){i.deleteBlockFile(t).then(function(o){0!=o.status&&(angular.isUndefined(o.result)||(n.region=o.result.countUniqueRegion,n.language=o.result.countUniqueLanguage,n.status=o.result.status),angular.forEach(n.subBlocks,function(e,o){e._id==t&&n.subBlocks.splice(o,1)}),e.tableParams.reload())})},e.editNameFolder=function(){var n=$("#tree").fancytree("getTree"),o=n.getActiveNode();if(o){var i="/cms/block-manager/edit-name-folder/"+o.data._id+"?"+(new Date).getTime(),r=t.open({animation:e.animationsEnabled,templateUrl:window.baseUrl+i,controller:"editNameFolderBlockCtrl",size:null,resolve:{}});r.result.then(function(t){o.setTitle(t.folder.name),o.setActive(),o.getParent().sortChildren(null,!0),e.tableParams.reload(),e.titleItemSelected=t.folder.name},function(){})}},e.showGroup=function(e,t){var n=($(".group-btn-ac").outerHeight(),$(window).outerWidth()),o=$(window).outerHeight(),i=e.pageY,r=o-i;300>r&&$(".wrap-ac-group").each(function(e){$(this).addClass("show-top")}),$(".wrap-ac-group").each(function(e){$(this).removeClass("ac-up")}),$(e.target).parent().toggleClass("ac-up"),$(".group-btn-ac").hasClass("fix-missing-li")?$(".group-btn-ac").css({top:e.pageY-65+"px",right:n-e.pageX-30+"px"}):$(".group-btn-ac").css({top:e.pageY-200+"px",right:n-e.pageX-30+"px"}),$(document).on("click",function a(e){$(e.target).closest("tr").siblings().find(".wrap-ac-group").removeClass("ac-up"),0===$(".wrap-ac-group").has(e.target).length?($(".wrap-ac-group").removeClass("ac-up"),$(".wrap-ac-group").removeClass("show-top")):$(document).one("click",a)}),angular.element(".table-responsive").addClass("fix-height")},e.addTagsForPage=function(t,n){$("#page-loading").css("display","block"),e.tagId=n,i.addTagsForPage(t,{tags:e.tagId}).then(function(t){for(var n in e.blocks)if(e.blocks[n].data._id==t.item._id){e.blocks[n].data.tags=t.item.tags;break}$("#page-loading").css("display","none"),e.tableParams.reload()})},e.getParentFolder=function(){var t=$("#tree").fancytree("getTree"),n=t.getActiveNode();n&&(0==n.folder||angular.isUndefined(n.folder)?(e.selectedItemName=n.getParent().title,e.selectedItemId=n.getParent().key):(e.selectedItemName=n.title,e.selectedItemId=n.key))};var d=!1;e.createFolderBlock=function(){if(!d){e.getParentFolder();var n="/cms/block-manager/create-folder?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName+"&&v="+(new Date).getTime(),o=t.open({templateUrl:window.baseUrl+n,controller:"ModalCreateFolderBlockCtrl",size:void 0,resolve:{}});d=!0,o.result.then(function(e){d=!1;var t=$("#tree").fancytree("getTree");if("0"==e.parent_id)var n=t.getNodeByKey("0");else var n=t.getNodeByKey(e.parent_id);window.folderType[e.key]=window.folderType[n.key];var o=n.addChildren(e);o.setExpanded(),n.sortChildren(null,!0)},function(){d=!1})}},e.getModalEditBlock=function(t){e.getParentFolder(),window.location.href=window.baseUrl+"/cms/block-manager/edit-block/"+t+"?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName+"&&v="+(new Date).getTime()},e.uploadNewBlock=function(){return e.getParentFolder(),angular.isUndefined(window.folderType[e.selectedItemId])?void(window.location.href=window.baseUrl+"/cms/block-manager/create-new-block?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName+"&&v="+(new Date).getTime()):void(-1!=window.folderType[e.selectedItemId].indexOf("managed_block")?window.location.href=window.baseUrl+"/cms/block-manager/create-new-block-manage?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName+"&&v="+(new Date).getTime():window.location.href=window.baseUrl+"/cms/block-manager/create-new-block?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName+"&&v="+(new Date).getTime())},e.getEditBlock=function(t){return e.getParentFolder(),angular.isUndefined(window.folderType[e.selectedItemId])?void(window.location=window.baseUrl+"/cms/block-manager/edit-block/"+t+"?v="+(new Date).getTime()):void(-1!=window.folderType[e.selectedItemId].indexOf("managed_block")?window.location=window.baseUrl+"/cms/block-manager/edit-block-manage/"+t+"?v="+(new Date).getTime():window.location=window.baseUrl+"/cms/block-manager/edit-block/"+t+"?v="+(new Date).getTime())}}]).controller("ModalCreateFolderBlockCtrl",["$scope","$modalInstance","BlockManagerService",function(e,t,n){e.blockFolder={},e.submit=function(o){return e.submitted=!0,e.nameExists=!1,o?!0:angular.isUndefined(e.blockFolder.parent_id)?!0:void n.createFolderProvider(e.blockFolder).then(function(n){return 0==n.status?(e.nameExists=!0,!0):(e.nameExists=!1,void t.close(n.item))})},e.cancel=function(){t.dismiss("cancel")}}]).controller("editNameFolderBlockCtrl",["$scope","$modalInstance","BlockManagerService","$http","$q",function(e,t,n,o,i){e.checkEmtypeName=function(n){if(""==n)return"The folder name is a required field";e.folder.name=n;var r=i.defer();return o.post("/api/block-manager/edit-name-folder/"+e.folder._id,e.folder).success(function(e){e=e||{},e.status?(r.resolve(),t.close(e)):r.resolve("Name has already been taken.")}).error(function(e){e.errors?r.resolve(e.errors[0]):r.reject("Server error!")}),r.promise}}]);var requestBlock=angular.module("BlockApp");requestBlock.controller("RequestBlockController",["$scope","$modal","ngTableParams","$filter","$timeout",function(e,t,n,o,r){e.getParentFolder=function(){var t=$("#tree").fancytree("getTree"),n=t.getActiveNode();n&&(0==n.folder||angular.isUndefined(n.folder)?(e.selectedItemName=n.getParent().title,e.selectedItemId=n.getParent().key):(e.selectedItemName=n.title,e.selectedItemId=n.key))};var a=!1;e.getModalRequestNewBlock=function(){if(!a){e.getParentFolder();var n=e.selectedItemId,o=t.open({animation:e.animationsEnabled,templateUrl:window.baseUrl+"/cms/block-manager/create?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName+"&&v="+(new Date).getTime(),controller:"ModalRequestBlockController",size:null,resolve:{folder_id:function(){return n}}});a=!0,o.result.then(function(e){a=!1,e.block.title=e.block.name,e.block.key=e.block._id,node=$("#tree").fancytree("getTree").getNodeByKey(e.block.folder_id),node.addChildren(e.block),node.setActive(!1),node.setActive(),node.sortChildren(null,!0)},function(){a=!1})}},e.getModalRequestTranslation=function(n){if(!a){e.getParentFolder();var o="/cms/block-manager/request-translation/"+n+"?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName+"&&v="+(new Date).getTime(),r=t.open({templateUrl:window.baseUrl+o,controller:"ModalRequestBlockController",size:void 0,resolve:{folder_id:function(){return null}}});a=!0,r.result.then(function(t){a=!1;for(i in t.blocks)node=$("#tree").fancytree("getTree").getNodeByKey(t.blocks[i].base_id),node.data.subBlocks.push(t.blocks[i]),"n/a"==node.data.language?node.data.language=1:node.data.language=parseInt(node.data.language)+1,"n/a"==node.data.due_date||"undefined"==typeof node.data.due_date?node.data.due_date=t.blocks[i].due_date:node.data.due_date>t.blocks[i].due_date&&(node.data.due_date=t.blocks[i].due_date),node.data.status="draft",e.tableParams.reload()},function(){a=!1})}},e.getModalRequestRegion=function(n){if(!a){e.getParentFolder();var o="/cms/block-manager/request-region/"+n+"?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName+"&&v="+(new Date).getTime(),r=t.open({templateUrl:window.baseUrl+o,controller:"ModalRequestBlockController",size:void 0,resolve:{folder_id:function(){return null}}});a=!0,r.result.then(function(t){a=!1;for(i in t.blocks)node=$("#tree").fancytree("getTree").getNodeByKey(t.blocks[i].base_id),node.data.region=t.countUniqueRegion,node.data.subBlocks.push(t.blocks[i]),"n/a"==node.data.due_date||"undefined"==typeof node.data.due_date?node.data.due_date=t.blocks[i].due_date:node.data.due_date>t.blocks[i].due_date&&(node.data.due_date=t.blocks[i].due_date),node.data.status="draft",e.tableParams.reload()},function(){a=!1})}}}]),requestBlock.controller("ModalRequestBlockController",["$scope","$modal","$filter","$modalInstance","folder_id","RequestBlockService","Upload","$timeout",function(e,t,n,o,i,r,a,l){e.languages_selected={},e.requiredLanguage=!0,e.requiredRegion=!0,e.regions_selected={},l(function(){e.block=angular.copy(window.block),e.folders=window.folders,"undefined"==typeof e.block.modal&&(e.block.folder_id="root"==i?"0":i)},500),e.format="MM-dd-yyyy",e.minDate=new Date,e.open=function(t,n){t.preventDefault(),t.stopPropagation(),e.opened={},e.opened[n]=!0},e.removeThumbnail=function(t){confirm("Do you want delete this image?")&&e.block.thumbnail.splice(t,1)},e.initRedactor=function(){$("#description").redactor({plugins:["table",1==window.isAdvancedEditingFeatures?"source":""],imageUpload:"/content/upload",callbacks:{modalOpened:function(e,t){if("link"!=e||this.observe.isCurrent("a")){if("link"==e){var n=this.link.$node.attr("rel");"undefined"==typeof n?$('<label><input type="checkbox" id="redactor-link-no-follow"> No Follow</label>').insertAfter($("#redactor-link-blank").parent()):$('<label><input type="checkbox" checked id="redactor-link-no-follow"> No Follow</label>').insertAfter($("#redactor-link-blank").parent())}}else $("#redactor-link-blank").attr("checked","true"),$('<label><input type="checkbox" checked id="redactor-link-no-follow"> No Follow</label>').insertAfter($("#redactor-link-blank").parent())},insertedLink:function(e){var t=$(e).attr("href");"http"!=t.substring(0,4)&&"https"!=t.substring(0,5)&&"ftp"!=t.substring(0,3)&&$(e).attr("href","http://"+t),$("#redactor-link-no-follow").prop("checked")?e.attr("rel","nofollow"):e.removeAttr("rel")},linkify:function(e){e.attr("target","_blank")},change:function(){$description=$("#description").redactor("code.get"),e.$apply(function(){"<div></div>"==$description||""==$description||"<br>"==$description||"<div><strong></strong></div>"==$description||"<div><em></em><strong></strong></div>"==$description||"<div><em><del></del></em></div>"==$description?e.requiredDescription=!0:e.requiredDescription=!1})}},linkSize:1e3,minHeight:200})},e.submit=function(t){return delete e.errors,e.requiredDescription=!1,e.submitted=!0,angular.isDefined(e.folderType)&&"managed_block"==e.folderType[e.block.folder_id]&&(e.block.type="managed_block"),$description=$("#description").redactor("code.get"),"<div></div>"!=$description&&""!=$description&&"<br>"!=$description&&"<div><strong></strong></div>"!=$description&&"<div><em></em><strong></strong></div>"!=$description&&"<div><em><del></del></em></div>"!=$description||(e.requiredDescription=!0),t||e.requiredDescription?($(".ng-invalid:eq(1)").focus(),!0):"undefined"==typeof e.block.folder_id&&"request_translation"!=e.block.modal&&"request_region"!=e.block.modal?!0:"request_translation"==e.block.modal&&e.requiredLanguage?($(".ng-invalid:eq(1)").focus(),!0):"request_region"==e.block.modal&&e.requiredRegion?($(".ng-invalid:eq(1)").focus(),!0):(files_id=[],"undefined"!=typeof e.filesUpload&&(files_id=e.filesUpload.ids),e.block.files_id=files_id,$("#btnSubmit").attr("disabled","true"),e.block.description=$description,e.block._id&&"request_translation"==e.block.modal&&(e.block.languages=e.languages_selected),e.block._id&&"request_region"==e.block.modal&&(e.block.contentId=e.block._id,e.block._id=e.block.base_id,e.block.regions=e.regions_selected),void r.requestBlock(e.block).then(function(t){if(0==t.status)$("#btnSubmit").removeAttr("disabled"),e.checkName=!0,t.errors?e.errors=t.errors:$(".name").focus();else{if("undefined"!=typeof e.block.thumbnail){var n="propose_new";"undefined"!=typeof e.block.modal&&(n=e.block.modal);for(var i=0;i<e.block.thumbnail.length;i++){var r=e.block.thumbnail[i];a.upload({url:window.baseUrl+"/api/block-manager/change-thumbnail",fields:{modal:n,data:t},file:r}).progress(function(e){}).success(function(e,t,n,o){!e.status})}}o.close(t)}}))},e.cancel=function(){o.dismiss("cancel")}}]);var blockApp=angular.module("BlockApp");blockApp.factory("RequestBlockResource",["$resource",function(e){return e("/api/block-manager/:method/:id",{method:"@method",id:"@id"},{add:{method:"post"},save:{method:"post"},update:{method:"put"}})}]),blockApp.service("RequestBlockService",["RequestBlockResource","$q",function(e,t){var n=this;this.requestBlock=function(o){if("undefined"!=typeof o._id&&"request_translation"==o.modal)return n.requestTranslation(o);if("undefined"!=typeof o._id&&"request_region"==o.modal)return n.requestRegion(o);var i=t.defer(),r=new e(o);return r.$save({},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.requestTranslation=function(n){var o=t.defer(),i=new e(n);return i.$save({method:"request-translation"},function(e){o.resolve(e)},function(e){o.resolve(e.data)}),o.promise},this.requestRegion=function(n){var o=t.defer(),i=new e(n);return i.$save({method:"request-region"},function(e){o.resolve(e)},function(e){o.resolve(e.data)}),o.promise},this.requestRevision=function(n){var o=t.defer(),i=new e(n);return i.$save({method:"request-revision"},function(e){0!=e.status&&o.resolve(e)},function(e){o.resolve(e.data)}),o.promise}}]);var blockApp=angular.module("BlockApp");blockApp.controller("EditBlockCtrl",["$scope","$modal","$timeout","Upload","$filter","ngTableParams","BlockManagerService","CmsService","$controller",function(e,t,n,o,i,r,a,l,s){e.blockContent=angular.copy(window.blockContent),e.baseUrl=window.baseUrl,e.usages=window.usages,null!=e.blockContent.content&&$('#mytab a[href="#content1"]').tab("show"),n(function(){$(document).ready(function(){e.setDIVHeight()}),$(window).resize(function(){e.setDIVHeight()})}),e.loadDataUsage=function(){e.tableParams=new r({page:1,count:50,sorting:{name:"desc"}},{total:e.usages.length,getData:function(t,n){var o=n.sorting()?i("orderBy")(e.usages,n.orderBy()):e.usages;o=n.filter()?i("filter")(o,n.filter()):o,n.total(o.length),t.resolve(o.slice((n.page()-1)*n.count(),n.page()*n.count()))}})},e.loadDataUsage(),e.clickable=function(e,t,n,o){switch(n){case"template":window.open(baseUrl+"/cms/template-content-manager/update-template/"+t,"_blank");break;case"page":window.open(baseUrl+"/cms/pages/edit-page/"+t,"_blank");break;case"block":window.open(baseUrl+"/cms/block-manager/edit-block/"+t,"_blank")}},e.setDIVHeight=function(){var e=$(".assets .fix-tab #code"),t=$(".assets .fix-tab #review"),n=$(".assets .fix-tab").offset(),o=n.top,i=screen.height,r=i-o-315;e.attr("style","height: "+r+"px!important;overflow:auto"),t.attr("style","height: "+r+"px!important;overflow:auto")},s("ConfigController",{$scope:e}),l.setFieldsContent(window.blockContent.fields),n(function(){e.editableCodeMirror=CodeMirror.fromTextArea(document.getElementById("editor"),{mode:"htmlmixed",theme:"night",styleActiveLine:!0,lineNumbers:!0,onChange:function(){}}),null==e.blockContent.content&&(e.blockContent.content=""),e.editableCodeMirror.setValue(e.blockContent.content),e.editableCodeMirror.on("change",function(){var t=e.editableCodeMirror.getValue();"<div></div>"==t||""==t||"<br>"==t||"<div><strong></strong></div>"==t||"<div><em></em><strong></strong></div>"==t||"<div><em><del></del></em></div>"==t?e.$apply(function(){e.requiredEditorContent=!0}):e.$apply(function(){e.requiredEditorContent=!1})})},700),e.showValueContent=function(){n(function(){e.editableCodeMirror.refresh()},200)},e.format="MM-dd-yyyy",e.minDate=new Date,e.submitted=!1,e.showField=!1,e.showLoad=!1;e.open=function(t,n){t.preventDefault(),t.stopPropagation(),e.opened={},e.opened[n]=!0},e.callModalInsert=function(o,i,r,a,l){var s="/cms/block-manager/insert?language="+i+"&&region="+r+"&&type="+o+"&&notShowFieldBlock="+a+"&&id="+l,d=t.open({templateUrl:window.baseUrl+s,controller:"ModalInsertCms",size:void 0,resolve:{blockId:function(){},language:function(){return i},region:function(){return r},listField:function(){}}});d.result.then(function(t){n(function(){e.editableCodeMirror.replaceSelection(t)})})},CodeMirror.markClean=function(){alert("Content Changed")},e.isShowCode=!0,e.showCodeBlock=function(){e.isShowCode=!0,e.isShowReView=!1},e.reViewBlock=function(){angular.element("#page-loading").css("display","block");var t;t="undefined"==typeof e.blockContent.type?"html":e.blockContent.type,data={content:JSON.stringify(e.editableCodeMirror.getValue()),type:t,language:e.blockContent.language,region:e.blockContent.region},a.reviewContentBlock(data).then(function(t){t.status&&e.refreshIframe()})},e.iframeLoaded=function(){e.isShowCode=!1,e.isShowReView=!0},e.refreshIframe=function(){a.getContentForIframe().then(function(t){e.iframeLoaded(),$("#frameBlock").contents().find("body").html(t.content),angular.element("#page-loading").css("display","none")})},e.removeThumbnail=function(t){confirm("Do you want delete this image?")&&(e.blockContent.thumbnail=null)},e.removeAddThumbnail=function(t){confirm("Do you want delete this image?")&&delete e.blockContent.addThumbnail},e.parseBlockontent=function(t){l.setFieldsOld(),e.errorContentTemplate="",e.blockContent.content=e.editableCodeMirror.getValue(),e.requiredEditorContent=!1,e.submitted=!0;var o=e.editableCodeMirror.getValue(),o=e.editableCodeMirror.getValue();return t?($(".ng-invalid:eq(1)").focus(),void $('#mytab a[href="#detail"]').tab("show")):"<div></div>"==o||""==o||"<br>"==o||"<div><strong></strong></div>"==o||"<div><em></em><strong></strong></div>"==o||"<div><em><del></del></em></div>"==o?(e.requiredEditorContent=!0,$('#mytab a[href="#content1"]').tab("show"),n(function(){e.editableCodeMirror.refresh()},200),void(e.saving=!1)):e.requiredEditorContent?void $('#mytab a[href="#content1"]').tab("show"):void a.parseContentConfigBlock({content:e.blockContent.content,type:"block"}).then(function(t){if(e.blockContent.injects=t.blocks,e.blockContent.links=t.links,e.blockContent.assets=t.assets,t.status){var n=l.getFieldsNew(t.fields);n.length>0?e.configFields(function(t){"undefined"!=typeof t&&(dataFields=l.mapDataFields(t),e.getModalShowListConfigFields(function(t){"undefined"!=typeof t&&(e.blockContent.fields=dataFields,d(e.blockContent))},dataFields))},n):(dataFields=l.mapDataFields([]),dataFields.length>0?e.getModalShowListConfigFields(function(t){"undefined"!=typeof t&&(e.blockContent.fields=dataFields,d(e.blockContent))},dataFields):(e.blockContent.fields=dataFields,d(e.blockContent)))}else e.errorContentTemplate=t.message})};var d=function(){angular.element("#page-loading").css("display","block"),e.saving=!0,delete e.errors,a.editBlock(e.blockContent).then(function(t){if(t.status)if(angular.isDefined(e.blockContent.addThumbnail))for(var n="propose_new",i=0;i<e.blockContent.addThumbnail.length;i++){var r=e.blockContent.addThumbnail[i];o.upload({url:window.baseUrl+"/api/block-manager/update-thumbnail",fields:{modal:n,data:t},file:r}).progress(function(e){}).success(function(t,n,o,i){return t.status?void(window.location=window.baseUrl+"/cms/block-manager/set-block-selected/"+e.blockContent.folder_id):void(e.saving=!1)})}else window.location=window.baseUrl+"/cms/block-manager/set-block-selected/"+e.blockContent.folder_id;else e.saving=!1,t.errors&&(e.errors=t.errors),angular.element("#page-loading").css("display","none")})};e.cancel=function(){window.location.href=window.baseUrl+"/cms/block-manager"}}]);var cmsApp=angular.module("cmsContentFolderApp");cmsApp.service("CmsContentFolderService",["$q",function(e){var t,n=this,o=[],i=!1,r="",a="",l="";this.changeStatusHideOrShowAllNestedContent=function(){o=[],i=!i,0==i?(t.isFolder()?this.showFirstLevelOfChildPages(t.children):o.push(t),r="Show All Nested Content"):(t.isFolder()?this.showAllLevelOfChildPages(t.children):o.push(t),r="Hide All Nested Content");var n={textButton:r,contents:o,nodeActive:t},a=e.defer();return a.resolve(n),a.promise},this.getDataNestedFromActiveNode=function(){return o=[],t.isFolder()?this.showAllLevelOfChildPages(t.children):(t.openChild=!0,o.push(t)),o},this.getDataFromActiveNode=function(e){var n=["blocks","assets","templates"];if(!(n.indexOf(t.data.type)>-1)){if(o=[],t.isFolder()){e&&0!=t.data.parent_id&&o.push(t);for(var i in t.children)o.push(t.children[i])}else t.openChild=!0,o.push(t);return o}},this.reloadTree=function(){var e=$("#tree").fancytree("getTree");e.reload()},this.initTree=function(e){i=!1,$("#tree").fancytree({extensions:["glyph"],source:o,autoScroll:!0,activate:function(r,l){var s=$("#tree").fancytree("getTree"),d=$("#tree").fancytree("getActiveNode");d.sortChildren(null,!0),t=s.getNodeByKey(String(a)),null!=t?(t.setActive(),a=""):t=d,n.expandAllChildNodes(t);var c=t.getChildren();o=[],t.isFolder()&&!angular.isUndefined(t.folder)||o.push(t),0==i?n.showFirstLevelOfChildPages(c):n.showAllLevelOfChildPages(c);var u=e.call(u,o,t)},click:function(e,t){var n=t.node;if(!n.isExpanded()&&angular.isDefined(n.data.type))switch(n.data.type){case"assets":n.data.type!=l&&$("#page-loading").css("display","block"),$("#click-asset").click();break;case"templates":n.data.type!=l&&$("#page-loading").css("display","block"),$("#click-template").click();break;case"pages":n.data.type!=l&&$("#page-loading").css("display","block"),$("#click-page").click();break;case"blocks":n.data.type!=l&&$("#page-loading").css("display","block"),$("#click-block").click();break;case"database":n.data.type!=l&&$("#page-loading").css("display","block"),$("#click-database").click();break;case"accessories":1!=n.isActive()&&$("#page-loading").css("display","block");break;case"lasers":1!=n.isActive()&&$("#page-loading").css("display","block");break;case"material":1!=n.isActive()&&$("#page-loading").css("display","block");break;case"platform":1!=n.isActive()&&$("#page-loading").css("display","block");break;case"product":1!=n.isActive()&&$("#page-loading").css("display","block")}}}),n.expandedRootNode()},this.expandAllChildNodes=function(e){"0"!=e.data.parent_id&&(e.setExpanded(!0),e.visit(function(e){e.setExpanded(!0)}))},this.cosllapseAllNodeNotActive=function(){},this.showFirstLevelOfChildPages=function(e){null==e||"Loading..."==e[0].title?e=[]:angular.forEach(e,function(e,t){e.isFolder()||o.push(e)})},this.showAllLevelOfChildPages=function(e){null==e||"Loading..."==e[0].title?e=[]:angular.forEach(e,function(e,t){e.hasChildren()?n.showAllLevelOfChildPages(e.children):e.isFolder()||o.push(e)})},this.expandedRootNode=function(){var e=$("#tree").fancytree("getTree"),t=e.getRootNode().children;for(var n in t)if(t[n].data.type==l)var o=n;var i=e.getRootNode().children[o];angular.isDefined(i)&&i.setActive(),i.hasChildren()&&i.setExpanded()},this.setActiveNode=function(e){a=e},this.setContents=function(e,t){return l=t,o=e},this.getContents=function(){return o}}]);var fileModule=angular.module("file");fileModule.factory("FileResource",["$resource",function(e){return e("/admin/document-manager/:method/:id",{},{add:{method:"post"},save:{method:"post"},update:{method:"put"}})}]).factory("shareDataFactory",["$rootScope",function(e){var t={};return t.data="",t.prepForBroadcase=function(e,t){this.data=e,this.broadcastItem(t)},t.broadcastItem=function(t){e.$broadcast(t)},t}]).service("FileService",["$q","$filter","FileResource",function(e,t,n){var o=[],i=[],r=[],a=[],l=[],s=[],d=[];this.create=function(t){var o=e.defer(),i=new n(t);return i.$save({},function(e){e.status?o.resolve(e):o.resolve(null)},function(e){o.resolve(null)}),o.promise},this.fileShare=function(t){var o=e.defer(),i=new n(t);return i.$save({id:t.fileId,method:"file-share"},function(e){o.resolve(e)},function(e){o.resolve(null)}),o.promise},this.deleteFileUserShare=function(t){var o=t.folder_id;"undefined"!=typeof t.file_id&&(o=t.file_id);var i=e.defer();return n["delete"]({id:o,method:"delete-file-user-share",userShareId:t.user_id,group:t.group},function(e){i.resolve(e)}),i.promise},this.getChildFolders=function(t){var o=e.defer();return n.query({id:t,method:"get-child-folders"},function(e){o.resolve(e)}),o.promise},this.getFilesFolder=function(){return i},this.getFiles=function(){return o},this.update=function(t){var o=e.defer(),i=new n(t);return i.$save({id:t._id},function(e){e.status?o.resolve(e):o.resolve(null)},function(e){o.resolve(null)}),o.promise},this.get=function(t,o){var i=e.defer();return n.get({id:t,prefix:o},function(e){i.resolve(e)}),i.promise},this.getAllOfUser=function(t){var o=e.defer();return n.query({created_at:t,method:"file-all"},function(e){for(var t in e)a[e[t].id]=e[t];o.resolve(e)}),o.promise},this.pushFilesOfUser=function(e){filesFormat=[];for(var t in e)a.push(e[t]);return a},this.getFilesOfUser=function(){return a},this.query=function(){var t=e.defer();return o&&o.length?t.resolve(o):n.query().$promise.then(function(e){o=e,t.resolve(o)}),t.promise},this.remove=function(t){var i=e.defer();new n(t);return n["delete"]({id:t},function(e){if(e.status){for(var n in d)if(d[n].id==t){d.splice(n,1);break}for(var n in o)if(o[n].id==t){o.splice(n,1);break}}i.resolve(e)}),i.promise},this.visibleFolder=function(t){var i=e.defer(),r=new n(t);return r.$save({id:t,method:"visible-folder"},function(e){if(e.status){for(var n in d)if(d[n].id==t){d[n].visible=e.visible;break}for(var n in o)if(o[n].id==t){o.splice(n,1);break}}i.resolve(e)}),i.promise},this.deleteFolder=function(t){var o=e.defer();return n["delete"]({id:t,method:"delete-folder"},function(e){if(e)for(var n in d)if(d[n].id==t){d.splice(n,1);break}o.resolve(e)}),o.promise},this.setFiles=function(e){o=e},this.pushFiles=function(e){o.push(e)},this.setFilesCurrentFolder=function(e){d=e},this.getFilesCurrentFolder=function(e){return d},this.pushFile=function(e){l=[],l.push(e),o.push(e)},this.pushFileFoler=function(e){i=[],l=[];for(var t in o)i[t]=o[t];i.push(e),l.push(e),o=i},this.getFileUpload=function(){return l},this.editFile=function(e){r=e},this.getDataFileEdit=function(){return r},this.getData=function(){return o},this.addFolder=function(t){var o=e.defer(),i=new n(t);return i.$save({method:"add-folder"},function(e){o.resolve(e)},function(e){o.resolve(null)}),o.promise},this.checkFile=function(e){var t=["png","gif","jpg","jpeg"];if("undefined"!=typeof e){if(-1!=t.indexOf(e.split("/")[1]))return"image";switch(e.split("/")[1]){case"zip":return"zip";case"pdf":return"pdf";case"msword":return"msword";default:return"other"}}},this.formatFilesWitFolderId=function(){var e=[];for(var t in o)angular.isArray(e[o[t].folder_id])||(e[o[t].folder_id]=[]),e[o[t].folder_id].push(o[t]);s=e},this.getFileFolderMap=function(){return s},this.filesMap=function(e){var t=[];for(var n in e)t[e[n].id]=e[n];return t},this.download=function(t){var o=e.defer(),i=new n;return i.$get({id:t,method:"download"},function(e){o.resolve(e)},function(e){o.resolve(null)}),o.promise},this.editFileName=function(t){var i=e.defer(),r=new n(t);return r.$update({id:t.id,method:"edit-file-name"},function(e){for(var t in o)if(o[t].id==e.id&&o[t].group==e.group){o[t]=e;break}if(e.folder_id>0||e.parent_id>0)for(var t in d)if(d[t].id==e.id){d[t]=e;break}i.resolve(e)},function(e){i.resolve(null)}),i.promise}}]);var fileUpload=angular.module("uls");fileUpload.directive("fileUpload",["FileService","Upload","$timeout",function(e,t,n){return{restrict:"EA",require:"^ngModel",scope:{files:"=",fileIds:"=",openPicture:"&",disabled:"=",control:"="},replace:!0,transclude:!0,templateUrl:baseUrl+"/app/shared/file-upload/views/file-upload.html?v=1",link:function(o,i,r,a){function l(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}var s=0;o.baseUrl=baseUrl,o.fileUpload={},o.fileUploaded=[],o.fileUploadIds=[],o.fileError={},o.uploadFinish=!0,a.$setViewValue({finished:o.uploadFinish}),o.numberFileUpload=[],o.upload=function(e){if(e&&e.length){s++,angular.isUndefined(o.numberFileUpload[s])&&(o.numberFileUpload[s]=[]);for(var i=0;i<e.length;i++)a.$setViewValue({finished:!1}),function(i){a.$setViewValue({finished:!1});var r=e[i];return angular.isDefined(window.maxUpload)&&r.size>window.maxUpload.size?(r.uniId=l(),r.proccess=100,r.error=1,r.status=0,o.fileUpload[r.uniId]=r,o.fileUpload[r.uniId].error="Max file size is "+window.maxUpload.name,o.fileError[r.uniId]=r,void a.$setViewValue({finished:!0})):(r.uniId=l(),r.proccess=0,r.error="",o.fileUpload[r.uniId]=r,void t.upload({url:baseUrl+"/support/file",file:r}).progress(function(e){if(a.$setViewValue({finished:!1}),angular.isDefined(o.fileUpload[r.uniId]))var t=parseInt(100*e.loaded/e.total);else{var t=100;o.uploadFinished=!0,a.$setViewValue({finished:o.uploadFinished})}angular.isDefined(o.fileUpload[r.uniId])&&(o.fileUpload[r.uniId].proccess=t,o.uploadFinished=!1,a.$setViewValue({finished:o.uploadFinished}))}).error(function(t,n,a,l){e.splice(1,i),angular.isDefined(o.fileUpload[r.uniId])&&(angular.isDefined(t.message)&&(o.fileUpload[r.uniId].error=t.message),o.fileError[l.file.uniId]=t)}).success(function(e,t,n,i){o.uploadFinished=!0,a.$setViewValue({finished:o.uploadFinished}),angular.isDefined(o.fileUpload[i.file.uniId])&&(e.item.uniId=i.file.uniId,o.fileUploaded.push(e.item),o.fileUploadIds.push(e.item.id))})["finally"](function(){o.uploadFinished=!0,n(function(){a.$setViewValue({ids:o.fileUploadIds,files:o.fileUploaded,finished:o.uploadFinished})})}))}(i)}},a.$render=function(){n(function(){o.filesUpload=a.$viewValue})},o.checkFile=function(t){return e.checkFile(t)},o.internalControl=o.control||{},o.internalControl.deleteAllFileUploaded=function(){delete o.fileUpload,o.fileUpload={},o.uploadFinished=!0,a.$setViewValue({ids:o.fileUploadIds,files:o.fileUploaded,finished:o.uploadFinished})},o.deleteFile=function(e){delete o.fileUpload[e];for(var t in o.fileUploaded)if(e==o.fileUploaded[t].uniId){var i=o.fileUploadIds.indexOf(o.fileUploaded[t].id);delete o.fileUploaded[t],o.fileUploadIds.splice(i,1)}o.uploadFinished=!0,n(function(){a.$setViewValue({ids:o.fileUploadIds,files:o.fileUploaded,finished:o.uploadFinished})})},o.$on("emptyFiles",function(e,t){o.fileUpload={},o.fileUploaded=[],o.fileUploadIds=[]})}}}]).filter("bytes",function(){return function(e,t){if(isNaN(parseFloat(e))||!isFinite(e))return"-";"undefined"==typeof t&&(t=1);var n=["bytes","kB","MB","GB","TB","PB"],o=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,Math.floor(o))).toFixed(t)+" "+n[o]}}),requestBlock.directive("multiSelectBlock",["$timeout",function(e){return{restrict:"EA",scope:{items:"=",itemsAssigned:"=",requiredItem:"=",placeholder:"@"},templateUrl:"/app/components/blocks/views/view.html?v=2",link:function(e,t,n){e.assignItem=function(){if(e.test={},"undefined"!=e.selectedItemFrom){for(var t in e.selectedItemFrom){var n=e.selectedItemFrom[t];e.itemsAssigned[n]=e.items[n],delete e.items[n]}(1==e.requiredItem||angular.isUndefined(e.requiredItem))&&(angular.equals(e.itemsAssigned,e.test)||(e.requiredItem=!1)),e.selectedItemFrom=[]}},e.undoItem=function(){if(angular.isArray(e.items)&&(e.items={}),angular.isDefined(e.selectedItemTo)){if(0==e.selectedItemTo.length)return;for(var t in e.selectedItemTo){var n=e.selectedItemTo[t];e.items[n]=e.itemsAssigned[n],delete e.itemsAssigned[n]}(0==e.requiredItem||angular.isUndefined(e.requiredItem))&&angular.equals(e.itemsAssigned,e.test)&&(e.requiredItem=!0),
e.selectedItemTo=[]}}}}}]),requestBlock.directive("codeMirror",function(){return{restrict:"A",link:function(e,t,n){CodeMirror.fromTextArea(document.getElementById("code"),{lineNumbers:!0,theme:"night",extraKeys:{F11:function(e){e.setOption("fullScreen",!e.getOption("fullScreen"))},Esc:function(e){e.getOption("fullScreen")&&e.setOption("fullScreen",!1)}}})}}});var selectLevel=angular.module("selectLevel",[]),version=5;selectLevel.directive("selectLevel",["$timeout","$filter",function(e,t){return{require:"?ngModel",restrict:"EA",scope:{items:"=",text:"@",title:"@",textFilter:"@",index:"=",key:"=",itemChoose:"=",selectedItems:"=selectedItem",onClick:"&",currentPage:"=",showIcon:"=",typeSelect:"=",disableClick:"=",notSelectCurrent:"=",chageType:"=",type:"=",canChooseFolder:"="},replace:!0,templateUrl:baseUrl+"/app/shared/select-level/view.html?v="+(new Date).getTime(),link:function(n,o,i,r){function a(e){var t={};return angular.forEach(e,function(e,n){t[e]=n}),t}n.currentIndex={value:0},"Asset"==n.type&&(n.items=window.assets),n.$watch("selectedItems",function(t,o){angular.isDefined(t)&&null!=t&&e(function(){var e={_id:t.selectedItemId,name:t.selectedItemName,parentIds:t.parentIds};n.selectedItem(e)})});var l="";"undefined"==typeof n.index&&(n.index=0),"undefined"==typeof n.key&&(n.key=0),e(function(){$(document).on("click",function(e){$("#select-level-modal-"+n.key+"-"+n.index).hasClass("in")&&!$(".js-filterable-field").is(":focus")&&($("#select-level-modal-"+n.key+"-"+n.index).collapse("hide"),$(".show-sub-select i").removeClass("fa fa-folder-open fa").addClass("fa fa-folder"))}),$("#select-level li:has(ul)").children("ul").addClass("off"),$("#select-level li a i").addClass("fa fa-folder"),n.listsId=[],n.showSubSelect=function(e,t){e.preventDefault(),$(e.currentTarget).parent().find("ul:first").toggleClass("off"),$(e.currentTarget).find("i").addClass("fa fa-folder"),$(e.currentTarget).find("i").toggleClass("fa fa-folder-open fa"),e.stopPropagation()},"undefined"!=typeof n.itemChoose&&d(n.items)}),n.focusInput=function(e){e.stopPropagation()};var s=0;n.selectedItem=function(e,o){""!=e._id&&"Assets"==n.typeSelect&&2>=s&&(1==Object.keys(e.parentIds).length?angular.forEach(n.items,function(t,o){t._id==e._id&&(n.items=[],n.items.push(t))}):angular.forEach(n.items,function(t,o){t._id==e.parentIds[Object.keys(e.parentIds).length-1]&&(n.items=[],n.items.push(t))})),s+=1,angular.isDefined(n.currentPage)&&angular.isDefined(e)&&e._id==n.currentPage._id||(angular.isDefined(o)&&o.preventDefault(),(angular.isDefined(e.parentIds)||angular.isDefined(e.parentId)||angular.isDefined(e.parent_id))&&""!=e.name?n.text=e.name:n.text=t("trans")("select-folder","directive-select-level"),r.$setViewValue(e._id),n.chageType&&n.onClick({pageId:e._id}),$("#select-level-modal-"+n.key+"-"+n.index).find(".name-select.active").removeClass("active"),l=e,$("#select-level-modal-"+n.key+"-"+n.index).find(".item-"+l._id).addClass("active"),angular.isDefined(o)&&$("#select-level-modal-"+n.key+"-"+n.index).collapse("hide"))},n.toggleSelectMenu=function(t){e(function(){n.itemsTmp=n.items}),"disabled"!=n.disableClick&&e(function(){if($(".show-sub-select").removeClass("active"),$("#select-level li a i").removeClass("fa fa-folder-open fa").addClass("fa fa-folder"),$(".parrent-select").addClass("off"),l)if(angular.forEach($(".item-"+l._id).parents("ul"),function(e,t){$(e).removeClass("off")}),$(".show-sub-select-"+l._id).addClass("active"),"Link"==n.type){var e=a(window.listsIdsMapPageAndContent);angular.forEach(l.parentIds,function(t,n){$(".show-sub-select-"+e[t]).find("i").removeClass("fa fa-folder").addClass("fa fa-folder-open fa")})}else angular.forEach(l.parentIds,function(e,t){l._id!=e&&$(".show-sub-select-"+e).find("i").removeClass("fa fa-folder").addClass("fa fa-folder-open fa")});$("#select-level-modal-"+n.key+"-"+n.index).collapse("toggle")})},n.closed=function(e){$("#select-level-modal-"+n.key+"-"+n.index).collapse("hide")};var d=function(e){for(var t in e)if(e[t].subFolder&&d(e[t].subFolder),e[t]._id==n.itemChoose){n.text=e[t].name;break}}}}}]);