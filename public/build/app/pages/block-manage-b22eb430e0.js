function humanized_time_span(e,t,i,n){function a(){for(var e=0;e<i[d].length;e++)if(null==i[d][e].ceiling||s<=i[d][e].ceiling)return i[d][e];return null}function l(){for(var e=s,t={},i=0;i<n.length;i++){var a=Math.floor(e/n[i][0]);e-=n[i][0]*a,t[n[i][1]]=a}return t}function r(e){var t=l(),i=e.text.replace(/\$(\w+)/g,function(){return t[arguments[1]]});return o(i,t)}function o(e,t){for(var i in t)if(1==t[i]){var n=new RegExp("\\b"+i+"\\b");e=e.replace(n,function(){return arguments[0].replace(/s\b/g,"")})}return e}if(i=i||{past:[{ceiling:60,text:"$seconds seconds ago"},{ceiling:3600,text:"$minutes minutes ago"},{ceiling:86400,text:"$hours hours ago"},{ceiling:2629744,text:"$days days ago"},{ceiling:31556926,text:"$months months ago"},{ceiling:null,text:"$years years ago"}],future:[{ceiling:60,text:"in $seconds seconds"},{ceiling:3600,text:"in $minutes minutes"},{ceiling:86400,text:"in $hours hours"},{ceiling:2629744,text:"in $days days"},{ceiling:31556926,text:"in $months months"},{ceiling:null,text:"in $years years"}]},n=n||[[31556926,"years"],[2629744,"months"],[86400,"days"],[3600,"hours"],[60,"minutes"],[1,"seconds"]],"Invalid Date"==new Date(e))for(;-1!=String(e).indexOf("-");)e=e.replace("-","/");e=new Date(e),t=t?new Date(t):new Date;var s=(t-e)/1e3,d="past";return 0>s&&(d="future",s=0-s),r(a())}angular.module("user",[]),angular.module("permission",[]),angular.module("role",[]),angular.module("multiSelect",[]),angular.module("ticket",[]),angular.module("type",[]),angular.module("dataOption",[]),angular.module("nlcFilter",[]),angular.module("file",[]),angular.module("AppLanguage",[]),angular.module("TemplateManagerApp",[]),angular.module("RegionApp",[]),angular.module("campaignApp",[]),angular.module("campaignDetailApp",[]),angular.module("MarketsegmentApp",[]),angular.module("notification",[]),angular.module("transApp",[]),angular.module("assetManager",[]),angular.module("BlockApp",[]),angular.module("ChannelPartnersApp",[]),angular.module("roleGroup1",[]),angular.module("filedType",[]),angular.module("filed",[]),angular.module("term",[]),angular.module("customFormatDate",[]),angular.module("SeoAnalysisApp",[]),angular.module("pageApp",[]),angular.module("treeresizer",[]),angular.module("CreatePageApp",[]),angular.module("EditDraftApp",[]),angular.module("fomatHtml",[]),angular.module("colorpicker.module",[]),angular.module("formBuilderDirectiveApp",[]),angular.module("appManageTerm",[]),angular.module("TermTemplateManagerApp",[]),angular.module("configurator",[]),angular.module("TemplateContentManager",[]),angular.module("cmsContentFolderApp",[]),angular.module("lowercaseCharater",[]),angular.module("selectLevel",[]),angular.module("modalSelectLevel",[]),angular.module("configField",[]),angular.module("cmsContentInsertApp",[]),angular.module("confirmDirective",[]),angular.module("CmsApp",[]),angular.module("checkLimitAndChangeDateTimeDirectiveApp",[]),angular.module("tagContentApp",[]),angular.module("tagContentDirective",[]),angular.module("cmsContentTagApp",[]),angular.module("viewDraft",[]),angular.module("databaseManager",[]),angular.module("selectLevelDatabase",[]),angular.module("modalSelectPage",[]),angular.module("configFormDatabaseApp",[]),angular.module("historyApp",[]),angular.module("BlockNestedApp",[]),angular.module("selectLevelAsset",[]),angular.module("MaterialApp",[]),angular.module("draganddrop",[]),angular.module("activityLog",[]),angular.module("translation",[]),angular.module("HelpEditorApp",[]),angular.module("helpEditorDirective",[]),angular.module("selectLevelHelp",[]),angular.module("cache",[]),angular.module("file",[]),angular.module("treeresize",[]),angular.module("test",[]),angular.module("guide",[]),angular.module("PlatformsApp",[]),angular.module("accessories",[]);var defaultModules=["ui.bootstrap","ngResource","ngCookies","ngFileUpload","ngRoute","toggle-switch","ngImgCrop","ngTable","user","role","permission","multiSelect","ticket","type","dataOption","nlcFilter","file","xeditable","timer","AppLanguage","TemplateManagerApp","RegionApp","campaignApp","campaignDetailApp","MarketsegmentApp","notification","transApp","assetManager","BlockApp","ChannelPartnersApp","roleGroup1","filedType","filed","term","ui-iconpicker","customFormatDate","SeoAnalysisApp","pageApp","treeresizer","CreatePageApp","EditDraftApp","fomatHtml","colorpicker.module","formBuilderDirectiveApp","appManageTerm","TermTemplateManagerApp","mgo-angular-wizard","configurator","TemplateContentManager","cmsContentFolderApp","lowercaseCharater","selectLevel","configField","cmsContentInsertApp","confirmDirective","CmsApp","checkLimitAndChangeDateTimeDirectiveApp","tagContentApp","tagContentDirective","cmsContentTagApp","viewDraft","modalSelectLevel","databaseManager","selectLevelDatabase","modalSelectPage","configFormDatabaseApp","historyApp","BlockNestedApp","selectLevelAsset","MaterialApp","ui.sortable","activityLog","translation","HelpEditorApp","helpEditorDirective","selectLevelHelp","cache","file","treeresize","guide","PlatformsApp","accessories"];"undefined"!=typeof modules&&(defaultModules=defaultModules.concat(modules));var myApp=angular.module("uls",defaultModules);angular.module("uls").run(["editableOptions",function(e){e.theme="bs3"}]),angular.module("uls").config(["$logProvider",function(e){e.debugEnabled(window.debug)}]),"undefined"!=typeof angularMock&&(defaultModules=defaultModules.concat(angularMock));var goTo=function(e){window.location.href="#_"+e,$("#fix-modal-top").scrollTop(0),$("#"+e).hasClass("in")||$("#"+e).prev().trigger("click")};myApp.config(["$httpProvider",function(e){e.interceptors.push(["$q",function(e){e.defer();return{responseError:function(t){var i=angular.element(".butterbar-container");switch(t.status){case 401:return void(window.location.href=window.baseUrl);case 404:i.hasClass("hidden")&&i.removeClass("hidden");break;case 500:i.hasClass("hidden")&&i.removeClass("hidden")}return e.reject(t)}}}])}]),function(e){function t(){var t=window.innerHeight;screen.height;e(".table-responsive.set-height, .table-responsive#tb-group-user").css({height:t-170+"px"}),e(".table-animate").css({height:t-170+"px"}),e("#search-page,.box-maps").css({height:t-105+"px"}),e(".box-list-rep").css({height:t-100+"px"}),e("#load-maps").css({height:t-185+"px"})}e(document).ready(t),e(window).resize(t),e(document).ready(function(){e(".dropdown-menu table tr td button").removeAttr("style")}),e(document).ready(function(){setTimeout(function(){var t=e("#frame_html").contents().find("head");t.append('<style type="text/css">.area_toolbar{background-color:#f1f1f1;}#editor{border:solid #ccc 1px}#result{border-top:solid #ccc 1px;border-bottom: solid #ccc 1px}.editarea_popup{box-shadow: 0px 4px 36px rgba(177, 177, 177, 0.75);border: solid 1px #CCCCCC;background-color: #FFFFFF;}.area_toolbar select{font-size:9pt;background-color:#fff}</style>')},1e3)}),e(window).load(function(){e(".step3 .show-more").click(function(){e(".step3 .wrap-more-product").toggleClass("show")})}),e(document).ready(function(){e(".nav-icon").click(function(){e(this).toggleClass("open"),e("#pagehome").toggleClass("on-off")})});var i,n,a,l,r,o,s;e(".next").click(function(){return s?!1:(s=!0,i=e(this).parent(),n=e(this).parent().next(),n.show(),void i.animate({opacity:0},{step:function(e,t){o=1-.2*(1-e),l=50*e+"%",r=1-e,i.css({transform:"scale("+o+")"}),n.css({left:l,opacity:r})},duration:800,complete:function(){i.hide(),s=!1},easing:"easeInOutBack"}))}),e(".previous").click(function(){return s?!1:(s=!0,i=e(this).parent(),a=e(this).parent().prev(),a.show(),void i.animate({opacity:0},{step:function(e,t){o=.8+.2*(1-e),l=50*(1-e)+"%",r=1-e,i.css({left:l}),a.css({transform:"scale("+o+")",opacity:r})},duration:800,complete:function(){i.hide(),s=!1},easing:"easeInOutBack"}))}),e(".submit").click(function(){return!1})}(jQuery),angular.module("uls").controller("BaseController",["$scope","$parse","$timeout","$modal","UserService","AssetManagerService",function(e,t,i,n,a,l){if(angular.element(".wrapper").removeClass("hidden"),a.setData(window.usersMap),i(function(){"undefined"!=typeof e.callbackLoadUserFinish&&(e.callbackLoadUserFinish(),e.users_map=a.getUsersMap())}),e.testFuture=window.testFuture,1==e.testFuture&&angular.element(".test").removeClass("hidden"),e.windowType=window.info,"undefined"!=typeof window.info)for(var r in window.info){var o=t(r);o.assign(e,window.info[r])}e.initDate=function(){angular.element(".date").bdatepicker({format:"yyyy-mm-dd"})},e.viewModalImage=function(e){var t=n.open({templateUrl:baseUrl+"/app/components/termTemplateManager/views/modal/viewImage.html",controller:"ModalViewPictureCtrl",size:void 0,windowClass:"show-img",resolve:{fileId:function(){return e}}});t.result.then(function(e){},function(){})},e.urlForm=[],e.getUrlImageAssetForm=function(t,i){"undefined"==typeof e.urlForm[t]&&(e.urlForm[t]=[]),l.getUrlImageAsset(t).then(function(n){e.urlForm[t][i]=n.url})},e.removeThumbnailAssertForm=function(t,i){e.urlForm[t][i]=""},e.initTooltip=function(e){$('[data-toggle="tooltip"]').tooltip()}}]).controller("ModalViewPictureCtrl",["$scope","$modalInstance","fileId",function(e,t,i){e.fileId=i,e.baseUrl=baseUrl,e.cancel=function(){t.dismiss("cancel")}}]);var userModule=angular.module("user");userModule.factory("UserResource",["$resource",function(e){return e("/api/user/:method/:id",{method:"@method",id:"@id"},{add:{method:"post"},save:{method:"post"},update:{method:"put"}})}]).factory("UserService",["$q","$filter","UserResource",function(e,t,i){var n=[],a=[],l=[],r=this,o={},s={};return this.setHashData=function(e){o=e},this.create=function(t){if("undefined"!=typeof t.id)return r.update(t);var a=e.defer(),l=new i(t);return l.$save({},function(e){e.status&&e.item&&(n.push(e.item),"undefined"==typeof e.item.last_login&&(e.item.last_login="0000-00-00 00:00:00")),a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.changePassword=function(t){var n=e.defer(),a=new i(t);return a.$save({method:"change-password",id:t.id},function(e){e.status?n.resolve(e):n.reject(e)},function(e){n.reject(e.data)}),n.promise},this.changeRoles=function(t){var n=e.defer(),a=new i(t);return a.$save({method:"change-roles"},function(e){e?n.resolve(e):n.reject(e)},function(e){n.reject(e.data)}),n.promise},this.update=function(t){var a=e.defer(),l=new i(t);return l.$update({id:t.id},function(e){if(e.status)for(var t in n)if(n[t].id==e.item.id){n[t]=e.item;break}a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.get=function(t){var n=e.defer();return i.get({id:t},function(e){n.resolve(e)}),n.promise},this.query=function(){var t=e.defer();return i.query(function(e){n=e,t.resolve(e)}),t.promise},this.queryUsersManager=function(){var t=e.defer();return i.query({method:"get-all-user-manager"},function(e){n=e,t.resolve(e)}),t.promise},this.remove=function(t){var a=e.defer();return i["delete"]({id:t},function(e){if(e.status)for(var i in n)if(n[i].id==t){n[i].status="no";break}a.resolve(e)}),a.promise},this.pushUser=function(e){n.push(e)},this.updateUser=function(e){for(var t in n)if(n[t].id==e.id){e.status="yes",n[t]=e;break}},this.changeAvatar=function(t,n){var a=e.defer();return i.save({method:"change-avatar",file:n,id:t},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.resetPassword=function(t){var n=e.defer();return i.save({method:"email",entity:"password",email:t},function(e){n.resolve(e)},function(e){n.resolve(e.data)}),n.promise},this.getUsers=function(){return n},this.getUserById=function(e){return s[e]},this.getUsersMap=function(){return s},this.listMap=function(e,t){if("role"==t)for(var i in e)a[e[i].id]=e[i];else for(var i in e)l[e[i].id]=e[i]},this.getMap=function(e){return"role"==e?a:l},this.userBranchManager=function(t){var n=e.defer();return i.query({id:t,method:"get-users-branch-manager"},function(e){n.resolve(e)}),n.promise},this.updatePermissions=function(t,n){var a=e.defer();return i.save({id:t,permissionIds:n,method:"update-permission"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.updateGroup=function(t,n){var a=e.defer();return i.save({id:t,groupIds:n,method:"update-group"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.updateRoles=function(t,n){var a=e.defer();return i.save({id:t,roleIds:n,method:"update-role"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.changeStatus=function(t){var a=e.defer();return i["delete"]({id:t,method:"change-status"},function(e){if(e.status)for(var i in n)if(n[i].id==t){n[i].status="yes";break}a.resolve(e)}),a.promise},this.setData=function(e){n=e;for(var t in e)s[e[t].id]=e[t];return n},this.updateShowDueDateUser=function(t){var n=e.defer(),a=new i(t);return a.$save({method:"update-show-due-date-user"},function(e){n.resolve(e)},function(e){n.resolve(e.data)}),n.promise},this}]);var assetmanagerApp=angular.module("assetManager",["ngResource","ui.bootstrap","ngSanitize","ngTable"]);assetmanagerApp.factory("AssetManagerResource",["$resource",function(e){return e("/api/asset-manager/:method/:id",{method:"@method",id:"@id"},{add:{method:"post"},save:{method:"post"},update:{method:"put"},editNameFolder:{method:"edit-name-folder"}})}]).service("AssetManagerService",["AssetManagerResource","$q",function(e,t){var i=this,n=[];this.createFolderProvider=function(n){if("undefined"!=typeof n.id)return i.editFolderAndFile(n);var a=t.defer(),l=new e(n);return l.$save({method:"create-folder"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.uploadNewAsset=function(i){var a=t.defer(),l=new e(i);return l.$save({method:"upload-new-asset"},function(e){0!=e.status&&n.push(e.item),a.resolve(e.item)},function(e){a.resolve(e.data)}),a.promise},this.createNewAsset=function(i){var a=t.defer(),l=new e(i);return l.$save({method:"create-new-asset"},function(e){0!=e.status&&n.push(e.item),a.resolve(e.item)},function(e){a.resolve(e.data)}),a.promise},this.saveFieldFile=function(i){var n=t.defer(),a=new e(i);return a.$save({method:"save-file-asset"},function(e){n.resolve(e)},function(e){n.resolve(e.data)}),n.promise},this.editFile=function(i){var n=t.defer(),a=new e(i);return a.$save({method:"edit-file"},function(e){n.resolve(e)},function(e){n.resolve(e.data)}),n.promise},this.crop=function(i){var n=t.defer(),a=new e(i);return a.$save({method:"crop"},function(e){n.resolve(e)},function(e){n.resolve(e.data)}),n.promise},this.addTagsForPage=function(i,n){var a=t.defer(),l=new e(n);return l.$save({id:i,method:"add-tags"},function(e){0!=e.status,a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.getAssetManagerById=function(i){var n=t.defer(),a=new e;return a.$get({id:i},function(e){n.resolve(e)},function(e){n.resolve(e.data)}),n.promise},this.setAssetManagers=function(e){return n=e},this.getAssetManagers=function(){return n},this.getUrlImageAsset=function(i){var n=t.defer();return e.get({id:i,method:"get-url-image-asset"},function(e){n.resolve(e)}),n.promise},this.deleteFolderAndAsset=function(i){var n=t.defer(),a=new e;return a.$delete({id:i},function(e){n.resolve(e)},function(e){n.resolve(e.data)}),n.promise},this.deleteAssetFile=function(i){var n=t.defer(),a=new e;return a.$get({id:i,method:"delete-file"},function(e){n.resolve(e)},function(e){n.resolve(e.data)}),n.promise},this.editNameFolder=function(i){var n=t.defer(),a=new e(i);return a.$save({id:i.id,method:"edit-name-folder"},function(e){0!=e.status&&n.resolve(e)},function(e){n.resolve(e.data)}),n.promise},this.updateContentFile=function(i,n){var a=t.defer(),l=new e(n);return l.$save({id:i,method:"update-content-file"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise}}]),angular.module("uls").controller("NotificationController",["$scope","$filter","NotificationService","$controller","$timeout",function(e,t,i,n,a){function l(){}function r(){if(f=!1,u.length>0){var e=u.shift();s(e)}}function o(){}function s(t){if(f)return void u.push(t);if(f=!0,-1==t.data.sender_id)var i=e.baseUrl+"/160x160_avatar_default.png?t=1";else var i=e.users_map[t.data.sender_id].avatar;var n=new Notify("Notification",{icon:i,body:t.data.message,tag:t.data.sender_id,notifyShow:l,notifyClose:r,notifyClick:function(){window.location.href="/"+t.data.href},notifyError:o,timeout:5});n.show()}n("BaseController",{$scope:e}),e.callbackLoadUserFinish=function(){},angular.element("#notification-top").removeClass("hidden"),e.baseUrl=window.baseUrl;var d=10;e.limitTo=d;var c=1;e.notifications=[];var u=[],f=!1;e.amount=0,$(".scroll-noti1").scroll(function(){$(this)[0].scrollHeight-$(this).scrollTop()===$(this).outerHeight()&&e.$apply(function(){e.limitTo=e.limitTo+d})});var p=RowboatPusher.subscribe("notification_ticket");p.bind("Rowboat\\Notification\\Events\\Notifications\\Broadcast\\NotificationTicket",function(t){e.$apply(function(){"undefined"!=typeof t.data.user_id&&-1!=t.data.user_id.indexOf(window.userId)&&(s(t),c=1,e.amount++)})}),e.getNotifications=function(){i.query(c).then(function(t){c&&e.setUserReadThisNotification(),e.notifications=t,e.hightlight=angular.copy(e.amount),e.amount=0,c=0})},e.setUserReadThisNotification=function(){i.setRead().then(function(){})},i.getAmountNotificationsNotRead().then(function(t){e.amount=t.result})}]);var permissionModule=angular.module("notification");permissionModule.factory("NotificationResource",["$resource",function(e){return e("/api/notification/:method/:id",{},{add:{method:"post"},save:{method:"post"}})}]).service("NotificationService",["$q","$filter","NotificationResource",function(e,t,i){var n=[];this.getAmountNotificationsNotRead=function(t){var n=e.defer();return i.get({method:"amount-notifications-not-read"},function(e){n.resolve(e)}),n.promise},this.query=function(t){var a=e.defer();return t?i.query().$promise.then(function(e){n=e,a.resolve(n)}):a.resolve(n),a.promise},this.notificationInvite=function(t){var n=e.defer(),a=new i(t);return a.$save({data:t,method:"invite"},function(e){n.resolve(e)},function(e){n.resolve(e.data)}),n.promise},this.setRead=function(){var t=e.defer(),n=new i;return n.$save({method:"set-read"},function(e){t.resolve(e)},function(e){t.resolve(e.data)}),t.promise}}]),notificationModule=angular.module("notification"),notificationModule.directive("notification",[function(){return{restrict:"AE",scope:{item:"="},replace:!0,templateUrl:baseUrl+"/app/shared/notification/views/notification.html",link:function(){}}}]);var module=angular.module("uls");module.directive("rowboatRequired",function(){return{restrict:"A",require:"ngModel",link:function(e,t,i,n){"undefined"==typeof e.$eval(i.ngModel)&&n.$setValidity("rowboatRequired",!1),t.on("focus",function(a){e.$watch(i.ngModel,function(e){var i="undefined"!=typeof e&&0!=e.length;if(i)t.parent().find("span").remove(),t.parent().removeClass("error"),n.$setValidity("rowboatRequired",i);else if(0==t.parent().find("span").length){t.parent().addClass("error");var a='<span class="control-label">It is required</span>';t.parent().append(a),n.$setValidity("rowboatRequired",i)}})})}}}),module.directive("rowboatLength",function(){return{restrict:"A",require:"ngModel",link:function(e,t,i,n){"undefined"!=typeof e.$eval(i.ngModel)&&e.$eval(i.ngModel).length!=i.rowboatLength&&n.$setValidity("rowboatLength",!1),t.on("focus",function(a){e.$watch(i.ngModel,function(e){var a=i.rowboatLength,l="undefined"!=typeof e&&e.length==a;if(l)t.parent().find("span").remove(),t.parent().removeClass("error"),n.$setValidity("rowboatLength",l);else if(0==t.parent().find("span").length){t.parent().addClass("error");var r='<span class="control-label">Length is '+a+"</span>";t.parent().append(r),n.$setValidity("rowboatLength",l)}})})}}}),module.directive("rowboatMinLength",function(){return{restrict:"A",require:"ngModel",link:function(e,t,i,n){"undefined"!=typeof e.$eval(i.ngModel)&&e.$eval(i.ngModel).length<i.rowboatMinLength&&n.$setValidity("rowboatMinLength",!1),t.on("focus",function(a){e.$watch(i.ngModel,function(e){var a=i.rowboatMinLength,l="undefined"!=typeof e&&e.length>=a;if(l)t.parent().find("span").remove(),t.parent().removeClass("error"),n.$setValidity("rowboatMinLength",l);else if(0==t.parent().find("span").length){t.parent().addClass("error");var r='<span class="control-label">Min length is '+a+"</span>";t.parent().append(r),n.$setValidity("rowboatMinLength",l)}})})}}}),module.directive("rowboatMaxLength",function(){return{restrict:"A",require:"ngModel",link:function(e,t,i,n){"undefined"!=typeof e.$eval(i.ngModel)&&e.$eval(i.ngModel).length>i.rowboatMaxLength&&n.$setValidity("rowboatMaxLength",!1),t.on("focus",function(a){e.$watch(i.ngModel,function(e){var a=i.rowboatMaxLength,l="undefined"!=typeof e&&e.length<=a;if(l)t.parent().find("span").remove(),t.parent().removeClass("error"),n.$setValidity("rowboatMaxLength",l);else if(0==t.parent().find("span").length){t.parent().addClass("error");var r='<span class="control-label">Max length is '+a+"</span>";t.parent().append(r),n.$setValidity("rowboatMaxLength",l)}})})}}}),module.directive("rowboatEmailPattern",function(){return{restrict:"A",require:"ngModel",link:function(e,t,i,n){$pattern=/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/,"undefined"==typeof e.$eval(i.ngModel)&&n.$setValidity("rowboatEmailPattern",!1),t.on("blur",function(a){e.$watch(i.ngModel,function(e){var i="undefined"!=typeof e&&$pattern.test(e);if(i)t.parent().find("span").remove(),t.parent().removeClass("error"),n.$setValidity("rowboatEmailPattern",i);else if(0==t.parent().find("span").length){t.parent().addClass("error");var a='<span class="control-label">Email Invalid</span>';t.parent().append(a),n.$setValidity("rowboatEmailPattern",i)}})})}}});var filterDate=angular.module("customFormatDate",[]);filterDate.filter("myDate",["$filter",function(e){return function(t,i){if(null==t)return"";if("Invalid Date"==new Date(t))for(;-1!=String(t).indexOf("-");)t=t.replace("-","/");if("Invalid Date"==new Date(t))return"";var n=e("date")(new Date(String(t)),angular.isUndefined(i)?"MM-dd-yyyy":i);return String(n)}}]).filter("myDateL",["$filter",function(e){return function(t){if(null==t)return"";if("Invalid Date"==new Date(t))for(;-1!=String(t).indexOf("-");)t=t.replace("-","/");if("Invalid Date"==new Date(t))return"";var i=e("date")(new Date(String(t)),"MMMM d, y");return String(i)}}]).filter("myDateTime",["$filter",function(e){return function(t){if(null==t)return"";if("0000-00-00 00:00:00"==t)return"";if("Invalid Date"==new Date(t))for(;-1!=String(t).indexOf("-");)t=t.replace("-","/");if("Invalid Date"==new Date(t))return"";var i=e("date")(new Date(String(t)),"MM-dd-yyyy HH:mm:ss");return String(i)}}]).filter("myDateShortTime",["$filter",function(e){return function(t){if(null==t)return"";if("0000-00-00 00:00:00"==t)return"";if("Invalid Date"==new Date(t))for(;-1!=String(t).indexOf("-");)t=t.replace("-","/");if("Invalid Date"==new Date(t))return"";var i=e("date")(new Date(String(t)),"MM-dd-yyyy h:mma");return String(i)}}]).filter("clientDate",["$filter",function(e){return function(t,i){if(null==t)return"";if("0000-00-00 00:00:00"==t)return"";if("Invalid Date"==new Date(t))for(;-1!=String(t).indexOf("-");)t=t.replace("-","/");if("Invalid Date"==new Date(t))return"";t=new Date(t),t=new Date(parseInt(new Date(t).getTime())-60*parseInt((new Date).getTimezoneOffset())*1e3);var n=e("date")(new Date(String(t)),angular.isUndefined(i)?"MM-dd-yyyy":i);return String(n)}}]).filter("clientDateTime",["$filter",function(e){return function(t){return e("date")(checkInvalid(t),window.dateTimeFormat)}}]).filter("clientLogDate",["$filter",function(e){return function(t){return e("date")(checkInvalid(t),window.logDate)}}]).filter("clientMediumDate",["$filter",function(e){return function(t){return e("date")(checkInvalid(t),window.mediumDate)}}]).filter("clientShortTime",["$filter",function(e){return function(t){return e("date")(checkInvalid(t),window.shortTime)}}]).filter("clientShortTimeFollowTimezone",["$filter",function(e){return function(t,i){if(null==t)return"";if("Invalid Date"==new Date(t))for(;-1!=String(t).indexOf("-");)t=t.replace("-","/");if("Invalid Date"==new Date(t))return"";var n=e("date")(new Date(String(t)),window.shortTime);return String(n)}}]).filter("formatCurrentDate",["$filter",function(e){return function(e){if(e=checkInvalid(e),!e)return"";e=new Date(e);var t=e.getMonth()+"-"+e.getDate()+"-"+e.getFullYear();return String(t)}}]).filter("formatCurrentTime",["$filter",function(e){return function(e){if(e=checkInvalid(e),!e)return"";e=new Date(e);var t=e.getHours()>=12?"pm":"am",i=parseInt(e.getHours())%12;i=i?10>i?"0"+i:i:12;var n=parseInt(e.getMinutes())<10?"0"+e.getMinutes():e.getMinutes(),a=parseInt(e.getSeconds())<10?"0"+e.getSeconds():e.getSeconds(),l=i+"-"+n+"-"+a+" "+t;return String(l)}}]).filter("formatCurrentShortTime",["$filter",function(e){return function(e){if(e=checkInvalid(e),!e)return"";e=new Date(e);var t=e.getHours()>=12?"pm":"am",i=parseInt(e.getHours())%12;i=i?10>i?"0"+i:i:12;var n=parseInt(e.getMinutes())<10?"0"+e.getMinutes():e.getMinutes(),a=i+":"+n+" "+t;return String(a)}}]);var checkInvalid=function(e,t){if(null==e)return"";if("Invalid Date"==new Date(e))for(;-1!=String(e).indexOf("-");)e=e.replace("-","/");return"Invalid Date"==new Date(e)?"":(e=new Date(e),e=new Date(parseInt(new Date(e).getTime())-60*parseInt((new Date).getTimezoneOffset())*1e3),new Date(String(e)))};angular.module("nlcFilter").filter("elapsedtime",function(){return function(e){return humanized_time_span(e)}});var translation=angular.module("translation",[]);translation.filter("trans",["$filter",function(e){return function(e,t){return null==e?"":window.translations[t][e]}}]);var selectLevel=angular.module("helpEditorDirective",[]),version=5;selectLevel.directive("helpEditorDirective",["$timeout","$filter",function(e,t){return{require:"?ngModel",restrict:"EA",scope:{items:"=",text:"@",selectedItems:"=selectedItem",onClick:"&"},replace:!0,templateUrl:baseUrl+"/app/components/user/help-editor/view/view-help.html?v="+(new Date).getTime(),link:function(t,i,n,a){t.description="",t.recursiveGetDescription=function(e){angular.forEach(e,function(e,i){e.parent=!1,t.description+='<strong class="space-topic" id="_'+e._id+'">'+e.name+"</strong>"+e.description,e.subFolder.length>0&&t.recursiveGetDescription(e.subFolder)})},t.getDesctiption=function(){angular.forEach(t.items,function(e,i){e.parent=!0,t.description+='<h4 id="_'+e._id+'" class="c-primary">'+e.name+'</h4><div class="space-area user-ad-area">'+e.description,t.recursiveGetDescription(e.subFolder),t.description+="</div>"})},t.getDesctiption(),t.goToAnchorWithId=function(e){window.location.href="#"+e,$("#fix-modal-top").scrollTop(0)},e(function(){$(".sub-select-"+t.items[0]._id).addClass("in")})}}}]);var blockApp=angular.module("BlockApp");blockApp.factory("BlockManagerResource",["$resource",function(e){return e("/api/block-manager/:method/:id",{method:"@method",id:"@id"},{add:{method:"post"},save:{method:"post"},update:{method:"put"},editNameFolder:{method:"edit-name-folder"}})}]).service("BlockManagerService",["BlockManagerResource","$q",function(e,t){var i=this;this.createFolderProvider=function(i){var n=t.defer(),a=new e(i);return a.$save({method:"create-folder"},function(e){n.resolve(e)},function(e){n.resolve(e.data)}),n.promise},this.addNew=function(n){if(angular.isDefined(n._id))return i.editBlock(n);var a=t.defer(),l=new e(n);return l.$save({method:"add-new"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.reviewContentBlock=function(i){var n=t.defer(),a=new e(i);return a.$save({method:"review-content-block"},function(e){n.resolve(e)},function(e){n.resolve(e.data)}),n.promise},this.editBlock=function(i){var n=t.defer(),a=new e(i);return a.$update({id:i._id,method:"edit-block"},function(e){n.resolve(e)},function(e){n.resolve(e.data)}),n.promise},this.parseContentBlock=function(i){var n=t.defer(),a=new e(i);return a.$save({method:"parse-content-config"},function(e){n.resolve(e)},function(e){n.resolve(e.data)}),n.promise},this.getHtmlFieldsCms=function(i){var n=t.defer(),a=new e(i);return a.$save({method:"get-htm-fields-cms"},function(e){n.resolve(e)},function(e){n.resolve(e.data)}),n.promise},this.addTagsForPage=function(i,n){var a=t.defer(),l=new e(n);return l.$save({id:i,method:"add-tags"},function(e){0!=e.status,a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.parseContentConfigBlock=function(i){var n=t.defer(),a=new e(i);return a.$save({method:"parse-content-config"},function(e){n.resolve(e)},function(e){n.resolve(e.data)}),n.promise},this.getContentForIframe=function(){var i=t.defer(),n=new e(data);return n.$save({method:"get-content-iframe"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.deleteFolderAndBlock=function(i){var n=t.defer(),a=new e;return a.$delete({id:i},function(e){n.resolve(e)},function(e){n.resolve(e.data)}),n.promise},this.deleteBlockFile=function(i){var n=t.defer(),a=new e;return a.$get({id:i,method:"delete-file"},function(e){n.resolve(e)},function(e){n.resolve(e.data)}),n.promise},this.editNameFolder=function(i){var n=t.defer(),a=new e(i);return a.$save({id:i.id,method:"edit-name-folder"},function(e){0!=e.status&&n.resolve(e)},function(e){n.resolve(e.data)}),n.promise},this.getDataBlock=function(i){var n=t.defer(),a=new e(i);return a.$save({method:"get-data-block"},function(e){n.resolve(e)},function(e){n.resolve(e.data)}),n.promise}}]),blockApp.controller("BlockManagerController",["$scope","$modal","ngTableParams","$timeout","BlockManagerService","CmsContentFolderService","$filter","$templateCache","CmsService",function(e,t,i,n,a,l,r,o,s){e.size=function(){s.setHeightTable()},e.isShowNested=!0,e.isShowBtnDelete=!1,e.isShowBtnEditNameFolder=!1,o.remove("cms/block-manager/template"),o.remove("cms/block-manager/template-manage-block"),e.blockManagers=l.setContents(window.folders,window.currentPage),e.allTags=angular.copy(window.allTags),e.tagsContent=angular.copy(window.tagsContent),e.pageSelected=window.idOfBlockSelected,e.contentHideOrShowAllNestedContent="Show All Nested Content",angular.isUndefined(e.blocks)&&(e.blocks=[]),e.isSearch=!1,e.btnSearch=function(){e.isSearch=!e.isSearch},e.tableParams=new i({page:1,count:100,sorting:{title:"asc"},filter:{}},{total:e.blocks.length,getData:function(t,i){var n=i.filter()?r("filter")(e.blocks,i.filter()):e.blocks,a=i.sorting()?r("orderBy")(n,i.orderBy()):n;i.total(n.length),t.resolve(a.slice((i.page()-1)*i.count(),i.page()*i.count()))}}),0!=e.pageSelected&&l.setActiveNode(e.pageSelected),l.initTree(function(t,i){e.blocks=[],"Blocks"==i.key?e.titleItemSelected="Blocks":1==i.folder?e.titleItemSelected=i.title:angular.isUndefined(i.parent.data.name)?e.titleItemSelected="Blocks":e.titleItemSelected=i.parent.data.name,angular.isDefined(t)&&1==t.length&&1!=i.folder?(t[0].expanded=!0,e.blocks=t):angular.forEach(t,function(t,i){t.expanded=!1,e.blocks.push(t)}),e.blocks=t,e.tableParams.reload(),angular.isDefined(e.tableParams.$params)&&(e.tableParams.$params.page=1),"0"!=i.data.parent_id?e.isShowBtnDelete=!0:e.isShowBtnDelete=!1,1==i.folder&&"0"!=i.data.parent_id?e.isShowBtnEditNameFolder=!0:e.isShowBtnEditNameFolder=!1}),e.hideOrShowAllNestedContent=function(){l.changeStatusHideOrShowAllNestedContent().then(function(t){e.contentHideOrShowAllNestedContent=t.textButton,"Show All Nested Content"==e.contentHideOrShowAllNestedContent?e.isShowNested=!0:e.isShowNested=!1,e.blocks=t.contents,e.tableParams.reload()})},e.checkPermission=function(t){var i=e.types_map[t.asset_id],n=window.editAssetPermission&&(window.jsPermission&&"javascript"==i||window.cssPermission&&"css"==i||window.imagePermission&&"image"==i||window.videoPermission&&"video"==i);return n},e.getChildrenPages=function(t){var i=[];for(var n in t){if(angular.isUndefined(t[n].data))return;"0"==t[n].key?(i.push(t[n]),delete t[n]):angular.isUndefined(t[n].folder)||(i.push(t[n]),delete t[n])}e.blockManagers=t,e.tableParams.reload()},e.deleteFolderAndBlock=function(){e.dsbBtnDelete=!0;var t=$("#tree").fancytree("getTree"),i=t.getActiveNode(),n=t.getRootNode();
if(1==i.folder)var l=confirm(r("trans")("confirm-delete-folder","golbal"));else var l=confirm(r("trans")("confirm-delete-content","golbal"));return 1!=l?void(e.dsbBtnDelete=!1):void("0"!=i.data.parent_id&&a.deleteFolderAndBlock(i.data._id).then(function(t){t.status&&(i.remove(),rootNodeOfNodeActive=_.find(n.children,function(e){return"Blocks"==e.title}),rootNodeOfNodeActive.setActive()),e.dsbBtnDelete=!1}))},e.deleteFileBlock=function(t,i){a.deleteBlockFile(t).then(function(n){0!=n.status&&(angular.isUndefined(n.result)||(i.region=n.result.countUniqueRegion,i.language=n.result.countUniqueLanguage,i.status=n.result.status),angular.forEach(i.subBlocks,function(e,n){e._id==t&&i.subBlocks.splice(n,1)}),e.tableParams.reload())})},e.editNameFolder=function(){var i=$("#tree").fancytree("getTree"),n=i.getActiveNode();if(n){var a="/cms/block-manager/edit-name-folder/"+n.data._id+"?"+(new Date).getTime(),l=t.open({animation:e.animationsEnabled,templateUrl:window.baseUrl+a,controller:"editNameFolderBlockCtrl",size:null,resolve:{}});l.result.then(function(t){n.setTitle(t.folder.name),n.setActive(),n.getParent().sortChildren(null,!0),e.tableParams.reload(),e.titleItemSelected=t.folder.name},function(){})}},e.showGroup=function(e,t){var i=($(".group-btn-ac").outerHeight(),$(window).outerWidth()),n=$(window).outerHeight(),a=e.pageY,l=n-a;300>l&&$(".wrap-ac-group").each(function(e){$(this).addClass("show-top")}),$(".wrap-ac-group").each(function(e){$(this).removeClass("ac-up")}),$(e.target).parent().toggleClass("ac-up"),$(".group-btn-ac").hasClass("fix-missing-li")?$(".group-btn-ac").css({top:e.pageY-65+"px",right:i-e.pageX-30+"px"}):$(".group-btn-ac").css({top:e.pageY-200+"px",right:i-e.pageX-30+"px"}),$(document).on("click",function r(e){$(e.target).closest("tr").siblings().find(".wrap-ac-group").removeClass("ac-up"),0===$(".wrap-ac-group").has(e.target).length?($(".wrap-ac-group").removeClass("ac-up"),$(".wrap-ac-group").removeClass("show-top")):$(document).one("click",r)}),angular.element(".table-responsive").addClass("fix-height")},e.addTagsForPage=function(t,i){$("#page-loading").css("display","block"),e.tagId=i,a.addTagsForPage(t,{tags:e.tagId}).then(function(t){for(var i in e.blocks)if(e.blocks[i].data._id==t.item._id){e.blocks[i].data.tags=t.item.tags;break}$("#page-loading").css("display","none"),e.tableParams.reload()})},e.getParentFolder=function(){var t=$("#tree").fancytree("getTree"),i=t.getActiveNode();i&&(0==i.folder||angular.isUndefined(i.folder)?(e.selectedItemName=i.getParent().title,e.selectedItemId=i.getParent().key):(e.selectedItemName=i.title,e.selectedItemId=i.key))};var d=!1;e.createFolderBlock=function(){if(!d){e.getParentFolder();var i="/cms/block-manager/create-folder?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName+"&&v="+(new Date).getTime(),n=t.open({templateUrl:window.baseUrl+i,controller:"ModalCreateFolderBlockCtrl",size:void 0,resolve:{}});d=!0,n.result.then(function(e){d=!1;var t=$("#tree").fancytree("getTree");if("0"==e.parent_id)var i=t.getNodeByKey("0");else var i=t.getNodeByKey(e.parent_id);window.folderType[e.key]=window.folderType[i.key];var n=i.addChildren(e);n.setExpanded(),i.sortChildren(null,!0)},function(){d=!1})}},e.getModalEditBlock=function(t){e.getParentFolder(),window.location.href=window.baseUrl+"/cms/block-manager/edit-block/"+t+"?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName+"&&v="+(new Date).getTime()},e.uploadNewBlock=function(){return e.getParentFolder(),angular.isUndefined(window.folderType[e.selectedItemId])?void(window.location.href=window.baseUrl+"/cms/block-manager/create-new-block?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName+"&&v="+(new Date).getTime()):void(-1!=window.folderType[e.selectedItemId].indexOf("managed_block")?window.location.href=window.baseUrl+"/cms/block-manager/create-new-block-manage?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName+"&&v="+(new Date).getTime():window.location.href=window.baseUrl+"/cms/block-manager/create-new-block?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName+"&&v="+(new Date).getTime())},e.getEditBlock=function(t){return e.getParentFolder(),angular.isUndefined(window.folderType[e.selectedItemId])?void(window.location=window.baseUrl+"/cms/block-manager/edit-block/"+t+"?v="+(new Date).getTime()):void(-1!=window.folderType[e.selectedItemId].indexOf("managed_block")?window.location=window.baseUrl+"/cms/block-manager/edit-block-manage/"+t+"?v="+(new Date).getTime():window.location=window.baseUrl+"/cms/block-manager/edit-block/"+t+"?v="+(new Date).getTime())}}]).controller("ModalCreateFolderBlockCtrl",["$scope","$modalInstance","BlockManagerService",function(e,t,i){e.blockFolder={},e.submit=function(n){return e.submitted=!0,e.nameExists=!1,n?!0:angular.isUndefined(e.blockFolder.parent_id)?!0:void i.createFolderProvider(e.blockFolder).then(function(i){return 0==i.status?(e.nameExists=!0,!0):(e.nameExists=!1,void t.close(i.item))})},e.cancel=function(){t.dismiss("cancel")}}]).controller("editNameFolderBlockCtrl",["$scope","$modalInstance","BlockManagerService","$http","$q",function(e,t,i,n,a){e.checkEmtypeName=function(i){if(""==i)return"The folder name is a required field";e.folder.name=i;var l=a.defer();return n.post("/api/block-manager/edit-name-folder/"+e.folder._id,e.folder).success(function(e){e=e||{},e.status?(l.resolve(),t.close(e)):l.resolve("Name has already been taken.")}).error(function(e){e.errors?l.resolve(e.errors[0]):l.reject("Server error!")}),l.promise}}]);var requestBlock=angular.module("BlockApp");requestBlock.controller("RequestBlockController",["$scope","$modal","ngTableParams","$filter","$timeout",function(e,t,n,a,l){e.getParentFolder=function(){var t=$("#tree").fancytree("getTree"),i=t.getActiveNode();i&&(0==i.folder||angular.isUndefined(i.folder)?(e.selectedItemName=i.getParent().title,e.selectedItemId=i.getParent().key):(e.selectedItemName=i.title,e.selectedItemId=i.key))};var r=!1;e.getModalRequestNewBlock=function(){if(!r){e.getParentFolder();var i=e.selectedItemId,n=t.open({animation:e.animationsEnabled,templateUrl:window.baseUrl+"/cms/block-manager/create?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName+"&&v="+(new Date).getTime(),controller:"ModalRequestBlockController",size:null,resolve:{folder_id:function(){return i}}});r=!0,n.result.then(function(e){r=!1,e.block.title=e.block.name,e.block.key=e.block._id,node=$("#tree").fancytree("getTree").getNodeByKey(e.block.folder_id),node.addChildren(e.block),node.setActive(!1),node.setActive(),node.sortChildren(null,!0)},function(){r=!1})}},e.getModalRequestTranslation=function(n){if(!r){e.getParentFolder();var a="/cms/block-manager/request-translation/"+n+"?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName+"&&v="+(new Date).getTime(),l=t.open({templateUrl:window.baseUrl+a,controller:"ModalRequestBlockController",size:void 0,resolve:{folder_id:function(){return null}}});r=!0,l.result.then(function(t){r=!1;for(i in t.blocks)node=$("#tree").fancytree("getTree").getNodeByKey(t.blocks[i].base_id),node.data.subBlocks.push(t.blocks[i]),"n/a"==node.data.language?node.data.language=1:node.data.language=parseInt(node.data.language)+1,"n/a"==node.data.due_date||"undefined"==typeof node.data.due_date?node.data.due_date=t.blocks[i].due_date:node.data.due_date>t.blocks[i].due_date&&(node.data.due_date=t.blocks[i].due_date),node.data.status="draft",e.tableParams.reload()},function(){r=!1})}},e.getModalRequestRegion=function(n){if(!r){e.getParentFolder();var a="/cms/block-manager/request-region/"+n+"?selectedItemId="+e.selectedItemId+"&&selectedItemName="+e.selectedItemName+"&&v="+(new Date).getTime(),l=t.open({templateUrl:window.baseUrl+a,controller:"ModalRequestBlockController",size:void 0,resolve:{folder_id:function(){return null}}});r=!0,l.result.then(function(t){r=!1;for(i in t.blocks)node=$("#tree").fancytree("getTree").getNodeByKey(t.blocks[i].base_id),node.data.region=t.countUniqueRegion,node.data.subBlocks.push(t.blocks[i]),"n/a"==node.data.due_date||"undefined"==typeof node.data.due_date?node.data.due_date=t.blocks[i].due_date:node.data.due_date>t.blocks[i].due_date&&(node.data.due_date=t.blocks[i].due_date),node.data.status="draft",e.tableParams.reload()},function(){r=!1})}}}]),requestBlock.controller("ModalRequestBlockController",["$scope","$modal","$filter","$modalInstance","folder_id","RequestBlockService","Upload","$timeout",function(e,t,i,n,a,l,r,o){e.languages_selected={},e.requiredLanguage=!0,e.requiredRegion=!0,e.regions_selected={},o(function(){e.block=angular.copy(window.block),e.folders=window.folders,"undefined"==typeof e.block.modal&&(e.block.folder_id="root"==a?"0":a)},500),e.format="MM-dd-yyyy",e.minDate=new Date,e.open=function(t,i){t.preventDefault(),t.stopPropagation(),e.opened={},e.opened[i]=!0},e.removeThumbnail=function(t){confirm("Do you want delete this image?")&&e.block.thumbnail.splice(t,1)},e.initRedactor=function(){$("#description").redactor({plugins:["table",1==window.isAdvancedEditingFeatures?"source":""],imageUpload:"/content/upload",callbacks:{modalOpened:function(e,t){if("link"!=e||this.observe.isCurrent("a")){if("link"==e){var i=this.link.$node.attr("rel");"undefined"==typeof i?$('<label><input type="checkbox" id="redactor-link-no-follow"> No Follow</label>').insertAfter($("#redactor-link-blank").parent()):$('<label><input type="checkbox" checked id="redactor-link-no-follow"> No Follow</label>').insertAfter($("#redactor-link-blank").parent())}}else $("#redactor-link-blank").attr("checked","true"),$('<label><input type="checkbox" checked id="redactor-link-no-follow"> No Follow</label>').insertAfter($("#redactor-link-blank").parent())},insertedLink:function(e){var t=$(e).attr("href");"http"!=t.substring(0,4)&&"https"!=t.substring(0,5)&&"ftp"!=t.substring(0,3)&&$(e).attr("href","http://"+t),$("#redactor-link-no-follow").prop("checked")?e.attr("rel","nofollow"):e.removeAttr("rel")},linkify:function(e){e.attr("target","_blank")},change:function(){$description=$("#description").redactor("code.get"),e.$apply(function(){"<div></div>"==$description||""==$description||"<br>"==$description||"<div><strong></strong></div>"==$description||"<div><em></em><strong></strong></div>"==$description||"<div><em><del></del></em></div>"==$description?e.requiredDescription=!0:e.requiredDescription=!1})}},linkSize:1e3,minHeight:200})},e.submit=function(t){return delete e.errors,e.requiredDescription=!1,e.submitted=!0,angular.isDefined(e.folderType)&&"managed_block"==e.folderType[e.block.folder_id]&&(e.block.type="managed_block"),$description=$("#description").redactor("code.get"),"<div></div>"!=$description&&""!=$description&&"<br>"!=$description&&"<div><strong></strong></div>"!=$description&&"<div><em></em><strong></strong></div>"!=$description&&"<div><em><del></del></em></div>"!=$description||(e.requiredDescription=!0),t||e.requiredDescription?($(".ng-invalid:eq(1)").focus(),!0):"undefined"==typeof e.block.folder_id&&"request_translation"!=e.block.modal&&"request_region"!=e.block.modal?!0:"request_translation"==e.block.modal&&e.requiredLanguage?($(".ng-invalid:eq(1)").focus(),!0):"request_region"==e.block.modal&&e.requiredRegion?($(".ng-invalid:eq(1)").focus(),!0):(files_id=[],"undefined"!=typeof e.filesUpload&&(files_id=e.filesUpload.ids),e.block.files_id=files_id,$("#btnSubmit").attr("disabled","true"),e.block.description=$description,e.block._id&&"request_translation"==e.block.modal&&(e.block.languages=e.languages_selected),e.block._id&&"request_region"==e.block.modal&&(e.block.contentId=e.block._id,e.block._id=e.block.base_id,e.block.regions=e.regions_selected),void l.requestBlock(e.block).then(function(t){if(0==t.status)$("#btnSubmit").removeAttr("disabled"),e.checkName=!0,t.errors?e.errors=t.errors:$(".name").focus();else{if("undefined"!=typeof e.block.thumbnail){var i="propose_new";"undefined"!=typeof e.block.modal&&(i=e.block.modal);for(var a=0;a<e.block.thumbnail.length;a++){var l=e.block.thumbnail[a];r.upload({url:window.baseUrl+"/api/block-manager/change-thumbnail",fields:{modal:i,data:t},file:l}).progress(function(e){}).success(function(e,t,i,n){!e.status})}}n.close(t)}}))},e.cancel=function(){n.dismiss("cancel")}}]);var blockApp=angular.module("BlockApp");blockApp.factory("RequestBlockResource",["$resource",function(e){return e("/api/block-manager/:method/:id",{method:"@method",id:"@id"},{add:{method:"post"},save:{method:"post"},update:{method:"put"}})}]),blockApp.service("RequestBlockService",["RequestBlockResource","$q",function(e,t){var i=this;this.requestBlock=function(n){if("undefined"!=typeof n._id&&"request_translation"==n.modal)return i.requestTranslation(n);if("undefined"!=typeof n._id&&"request_region"==n.modal)return i.requestRegion(n);var a=t.defer(),l=new e(n);return l.$save({},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.requestTranslation=function(i){var n=t.defer(),a=new e(i);return a.$save({method:"request-translation"},function(e){n.resolve(e)},function(e){n.resolve(e.data)}),n.promise},this.requestRegion=function(i){var n=t.defer(),a=new e(i);return a.$save({method:"request-region"},function(e){n.resolve(e)},function(e){n.resolve(e.data)}),n.promise},this.requestRevision=function(i){var n=t.defer(),a=new e(i);return a.$save({method:"request-revision"},function(e){0!=e.status&&n.resolve(e)},function(e){n.resolve(e.data)}),n.promise}}]);var blockApp=angular.module("BlockApp");blockApp.controller("ModalInsertCms",["$scope","$modalInstance","$timeout","$controller","CmsContentInsertService","AssetManagerService","$compile","$filter","EditDraftService","language","region","Upload",function(e,t,i,n,a,l,r,o,s,d,c,u){function f(i){a.getContentBlock({language:d,region:c},i).then(function(i){i.status&&"managed_block"!==i.content.type&&i.content.fields&&i.content.fields.length?(e.existField=!0,e.listField=i.content.fields,m(e.listField)):t.close(a.customCurrentData(o("lowercase")(e.curType),e.currentId))})}function p(e){var t=angular.copy(e);if(angular.isDefined(t)){var i=t;for(var n in i){if(angular.isArray(i[n])||angular.isObject(i[n]))for(var a in i[n])angular.isArray(i[n][a])||angular.isObject(i[n][a])&&Object.keys(i[n][a]).length?i[n][a]=angular.isUndefined(i[n][a])?null:i[n][a]:i[n][a]=angular.isUndefined(i[n][a])?null:i[n][a];t[n]=angular.isUndefined(i[n])?null:i[n]}}return t}function m(t){for(var i in t)t[i].multiple&&(angular.isUndefined(e.curFields)&&(e.curFields={}),e.curFields[t[i].variable]=null,g("add",t[i].variable),e.curFields[t[i].variable]={},e.curFields[t[i].variable][0]=null,angular.isUndefined(e.multiFieldFollowVariable[t[i].variable])&&(e.multiFieldFollowVariable[t[i].variable]=[{id:t[i].variable+0,key_field:0}]))}function g(t,i){if(angular.isDefined(e.countFieldsOfMultiField[i]))switch(t){case"add":e.countFieldsOfMultiField[i]+=1;break;case"remove":e.countFieldsOfMultiField[i]-=1}else e.countFieldsOfMultiField[i]=1}function v(){e.listErrorListFile=[];var t=e.listField;if(angular.isDefined(e.curFields))var i=e.curFields;if(angular.isDefined(t)&&angular.isDefined(i))for(var n in t)if(t[n].multiple&&angular.isDefined(e.countFieldsOfMultiField[t[n].variable])&&e.countFieldsOfMultiField[t[n].variable]<t[n].min_field&&t[n].min_field>1){e.listErrorListFile.push("Please, add minimum "+t[n].min_field+" field "+t[n].name);break}return!!e.listErrorListFile.length}n("BaseController",{$scope:e}),e.item={},e.curFields={},e.file_fields=[],e.countFieldsOfMultiField=[],e.multiFieldFollowVariable=[],e.currentId="",e.listField=[],e.curType="",e.submit=function(i){if(e.requireId=!1,e.currentId=e.item.curValue,"undefined"==typeof e.currentId)return void(e.requireId=!0);if(e.curType=o("lowercase")(i),angular.isDefined(i)&&"Block"==i)if(e.template||e.notShowFieldBlock){var n="{{-- Begin "+window.blockCommentMap[e.item.curValue]+" Block --}}{{inject('block','",l=")}}{{-- End "+window.blockCommentMap[e.item.curValue]+" Block --}}";a.getBlockAndUpdateInjectAutoIncrement(e.item.curValue).then(function(i){$str=n+e.item.curValue+"_"+i.autoIncrement+"'"+l,t.close($str)})}else f(e.currentId);"Asset"==i&&"undefined"!=typeof e.item.curValue&&null!=e.item.curValue&&a.getDetailCommentAsset(e.item.curValue).then(function(i){angular.isDefined(e.item.thumbNail)?$str="{{-- Begin "+i.asset.filename+" Asset --}}{{inject('asset','"+e.item.curValue+"', '"+e.item.thumbNail+"')}}{{-- End "+i.asset.filename+" Asset --}}":$str="{{-- Begin "+i.asset.filename+" Asset --}}{{inject('asset','"+e.item.curValue+"')}}{{-- End "+i.asset.filename+" Asset --}}",$("#checkbox-insert-object").is(":checked")&&($str="{{-- Begin "+i.asset.filename+" Asset --}}@outject('image','asset','"+e.item.curValue+"'){{-- End "+i.asset.filename+" Asset --}}"),t.close($str)}),"Link"==i&&"undefined"!=typeof e.item.curValue&&null!=e.item.curValue&&a.getDetailCommentLink(e.item.curValue).then(function(i){$str="{{-- Begin "+i.link.name+" Link --}}{{inject('link','"+e.item.curValue+"')}}{{-- End "+i.link.name+" Link --}}",t.close($str)})},e.url=[],e.getUrlImageAsset=function(t){l.getUrlImageAsset(t).then(function(i){e.url[t]=i.url})},e.removeThumbnailAssert=function(t,i,n){e.url[t]="","undefined"!=typeof n?e.page.fields[i][n]=null:e.page.fields[i]=null},e.saveContentBlock=function(i){if(e.submitted=!1,i)return $("#form-edit-field").find(".ng-invalid:eq(0)").focus(),void(e.submitted=!0);if(!v()){var n=angular.copy(e.curFields);n.fields=p(n.fields);var l=a.customCurrentData(e.curType,e.currentId,n,e.listField);t.close(l)}},e.addNewField=function(t){e.listErrorListFile=[];var i=0,n=0;if(angular.isDefined(e.multiFieldFollowVariable[t.variable])&&e.multiFieldFollowVariable[t.variable].length)for(var a in e.multiFieldFollowVariable[t.variable])e.multiFieldFollowVariable[t.variable][a].id==t.variable+e.multiFieldFollowVariable[t.variable][a].key_field&&(n+=1,e.multiFieldFollowVariable[t.variable][a].key_field>i&&(i=e.multiFieldFollowVariable[t.variable][a].key_field));return n>=t.max_field?void alert("Maximum "+t.name+" field is "+t.max_field):(i=parseInt(i)+1,e.curFields[t.variable][i]=null,void(angular.isUndefined(e.multiFieldFollowVariable[t.variable])?(e.multiFieldFollowVariable[t.variable]=[{id:t.variable+i,key_field:i}],g("add",t.variable)):(e.multiFieldFollowVariable[t.variable].push({id:t.variable+i,key_field:i}),g("add",t.variable))))},e.removeCurrentField=function(t,i){e.listErrorListFile=[];var n=e.multiFieldFollowVariable[t.variable];if(angular.isDefined(n)&&n.length)for(var a in n)if(n[a].key_field==i&&n[a].id==t.variable+n[a].key_field){angular.isDefined(e.curFields)&&angular.isDefined(e.curFields[t.variable])&&(e.curFields[t.variable]=angular.extend({},e.curFields[t.variable]),angular.isArray(e.curFields[t.variable])&&(e.curFields=angular.extend({},e.curFields)),delete e.curFields[t.variable][n[a].key_field],g("remove",t.variable)),e.multiFieldFollowVariable[t.variable].splice(a,1);break}},e.uploadFileCurTemp=function(t,i,n){if(t.length){var a=window.maxUpload;return t[0].size>a.size?(angular.isUndefined(n)?e.curFields[i]=null:e.curFields[i][n]=null,void alert("Max file size is "+a.name)):void u.upload({url:baseUrl+"/admin/file",file:t}).progress(function(e){}).success(function(t,a,l,r){angular.isDefined(e.curFields)&&angular.isDefined(n)?(angular.isUndefined(e.curFields[i])&&(e.curFields[i]={}),angular.isUndefined(e.file_fields[i])&&(e.file_fields[i]={}),e.file_fields[i][n]={},e.curFields[i][n]=t.item.id,e.file_fields[i][n].avatar=t.item.file_name):angular.isDefined(e.curFields)&&(e.file_fields[i]=t.item.file_name,e.curFields[i]=t.item.id)}).error(function(e){})}},e.cancel=function(){t.dismiss("cancel")}}]);var blockApp=angular.module("BlockApp");blockApp.controller("ManagerBlockValidate",["$scope","$controller","$timeout","$filter",function(e,t,i,n){function a(e,t,n){var a=!1;return function l(e){for(var r in e)if(Object.keys(angular.extend({},e[r])).length&&-1!=r.indexOf(t))for(var o in e[r])l(e[r][o]);else if(1==e[r]&&(a=!0,n))return i(function(){angular.isDefined($("#inject_"+t))&&$("#inject_"+t).length?$("#inject_"+t).trigger("click"):$("#popular_"+t).trigger("click")}),!0}(e),a}function l(t,n){if("undefined"!=typeof t&&t.length>0){var a=e.currentBlockInject;if("undefined"!=typeof n&&(a=n),e.listErrorListFile=[],angular.isDefined(t))for(var l in t){var r="_"+a+"_"+t[l].variable;if(t[l].multiple&&(angular.isUndefined(e.countFieldsOfMultiField[r])||e.countFieldsOfMultiField[r]<t[l].min_field)&&t[l].min_field>0){if(angular.isUndefined(e.countFieldsOfMultiField[r])){var o=e.listValueFieldRequired[a][r];if(Object.keys(angular.extend({},o)).length&&Object.keys(angular.extend({},o)).length>=t[l].min_field)return!1}return e.listErrorListFile.push("Please, add minimum "+t[l].min_field+" field "+t[l].name),i(function(){angular.isDefined($("#inject_"+a))&&$("#inject_"+a).length?$("#inject_"+a).trigger("click"):$("#popular_"+a).trigger("click")}),!0}}}return!1}e.listFieldValidate=[],e.updateStatusFieldRequired=function(t,i,a){if(angular.isDefined(i)&&i)for(var l in t)if(Object.keys(angular.extend({},t[l])).length&&-1!=l.indexOf("_"+a)&&angular.isDefined(i[l]))for(var r in t[l])e.updateStatusFieldRequired(t[l][r],i[l][r],a);else angular.isDate(i[l])&&(i[l]=n("date")(i[l],"yyyy-MM-dd")),("object"!=typeof t[l]&&"array"!=typeof t[l]||angular.isDate(t[l]))&&(angular.isDefined(i[l])&&(i[l]||0==i[l])?t[l]=!1:angular.isDefined(e.term)&&angular.isDefined(e.term[a])&&e.term[a][l]&&(t[l]=!0));return t},e.activeTabError=function(t){for(var i in e.listValueFieldRequired)if(a(e.listValueFieldRequired[i],i,t))return!0;return!1},e.checkMinimumFieldOfBlock=function(){var t=!1,i=e.fieldsBlocks,n=angular.isDefined(e.block.base_id)?e.block.base_id:"current_block";if(t=l(e.fieldsConfig,n),t||"undefined"==typeof i){if(t)return t}else for(var a in i)if(t=l(i[a].fields,i[a]._id))return t;return t}}]);var blockApp=angular.module("BlockApp");blockApp.controller("ManageBlockCreateController",["$scope","$modal","$timeout","Upload","$filter","BlockManagerService","$controller","ngTableParams",function(e,t,i,n,a,l,r,o){function s(t,i,n,a){angular.isUndefined(e.multiFieldFollowVariable[n])?("undefined"==typeof e.listValueFieldRequired[e.currentBlockInject]&&(e.listValueFieldRequired[e.currentBlockInject]={}),e.listValueFieldRequired[e.currentBlockInject][n]={},e.multiFieldFollowVariable[n]=[{id:t.variable+"___"+a,key_field:a}],e.listValueFieldRequired[e.currentBlockInject][n][a]=d(t.option_id,e.currentBlockInject),C("add",n)):(e.multiFieldFollowVariable[n].push({id:t.variable+"___"+a,key_field:a}),e.listValueFieldRequired[e.currentBlockInject][n][a]=d(t.option_id,e.currentBlockInject),C("add",n))}function d(t,i){var n=angular.isDefined(e.term[i])?e.term[i]:[],a=[];for(var l in n)-1!=l.indexOf(t)&&(a[l]=n[l]);return angular.extend({},a)}function c(t,i,n,a){_id="_"+i+"_";for(var l in n){if("current"==a){_variable=_id+n[l].variable;var r=t[_variable]}else{_variable=n[l].variable;var r=t[n[l].variable]}if(angular.isDefined(r)&&(angular.isArray(r)||angular.isObject(r))&&n[l].multiple)for(var o in r)angular.isUndefined(e.multiFieldFollowVariable[_variable])?(e.multiFieldFollowVariable[_variable]=[{id:n[l].variable+"___"+o,key_field:o}],C("add",_variable)):(e.multiFieldFollowVariable[_variable].push({id:n[l].variable+"___"+o,key_field:o}),C("add",_variable))}}function u(t,i,n,a){if(angular.isDefined(e.contentBlock["_"+t])&&angular.isDefined(e.contentBlock["_"+t].data)&&angular.isDefined(e.contentBlock["_"+t].data.fields)&&angular.isDefined(e.contentBlock["_"+t].data.fields[n])&&angular.isDefined(e.contentBlock["_"+t].data.fields[n][i])){var l=angular.copy(e.contentBlock["_"+t].data.fields[n]);l=angular.extend({},l);var r=Object.keys(l);if(1==r.length||r[r.length-1]==i)delete l[i];else for(var o in l)parseInt(o)>parseInt(i)&&angular.isDefined(l[o])&&(l[o-1]=angular.copy(l[o]),delete l[o]);e.contentBlock["_"+t].data.fields[n]=l}a.call()}function f(t,i,n){var a=e.listValueFieldRequired[t];if(angular.isDefined(a)&&angular.isDefined(a[n])){var l=angular.extend({},a[n]),r=Object.keys(l);if(1==r.length||r[r.length-1]==i)delete l[i];else for(var o in l)parseInt(o)>parseInt(i)&&angular.isDefined(l[o])&&(l[o-1]=angular.copy(l[o]),delete l[o]);a[n]=l}}function p(e){!function(e){for(var t in e)angular.isArray(e[t])&&e[t].length||angular.isObject(e[t])&&Object.keys(e[t]).length?p(e[t]):angular.isDate(e[t])&&(e[t]=a("date")(e[t],"yyyy-MM-dd"))}(e)}function m(t,i){e.configFields(function(t){if(angular.isDefined(t)){for(var n in t)e.fieldsHaveConfigured[t[n].variable]=t[n];e.getModalShowListConfigFields(function(n){angular.isUndefined(n)&&(n=angular.copy(t)),(angular.isDefined(n)||angular.isDefined(e.block.fields))&&g(n,i)},t)}else!angular.isUndefined(i)&&i||M()},t)}function g(t,i){angular.isDefined(t)&&t?(e.fieldsConfig=t,_()):e.fieldsConfig=[],S(i,function(e){!angular.isUndefined(i)&&i||M(),I()})}function v(t,i,n){l.parseContentBlock({content:t,type:"block"}).then(function(t){if(e.fields=[],e.block.injects=[],angular.isUndefined(t.assets)||(e.block.assets=t.assets),t.blocks.length>0){e.block.injects=t.blocks,e.isShowManageBlock=!0;for(var i in t.blocks)angular.isUndefined(e.exitsInject[t.blocks[i]])&&(e.successForm[0]=!1)}if(t.fields.length>0){e.fields=t.fields,e.isShowManageBlock=!0;for(var i in t.fields)if(angular.isUndefined(e.fieldsHaveConfigured[t.fields[i].variable])){e.successForm[0]=!1,e.successFieldsCurrentBlock=!1;break}}else e.fields=[],e.block.fields={};angular.isDefined(n)&&n.call(!0,t)})}function h(e){angular.isDefined($(e))&&$(e).length&&($(e).stop(!0,!0).fadeOut(),$(e).fadeIn(function(){$(e).fadeOut(5e3)}))}function b(e){var t=e.parent().find('[data-toggle="collapse"]');return t.each(function(){var t=$(this).attr("data-target"),i=new RegExp("(.|#)");return t=t.replace(i,""),e.hasClass(t)||e.attr("id")==t?($(this).trigger("click"),!0):void 0}),!1}function w(){var e=$('form[name="formData"]').find(".ng-invalid:eq(0)");e.length&&(!function t(e){if(!e.parent().is("form")&&(e=e.parents(".collapse:not(.in)"),e.length)){if(b(e))return;t(e)}}(e),k())}function k(){var e=$('form[name="formData"]').find(".ng-invalid:eq(0)");if(e.is("div"))$offsetTopOfCurrentDiv=e.offset().top,$("body").scrollTop($offsetTopOfCurrentDiv-150);else if(e.is("textarea")){var t=e.parent(),i=t.find("div.redactor-editor").length;i&&($offsetTopOfCurrentDiv=t.offset().top,$("body").scrollTop($offsetTopOfCurrentDiv-150))}else e&&($offsetTopOfCurrentDiv=e.offset().top,$("body").scrollTop($offsetTopOfCurrentDiv-150));e.focus()}function y(t){for(var i in t)angular.isDefined(e.contentBlock[i])&&angular.isDefined(e.contentBlock[i].data)&&angular.isDefined(e.contentBlock[i].data.fields)&&p(e.contentBlock[i].data.fields)}function F(t,i,n){var a="_"+t;if(angular.isUndefined(e.cacheDataBlock[a])){var r=null;angular.isDefined(e.block._id)&&(r=e.block._id);var o={index_base_id:t,content_id:r,type:i};l.getDataBlock(o).then(function(l){l.result[a].data=angular.extend({},l.result[a].data),l.result[a].data.fields=angular.extend({},l.result[a].data.fields),e.contentBlock[a]=l.result[a],e.cacheDataBlock[a]=e.contentBlock[a],"current"==i?c(l.result[a].data.fields,t,e.block.fields,i):c(l.result[a].data.fields,t,e.fieldsBlocksMap[t],i),angular.isDefined(n)&&n.call()}).then(function(e){angular.isDefined(n)&&n.call()})}else angular.isDefined(n)&&n.call()}if(r("ConfigController",{$scope:e}),r("ManagerBlockValidate",{$scope:e}),e.block=window.block,e.usages=window.usages,angular.isUndefined(e.usages)&&(e.usages=[]),e.loadDataUsage=function(){e.tableParams=new o({page:1,count:50,sorting:{name:"desc"}},{total:e.usages.length,getData:function(t,i){var n=i.sorting()?a("orderBy")(e.usages,i.orderBy()):e.usages;n=i.filter()?a("filter")(n,i.filter()):n,i.total(n.length),t.resolve(n.slice((i.page()-1)*i.count(),i.page()*i.count()))}})},e.loadDataUsage(),e.clickable=function(e,t,i,n){switch(i){case"template":window.open(baseUrl+"/cms/template-content-manager/update-template/"+t,"_blank"),window.location=baseUrl+"/cms/template-content-manager/update-template/"+t;break;case"page":window.open(baseUrl+"/cms/pages/edit-page/"+t,"_blank");break;case"block":window.open(baseUrl+"/cms/block-manager/edit-block/"+t,"_blank")}},e.successForm=[],e.fieldsHaveConfigured=[],e.exitsInject=[],angular.isUndefined(e.block))e.block={},e.successForm[0]=!0,e.successForm[1]=!1,e.requiredEditorContent=!0,e.curFields={},e.block.injects={},e.fields={};else{if(angular.isDefined(e.block.data)&&(e.successForm[0]=!0,e.successForm[1]=!0,e.requiredEditorContent=!1,e.curFields=angular.extend({},angular.copy(e.block.data.fields))),angular.isDefined(e.block.injects))for(var D in e.block.injects)e.exitsInject[e.block.injects[D]]=e.block.injects[D];if(angular.isDefined(e.block.fields)){e.fields=e.block.fields;for(var D in e.block.fields)e.fieldsHaveConfigured[e.block.fields[D].variable]=e.block.fields[D]}}e.uploading=!1,e.isChangeDataMirror=!1,e.parsedContent=!1,e.isUploading=function(t){e.uploading=t},e.successFieldsCurrentBlock=!0,e.successInjectBlock=[],e.isShowManageBlock=!1,e.isShowFieldBlockInject=!1,e.isShowFieldCurrentBlock=!1,e.contentBlock={},e.finishConfigFields=!1,e.successInject=[],e.listOutTypeMap=angular.copy(window.listOutTypeMap),e.listCheckBoxMap=angular.copy(window.listCheckBoxMap),e.isDetail=!0,e.multiFieldFollowVariable={},e.file_fields=[],e.listField=[],e.countFieldsOfMultiField=[],e.fieldsBlocks=[],e.cacheDataBlock={},e.fieldsBlocksMap={};var C=function(t,i){if(angular.isDefined(e.countFieldsOfMultiField[i]))switch(t){case"add":e.countFieldsOfMultiField[i]+=1;break;case"remove":e.countFieldsOfMultiField[i]-=1}else e.countFieldsOfMultiField[i]=1};e.addNewField=function(t,i){$("#page-loading").css("display","block");var n=0,a=0,l=e.currentBlockInject;if("current"==i)var r="_"+l+"_"+t.variable;else var r=t.variable;if(e.listErrorListFile=[],angular.isDefined(e.multiFieldFollowVariable[r])&&e.multiFieldFollowVariable[r].length)for(var o in e.multiFieldFollowVariable[r])e.multiFieldFollowVariable[r][o].id==t.variable+"___"+e.multiFieldFollowVariable[r][o].key_field&&(a+=1,e.multiFieldFollowVariable[r][o].key_field>n&&(n=e.multiFieldFollowVariable[r][o].key_field));return a>=t.max_field&&t.max_field?(alert("Maximum "+t.name+" field is "+t.max_field),void $("#page-loading").css("display","none")):(n=a>0?parseInt(n)+1:0,s(t,l,r,n),angular.element("#parentBlock_"+t.variable).hasClass("in")||angular.element("#action-"+t.variable).trigger("click"),void $("#page-loading").css("display","none"))},e.removeCurrentField=function(t,i,n){var a=e.currentBlockInject;if("current"==n)var l="_"+a+"_"+t.variable;else l=t.variable;e.listErrorListFile=[];var r=angular.copy(e.multiFieldFollowVariable[l]);if(angular.isDefined(r)&&r.length)for(var o in r)if(r[o].key_field==i&&r[o].id==t.variable+"___"+r[o].key_field){u(a,r[o].key_field,l,function(){C("remove",l),e.multiFieldFollowVariable[l].splice(r[o].key_field,1);for(var i in e.multiFieldFollowVariable[l])e.multiFieldFollowVariable[l][i].key_field>r[o].key_field&&(e.multiFieldFollowVariable[l][i]={id:t.variable+"___"+i,key_field:i});f(a,r[o].key_field,l)});break}},i(function(){e.mixedMode={name:"htmlmixed",scriptTypes:[{matches:/\/x-handlebars-template|\/x-mustache/i,mode:null},{matches:/(text|application)\/(x-)?vb(a|script)/i,mode:"vbscript"}]},e.breadCrumbNewBlock=function(){window.location.href=window.baseUrl+"/cms/block-manager"},e.editableCodeMirror=CodeMirror.fromTextArea(document.getElementById("editor"),{lineNumbers:!0,mode:"application/x-httpd-php",keyMap:"sublime",autoCloseBrackets:!0,matchBrackets:!0,showCursorWhenSelecting:!0,lineWrapping:!0,theme:"monokai",tabSize:2,indentUnit:4,indentWithTabs:!0,onBlur:function(){},onChange:function(){}}),angular.isUndefined(e.block.content)||null==e.block.content?(e.block.content="",M()):(v(e.block.content,!1,function(e){}),I(),$('#mytab a[href="#detail"]').tab("show"),M(),e.isChangeDataMirror=!0),
e.editableCodeMirror.setValue(e.block.content),e.editableCodeMirror.on("blur",function(){var t=e.editableCodeMirror.getValue();e.warningError=!1,angular.isDefined(e.isChangeDataMirror)&&e.isChangeDataMirror&&v(t,!1,function(t){e.parsedContent=!0,e.isChangeDataMirror=!1,0==t.blocks.length&&0==t.fields.length&&(e.isShowManageBlock=!1,$('#mytab a[href="#content"]').tab("show"))})}),e.editableCodeMirror.on("change",function(){e.parsedContent=!1;var t=e.editableCodeMirror.getValue();"<div></div>"==t||""==t||"<br>"==t||"<div><strong></strong></div>"==t||"<div><em></em><strong></strong></div>"==t||"<div><em><del></del></em></div>"==t?e.$apply(function(){e.requiredEditorContent=!0}):e.$apply(function(){e.requiredEditorContent=!1}),e.isChangeDataMirror=!0})},700),i(function(){$(document).ready(function(){e.setDIVHeight()}),$(window).resize(function(){e.setDIVHeight()})}),e.setDIVHeight=function(){var e=$(".assets .fix-tab #code"),t=$(".assets .fix-tab #review"),i=$(".assets .fix-tab").offset(),n=i.top,a=screen.height,l=a-n-315;e.attr("style","height: "+l+"px!important;overflow:auto"),t.attr("style","height: "+l+"px!important;overflow:auto")};var I=function(){e.fieldsConfig=[];for(var t in e.fields)variable=angular.copy(e.fields[t].variable),angular.isDefined(e.fieldsHaveConfigured[variable])&&e.fieldsConfig.push(e.fieldsHaveConfigured[variable])},_=function(){angular.element("#page-loading").css("display","block")},M=function(){angular.element("#page-loading").css("display","none")};_(),e.activeManageBlock=function(t){Object.keys(angular.extend({},e.curFields)).length&&p(e.curFields),e.isDetail&&!t&&(e.successForm[1]=!0),e.submitted=!1,_(),e.isChangeDataMirror&&!e.parsedContent?v(e.editableCodeMirror.getValue(),!1,function(t){delete e.isChangeDataMirror,0==t.blocks.length&&0==t.fields.length?(e.isShowManageBlock=!1,$('#mytab a[href="#content"]').tab("show"),M()):U()}):U()};var U=function(t){e.fields.length>0?(fieldConfig=A(),fieldConfig.length>0?(M(),m(fieldConfig,t)):(M(),e.getModalShowListConfigFields(function(i){(angular.isDefined(i)||angular.isDefined(e.block.fields))&&(angular.isUndefined(i)&&(i=angular.copy(e.block.fields)),g(i,t))},e.block.fields))):(g(!1,t),e.fieldsHaveConfigured=[])},B=function(){e.finishConfigFields=!0,M(),angular.isUndefined(e.block._id)&&(e.isManage=!0),e.isDetail=!1,e.isContent=!1,angular.element("#event-manage").trigger("click")};e.showDetail=function(t){_(),e.isDetail&&!t&&(e.successForm[1]=!0),e.isManage&&!t&&(e.successForm[0]=!0),e.submitted=!1,e.isDetail=!0,e.isContent=!1,e.isManage=!1,e.isDetail=!0,M()};var A=function(){var t=[];for(var i in e.fields)angular.isDefined(e.fieldsHaveConfigured[e.fields[i].variable])||t.push(e.fields[i]);return t},S=function(t,n){e.baseId="current_block",angular.isDefined(e.block.base_id)&&(e.baseId=e.block.base_id);var a=null;angular.isDefined(e.block._id)&&(a=e.block._id),l.getHtmlFieldsCms({blockIds:e.block.injects,fields:e.fieldsConfig,base_id:e.baseId,content_id:a}).then(function(i){e.listValueFieldRequired=i.dataFieldValidate.listFieldRequired.fieldRequiredIsValid,e.term=i.dataFieldValidate.term,e.fieldsBlockInjects=[],i.fields.length>0?(e.isShowFieldCurrentBlock=!0,e.isShowFieldBlockInject=!1,!angular.isUndefined(t)&&t||e.chooseFieldsCurrentBlock()):i.fieldsBlocks.length>0&&(e.isShowFieldBlockInject=!0,!angular.isUndefined(t)&&t||e.chooseBlockInject(0,i.fieldsBlocks[0]._id)),e.block.fields=i.fields,e.fieldsBlocks=i.fieldsBlocks;for(var a in i.fieldsBlocks){e.fieldsBlocksMap[i.fieldsBlocks[a]._id]=i.fieldsBlocks[a].fields;for(var l in i.fieldsBlocks[a].fields)e.fieldsBlockInjects.push(i.fieldsBlocks[a].fields[l]);angular.isUndefined(e.successInjectBlock[i.fieldsBlocks[a]._id])&&(e.successInjectBlock[i.fieldsBlocks[a]._id]=!1)}angular.isDefined(n)&&n.call(!0,!0)}).then(function(){angular.isDefined(t)&&t?e.addNewBlockManage():i(function(){B()}),e.isLoadingEdit&&(e.isLoadingEdit=!1,angular.isUndefined(e.block._id)&&(e.isManage=!0)),angular.isDefined(n)&&n.call(!0,!0)})};e.callModalInsert=function(n,a,l,r,o){var s="/cms/block-manager/insert?language="+a+"&&region="+l+"&&type="+n+"&&notShowFieldBlock="+r+"&&id="+o,d=t.open({templateUrl:window.baseUrl+s,controller:"ModalInsertCms",size:void 0,resolve:{blockId:function(){},language:function(){return null},region:function(){return null},listField:function(){}}});d.result.then(function(t){i(function(){e.editableCodeMirror.replaceSelection(t),v(e.editableCodeMirror.getValue(),!1,function(e){M()})})})},e.chooseFieldsCurrentBlock=function(){e.activeBlockTab=[],Object.keys(angular.extend({},e.curFields)).length&&p(e.curFields),angular.isDefined(e.block.base_id)?e.currentBlockInject=e.block.base_id:e.currentBlockInject="current_block",_(),F(e.currentBlockInject,"current",function(t){e.warningError=!1,e.isManage=!0,e.isShowFieldCurrentBlock=!0,e.isShowFieldBlockInject=!1,i(function(){w()}),M()})},e.chooseBlockInject=function(t,n){Object.keys(angular.extend({},e.curFields)).length&&p(e.curFields),_(),F(n,"inject",function(a){e.activeBlockTab=[],e.activeBlockTab[t]=!0,e.warningError=!1,e.currentIndexBlockInject=t,e.currentBlockInject=n,e.isShowFieldBlockInject=!0,e.isShowFieldCurrentBlock=!1,e.isManage=!0,i(function(){w()}),M()})},e.validateCurrentForm=function(t){e.warningError=!1;var i=!1;t||(i=!0),e.isShowFieldCurrentBlock?e.successFieldsCurrentBlock=i:angular.isDefined(e.currentBlockInject)&&(e.successInjectBlock[e.currentBlockInject]=i);var n=e.contentBlock["_"+e.currentBlockInject],a=e.listValueFieldRequired[e.currentBlockInject];angular.isDefined(n)&&angular.isDefined(n.data)&&angular.isDefined(n.data.fields)&&e.updateStatusFieldRequired(a,n.data.fields,e.currentBlockInject)},e.showValueContent=function(t){e.isDetail&&!t&&(e.successForm[1]=!0),_(),e.warningError=!1,e.submitted=!1,e.isContent=!0,e.isDetail=!1,e.isManage=!1,i(function(){e.editableCodeMirror.refresh(),M()},700)},e.format="MM-dd-yyyy",e.minDate=new Date,e.submitted=!1,e.showField=!1,e.showLoad=!1;e.open=function(t,i){t.preventDefault(),t.stopPropagation(),e.opened={},e.opened[i]=!0},CodeMirror.markClean=function(){alert("Content Changed")},e.contentBlock={},e.currentReviewBlockUrl="",e.isShowCode=!0,e.showCodeBlock=function(){e.isShowCode=!0,e.isShowReView=!1},e.removeThumbnail=function(){confirm("Do you want delete this image?")&&delete e.block.thumbnail},e.submit=function(t){if(e.submitted=!0,e.warningErrorMissDataField=!1,t){var i=$('form[name="formData"]').find(".ng-invalid:eq(0)").closest("div.tab-pane").attr("id");return!e.activeTabError(!0)&&angular.isDefined(i)&&"detail"==i&&($('#mytab a[href="#detail"]').tab("show"),e.isDetail=!0),w(),$(".ng-invalid:eq(1)").focus(),void h("#show-warning")}if(e.requiredEditorContent)return $('#mytab a[href="#content"]').tab("show"),e.requiredEditorContent=!0,e.isContent=!0,e.saving=!1,void h("#show-warning");if(e.isShowManageBlock&&e.isManage){if(e.activeTabError(!0))return e.listErrorListFile=[],void h("#show-warning");if(e.checkMinimumFieldOfBlock())return void $("#show-warning").addClass("hidden")}if(!e.isChangeDataMirror||e.parsedContent){var n=A();n.length?U(!0):e.addNewBlockManage()}else _(),v(e.editableCodeMirror.getValue(),!0,function(t){e.parsedContent=!0,0!=t.fields.length?U(!0):e.addNewBlockManage(),e.isChangeDataMirror=!1})},e.addNewBlockManage=function(){e.saving=!0,_(),e.block.content=e.editableCodeMirror.getValue(),e.block.type="managed_block",y(e.contentBlock),e.block.contentBlock=e.contentBlock,l.addNew(e.block).then(function(t){t.status?window.location.href=window.baseUrl+"/cms/block-manager/set-block-selected/"+t.block.folder_id:e.saving=!1})},e.cancel=function(){},e.closeAlert=function(){e.warningErrorMissDataField=!1}}]);var fileModule=angular.module("file");fileModule.factory("FileResource",["$resource",function(e){return e("/admin/document-manager/:method/:id",{},{add:{method:"post"},save:{method:"post"},update:{method:"put"}})}]).factory("shareDataFactory",["$rootScope",function(e){var t={};return t.data="",t.prepForBroadcase=function(e,t){this.data=e,this.broadcastItem(t)},t.broadcastItem=function(t){e.$broadcast(t)},t}]).service("FileService",["$q","$filter","FileResource",function(e,t,i){var n=[],a=[],l=[],r=[],o=[],s=[],d=[];this.create=function(t){var n=e.defer(),a=new i(t);return a.$save({},function(e){e.status?n.resolve(e):n.resolve(null)},function(e){n.resolve(null)}),n.promise},this.fileShare=function(t){var n=e.defer(),a=new i(t);return a.$save({id:t.fileId,method:"file-share"},function(e){n.resolve(e)},function(e){n.resolve(null)}),n.promise},this.deleteFileUserShare=function(t){var n=t.folder_id;"undefined"!=typeof t.file_id&&(n=t.file_id);var a=e.defer();return i["delete"]({id:n,method:"delete-file-user-share",userShareId:t.user_id,group:t.group},function(e){a.resolve(e)}),a.promise},this.getChildFolders=function(t){var n=e.defer();return i.query({id:t,method:"get-child-folders"},function(e){n.resolve(e)}),n.promise},this.getFilesFolder=function(){return a},this.getFiles=function(){return n},this.update=function(t){var n=e.defer(),a=new i(t);return a.$save({id:t._id},function(e){e.status?n.resolve(e):n.resolve(null)},function(e){n.resolve(null)}),n.promise},this.get=function(t,n){var a=e.defer();return i.get({id:t,prefix:n},function(e){a.resolve(e)}),a.promise},this.getAllOfUser=function(t){var n=e.defer();return i.query({created_at:t,method:"file-all"},function(e){for(var t in e)r[e[t].id]=e[t];n.resolve(e)}),n.promise},this.pushFilesOfUser=function(e){filesFormat=[];for(var t in e)r.push(e[t]);return r},this.getFilesOfUser=function(){return r},this.query=function(){var t=e.defer();return n&&n.length?t.resolve(n):i.query().$promise.then(function(e){n=e,t.resolve(n)}),t.promise},this.remove=function(t){var a=e.defer();new i(t);return i["delete"]({id:t},function(e){if(e.status){for(var i in d)if(d[i].id==t){d.splice(i,1);break}for(var i in n)if(n[i].id==t){n.splice(i,1);break}}a.resolve(e)}),a.promise},this.visibleFolder=function(t){var a=e.defer(),l=new i(t);return l.$save({id:t,method:"visible-folder"},function(e){if(e.status){for(var i in d)if(d[i].id==t){d[i].visible=e.visible;break}for(var i in n)if(n[i].id==t){n.splice(i,1);break}}a.resolve(e)}),a.promise},this.deleteFolder=function(t){var n=e.defer();return i["delete"]({id:t,method:"delete-folder"},function(e){if(e)for(var i in d)if(d[i].id==t){d.splice(i,1);break}n.resolve(e)}),n.promise},this.setFiles=function(e){n=e},this.pushFiles=function(e){n.push(e)},this.setFilesCurrentFolder=function(e){d=e},this.getFilesCurrentFolder=function(e){return d},this.pushFile=function(e){o=[],o.push(e),n.push(e)},this.pushFileFoler=function(e){a=[],o=[];for(var t in n)a[t]=n[t];a.push(e),o.push(e),n=a},this.getFileUpload=function(){return o},this.editFile=function(e){l=e},this.getDataFileEdit=function(){return l},this.getData=function(){return n},this.addFolder=function(t){var n=e.defer(),a=new i(t);return a.$save({method:"add-folder"},function(e){n.resolve(e)},function(e){n.resolve(null)}),n.promise},this.checkFile=function(e){var t=["png","gif","jpg","jpeg"];if("undefined"!=typeof e){if(-1!=t.indexOf(e.split("/")[1]))return"image";switch(e.split("/")[1]){case"zip":return"zip";case"pdf":return"pdf";case"msword":return"msword";default:return"other"}}},this.formatFilesWitFolderId=function(){var e=[];for(var t in n)angular.isArray(e[n[t].folder_id])||(e[n[t].folder_id]=[]),e[n[t].folder_id].push(n[t]);s=e},this.getFileFolderMap=function(){return s},this.filesMap=function(e){var t=[];for(var i in e)t[e[i].id]=e[i];return t},this.download=function(t){var n=e.defer(),a=new i;return a.$get({id:t,method:"download"},function(e){n.resolve(e)},function(e){n.resolve(null)}),n.promise},this.editFileName=function(t){var a=e.defer(),l=new i(t);return l.$update({id:t.id,method:"edit-file-name"},function(e){for(var t in n)if(n[t].id==e.id&&n[t].group==e.group){n[t]=e;break}if(e.folder_id>0||e.parent_id>0)for(var t in d)if(d[t].id==e.id){d[t]=e;break}a.resolve(e)},function(e){a.resolve(null)}),a.promise}}]),requestBlock.directive("multiSelectBlock",["$timeout",function(e){return{restrict:"EA",scope:{items:"=",itemsAssigned:"=",requiredItem:"=",placeholder:"@"},templateUrl:"/app/components/blocks/views/view.html?v=2",link:function(e,t,i){e.assignItem=function(){if(e.test={},"undefined"!=e.selectedItemFrom){for(var t in e.selectedItemFrom){var i=e.selectedItemFrom[t];e.itemsAssigned[i]=e.items[i],delete e.items[i]}(1==e.requiredItem||angular.isUndefined(e.requiredItem))&&(angular.equals(e.itemsAssigned,e.test)||(e.requiredItem=!1)),e.selectedItemFrom=[]}},e.undoItem=function(){if(angular.isArray(e.items)&&(e.items={}),angular.isDefined(e.selectedItemTo)){if(0==e.selectedItemTo.length)return;for(var t in e.selectedItemTo){var i=e.selectedItemTo[t];e.items[i]=e.itemsAssigned[i],delete e.itemsAssigned[i]}(0==e.requiredItem||angular.isUndefined(e.requiredItem))&&angular.equals(e.itemsAssigned,e.test)&&(e.requiredItem=!0),e.selectedItemTo=[]}}}}}]),requestBlock.directive("codeMirror",function(){return{restrict:"A",link:function(e,t,i){CodeMirror.fromTextArea(document.getElementById("code"),{lineNumbers:!0,theme:"night",extraKeys:{F11:function(e){e.setOption("fullScreen",!e.getOption("fullScreen"))},Esc:function(e){e.getOption("fullScreen")&&e.setOption("fullScreen",!1)}}})}}});var editDraftApp=angular.module("EditDraftApp",[]);editDraftApp.factory("EditDraftResource",["$resource",function(e){return e("/api/pages/:method/:id",{method:"@method",id:"@id"},{add:{method:"post"},save:{method:"post"},update:{method:"put"}})}]),editDraftApp.service("EditDraftService",["EditDraftResource","$q",function(e,t){this.editDraft=function(i){var n=t.defer(),a=new e(i);return a.$save({method:"edit-draft"},function(e){n.resolve(e)},function(e){n.resolve(e.data)}),n.promise},this.editChangeDraft=function(i,n,a){var l=t.defer(),r=new e(i);return r.$save({method:"edit-change-draft"},function(e){l.resolve(e)},function(e){l.resolve(e.data)}),l.promise},this.createDraftContentPreview=function(i,n){var a=t.defer(),l=new e(i);return l.$save({method:"create-preview-draft"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.changePositionOfBlock=function(i){var n=t.defer(),a=new e(i);return a.$save({method:"change-position-block"},function(e){n.resolve(e)},function(e){n.resolve(e.data)}),n.promise},this.addFieldType=function(i){var n=t.defer(),a=new e(i);return a.$save({method:"add-field-type"},function(e){n.resolve(e)},function(e){n.resolve(e.data)}),n.promise},this.addFieldType=function(e,i,n,a,l){var r=t.defer();l="undefined"==typeof n?1:n+1;var o=new RegExp("[[0]]","g"),s='<label class="label-form"><span class="pointer"         ng-click="removeFieldType('+a+","+l+",'"+e.variable.trim()+"')\"> "+e.name+'&nbsp<i class="fa fa-times"></i></span></label><div class="clearfix"></div>',d=angular.copy(e.form);d=d.replace(o,l+"]");var c='<small class="help-inline" ng-show="submitted && !curFields.'+e.variable+"["+l+"] && "+e.required+' == true"><span style="text-transform: capitalize;">'+e.name+"</span> is invalid</small>";return d='<div id="element-apepend-'+a+l+'">'+s+d+c+"</div>",r.resolve({dynamicIndex:l,html:d}),r.promise},this.convertContentToInject=function(e){var n=t.defer(),a=Object.keys(e).length,l=0;if(l==a)return n.resolve(e),n.promise;for(i in e){l++;var r=$("<div>"+e[i]+"</div>").find('[data^="inject"]');if(r.each(function(t,n){var a="{{"+$(n).attr("data")+"}}";e[i]=e[i].replace(" >",">"),e[i]=e[i].replace($(n)[0].outerHTML,a)}),l==a)return n.resolve(e),n.promise}},this.getContentForIframe=function(){var i=t.defer(),n=new e(data);return n.$save({method:"get-content-iframe"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.getListQueryWithViewId=function(i){var n=t.defer(),a=new e(i);return a.$save({method:"get-list-query-with-view-id",id:i.id},function(e){n.resolve(e)},function(e){n.resolve(e.data)}),n.promise},this.customDataDatabsesFieldOfTemplate=function(i){var n=t.defer(),a=new e(i);return a.$save({method:"custom-data-databses-field-of-template"},function(e){n.resolve(e)},function(e){n.resolve(e.data)}),n.promise},this.getParentUrl=function(i){var n=t.defer(),a=new e(i);return a.$save({method:"get-parent-url"},function(e){n.resolve(e)},function(e){n.resolve(e.data)}),n.promise},this.getDataPage=function(i){var n=t.defer(),a=new e(i);return a.$save({method:"get-data-page"},function(e){n.resolve(e)},function(e){n.resolve(e.data)}),n.promise},this.removeDataPage=function(i){var n=t.defer();return e.get({id:i,method:"remove-data-page"},function(e){n.resolve(e)}),n.promise},this.sortArray=function(e,i,n){var a=[],l=t.defer();for(var r in n)r==i&&n[e]&&(a[i]=n[e]),i>e?r>e&&i>=r?n[r]&&(a[parseInt(r)-1]=n[r]):(r>i||e>r)&&n[r]&&(a[r]=n[r]):e>i&&(e>r&&r>=i?n[r]&&(a[parseInt(r)+1]=n[r]):(i>r||r>e)&&n[r]&&(a[r]=n[r]));return l.resolve(a),l.promise}}]);var cmsApp=angular.module("cmsContentFolderApp");cmsApp.service("CmsContentFolderService",["$q",function(e){var t,i=this,n=[],a=!1,l="",r="",o="";this.changeStatusHideOrShowAllNestedContent=function(){n=[],a=!a,0==a?(t.isFolder()?this.showFirstLevelOfChildPages(t.children):n.push(t),l="Show All Nested Content"):(t.isFolder()?this.showAllLevelOfChildPages(t.children):n.push(t),l="Hide All Nested Content");var i={textButton:l,contents:n,nodeActive:t},r=e.defer();return r.resolve(i),r.promise},this.getDataNestedFromActiveNode=function(){return n=[],t.isFolder()?this.showAllLevelOfChildPages(t.children):(t.openChild=!0,n.push(t)),n},this.getDataFromActiveNode=function(e){var i=["blocks","assets","templates"];if(!(i.indexOf(t.data.type)>-1)){if(n=[],t.isFolder()){e&&0!=t.data.parent_id&&n.push(t);for(var a in t.children)n.push(t.children[a])}else t.openChild=!0,n.push(t);return n}},this.reloadTree=function(){var e=$("#tree").fancytree("getTree");e.reload()},this.initTree=function(e){a=!1,$("#tree").fancytree({extensions:["glyph"],source:n,autoScroll:!0,activate:function(l,o){var s=$("#tree").fancytree("getTree"),d=$("#tree").fancytree("getActiveNode");d.sortChildren(null,!0),t=s.getNodeByKey(String(r)),null!=t?(t.setActive(),r=""):t=d,i.expandAllChildNodes(t);var c=t.getChildren();n=[],t.isFolder()&&!angular.isUndefined(t.folder)||n.push(t),0==a?i.showFirstLevelOfChildPages(c):i.showAllLevelOfChildPages(c);var u=e.call(u,n,t)},click:function(e,t){var i=t.node;if(!i.isExpanded()&&angular.isDefined(i.data.type))switch(i.data.type){case"assets":i.data.type!=o&&$("#page-loading").css("display","block"),$("#click-asset").click();break;case"templates":i.data.type!=o&&$("#page-loading").css("display","block"),$("#click-template").click();break;case"pages":i.data.type!=o&&$("#page-loading").css("display","block"),$("#click-page").click();break;case"blocks":i.data.type!=o&&$("#page-loading").css("display","block"),$("#click-block").click();break;case"database":i.data.type!=o&&$("#page-loading").css("display","block"),$("#click-database").click();break;case"accessories":1!=i.isActive()&&$("#page-loading").css("display","block");break;case"lasers":1!=i.isActive()&&$("#page-loading").css("display","block");break;case"material":1!=i.isActive()&&$("#page-loading").css("display","block");break;case"platform":1!=i.isActive()&&$("#page-loading").css("display","block");break;case"product":1!=i.isActive()&&$("#page-loading").css("display","block")}}}),i.expandedRootNode()},this.expandAllChildNodes=function(e){"0"!=e.data.parent_id&&(e.setExpanded(!0),e.visit(function(e){e.setExpanded(!0)}))},this.cosllapseAllNodeNotActive=function(){},this.showFirstLevelOfChildPages=function(e){null==e||"Loading..."==e[0].title?e=[]:angular.forEach(e,function(e,t){e.isFolder()||n.push(e)})},this.showAllLevelOfChildPages=function(e){null==e||"Loading..."==e[0].title?e=[]:angular.forEach(e,function(e,t){e.hasChildren()?i.showAllLevelOfChildPages(e.children):e.isFolder()||n.push(e)})},this.expandedRootNode=function(){var e=$("#tree").fancytree("getTree"),t=e.getRootNode().children;for(var i in t)if(t[i].data.type==o)var n=i;var a=e.getRootNode().children[n];angular.isDefined(a)&&a.setActive(),a.hasChildren()&&a.setExpanded()},this.setActiveNode=function(e){r=e},this.setContents=function(e,t){return o=t,n=e},this.getContents=function(){return n}}]);var cmsInsertApp=angular.module("cmsContentInsertApp",[]);cmsInsertApp.factory("CmsContentInsertResource",["$resource",function(e){return e("/api/cm-content/:method/:id",{method:"@method",id:"@id"},{add:{method:"post"},save:{method:"post"},update:{method:"put"}})}]).service("CmsContentInsertService",["CmsContentInsertResource","$q","$filter",function(e,t,i){function n(e,t){for(var i in e)t=i;return t}function a(e,t,a){return function l(e,a){for(var r in e)!angular.isArray(e[r])&&angular.isObject(e[r])&&Object.keys(e[r]).length?(t+="[",a=n(e[r],a),l(e[r],a),t+="]"):(angular.isUndefined(e[r])&&(e[r]=null),angular.isDate(e[r])&&(e[r]=i("date")(e[r],"MM-dd-yyyy")),t+=r!=a?"'"+e[r]+"', ":"'"+e[r]+"'")}(e,a),t=t.replace(/\]\[/g,"], [")}this.insertServiceProvider=function(e){},this.getContentBlock=function(i,n){var a=t.defer(),l=new e(i);return l.$save({id:n,method:"get-content-block"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.customCurrentData=function(e,t,l,r){var o="";if(angular.isDefined(r))for(var s in r){var d=0;if(d=n(l[r[s].variable],d),angular.isDate(l[r[s].variable])&&(l[r[s].variable]=i("date")(l[r[s].variable],"MM-dd-yyyy")),angular.isObject(l[r[s].variable])||angular.isArray(l[r[s].variable])){var c="term"==r[s].type?"term:":"",u=c+"[";u=a(l[r[s].variable],u,d),u+="]",o=o+", "+u}else angular.isUndefined(l[r[s].variable])&&(l[r[s].variable]=null),l[r[s].variable]=this.formatCurrentData(l[r[s].variable]),o=o+", '"+l[r[s].variable]+"'"}return"{{-- Begin "+window.blockCommentMap[t]+" Block --}}{{inject('"+i("lowercase")(e)+"', '"+t+"'"+this.formatCurrentData(o)+")}}{{-- End "+window.blockCommentMap[t]+" Block --}} "},this.formatCurrentData=function(e){if(angular.isString(e))var e=e.replace(/\r?\n/g,"<br />");return e},this.getDetailCommentAsset=function(i){var n=t.defer(),a=new e;return a.$save({id:i,method:"get-detail-comment-asset"},function(e){n.resolve(e)}),n.promise},this.getDetailCommentLink=function(i){var n=t.defer(),a=new e;return a.$save({id:i,method:"get-detail-comment-link"},function(e){n.resolve(e)}),n.promise},this.getBlockAndUpdateInjectAutoIncrement=function(i){var n=t.defer(),a=new e;return a.$save({id:i,method:"get-block-and-update-inject-auto-increment"},function(e){n.resolve(e)}),n.promise}}]);var fileUpload=angular.module("uls");fileUpload.directive("fileUpload",["FileService","Upload","$timeout",function(e,t,i){return{restrict:"EA",require:"^ngModel",scope:{files:"=",fileIds:"=",openPicture:"&",disabled:"=",control:"="},replace:!0,transclude:!0,templateUrl:baseUrl+"/app/shared/file-upload/views/file-upload.html?v=1",link:function(n,a,l,r){function o(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}var s=0;n.baseUrl=baseUrl,n.fileUpload={},n.fileUploaded=[],n.fileUploadIds=[],n.fileError={},n.uploadFinish=!0,r.$setViewValue({finished:n.uploadFinish}),n.numberFileUpload=[],n.upload=function(e){if(e&&e.length){s++,angular.isUndefined(n.numberFileUpload[s])&&(n.numberFileUpload[s]=[]);for(var a=0;a<e.length;a++)r.$setViewValue({finished:!1}),function(a){r.$setViewValue({finished:!1});var l=e[a];return angular.isDefined(window.maxUpload)&&l.size>window.maxUpload.size?(l.uniId=o(),l.proccess=100,l.error=1,l.status=0,n.fileUpload[l.uniId]=l,n.fileUpload[l.uniId].error="Max file size is "+window.maxUpload.name,n.fileError[l.uniId]=l,void r.$setViewValue({finished:!0})):(l.uniId=o(),l.proccess=0,l.error="",n.fileUpload[l.uniId]=l,void t.upload({url:baseUrl+"/support/file",file:l}).progress(function(e){if(r.$setViewValue({finished:!1}),angular.isDefined(n.fileUpload[l.uniId]))var t=parseInt(100*e.loaded/e.total);else{var t=100;n.uploadFinished=!0,r.$setViewValue({finished:n.uploadFinished})}angular.isDefined(n.fileUpload[l.uniId])&&(n.fileUpload[l.uniId].proccess=t,n.uploadFinished=!1,r.$setViewValue({finished:n.uploadFinished}))}).error(function(t,i,r,o){e.splice(1,a),angular.isDefined(n.fileUpload[l.uniId])&&(angular.isDefined(t.message)&&(n.fileUpload[l.uniId].error=t.message),n.fileError[o.file.uniId]=t)}).success(function(e,t,i,a){n.uploadFinished=!0,r.$setViewValue({finished:n.uploadFinished}),angular.isDefined(n.fileUpload[a.file.uniId])&&(e.item.uniId=a.file.uniId,n.fileUploaded.push(e.item),n.fileUploadIds.push(e.item.id))})["finally"](function(){n.uploadFinished=!0,i(function(){r.$setViewValue({ids:n.fileUploadIds,files:n.fileUploaded,finished:n.uploadFinished})})}))}(a)}},r.$render=function(){i(function(){n.filesUpload=r.$viewValue})},n.checkFile=function(t){return e.checkFile(t)},n.internalControl=n.control||{},n.internalControl.deleteAllFileUploaded=function(){delete n.fileUpload,n.fileUpload={},n.uploadFinished=!0,r.$setViewValue({ids:n.fileUploadIds,files:n.fileUploaded,finished:n.uploadFinished})},n.deleteFile=function(e){delete n.fileUpload[e];for(var t in n.fileUploaded)if(e==n.fileUploaded[t].uniId){var a=n.fileUploadIds.indexOf(n.fileUploaded[t].id);delete n.fileUploaded[t],n.fileUploadIds.splice(a,1)}n.uploadFinished=!0,i(function(){r.$setViewValue({ids:n.fileUploadIds,files:n.fileUploaded,finished:n.uploadFinished})})},n.$on("emptyFiles",function(e,t){n.fileUpload={},n.fileUploaded=[],n.fileUploadIds=[]})}}}]).filter("bytes",function(){return function(e,t){if(isNaN(parseFloat(e))||!isFinite(e))return"-";"undefined"==typeof t&&(t=1);var i=["bytes","kB","MB","GB","TB","PB"],n=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,Math.floor(n))).toFixed(t)+" "+i[n]}});var cmsConfigApp=angular.module("CmsApp");cmsConfigApp.controller("ConfigController",["$scope","$modal","$filter",function(e,t,i){e.configSection=function(e,i){var n=window.baseUrl+"/app/shared/cms/cms-config/modal/view-config-section.html?"+(new Date).getTime(),a=t.open({templateUrl:n,controller:"ModalConfigSection",size:void 0,resolve:{sections:function(){return i}}});a.result.then(function(t){var i=e.call(i,t)},function(){var t=e.call(t)})},e.listFields=[],e.setData=function(){angular.isDefined(data.fields)&&(e.listFields=angular.copy(data.fields))},e.configFields=function(e,i){var n=window.baseUrl+"/app/shared/cms/cms-config/modal/view-config-field.html?"+(new Date).getTime(),a=t.open({templateUrl:n,controller:"ModelConfigField",size:void 0,resolve:{item:function(){return i}}});a.result.then(function(t){var i=e.call(i,t)},function(){var t=e.call(t)})},e.getModalShowListConfigFields=function(e,i){if(i.length<0||angular.isUndefined(i.length)&&Object.keys(i).length<0)return void e.call(!0,data);var n=t.open({templateUrl:window.baseUrl+"/app/shared/cms/cms-config/modal/list-field-config.html?v="+(new Date).getTime(),controller:"ModalShowListConfigFields",size:void 0,windowClass:"update-template",resolve:{fields:function(){return i}}});n.result.then(function(t){var i=e.call(i,t)},function(){var t=e.call(t)})}}]).controller("ModalConfigSection",["$scope","$modalInstance","Upload","sections",function(e,t,i,n){e.stepSection=0,e.sectionsConfig=n,e.sections=[],e.sectionLenght=n.length,e.loadingFile=[],e.errorThumbnailSection=[],e.submittedSection=[],e.uploadThumbnailSection=function(t,n){t&&t.length&&(e.loadingFile[n]="uploading file",i.upload({url:baseUrl+"/admin/file",method:"POST",file:t,fields:{store:"template-content-manager"}}).progress(function(t){e.isErrorUploadFile=!0}).success(function(i,a,l,r){e.isErrorUploadFile=!1,e.sections[n].thumbnail=i.item.id,e.loadingFile[n]=t[0].name,e.errorThumbnailSection[n]=""}).error(function(t){e.loadingFile[n]="",e.errorThumbnailSection[n]=t.message}))},e.eventNextStepSection=function(i){e.submittedSection[e.stepSection]=!0,!i&&e.sections[e.stepSection].thumbnail&&(e.stepSection<e.sectionLenght-1?e.stepSection++:t.close(e.sections))},e.prevStepSection=function(){e.stepSection>0&&e.stepSection--},e.cancel=function(){t.dismiss("cancel")}}]).controller("ModelConfigField",["$scope","item","$modalInstance",function(e,t,i){e.listFields=[],e.listFieldType=window.listFieldType,e.attributeDataOption=window.listAttributeDataOption,e.listIdCheck=angular.copy(window.listIdCheck),e.listMapType=window.listMapType,e.listFieldNameMap=window.listFieldNameMap,e.listMapTypeTextSpecial=window.listMapTypeTextSpecial,e.listBlocks=window.listBlocks,e.curStepField=0,e.stepThird=!0,angular.isDefined(t)&&(e.listFields=angular.copy(t)),e.nextStepFileld=function(t,n){if($(".ng-invalid:eq(0)").focus(),e.submitted=!0,e.errorMax="",n)return void $(".ng-invalid:eq(1)").focus();if("field_title"==e.listFields[t].variable&&(e.listFields[t].field_type="text",e.listFields[t].type="text"),e.listFields[t].multiple){var a=e.listFields[t].min_field,l=e.listFields[t].max_field;if(angular.isDefined(a)&&angular.isDefined(l)&&l&&a&&a>l)return e.errorMax="Max is invalid",void angular.element("#max-field-in").focus()}return e.submitted=!1,angular.isDefined(window.listMapType[e.listFields[t].field_type])?e.listFields[t].type=angular.copy(window.listMapType[e.listFields[t].field_type]):e.listFields[t].type=angular.copy(e.listFields[t].field_type),e.curStepField==e.listFields.length-1?void i.close(e.listFields):void(e.curStepField=t+1)},e.hiddenE=function(){e.errorMax=""},e.prevStepFileld=function(t){e.curStepField=t-1},e.eventPrevStepSecond=function(){0==e.result.sections.length?(e.stepFirst=!0,e.stepThird=!1):(e.stepSecond=!0,e.stepThird=!1)},e.cancel=function(){angular.element("#model-template-content").show(),i.dismiss("cancel")}}]).controller("ModalShowListConfigFields",["$scope","$modalInstance","$timeout","fields","$filter",function(e,t,i,n,a){e.listFieldType=window.listFieldType,e.listMapType=window.listMapType,e.mapListType=[];for(var l in e.listFieldType)e.mapListType[e.listFieldType[l]._id]=e.listFieldType[l].name;e.attributeDataOption=window.listAttributeDataOption,e.listIdCheck=angular.copy(window.listIdCheck),e.fields=n,e.fieldsRollback=angular.copy(e.fields),e.edit=[],e.validate=[],e.listBlocks=window.listBlocks,e.blockMapFields=[];for(var l in e.listBlocks){e.blockMapFields[l]=[];for(var r in e.listBlocks[l].fields){var o=e.listBlocks[l].fields[r].variable;e.blockMapFields[l][o]=e.listBlocks[l].fields[r].name}}e.mapSort={"":"None",asc:"Asc",desc:"Desc"},e.orderBySort=function(t,i){t||(e.fields[i].order_by="asc")},e.showEditField=function(t){e.edit[t]=!0},e.editField=function(t,i){isValidate=e.validateFields(t,i),isValidate||(angular.isDefined(window.listMapType[e.fields[t].field_type])?e.fields[t].type=angular.copy(window.listMapType[e.fields[t].field_type]):e.fields[t].type=angular.copy(e.fields[t].field_type),i.multiple&&null==i.min_field&&(e.fields[t].min_field=1),e.edit[t]=!1,e.fieldsRollback=angular.copy(e.fields))},e.rollbackItemField=function(t,i){e.validate[t]=[];for(var n in e.fieldsRollback)if(e.fieldsRollback[n].variable===i){e.fields[t]=angular.copy(e.fieldsRollback[n]);break}e.edit[t]=!1},e.checkValidateFields=function(){for(var t in e.fields){if(isValidate=e.validateFields(t,e.fields[t]),isValidate)return;angular.isDefined(window.listMapType[e.fields[t].field_type])?e.fields[t].type=angular.copy(window.listMapType[e.fields[t].field_type]):e.fields[t].type=angular.copy(e.fields[t].field_type),e.fields[t].multiple&&null==e.fields[t].min_field&&(e.fields[t].min_field=1)}i(function(){angular.element("#submit-field").trigger("click")},10)},e.hideValidate=function(t,i){"undefined"!=typeof e.validate[t]&&"undefined"!=typeof e.validate[t][i]&&(e.validate[t][i]="")},e.updateTitleCheck=function(t){("checkbox"!=e.fields[t].field_type&&"radio"!=e.fields[t].field_type||"checkbox"!=window.listMapType[e.fields[t].field_type]||"radio"!=window.listMapType[e.fields[t].field_type])&&"undefined"!=typeof e.fields[t].ra_check_title&&(e.fields[t].ra_check_title="")},e.updateContentField=function(){t.close(e.fields)},e.cancel=function(){t.dismiss("cancel")},e.validateFields=function(t,i){var n=!1;return e.validate[t]=[],
0==i.name.length&&(e.validate[t].name=a("trans")("name","directive-cms-config")+" "+a("trans")("required","validate"),n=!0),i.max_field<0?(e.validate[t].max_field=a("trans")("max","golbal")+" "+a("trans")("invalid","validate"),n=!0):i.max_field&&i.max_field<i.min_field&&i.min_field>0&&(e.validate[t].max_field=a("trans")("max","golbal")+" "+a("trans")("invalid","validate"),n=!0),i.min_field<0?(e.validate[t].min_field=a("trans")("min","golbal")+a("trans")("invalid","validate"),n=!0):i.min_field>i.max_field&&i.max_field>0&&(e.validate[t].min_field=a("trans")("min","golbal")+" "+a("trans")("invalid","validate"),n=!0),"checkbox"!=i.field_type&&"radio"!=i.field_type&&"checkbox"!=window.listMapType[i.field_type]&&"radio"!=window.listMapType[i.field_type]||"undefined"!=typeof i.ra_check_title&&0!=i.ra_check_title.length||(e.validate[t].ra_check_title=a("trans")("title","golbal")+" "+a("trans")("required","validate"),n=!0),"select"!=i.field_type&&"select"!=window.listMapType[i.field_type]||"undefined"!=typeof i.option_id&&i.option_id||(e.validate[t]["data-option"]=a("trans")("option","golbal")+" "+a("trans")("required","validate"),n=!0),n}}]).directive("formatNumber",["$filter","$timeout",function(e,t){return{restrict:"A",require:"?ngModel",scope:{listTypes:"="},link:function(e,t,i,n){n.$viewChangeListeners.push(function(){var e=t.val();!e||isNaN(e)?(n.$setViewValue(null),n.$render()):String(e).length>=9&&!isNaN(e)&&(e=e.substr(0,9),n.$setViewValue(e),n.$render(),event.preventDefault())})}}}]),function(e){angular.module("formBuilderDirectiveApp",[]).directive("switchBootstrap",["$parse","$timeout",function(e,t){return{restrict:"A",require:"?ngModel",link:function(e,t,i,n){e.isDisable=!1,angular.isDefined(window.isDisable)&&(e.isDisable=window.isDisable),t.bootstrapSwitch({}),window.isDisable||t.on("switchChange.bootstrapSwitch",function(t,i){n&&e.$apply(function(){n.$setViewValue(i)})}),e.$watch(i.ngModel,function(i,a){i?(n.$setViewValue(!0),t.bootstrapSwitch("state",!0,!0)):(n.$setViewValue(!1),t.bootstrapSwitch("state",!1,!0)),t.bootstrapSwitch("disabled",e.isDisable,e.isDisable)})}}}]).directive("limitTo",[function(){return{restrict:"A",link:function(e,t,i){var n=999999999999999;"number"==i.type&&(n=7),"text"==i.type&&(n=255),t.bind("keypress",function(e){return t[0].value.length>=n?(e.preventDefault(),!1):void 0})}}}]).directive("select2",["$timeout",function(t){return{restrict:"A",require:"?ngModel",replace:!0,link:function(i,n,a,l){function r(t){return e(n).find('[value="? undefined:undefined ?"]').remove(),e("<span>"+t.text+"</span>")}i.$watch(a.ngModel,function(a,r){angular.isDefined(l.$modelValue)&&l.$modelValue==l.$modelValue?(i.valueActived=l.$modelValue,t(function(){e(n).select2().val(i.valueActived).change()})):t(function(){e(n).select2().val("").change()})}),t(function(){e(n).select2({templateResult:r}),e(n).removeClass("form-control")},500)}}}]).directive("multiSelect",["$parse","$timeout",function(t,i){return{restrict:"A",require:"?ngModel",link:function(t,n,a,l){var r=[];t.isDisable=!1,angular.isDefined(window.isDisable)&&(t.isDisable=window.isDisable),t.$watch(a.ngModel,function(a,l){i(function(){angular.isDefined(a)&&(angular.isUndefined(l)||0==r.length)&&(r=a,e(n).multiSelect("select",a)),t.isDisable&&e(n).multiSelect({disabledClass:"disabled"})})}),t.isDisable||e(n).multiSelect({})}}}]).directive("colorPicker",["$parse","$compile","$timeout",function(t,i,n){return{restrict:"A",require:"?ngModel",link:function(i,n,a,l){function r(e,t){e.$setViewValue(t),e.$render(),s(t)}function o(e,t){var i;return i=e.length>5?-1!=l.$viewValue.indexOf("#")?String(e).substring(1,7):String(e).substring(1,6):e}function s(t){e(n).spectrum({color:t,preferredFormat:"hex",allowEmpty:!0,showInitial:!0,showInput:!0,disabled:i.isDisable,change:function(e){r(l,e.toHexString()),l.$parsers.push(function(e){return l.$viewValue=o(e,l),l.$render(),-1==l.$viewValue.indexOf("#")&&(l.$viewValue="#"+l.$viewValue),l.$viewValue})}})}i.isDisable=!1,angular.isDefined(window.isDisable)&&window.isDisable&&(i.isDisable=!0);var d=t(a.ngModel);d=d(i),d==d&&angular.isDefined(d)&&d?r(l,d):r(l,"#f00"),i.$watch(a.ngModel,function(e,t){angular.isDefined(l.$modelValue)&&r(l,l.$modelValue)})}}}]).directive("datepickerRowboat",["$compile",function(e){return{restrict:"A",require:"?ngModel",link:function(e,t,i,n){t.bind("click",function(){var t=i.isOpen;e.$apply(function(){angular.isUndefined(e[t])?e[t]=!0:e[t]=!e[t]})})}}}]).directive("uimaskRowboat",["$compile",function(e){return{restrict:"A",require:"?ngModel",link:function(e,t,i,n){var a=t.attr("ui-mask");t.mask(a)}}}]).directive("redactor",["$compile","$timeout","$parse",function(t,i,n){return{restrict:"A",require:"?ngModel",link:function(t,a,l,r){var o=!1;if(angular.isDefined(window.isDisable)&&window.isDisable&&i(function(){e(a).redactor("button.disableAll")}),t.$watch(l.ngModel,function(i,n){return o?void(o=!1):void(angular.isDefined(r.$modelValue)&&r.$modelValue==r.$modelValue&&(e(a).redactor("code.set",r.$modelValue),"<div></div>"!=r.$modelValue&&""!=r.$modelValue&&"<br>"!=r.$modelValue||(t.checkRequired=!0)))}),t.inited=0,window.redactorInited){if(o)return void(o=!1);var s=n(l.ngModel);return void(angular.isDefined(s(t))&&s(t)==s(t)&&e(a).redactor("code.set",s(t)))}e(a).redactor({imageUpload:"/content/upload",plugins:["table"],callbacks:{blur:function(e){var i=this.code.get();"<div></div>"!=i&&""!=i&&"<br>"!=i||(t.checkRequired=!0),r.$setViewValue(i),o=!0},change:function(e){if(!l.disabled){var i=this.code.get();"<div></div>"!=i&&""!=i&&"<br>"!=i||(t.checkRequired=!0),r.$setViewValue(i),o=!0}},insertedTable:function(e){var t=this.code.get();r.$setViewValue(t),o=!0},init:function(){t.inited=1,i(function(){e(a).each(function(t,i){r.$modelValue&&angular.isDefined(r.$modelValue)&&angular.isDefined(e.data(i,"redactor"))&&e(a).redactor("code.set",r.$modelValue)})})}},focus:!1,minHeight:300})}}}]).directive("uploadFile",["$http","$parse","$timeout","Upload",function(e,t,i,n){return{restrict:"EA",require:"?ngModel",scope:{files:"=",fileIds:"=",openPicture:"&",disabled:"=",isUploading:"&"},priority:1,replace:!0,transclude:!0,templateUrl:baseUrl+"/app/shared/form-builder-directive/views/file-upload.html?v="+(new Date).getTime(),link:function(e,t,a,l){function r(){a.ngMultiple||(a.ngMultiple="true");var t="true"===a.ngMultiple;if("true"!=a.ngMultiple?(e.ngMultiple=!1,"false"==a.ngMultiple?e.uploadMultiple=t:e.uploadMultiple="one"):(e.ngMultiple=t,e.uploadMultiple=t),"undefined"!=typeof l.$modelValue&&null!=l.$modelValue){if("one"==e.uploadMultiple){e.hideIconLoading=!0;var i=e.listFilesFormBuilder[l.$modelValue],n=[];n.uniId=d(),n.proccess=100,n.error=0,angular.isDefined(i)&&(n.name=i.file_name,n.file_name=i.file_name,n.id=i.id,n.size=i.size,n.type=i.type),e.fileUploadIds=l.$modelValue,e.fileUpload[n.uniId]=n,l.$setViewValue(e.fileUploadIds),e.hideIconLoading=!1,c(e.fileUpload)}else if(e.fileUploadIds=[],angular.isArray(l.$modelValue)){for(var r=0;r<l.$modelValue.length;r++){var o=l.$modelValue.length;e.hideIconLoading=!0;var i=e.listFilesFormBuilder[l.$modelValue[r]],n=[];n.uniId=d(),n.proccess=100,n.error=0,angular.isDefined(i)&&(n.name=i.file_name,n.file_name=i.file_name,n.id=i.id,n.size=i.size,n.type=i.type),e.fileUploadIds.push(l.$modelValue[r]),e.fileUpload[n.uniId]=n,o==e.fileUploadIds.length&&(e.hideIconLoading=!1)}l.$setViewValue(e.fileUploadIds),angular.isDefined(l.$modelValue)&&r==l.$modelValue.length&&c(e.fileUpload)}}else e.fileUpload={}}function o(e){f()}function s(e){var t=["png","gif","jpg","jpeg"];if("undefined"!=typeof e){if(-1!=t.indexOf(e.split("/")[1]))return"image";switch(e.split("/")[1]){case"zip":return"zip";case"pdf":return"pdf";case"msword":return"msword";default:return"other"}}}function d(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}function c(t){if(angular.isDefined(e.fileUploaded)&&!e.fileUploaded.length)for(var i in t)e.fileUploaded.push(t[i])}e.disabled=window.isDisable;var u=0;e.baseUrl=baseUrl,e.fileUpload={},e.fileUploaded=[],e.fileUploadIds=[],e.fileError={},e.accept=a.accept,e.uploadFinish=!0,e.listFilesFormBuilder=window.listFilesFormBuilder,e.isLoadField={},e.numberFileUpload=[];var f=e.$watch(function(){r()},o);e.upload=function(t){if(e.fileUploaded=[],t&&t.length){u++,angular.isUndefined(e.numberFileUpload[u])&&(e.numberFileUpload[u]=[]);for(var r=0;r<t.length;r++)"image"==a.accept&&a.accept!=s(t[r].type)||(e.isUploading({status:!0}),function(r){"one"==e.uploadMultiple&&(e.fileUpload={});var o=t[r];o.uniId=d(),o.proccess=0,o.error="",e.isUploadServe=a.isUploadServe,e.fileUpload[o.uniId]=o,angular.isDefined(window.maxUpload.size)&&o.size>window.maxUpload.size?(angular.isUndefined(e.fileError[o.uniId])&&(e.fileError[o.uniId]={}),e.fileError[o.uniId].status=0,e.fileError[o.uniId].error="Max file size is "+window.maxUpload.name,e.fileUpload[o.uniId].error="Max file size is "+window.maxUpload.name,e.uploadFinished=!0,l.$setViewValue(e.fileUploadIds)):n.upload({method:"POST",url:baseUrl+"/upload-form-builder/file",file:o,data:a.isUploadServe}).progress(function(t){var i=parseInt(100*t.loaded/t.total);if(e.fileIsUploading=!0,angular.isDefined(e.fileUpload[o.uniId])){e.fileUpload[o.uniId].proccess=i;var n=Object.keys(angular.extend({},e.fileUpload)).length,a=Object.keys(angular.extend({},e.fileUpload));for(var l in e.fileUpload)if(l==a[n-1]&&100==e.fileUpload[l].proccess)e.isUploading({status:!1});else if(e.fileUpload[l].proccess<100)break}}).error(function(i,n,a,l){t.splice(1,r),angular.isDefined(e.fileUpload[o.uniId])&&(i&&angular.isDefined(i.message)&&(e.fileUpload[o.uniId].error=i.message),e.fileError[l.file.uniId]=l.file,e.fileError[l.file.uniId].status=i.status)}).success(function(t,i,n,a){angular.isDefined(e.fileUpload[a.file.uniId])&&(e.isUploadServe?(t.item.uniId=a.file.uniId,"one"==e.uploadMultiple?(e.fileUploaded=t.item,e.fileUploadIds=t.item.id):(e.fileUploaded.push(t.item),e.fileUploadIds.push(t.item.id)),e.listFilesFormBuilder[t.item.id]=t.item):"one"==e.uploadMultiple?(e.fileUploaded=a.file.uniId,e.fileUploadIds=a.file):(e.fileUploaded.push(a.file.uniId),e.fileUploadIds.push(a.file)))})["finally"](function(){e.uploadFinished=!0,i(function(){l.$setViewValue(e.fileUploadIds)})})}(r))}},l.$render=function(){e.filesUpload=l.$viewValue},e.checkFile=function(e){return s(e)},e.deleteFile=function(t){if(delete e.fileUpload[t],"one"==e.uploadMultiple)e.fileUploadIds=[],e.uploadFinished=!0,l.$setViewValue(null);else for(var i in e.fileUploaded)if(t==e.fileUploaded[i].uniId){var n=e.fileUploadIds.indexOf(e.fileUploaded[i].id);e.fileUploadIds.splice(n,1),e.uploadFinished=!0,e.fileUploadIds.length?l.$setViewValue(e.fileUploadIds):l.$setViewValue(null)}},e.$on("emptyFiles",function(t,i){e.fileUpload={},e.fileUploaded=[],e.fileUploadIds=[]})}}}]).directive("refreshCheckbox",["$compile",function(e){return{restrict:"A",require:"?ngModel",link:function(e,t,i,n){e.$watch(i.ngModel,function(e,i){angular.isDefined(n.$modelValue)&&(1==n.$modelValue&&n.$setViewValue(!0),t.attr("checked",n.$modelValue))})}}}]).filter("bytes",function(){return function(e,t){if(isNaN(parseFloat(e))||!isFinite(e))return"-";"undefined"==typeof t&&(t=1);var i=["bytes","kB","MB","GB","TB","PB"],n=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,Math.floor(n))).toFixed(t)+" "+i[n]}})}(jQuery);var selectLevel=angular.module("selectLevel",[]),version=5;selectLevel.directive("selectLevel",["$timeout","$filter",function(e,t){return{require:"?ngModel",restrict:"EA",scope:{items:"=",text:"@",title:"@",textFilter:"@",index:"=",key:"=",itemChoose:"=",selectedItems:"=selectedItem",onClick:"&",currentPage:"=",showIcon:"=",typeSelect:"=",disableClick:"=",notSelectCurrent:"=",chageType:"=",type:"=",canChooseFolder:"="},replace:!0,templateUrl:baseUrl+"/app/shared/select-level/view.html?v="+(new Date).getTime(),link:function(i,n,a,l){function r(e){var t={};return angular.forEach(e,function(e,i){t[e]=i}),t}i.currentIndex={value:0},"Asset"==i.type&&(i.items=window.assets),i.$watch("selectedItems",function(t,n){angular.isDefined(t)&&null!=t&&e(function(){var e={_id:t.selectedItemId,name:t.selectedItemName,parentIds:t.parentIds};i.selectedItem(e)})});var o="";"undefined"==typeof i.index&&(i.index=0),"undefined"==typeof i.key&&(i.key=0),e(function(){$(document).on("click",function(e){$("#select-level-modal-"+i.key+"-"+i.index).hasClass("in")&&!$(".js-filterable-field").is(":focus")&&($("#select-level-modal-"+i.key+"-"+i.index).collapse("hide"),$(".show-sub-select i").removeClass("fa fa-folder-open fa").addClass("fa fa-folder"))}),$("#select-level li:has(ul)").children("ul").addClass("off"),$("#select-level li a i").addClass("fa fa-folder"),i.listsId=[],i.showSubSelect=function(e,t){e.preventDefault(),$(e.currentTarget).parent().find("ul:first").toggleClass("off"),$(e.currentTarget).find("i").addClass("fa fa-folder"),$(e.currentTarget).find("i").toggleClass("fa fa-folder-open fa"),e.stopPropagation()},"undefined"!=typeof i.itemChoose&&d(i.items)}),i.focusInput=function(e){e.stopPropagation()};var s=0;i.selectedItem=function(e,n){""!=e._id&&"Assets"==i.typeSelect&&2>=s&&(1==Object.keys(e.parentIds).length?angular.forEach(i.items,function(t,n){t._id==e._id&&(i.items=[],i.items.push(t))}):angular.forEach(i.items,function(t,n){t._id==e.parentIds[Object.keys(e.parentIds).length-1]&&(i.items=[],i.items.push(t))})),s+=1,angular.isDefined(i.currentPage)&&angular.isDefined(e)&&e._id==i.currentPage._id||(angular.isDefined(n)&&n.preventDefault(),(angular.isDefined(e.parentIds)||angular.isDefined(e.parentId)||angular.isDefined(e.parent_id))&&""!=e.name?i.text=e.name:i.text=t("trans")("select-folder","directive-select-level"),l.$setViewValue(e._id),i.chageType&&i.onClick({pageId:e._id}),$("#select-level-modal-"+i.key+"-"+i.index).find(".name-select.active").removeClass("active"),o=e,$("#select-level-modal-"+i.key+"-"+i.index).find(".item-"+o._id).addClass("active"),angular.isDefined(n)&&$("#select-level-modal-"+i.key+"-"+i.index).collapse("hide"))},i.toggleSelectMenu=function(t){e(function(){i.itemsTmp=i.items}),"disabled"!=i.disableClick&&e(function(){if($(".show-sub-select").removeClass("active"),$("#select-level li a i").removeClass("fa fa-folder-open fa").addClass("fa fa-folder"),$(".parrent-select").addClass("off"),o)if(angular.forEach($(".item-"+o._id).parents("ul"),function(e,t){$(e).removeClass("off")}),$(".show-sub-select-"+o._id).addClass("active"),"Link"==i.type){var e=r(window.listsIdsMapPageAndContent);angular.forEach(o.parentIds,function(t,i){$(".show-sub-select-"+e[t]).find("i").removeClass("fa fa-folder").addClass("fa fa-folder-open fa")})}else angular.forEach(o.parentIds,function(e,t){o._id!=e&&$(".show-sub-select-"+e).find("i").removeClass("fa fa-folder").addClass("fa fa-folder-open fa")});$("#select-level-modal-"+i.key+"-"+i.index).collapse("toggle")})},i.closed=function(e){$("#select-level-modal-"+i.key+"-"+i.index).collapse("hide")};var d=function(e){for(var t in e)if(e[t].subFolder&&d(e[t].subFolder),e[t]._id==i.itemChoose){i.text=e[t].name;break}}}}}]);var selectLevel=angular.module("modalSelectLevel",[]),version=3;selectLevel.directive("modalSelectLevel",["$timeout","$filter","$modal","$parse",function(e,t,i,n){return{require:"?ngModel",restrict:"EA",scope:{items:"=",itemSelected:"=",type:"@",onClick:"&",ngModel:"=",isDisabled:"="},templateUrl:baseUrl+"/app/shared/modal-select-level/view.html?v="+version,link:function(e,t,n,a){e.text="",angular.isDefined(e.isDisabled)&&e.isDisabled&&$(".form-control").addClass("no-drop"),e.$watch("ngModel",function(e,i){angular.isDefined(e)&&null!=e&&$(t).find(".text-asset").text(window.listsAsset[e])}),""!=e.itemSelected&&$(t).find(".text-asset").text(window.listsAsset[e.itemSelected]),e.callModal=function(){if(!e.isDisabled){var n="/app/shared/modal-select-level/select.html",l=i.open({templateUrl:window.baseUrl+n,controller:"SelectLevelController",size:null,resolve:{itemSelected:function(){return angular.copy(e.itemSelected)},type:function(){return e.type}}});l.result.then(function(i){$(t).find(".text-asset").text(i.name),e.itemSelected=i._id,a.$setViewValue(i._id),a.$render(),e.onClick()},function(){})}}}}}]),selectLevel.controller("SelectLevelController",["$scope","$modalInstance","$timeout","itemSelected","$timeout","type",function(e,t,i,n,i,a){e.items=[],angular.isDefined(a)?e.items.push(_.find(window.assets,function(e){return e.name==a})):e.items=window.assets;var l="";i(function(){if(!angular.isUndefined(n)&&n){var t=$(".show-sub-select-"+n).data("asset");if(!angular.isUndefined(t)){var i={_id:t._id,name:t.name,parentIds:t.parentIds};e.selectedItem(i)}}},500),i(function(){$("#select-level li:has(ul)").children("ul").addClass("off"),$("#select-level li a i").addClass("fa fa-folder"),e.listsId=[],e.showSubSelect=function(e,t){e.preventDefault(),$(e.currentTarget).parent().find("ul:first").toggleClass("off"),$(e.currentTarget).find("i").toggleClass("fa fa-folder-open fa"),$(e.currentTarget).find("i").addClass(" fa-folder"),e.stopPropagation()}}),e.selectedItem=function(e,t){angular.isDefined(t)&&t.preventDefault(),angular.isDefined(e.subFolder)&&e.subFolder.length>0||$(".show-sub-select-"+e._id).find("i").hasClass("fa-folder")||(angular.forEach($(".item-"+e._id).parents("ul"),function(e,t){$(e).removeClass("off")}),angular.forEach(e.parentIds,function(e,t){$(".show-sub-select-"+e).find("i").removeClass("fa fa-folder").addClass("fa fa-folder-open fa")}),l=e,$(".show-sub-select").removeClass("active"),$(".show-sub-select-"+l._id).addClass("active"))},e.submit=function(){var e={};e._id=l._id,e.name=l.name,t.close(e)},e.cancel=function(){t.dismiss("cancel")}}]);var selectLevel=angular.module("modalSelectPage",[]),version=3;selectLevel.directive("modalSelectPage",["$timeout","$filter","$modal","$parse",function(e,t,i,n){return{require:"?ngModel",restrict:"EA",scope:{items:"=",itemSelected:"=",onClick:"&",ngModel:"=",isDisabled:"="},templateUrl:baseUrl+"/app/shared/modal-select-page/view.html?v="+version,link:function(e,t,n,a){if(e.text="",angular.isDefined(e.isDisabled)&&e.isDisabled&&$(".form-control").addClass("no-drop"),e.$watch("ngModel",function(e,i){angular.isDefined(e)&&null!=e&&$(t).find(".text-page").text(window.listsPageMap[e])}),""!=e.itemSelected)for(var l in window.listsPageMap)if(l==e.itemSelected){$(t).find(".text-page").text(window.listsPageMap[l]);break}e.callModal=function(){if(!e.isDisabled){var n="/app/shared/modal-select-page/select.html",l=i.open({templateUrl:window.baseUrl+n,controller:"SelectLevelLinkController",size:null,resolve:{itemSelected:function(){return angular.copy(e.itemSelected)}}});l.result.then(function(i){$(t).find(".text-page").text(i.name),e.itemSelected=i._id,a.$setViewValue(i._id),a.$render(),e.onClick()},function(){})}}}}}]),selectLevel.controller("SelectLevelLinkController",["$scope","$modalInstance","$timeout","itemSelected","$timeout",function(e,t,i,n,i){e.items=window.listpages,e.listsIdsMapPageAndContent=window.listsIdsMapPageAndContent;var a="";i(function(){if(!angular.isUndefined(n)&&null!=n){var t=$(".show-sub-select-"+window.listsIdsMapPageAndContent[n]).data("page");if(angular.isDefined(t)){var i={_id:t._id,name:t.name,parentIds:t.parentIds,folderId:t.folder_id};e.selectedItem(i)}}},500),i(function(){$(".parrent-select").addClass("off"),$("#select-level li a i").addClass("fa fa-folder"),e.listsId=[],e.showSubSelect=function(e,t){e.preventDefault(),$(e.currentTarget).parent().find("ul:first").toggleClass("off"),$(e.currentTarget).find("i").toggleClass("fa fa-folder-open fa"),$(e.currentTarget).find("i").addClass(" fa-folder"),e.stopPropagation()}}),e.selectedItem=function(e,t){angular.isDefined(t)&&t.preventDefault(),angular.forEach($(".item-"+e._id).parents("ul"),function(e,t){$(e).removeClass("off")}),angular.forEach(e.parentIds,function(e,t){$(".show-sub-select-"+e).find("i").removeClass("fa fa-folder").addClass("fa fa-folder-open fa")}),a=e,$(".show-sub-select").removeClass("active"),$(".show-sub-select-"+window.listsIdsMapPageAndContent[a._id]).addClass("active")},e.submit=function(){var e={};e._id=a._id,e.name=a.name,t.close(e)},e.cancel=function(){t.dismiss("cancel")}}]);var selectLevelAsset=angular.module("selectLevelAsset",[]);selectLevelAsset.directive("selectLevelAsset",["$timeout","$filter",function(e,t){return{require:"?ngModel",restrict:"EA",scope:{items:"=",text:"@",title:"@",textFilter:"@",index:"=",key:"=",itemChoose:"=",selectedItems:"=selectedItem",onClick:"&",currentPage:"=",showIcon:"=",typeSelect:"=",disableClick:"=",notSelectCurrent:"=",chageType:"=",type:"="},replace:!0,templateUrl:baseUrl+"/app/shared/select-level-asset/view.html?v="+(new Date).getTime(),link:function(i,n,a,l){var r=window.window.listAssetFolderContainFirstLevel;i.$watch("selectedItems",function(t,n){angular.isDefined(t)&&e(function(){var e={_id:t.selectedItemId,name:t.selectedItemName,parentIds:t.parentIds};i.selectedItem(e)})});var o="";"undefined"==typeof i.index&&(i.index=0),"undefined"==typeof i.key&&(i.key=0),e(function(){$(document).on("click",function(e){$("#select-level-modal-"+i.key+"-"+i.index).hasClass("in")&&!$(".js-filterable-field").is(":focus")&&($("#select-level-modal-"+i.key+"-"+i.index).collapse("hide"),$(".show-sub-select i").removeClass("fa fa-folder-open fa").addClass("fa fa-folder"))}),$("#select-level li:has(ul)").children("ul").addClass("off"),$("#select-level li a i").addClass("fa fa-folder"),i.listsId=[],i.showSubSelect=function(e,t){e.preventDefault(),$(e.currentTarget).parent().find("ul:first").toggleClass("off"),$(e.currentTarget).find("i").addClass("fa fa-folder"),$(e.currentTarget).find("i").toggleClass("fa fa-folder-open fa"),e.stopPropagation(),i.value=t;var n=_.find(r,function(e){return e._id==t._id});angular.isUndefined(n)||(i.value.subFolder=n.subFolder)},"undefined"!=typeof i.itemChoose&&s(i.items)}),i.focusInput=function(e){e.stopPropagation()};i.selectedItem=function(e,n){angular.isDefined(n)&&n.preventDefault(),(angular.isDefined(e.ancestor_ids)||angular.isDefined(e.ancestor_ids))&&""!=e.name?i.text=e.name:i.text=t("trans")("select-asset","directive-select-level"),l.$setViewValue(e._id),$("#select-level-modal").find(".name-select.active").removeClass("active"),$("#select-level-modal").find(".item-"+e._id).addClass("active"),angular.isDefined(n)&&$("#select-level-modal-"+i.key+"-"+i.index).collapse("hide"),o=e},i.toggleSelectMenu=function(t){e(function(){var e=_.find(r,function(e){return"0"==e.parent_id});i.itemsTmp=e.subFolder}),e(function(){$(".show-sub-select").removeClass("active"),$("#select-level li a i").removeClass("fa fa-folder-open fa").addClass("fa fa-folder"),$(".parrent-select").addClass("off"),o&&(angular.forEach($(".item-"+o._id).parents("ul"),function(e,t){$(e).removeClass("off")}),$(".show-sub-select-"+o._id).addClass("active"),angular.forEach(o.ancestor_ids,function(e,t){$(".show-sub-select-"+e).find("i").removeClass("fa fa-folder").addClass("fa fa-folder-open fa")})),$("#select-level-modal-"+i.key+"-"+i.index).collapse("toggle")})};var s=function(e){for(var t in e)if(e[t].subFolder&&s(e[t].subFolder),e[t]._id==i.itemChoose){i.text=e[t].name;break}}}}}]);var confirmDirectiveModule=angular.module("confirmDirective",[]);confirmDirectiveModule.directive("confirm",["$modal","$parse","$log",function(e,t,i){return{scope:{option:"=",onConfirm:"&"},link:function(i,n,a){n.bind("click",function(){var n=e.open({templateUrl:window.baseUrl+"/app/shared/confirm/view/modal.html",windowClass:"fix-modal-alert",resolve:{messageConfirm:function(){return t(a.confirm)(i)},option:function(){return i.option}},controller:["$scope","$modalInstance","messageConfirm","option",function(e,t,i,n){e.messageConfirm=i,e.option=n,e.ok=function(){t.close()},e.cancel=function(){t.dismiss()}}]});n.result.then(function(){t(a.onConfirm)(i),i.onConfirm()},function(){})})}}}]);