function humanized_time_span(e,t,n,i){function a(){for(var e=0;e<n[d].length;e++)if(null==n[d][e].ceiling||s<=n[d][e].ceiling)return n[d][e];return null}function r(){for(var e=s,t={},n=0;n<i.length;n++){var a=Math.floor(e/i[n][0]);e-=i[n][0]*a,t[i[n][1]]=a}return t}function l(e){var t=r(),n=e.text.replace(/\$(\w+)/g,function(){return t[arguments[1]]});return o(n,t)}function o(e,t){for(var n in t)if(1==t[n]){var i=new RegExp("\\b"+n+"\\b");e=e.replace(i,function(){return arguments[0].replace(/s\b/g,"")})}return e}if(n=n||{past:[{ceiling:60,text:"$seconds seconds ago"},{ceiling:3600,text:"$minutes minutes ago"},{ceiling:86400,text:"$hours hours ago"},{ceiling:2629744,text:"$days days ago"},{ceiling:31556926,text:"$months months ago"},{ceiling:null,text:"$years years ago"}],future:[{ceiling:60,text:"in $seconds seconds"},{ceiling:3600,text:"in $minutes minutes"},{ceiling:86400,text:"in $hours hours"},{ceiling:2629744,text:"in $days days"},{ceiling:31556926,text:"in $months months"},{ceiling:null,text:"in $years years"}]},i=i||[[31556926,"years"],[2629744,"months"],[86400,"days"],[3600,"hours"],[60,"minutes"],[1,"seconds"]],"Invalid Date"==new Date(e))for(;-1!=String(e).indexOf("-");)e=e.replace("-","/");e=new Date(e),t=t?new Date(t):new Date;var s=(t-e)/1e3,d="past";return 0>s&&(d="future",s=0-s),l(a())}angular.module("user",[]),angular.module("permission",[]),angular.module("role",[]),angular.module("multiSelect",[]),angular.module("ticket",[]),angular.module("type",[]),angular.module("dataOption",[]),angular.module("nlcFilter",[]),angular.module("file",[]),angular.module("AppLanguage",[]),angular.module("TemplateManagerApp",[]),angular.module("RegionApp",[]),angular.module("campaignApp",[]),angular.module("campaignDetailApp",[]),angular.module("MarketsegmentApp",[]),angular.module("notification",[]),angular.module("transApp",[]),angular.module("assetManager",[]),angular.module("BlockApp",[]),angular.module("ChannelPartnersApp",[]),angular.module("roleGroup1",[]),angular.module("filedType",[]),angular.module("filed",[]),angular.module("term",[]),angular.module("customFormatDate",[]),angular.module("SeoAnalysisApp",[]),angular.module("pageApp",[]),angular.module("treeresizer",[]),angular.module("CreatePageApp",[]),angular.module("EditDraftApp",[]),angular.module("fomatHtml",[]),angular.module("colorpicker.module",[]),angular.module("formBuilderDirectiveApp",[]),angular.module("appManageTerm",[]),angular.module("TermTemplateManagerApp",[]),angular.module("configurator",[]),angular.module("TemplateContentManager",[]),angular.module("cmsContentFolderApp",[]),angular.module("lowercaseCharater",[]),angular.module("selectLevel",[]),angular.module("modalSelectLevel",[]),angular.module("configField",[]),angular.module("cmsContentInsertApp",[]),angular.module("confirmDirective",[]),angular.module("CmsApp",[]),angular.module("checkLimitAndChangeDateTimeDirectiveApp",[]),angular.module("tagContentApp",[]),angular.module("tagContentDirective",[]),angular.module("cmsContentTagApp",[]),angular.module("viewDraft",[]),angular.module("databaseManager",[]),angular.module("selectLevelDatabase",[]),angular.module("modalSelectPage",[]),angular.module("configFormDatabaseApp",[]),angular.module("historyApp",[]),angular.module("BlockNestedApp",[]),angular.module("selectLevelAsset",[]),angular.module("MaterialApp",[]),angular.module("draganddrop",[]),angular.module("activityLog",[]),angular.module("translation",[]),angular.module("HelpEditorApp",[]),angular.module("helpEditorDirective",[]),angular.module("selectLevelHelp",[]),angular.module("cache",[]),angular.module("file",[]),angular.module("treeresize",[]),angular.module("test",[]),angular.module("guide",[]),angular.module("PlatformsApp",[]),angular.module("accessories",[]);var defaultModules=["ui.bootstrap","ngResource","ngCookies","ngFileUpload","ngRoute","toggle-switch","ngImgCrop","ngTable","user","role","permission","multiSelect","ticket","type","dataOption","nlcFilter","file","xeditable","timer","AppLanguage","TemplateManagerApp","RegionApp","campaignApp","campaignDetailApp","MarketsegmentApp","notification","transApp","assetManager","BlockApp","ChannelPartnersApp","roleGroup1","filedType","filed","term","ui-iconpicker","customFormatDate","SeoAnalysisApp","pageApp","treeresizer","CreatePageApp","EditDraftApp","fomatHtml","colorpicker.module","formBuilderDirectiveApp","appManageTerm","TermTemplateManagerApp","mgo-angular-wizard","configurator","TemplateContentManager","cmsContentFolderApp","lowercaseCharater","selectLevel","configField","cmsContentInsertApp","confirmDirective","CmsApp","checkLimitAndChangeDateTimeDirectiveApp","tagContentApp","tagContentDirective","cmsContentTagApp","viewDraft","modalSelectLevel","databaseManager","selectLevelDatabase","modalSelectPage","configFormDatabaseApp","historyApp","BlockNestedApp","selectLevelAsset","MaterialApp","ui.sortable","activityLog","translation","HelpEditorApp","helpEditorDirective","selectLevelHelp","cache","file","treeresize","guide","PlatformsApp","accessories"];"undefined"!=typeof modules&&(defaultModules=defaultModules.concat(modules));var myApp=angular.module("uls",defaultModules);angular.module("uls").run(["editableOptions",function(e){e.theme="bs3"}]),angular.module("uls").config(["$logProvider",function(e){e.debugEnabled(window.debug)}]),"undefined"!=typeof angularMock&&(defaultModules=defaultModules.concat(angularMock));var goTo=function(e){window.location.href="#_"+e,$("#fix-modal-top").scrollTop(0),$("#"+e).hasClass("in")||$("#"+e).prev().trigger("click")};myApp.config(["$httpProvider",function(e){e.interceptors.push(["$q",function(e){e.defer();return{responseError:function(t){var n=angular.element(".butterbar-container");switch(t.status){case 401:return void(window.location.href=window.baseUrl);case 404:n.hasClass("hidden")&&n.removeClass("hidden");break;case 500:n.hasClass("hidden")&&n.removeClass("hidden")}return e.reject(t)}}}])}]),function(e){function t(){var t=window.innerHeight;screen.height;e(".table-responsive.set-height, .table-responsive#tb-group-user").css({height:t-170+"px"}),e(".table-animate").css({height:t-170+"px"}),e("#search-page,.box-maps").css({height:t-105+"px"}),e(".box-list-rep").css({height:t-100+"px"}),e("#load-maps").css({height:t-185+"px"})}e(document).ready(t),e(window).resize(t),e(document).ready(function(){e(".dropdown-menu table tr td button").removeAttr("style")}),e(document).ready(function(){setTimeout(function(){var t=e("#frame_html").contents().find("head");t.append('<style type="text/css">.area_toolbar{background-color:#f1f1f1;}#editor{border:solid #ccc 1px}#result{border-top:solid #ccc 1px;border-bottom: solid #ccc 1px}.editarea_popup{box-shadow: 0px 4px 36px rgba(177, 177, 177, 0.75);border: solid 1px #CCCCCC;background-color: #FFFFFF;}.area_toolbar select{font-size:9pt;background-color:#fff}</style>')},1e3)}),e(window).load(function(){e(".step3 .show-more").click(function(){e(".step3 .wrap-more-product").toggleClass("show")})}),e(document).ready(function(){e(".nav-icon").click(function(){e(this).toggleClass("open"),e("#pagehome").toggleClass("on-off")})});var n,i,a,r,l,o,s;e(".next").click(function(){return s?!1:(s=!0,n=e(this).parent(),i=e(this).parent().next(),i.show(),void n.animate({opacity:0},{step:function(e,t){o=1-.2*(1-e),r=50*e+"%",l=1-e,n.css({transform:"scale("+o+")"}),i.css({left:r,opacity:l})},duration:800,complete:function(){n.hide(),s=!1},easing:"easeInOutBack"}))}),e(".previous").click(function(){return s?!1:(s=!0,n=e(this).parent(),a=e(this).parent().prev(),a.show(),void n.animate({opacity:0},{step:function(e,t){o=.8+.2*(1-e),r=50*(1-e)+"%",l=1-e,n.css({left:r}),a.css({transform:"scale("+o+")",opacity:l})},duration:800,complete:function(){n.hide(),s=!1},easing:"easeInOutBack"}))}),e(".submit").click(function(){return!1})}(jQuery),angular.module("uls").controller("BaseController",["$scope","$parse","$timeout","$modal","UserService","AssetManagerService",function(e,t,n,i,a,r){if(angular.element(".wrapper").removeClass("hidden"),a.setData(window.usersMap),n(function(){"undefined"!=typeof e.callbackLoadUserFinish&&(e.callbackLoadUserFinish(),e.users_map=a.getUsersMap())}),e.testFuture=window.testFuture,1==e.testFuture&&angular.element(".test").removeClass("hidden"),e.windowType=window.info,"undefined"!=typeof window.info)for(var l in window.info){var o=t(l);o.assign(e,window.info[l])}e.initDate=function(){angular.element(".date").bdatepicker({format:"yyyy-mm-dd"})},e.viewModalImage=function(e){var t=i.open({templateUrl:baseUrl+"/app/components/termTemplateManager/views/modal/viewImage.html",controller:"ModalViewPictureCtrl",size:void 0,windowClass:"show-img",resolve:{fileId:function(){return e}}});t.result.then(function(e){},function(){})},e.urlForm=[],e.getUrlImageAssetForm=function(t,n){"undefined"==typeof e.urlForm[t]&&(e.urlForm[t]=[]),r.getUrlImageAsset(t).then(function(i){e.urlForm[t][n]=i.url})},e.removeThumbnailAssertForm=function(t,n){e.urlForm[t][n]=""},e.initTooltip=function(e){$('[data-toggle="tooltip"]').tooltip()}}]).controller("ModalViewPictureCtrl",["$scope","$modalInstance","fileId",function(e,t,n){e.fileId=n,e.baseUrl=baseUrl,e.cancel=function(){t.dismiss("cancel")}}]);var userModule=angular.module("user");userModule.factory("UserResource",["$resource",function(e){return e("/api/user/:method/:id",{method:"@method",id:"@id"},{add:{method:"post"},save:{method:"post"},update:{method:"put"}})}]).factory("UserService",["$q","$filter","UserResource",function(e,t,n){var i=[],a=[],r=[],l=this,o={},s={};return this.setHashData=function(e){o=e},this.create=function(t){if("undefined"!=typeof t.id)return l.update(t);var a=e.defer(),r=new n(t);return r.$save({},function(e){e.status&&e.item&&(i.push(e.item),"undefined"==typeof e.item.last_login&&(e.item.last_login="0000-00-00 00:00:00")),a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.changePassword=function(t){var i=e.defer(),a=new n(t);return a.$save({method:"change-password",id:t.id},function(e){e.status?i.resolve(e):i.reject(e)},function(e){i.reject(e.data)}),i.promise},this.changeRoles=function(t){var i=e.defer(),a=new n(t);return a.$save({method:"change-roles"},function(e){e?i.resolve(e):i.reject(e)},function(e){i.reject(e.data)}),i.promise},this.update=function(t){var a=e.defer(),r=new n(t);return r.$update({id:t.id},function(e){if(e.status)for(var t in i)if(i[t].id==e.item.id){i[t]=e.item;break}a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.get=function(t){var i=e.defer();return n.get({id:t},function(e){i.resolve(e)}),i.promise},this.query=function(){var t=e.defer();return n.query(function(e){i=e,t.resolve(e)}),t.promise},this.queryUsersManager=function(){var t=e.defer();return n.query({method:"get-all-user-manager"},function(e){i=e,t.resolve(e)}),t.promise},this.remove=function(t){var a=e.defer();return n["delete"]({id:t},function(e){if(e.status)for(var n in i)if(i[n].id==t){i[n].status="no";break}a.resolve(e)}),a.promise},this.pushUser=function(e){i.push(e)},this.updateUser=function(e){for(var t in i)if(i[t].id==e.id){e.status="yes",i[t]=e;break}},this.changeAvatar=function(t,i){var a=e.defer();return n.save({method:"change-avatar",file:i,id:t},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.resetPassword=function(t){var i=e.defer();return n.save({method:"email",entity:"password",email:t},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.getUsers=function(){return i},this.getUserById=function(e){return s[e]},this.getUsersMap=function(){return s},this.listMap=function(e,t){if("role"==t)for(var n in e)a[e[n].id]=e[n];else for(var n in e)r[e[n].id]=e[n]},this.getMap=function(e){return"role"==e?a:r},this.userBranchManager=function(t){var i=e.defer();return n.query({id:t,method:"get-users-branch-manager"},function(e){i.resolve(e)}),i.promise},this.updatePermissions=function(t,i){var a=e.defer();return n.save({id:t,permissionIds:i,method:"update-permission"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.updateGroup=function(t,i){var a=e.defer();return n.save({id:t,groupIds:i,method:"update-group"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.updateRoles=function(t,i){var a=e.defer();return n.save({id:t,roleIds:i,method:"update-role"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.changeStatus=function(t){var a=e.defer();return n["delete"]({id:t,method:"change-status"},function(e){if(e.status)for(var n in i)if(i[n].id==t){i[n].status="yes";break}a.resolve(e)}),a.promise},this.setData=function(e){i=e;for(var t in e)s[e[t].id]=e[t];return i},this.updateShowDueDateUser=function(t){var i=e.defer(),a=new n(t);return a.$save({method:"update-show-due-date-user"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this}]);var assetmanagerApp=angular.module("assetManager",["ngResource","ui.bootstrap","ngSanitize","ngTable"]);assetmanagerApp.factory("AssetManagerResource",["$resource",function(e){return e("/api/asset-manager/:method/:id",{method:"@method",id:"@id"},{add:{method:"post"},save:{method:"post"},update:{method:"put"},editNameFolder:{method:"edit-name-folder"}})}]).service("AssetManagerService",["AssetManagerResource","$q",function(e,t){var n=this,i=[];this.createFolderProvider=function(i){if("undefined"!=typeof i.id)return n.editFolderAndFile(i);var a=t.defer(),r=new e(i);return r.$save({method:"create-folder"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.uploadNewAsset=function(n){var a=t.defer(),r=new e(n);return r.$save({method:"upload-new-asset"},function(e){0!=e.status&&i.push(e.item),a.resolve(e.item)},function(e){a.resolve(e.data)}),a.promise},this.createNewAsset=function(n){var a=t.defer(),r=new e(n);return r.$save({method:"create-new-asset"},function(e){0!=e.status&&i.push(e.item),a.resolve(e.item)},function(e){a.resolve(e.data)}),a.promise},this.saveFieldFile=function(n){var i=t.defer(),a=new e(n);return a.$save({method:"save-file-asset"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.editFile=function(n){var i=t.defer(),a=new e(n);return a.$save({method:"edit-file"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.crop=function(n){var i=t.defer(),a=new e(n);return a.$save({method:"crop"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.addTagsForPage=function(n,i){var a=t.defer(),r=new e(i);return r.$save({id:n,method:"add-tags"},function(e){0!=e.status,a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.getAssetManagerById=function(n){var i=t.defer(),a=new e;return a.$get({id:n},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.setAssetManagers=function(e){return i=e},this.getAssetManagers=function(){return i},this.getUrlImageAsset=function(n){var i=t.defer();return e.get({id:n,method:"get-url-image-asset"},function(e){i.resolve(e)}),i.promise},this.deleteFolderAndAsset=function(n){var i=t.defer(),a=new e;return a.$delete({id:n},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.deleteAssetFile=function(n){var i=t.defer(),a=new e;return a.$get({id:n,method:"delete-file"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.editNameFolder=function(n){var i=t.defer(),a=new e(n);return a.$save({id:n.id,method:"edit-name-folder"},function(e){0!=e.status&&i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.updateContentFile=function(n,i){var a=t.defer(),r=new e(i);return r.$save({id:n,method:"update-content-file"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise}}]),angular.module("uls").controller("NotificationController",["$scope","$filter","NotificationService","$controller","$timeout",function(e,t,n,i,a){function r(){}function l(){if(f=!1,c.length>0){var e=c.shift();s(e)}}function o(){}function s(t){if(f)return void c.push(t);if(f=!0,-1==t.data.sender_id)var n=e.baseUrl+"/160x160_avatar_default.png?t=1";else var n=e.users_map[t.data.sender_id].avatar;var i=new Notify("Notification",{icon:n,body:t.data.message,tag:t.data.sender_id,notifyShow:r,notifyClose:l,notifyClick:function(){window.location.href="/"+t.data.href},notifyError:o,timeout:5});i.show()}i("BaseController",{$scope:e}),e.callbackLoadUserFinish=function(){},angular.element("#notification-top").removeClass("hidden"),e.baseUrl=window.baseUrl;var d=10;e.limitTo=d;var u=1;e.notifications=[];var c=[],f=!1;e.amount=0,$(".scroll-noti1").scroll(function(){$(this)[0].scrollHeight-$(this).scrollTop()===$(this).outerHeight()&&e.$apply(function(){e.limitTo=e.limitTo+d})});var p=RowboatPusher.subscribe("notification_ticket");p.bind("Rowboat\\Notification\\Events\\Notifications\\Broadcast\\NotificationTicket",function(t){e.$apply(function(){"undefined"!=typeof t.data.user_id&&-1!=t.data.user_id.indexOf(window.userId)&&(s(t),u=1,e.amount++)})}),e.getNotifications=function(){n.query(u).then(function(t){u&&e.setUserReadThisNotification(),e.notifications=t,e.hightlight=angular.copy(e.amount),e.amount=0,u=0})},e.setUserReadThisNotification=function(){n.setRead().then(function(){})},n.getAmountNotificationsNotRead().then(function(t){e.amount=t.result})}]);var permissionModule=angular.module("notification");permissionModule.factory("NotificationResource",["$resource",function(e){return e("/api/notification/:method/:id",{},{add:{method:"post"},save:{method:"post"}})}]).service("NotificationService",["$q","$filter","NotificationResource",function(e,t,n){var i=[];this.getAmountNotificationsNotRead=function(t){var i=e.defer();return n.get({method:"amount-notifications-not-read"},function(e){i.resolve(e)}),i.promise},this.query=function(t){var a=e.defer();return t?n.query().$promise.then(function(e){i=e,a.resolve(i)}):a.resolve(i),a.promise},this.notificationInvite=function(t){var i=e.defer(),a=new n(t);return a.$save({data:t,method:"invite"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.setRead=function(){var t=e.defer(),i=new n;return i.$save({method:"set-read"},function(e){t.resolve(e)},function(e){t.resolve(e.data)}),t.promise}}]),notificationModule=angular.module("notification"),notificationModule.directive("notification",[function(){return{restrict:"AE",scope:{item:"="},replace:!0,templateUrl:baseUrl+"/app/shared/notification/views/notification.html",link:function(){}}}]);var module=angular.module("uls");module.directive("rowboatRequired",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,i){"undefined"==typeof e.$eval(n.ngModel)&&i.$setValidity("rowboatRequired",!1),t.on("focus",function(a){e.$watch(n.ngModel,function(e){var n="undefined"!=typeof e&&0!=e.length;if(n)t.parent().find("span").remove(),t.parent().removeClass("error"),i.$setValidity("rowboatRequired",n);else if(0==t.parent().find("span").length){t.parent().addClass("error");var a='<span class="control-label">It is required</span>';t.parent().append(a),i.$setValidity("rowboatRequired",n)}})})}}}),module.directive("rowboatLength",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,i){"undefined"!=typeof e.$eval(n.ngModel)&&e.$eval(n.ngModel).length!=n.rowboatLength&&i.$setValidity("rowboatLength",!1),t.on("focus",function(a){e.$watch(n.ngModel,function(e){var a=n.rowboatLength,r="undefined"!=typeof e&&e.length==a;if(r)t.parent().find("span").remove(),t.parent().removeClass("error"),i.$setValidity("rowboatLength",r);else if(0==t.parent().find("span").length){t.parent().addClass("error");var l='<span class="control-label">Length is '+a+"</span>";t.parent().append(l),i.$setValidity("rowboatLength",r)}})})}}}),module.directive("rowboatMinLength",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,i){"undefined"!=typeof e.$eval(n.ngModel)&&e.$eval(n.ngModel).length<n.rowboatMinLength&&i.$setValidity("rowboatMinLength",!1),t.on("focus",function(a){e.$watch(n.ngModel,function(e){var a=n.rowboatMinLength,r="undefined"!=typeof e&&e.length>=a;if(r)t.parent().find("span").remove(),t.parent().removeClass("error"),i.$setValidity("rowboatMinLength",r);else if(0==t.parent().find("span").length){t.parent().addClass("error");var l='<span class="control-label">Min length is '+a+"</span>";t.parent().append(l),i.$setValidity("rowboatMinLength",r)}})})}}}),module.directive("rowboatMaxLength",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,i){"undefined"!=typeof e.$eval(n.ngModel)&&e.$eval(n.ngModel).length>n.rowboatMaxLength&&i.$setValidity("rowboatMaxLength",!1),t.on("focus",function(a){e.$watch(n.ngModel,function(e){var a=n.rowboatMaxLength,r="undefined"!=typeof e&&e.length<=a;if(r)t.parent().find("span").remove(),t.parent().removeClass("error"),i.$setValidity("rowboatMaxLength",r);else if(0==t.parent().find("span").length){t.parent().addClass("error");var l='<span class="control-label">Max length is '+a+"</span>";t.parent().append(l),i.$setValidity("rowboatMaxLength",r)}})})}}}),module.directive("rowboatEmailPattern",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,i){$pattern=/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/,"undefined"==typeof e.$eval(n.ngModel)&&i.$setValidity("rowboatEmailPattern",!1),t.on("blur",function(a){e.$watch(n.ngModel,function(e){var n="undefined"!=typeof e&&$pattern.test(e);if(n)t.parent().find("span").remove(),t.parent().removeClass("error"),i.$setValidity("rowboatEmailPattern",n);else if(0==t.parent().find("span").length){t.parent().addClass("error");var a='<span class="control-label">Email Invalid</span>';t.parent().append(a),i.$setValidity("rowboatEmailPattern",n)}})})}}});var filterDate=angular.module("customFormatDate",[]);filterDate.filter("myDate",["$filter",function(e){return function(t,n){if(null==t)return"";if("Invalid Date"==new Date(t))for(;-1!=String(t).indexOf("-");)t=t.replace("-","/");if("Invalid Date"==new Date(t))return"";var i=e("date")(new Date(String(t)),angular.isUndefined(n)?"MM-dd-yyyy":n);return String(i)}}]).filter("myDateL",["$filter",function(e){return function(t){if(null==t)return"";if("Invalid Date"==new Date(t))for(;-1!=String(t).indexOf("-");)t=t.replace("-","/");if("Invalid Date"==new Date(t))return"";var n=e("date")(new Date(String(t)),"MMMM d, y");return String(n)}}]).filter("myDateTime",["$filter",function(e){return function(t){if(null==t)return"";if("0000-00-00 00:00:00"==t)return"";if("Invalid Date"==new Date(t))for(;-1!=String(t).indexOf("-");)t=t.replace("-","/");if("Invalid Date"==new Date(t))return"";var n=e("date")(new Date(String(t)),"MM-dd-yyyy HH:mm:ss");return String(n)}}]).filter("myDateShortTime",["$filter",function(e){return function(t){if(null==t)return"";if("0000-00-00 00:00:00"==t)return"";if("Invalid Date"==new Date(t))for(;-1!=String(t).indexOf("-");)t=t.replace("-","/");if("Invalid Date"==new Date(t))return"";var n=e("date")(new Date(String(t)),"MM-dd-yyyy h:mma");return String(n)}}]).filter("clientDate",["$filter",function(e){return function(t,n){if(null==t)return"";if("0000-00-00 00:00:00"==t)return"";if("Invalid Date"==new Date(t))for(;-1!=String(t).indexOf("-");)t=t.replace("-","/");if("Invalid Date"==new Date(t))return"";t=new Date(t),t=new Date(parseInt(new Date(t).getTime())-60*parseInt((new Date).getTimezoneOffset())*1e3);var i=e("date")(new Date(String(t)),angular.isUndefined(n)?"MM-dd-yyyy":n);return String(i)}}]).filter("clientDateTime",["$filter",function(e){return function(t){return e("date")(checkInvalid(t),window.dateTimeFormat)}}]).filter("clientLogDate",["$filter",function(e){return function(t){return e("date")(checkInvalid(t),window.logDate)}}]).filter("clientMediumDate",["$filter",function(e){return function(t){return e("date")(checkInvalid(t),window.mediumDate)}}]).filter("clientShortTime",["$filter",function(e){return function(t){return e("date")(checkInvalid(t),window.shortTime)}}]).filter("clientShortTimeFollowTimezone",["$filter",function(e){return function(t,n){if(null==t)return"";if("Invalid Date"==new Date(t))for(;-1!=String(t).indexOf("-");)t=t.replace("-","/");if("Invalid Date"==new Date(t))return"";var i=e("date")(new Date(String(t)),window.shortTime);return String(i)}}]).filter("formatCurrentDate",["$filter",function(e){return function(e){if(e=checkInvalid(e),!e)return"";e=new Date(e);var t=e.getMonth()+"-"+e.getDate()+"-"+e.getFullYear();return String(t)}}]).filter("formatCurrentTime",["$filter",function(e){return function(e){if(e=checkInvalid(e),!e)return"";e=new Date(e);var t=e.getHours()>=12?"pm":"am",n=parseInt(e.getHours())%12;n=n?10>n?"0"+n:n:12;var i=parseInt(e.getMinutes())<10?"0"+e.getMinutes():e.getMinutes(),a=parseInt(e.getSeconds())<10?"0"+e.getSeconds():e.getSeconds(),r=n+"-"+i+"-"+a+" "+t;return String(r)}}]).filter("formatCurrentShortTime",["$filter",function(e){return function(e){if(e=checkInvalid(e),!e)return"";e=new Date(e);var t=e.getHours()>=12?"pm":"am",n=parseInt(e.getHours())%12;n=n?10>n?"0"+n:n:12;var i=parseInt(e.getMinutes())<10?"0"+e.getMinutes():e.getMinutes(),a=n+":"+i+" "+t;return String(a)}}]);var checkInvalid=function(e,t){if(null==e)return"";if("Invalid Date"==new Date(e))for(;-1!=String(e).indexOf("-");)e=e.replace("-","/");return"Invalid Date"==new Date(e)?"":(e=new Date(e),e=new Date(parseInt(new Date(e).getTime())-60*parseInt((new Date).getTimezoneOffset())*1e3),new Date(String(e)))};angular.module("nlcFilter").filter("elapsedtime",function(){return function(e){return humanized_time_span(e)}});var translation=angular.module("translation",[]);translation.filter("trans",["$filter",function(e){return function(e,t){return null==e?"":window.translations[t][e]}}]);var selectLevel=angular.module("helpEditorDirective",[]),version=5;selectLevel.directive("helpEditorDirective",["$timeout","$filter",function(e,t){return{require:"?ngModel",restrict:"EA",scope:{items:"=",text:"@",selectedItems:"=selectedItem",onClick:"&"},replace:!0,templateUrl:baseUrl+"/app/components/user/help-editor/view/view-help.html?v="+(new Date).getTime(),link:function(t,n,i,a){t.description="",t.recursiveGetDescription=function(e){angular.forEach(e,function(e,n){e.parent=!1,t.description+='<strong class="space-topic" id="_'+e._id+'">'+e.name+"</strong>"+e.description,e.subFolder.length>0&&t.recursiveGetDescription(e.subFolder)})},t.getDesctiption=function(){angular.forEach(t.items,function(e,n){e.parent=!0,t.description+='<h4 id="_'+e._id+'" class="c-primary">'+e.name+'</h4><div class="space-area user-ad-area">'+e.description,t.recursiveGetDescription(e.subFolder),t.description+="</div>"})},t.getDesctiption(),t.goToAnchorWithId=function(e){window.location.href="#"+e,$("#fix-modal-top").scrollTop(0)},e(function(){$(".sub-select-"+t.items[0]._id).addClass("in")})}}}]);var blockApp=angular.module("BlockApp");blockApp.controller("ModalInsertCms",["$scope","$modalInstance","$timeout","$controller","CmsContentInsertService","AssetManagerService","$compile","$filter","EditDraftService","language","region","Upload",function(e,t,n,i,a,r,l,o,s,d,u,c){function f(n){a.getContentBlock({language:d,region:u},n).then(function(n){n.status&&"managed_block"!==n.content.type&&n.content.fields&&n.content.fields.length?(e.existField=!0,e.listField=n.content.fields,m(e.listField)):t.close(a.customCurrentData(o("lowercase")(e.curType),e.currentId))})}function p(e){var t=angular.copy(e);if(angular.isDefined(t)){var n=t;for(var i in n){if(angular.isArray(n[i])||angular.isObject(n[i]))for(var a in n[i])angular.isArray(n[i][a])||angular.isObject(n[i][a])&&Object.keys(n[i][a]).length?n[i][a]=angular.isUndefined(n[i][a])?null:n[i][a]:n[i][a]=angular.isUndefined(n[i][a])?null:n[i][a];t[i]=angular.isUndefined(n[i])?null:n[i]}}return t}function m(t){for(var n in t)t[n].multiple&&(angular.isUndefined(e.curFields)&&(e.curFields={}),e.curFields[t[n].variable]=null,g("add",t[n].variable),e.curFields[t[n].variable]={},e.curFields[t[n].variable][0]=null,angular.isUndefined(e.multiFieldFollowVariable[t[n].variable])&&(e.multiFieldFollowVariable[t[n].variable]=[{id:t[n].variable+0,key_field:0}]))}function g(t,n){if(angular.isDefined(e.countFieldsOfMultiField[n]))switch(t){case"add":e.countFieldsOfMultiField[n]+=1;break;case"remove":e.countFieldsOfMultiField[n]-=1}else e.countFieldsOfMultiField[n]=1}function v(){e.listErrorListFile=[];var t=e.listField;if(angular.isDefined(e.curFields))var n=e.curFields;if(angular.isDefined(t)&&angular.isDefined(n))for(var i in t)if(t[i].multiple&&angular.isDefined(e.countFieldsOfMultiField[t[i].variable])&&e.countFieldsOfMultiField[t[i].variable]<t[i].min_field&&t[i].min_field>1){e.listErrorListFile.push("Please, add minimum "+t[i].min_field+" field "+t[i].name);break}return!!e.listErrorListFile.length}i("BaseController",{$scope:e}),e.item={},e.curFields={},e.file_fields=[],e.countFieldsOfMultiField=[],e.multiFieldFollowVariable=[],e.currentId="",e.listField=[],e.curType="",e.submit=function(n){if(e.requireId=!1,e.currentId=e.item.curValue,"undefined"==typeof e.currentId)return void(e.requireId=!0);if(e.curType=o("lowercase")(n),angular.isDefined(n)&&"Block"==n)if(e.template||e.notShowFieldBlock){var i="{{-- Begin "+window.blockCommentMap[e.item.curValue]+" Block --}}{{inject('block','",r=")}}{{-- End "+window.blockCommentMap[e.item.curValue]+" Block --}}";a.getBlockAndUpdateInjectAutoIncrement(e.item.curValue).then(function(n){$str=i+e.item.curValue+"_"+n.autoIncrement+"'"+r,t.close($str)})}else f(e.currentId);"Asset"==n&&"undefined"!=typeof e.item.curValue&&null!=e.item.curValue&&a.getDetailCommentAsset(e.item.curValue).then(function(n){angular.isDefined(e.item.thumbNail)?$str="{{-- Begin "+n.asset.filename+" Asset --}}{{inject('asset','"+e.item.curValue+"', '"+e.item.thumbNail+"')}}{{-- End "+n.asset.filename+" Asset --}}":$str="{{-- Begin "+n.asset.filename+" Asset --}}{{inject('asset','"+e.item.curValue+"')}}{{-- End "+n.asset.filename+" Asset --}}",$("#checkbox-insert-object").is(":checked")&&($str="{{-- Begin "+n.asset.filename+" Asset --}}@outject('image','asset','"+e.item.curValue+"'){{-- End "+n.asset.filename+" Asset --}}"),t.close($str)}),"Link"==n&&"undefined"!=typeof e.item.curValue&&null!=e.item.curValue&&a.getDetailCommentLink(e.item.curValue).then(function(n){$str="{{-- Begin "+n.link.name+" Link --}}{{inject('link','"+e.item.curValue+"')}}{{-- End "+n.link.name+" Link --}}",t.close($str)})},e.url=[],e.getUrlImageAsset=function(t){r.getUrlImageAsset(t).then(function(n){e.url[t]=n.url})},e.removeThumbnailAssert=function(t,n,i){e.url[t]="","undefined"!=typeof i?e.page.fields[n][i]=null:e.page.fields[n]=null},e.saveContentBlock=function(n){if(e.submitted=!1,n)return $("#form-edit-field").find(".ng-invalid:eq(0)").focus(),void(e.submitted=!0);if(!v()){var i=angular.copy(e.curFields);i.fields=p(i.fields);var r=a.customCurrentData(e.curType,e.currentId,i,e.listField);t.close(r)}},e.addNewField=function(t){e.listErrorListFile=[];var n=0,i=0;if(angular.isDefined(e.multiFieldFollowVariable[t.variable])&&e.multiFieldFollowVariable[t.variable].length)for(var a in e.multiFieldFollowVariable[t.variable])e.multiFieldFollowVariable[t.variable][a].id==t.variable+e.multiFieldFollowVariable[t.variable][a].key_field&&(i+=1,e.multiFieldFollowVariable[t.variable][a].key_field>n&&(n=e.multiFieldFollowVariable[t.variable][a].key_field));return i>=t.max_field?void alert("Maximum "+t.name+" field is "+t.max_field):(n=parseInt(n)+1,e.curFields[t.variable][n]=null,void(angular.isUndefined(e.multiFieldFollowVariable[t.variable])?(e.multiFieldFollowVariable[t.variable]=[{id:t.variable+n,key_field:n}],g("add",t.variable)):(e.multiFieldFollowVariable[t.variable].push({id:t.variable+n,key_field:n}),g("add",t.variable))))},e.removeCurrentField=function(t,n){e.listErrorListFile=[];var i=e.multiFieldFollowVariable[t.variable];if(angular.isDefined(i)&&i.length)for(var a in i)if(i[a].key_field==n&&i[a].id==t.variable+i[a].key_field){angular.isDefined(e.curFields)&&angular.isDefined(e.curFields[t.variable])&&(e.curFields[t.variable]=angular.extend({},e.curFields[t.variable]),angular.isArray(e.curFields[t.variable])&&(e.curFields=angular.extend({},e.curFields)),
delete e.curFields[t.variable][i[a].key_field],g("remove",t.variable)),e.multiFieldFollowVariable[t.variable].splice(a,1);break}},e.uploadFileCurTemp=function(t,n,i){if(t.length){var a=window.maxUpload;return t[0].size>a.size?(angular.isUndefined(i)?e.curFields[n]=null:e.curFields[n][i]=null,void alert("Max file size is "+a.name)):void c.upload({url:baseUrl+"/admin/file",file:t}).progress(function(e){}).success(function(t,a,r,l){angular.isDefined(e.curFields)&&angular.isDefined(i)?(angular.isUndefined(e.curFields[n])&&(e.curFields[n]={}),angular.isUndefined(e.file_fields[n])&&(e.file_fields[n]={}),e.file_fields[n][i]={},e.curFields[n][i]=t.item.id,e.file_fields[n][i].avatar=t.item.file_name):angular.isDefined(e.curFields)&&(e.file_fields[n]=t.item.file_name,e.curFields[n]=t.item.id)}).error(function(e){})}},e.cancel=function(){t.dismiss("cancel")}}]);var editDraftApp=angular.module("EditDraftApp",[]);editDraftApp.factory("EditDraftResource",["$resource",function(e){return e("/api/pages/:method/:id",{method:"@method",id:"@id"},{add:{method:"post"},save:{method:"post"},update:{method:"put"}})}]),editDraftApp.service("EditDraftService",["EditDraftResource","$q",function(e,t){this.editDraft=function(n){var i=t.defer(),a=new e(n);return a.$save({method:"edit-draft"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.editChangeDraft=function(n,i,a){var r=t.defer(),l=new e(n);return l.$save({method:"edit-change-draft"},function(e){r.resolve(e)},function(e){r.resolve(e.data)}),r.promise},this.createDraftContentPreview=function(n,i){var a=t.defer(),r=new e(n);return r.$save({method:"create-preview-draft"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.changePositionOfBlock=function(n){var i=t.defer(),a=new e(n);return a.$save({method:"change-position-block"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.addFieldType=function(n){var i=t.defer(),a=new e(n);return a.$save({method:"add-field-type"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.addFieldType=function(e,n,i,a,r){var l=t.defer();r="undefined"==typeof i?1:i+1;var o=new RegExp("[[0]]","g"),s='<label class="label-form"><span class="pointer"         ng-click="removeFieldType('+a+","+r+",'"+e.variable.trim()+"')\"> "+e.name+'&nbsp<i class="fa fa-times"></i></span></label><div class="clearfix"></div>',d=angular.copy(e.form);d=d.replace(o,r+"]");var u='<small class="help-inline" ng-show="submitted && !curFields.'+e.variable+"["+r+"] && "+e.required+' == true"><span style="text-transform: capitalize;">'+e.name+"</span> is invalid</small>";return d='<div id="element-apepend-'+a+r+'">'+s+d+u+"</div>",l.resolve({dynamicIndex:r,html:d}),l.promise},this.convertContentToInject=function(e){var n=t.defer(),a=Object.keys(e).length,r=0;if(r==a)return n.resolve(e),n.promise;for(i in e){r++;var l=$("<div>"+e[i]+"</div>").find('[data^="inject"]');if(l.each(function(t,n){var a="{{"+$(n).attr("data")+"}}";e[i]=e[i].replace(" >",">"),e[i]=e[i].replace($(n)[0].outerHTML,a)}),r==a)return n.resolve(e),n.promise}},this.getContentForIframe=function(){var n=t.defer(),i=new e(data);return i.$save({method:"get-content-iframe"},function(e){n.resolve(e)},function(e){n.resolve(e.data)}),n.promise},this.getListQueryWithViewId=function(n){var i=t.defer(),a=new e(n);return a.$save({method:"get-list-query-with-view-id",id:n.id},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.customDataDatabsesFieldOfTemplate=function(n){var i=t.defer(),a=new e(n);return a.$save({method:"custom-data-databses-field-of-template"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.getParentUrl=function(n){var i=t.defer(),a=new e(n);return a.$save({method:"get-parent-url"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.getDataPage=function(n){var i=t.defer(),a=new e(n);return a.$save({method:"get-data-page"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.removeDataPage=function(n){var i=t.defer();return e.get({id:n,method:"remove-data-page"},function(e){i.resolve(e)}),i.promise},this.sortArray=function(e,n,i){var a=[],r=t.defer();for(var l in i)l==n&&i[e]&&(a[n]=i[e]),n>e?l>e&&n>=l?i[l]&&(a[parseInt(l)-1]=i[l]):(l>n||e>l)&&i[l]&&(a[l]=i[l]):e>n&&(e>l&&l>=n?i[l]&&(a[parseInt(l)+1]=i[l]):(n>l||l>e)&&i[l]&&(a[l]=i[l]));return r.resolve(a),r.promise}}]);var editDraftApp=angular.module("EditDraftApp");editDraftApp.controller("EditDraftController",["$scope","$modal","$filter","ngTableParams","$http","$window","$timeout","BlockNestedService","EditDraftService","AssetManagerService","$compile","Upload","CmsContentInsertService","BlockNestedService","$controller","RemoveCacheService",function(e,t,n,i,a,r,l,o,s,d,u,c,f,o,p,m){function g(){e.successForm={},angular.isDefined(e.page.url)&&e.page.url&&angular.isDefined(e.page.name)&&e.page.name&&(e.successForm[1]=!0),e.successField={},e.successInject={},e.existInjecIntTemplate={},e.contentPage={},e.cacheContentPage={},e.countFieldsOfMultiField={},e.multiFieldFollowVariable={},e.extendsTemplate={},e.activeTemplate={},e.indexCurrentTemplate=1,e.lastTemplate=0,e.warningError=!1}function v(t,n,i,a){for(var r in i){var l="_"+n+"_"+i[r].variable,o=t[l];if(angular.isDefined(o)&&(angular.isArray(o)||angular.isObject(o))&&i[r].multiple)for(var s in o)angular.isUndefined(e.multiFieldFollowVariable[l])?(e.multiFieldFollowVariable[l]=[{id:i[r].variable+"___"+s,key_field:s}],z("add",l)):(e.multiFieldFollowVariable[l].push({id:i[r].variable+"___"+s,key_field:s}),z("add",l)),"asset"==i[r].type&&e.getUrlImageAsset(o[s]);angular.isDefined(o)&&!i[r].multiple&&"html"==i[r].type&&e.getUrlImageAsset(o)}return a}function h(t,n,i,a){if(angular.isDefined(t.injects))for(var r in t.injects){e.successInject[i][r]=!0;var l=t.injects[r].fields;angular.isDefined(l)&&l.length&&(e.existInjecIntTemplate[i]=!0,e.exitsFieldBlock[r]=!0)}}function b(t){if(angular.isDefined(e.templates[t]["extends"])){var n=angular.copy(e.templates[t]["extends"]);for(var i in n)e.listTemPlate[i]=e.templates[i]}e.listTemPlate[t]=e.templates[t]}function w(e){if(angular.isDefined(e))for(var t in e)if(Object.keys(e[t].fields).length)return!0;return!1}function D(t){var n=e.listTemPlate[t].injects;if(angular.isUndefined(n)||angular.isDefined(n)&&Object.keys(angular.extend({},n)).length<1)T(t);else for(var i in n){var a=n[i].fields;if(angular.isDefined(a)&&Object.keys(a).length){e.curSecIndex=i,Y(i),X(i,"block",function(t){e.isShowInjects={},e.isShowInjects[e.curSecIndex+e.indexCurrentTemplate]=!0,angular.isUndefined(e.activeBlocks[e.curSecIndex+e.indexCurrentTemplate])&&(e.activeBlocks={},e.activeBlocks[e.curSecIndex+e.indexCurrentTemplate]=!0),k(isDetails=!1,isShowField=!0,isShowInject=!0,isShowContentSection=!1,isShowDatabase=!1)});break}Object.keys(n)[Object.keys(n).length-1]==i&&T(t)}}function y(e){!function(e){for(var t in e)angular.isArray(e[t])&&e[t].length||angular.isObject(e[t])&&Object.keys(e[t]).length?y(e[t]):angular.isDate(e[t])&&(e[t]=n("date")(e[t],"yyyy-MM-dd"))}(e)}function k(t,n,i,a,r){e.isDetails=t,e.isShowField=n,i||(e.isShowInjects={}),e.isShowInject=i,e.isShowContentSection=a,angular.isDefined(e.nested_block)&&Object.keys(e.nested_block).length&&F(e.nested_block)}function F(e){!function t(e){for(var n in e)angular.isDefined(e[n])&&angular.isUndefined(e[n].data)?t(e[n]):y(e[n].data)}(e)}function C(t,n,i){var a=e.listTemPlate[t].injects;if(angular.isDefined(a)&&angular.isDefined(a[n])&&angular.isDefined(a[n].fields))var r=a[n].fields;if(angular.isDefined(r)&&r.length>0){angular.isDefined(e.listFieldTemplateRequired[t])&&angular.isDefined(e.listFieldTemplateRequired[t].block)?v(i,n,r,e.listFieldTemplateRequired[t].block[n]):v(i,n,r);var l=e.listFieldTemplateRequired[t][n];V(n,l,e.contentPage["_"+n].data.fields)}angular.element("#page-loading").css("display","none")}function _(t,n){var i=e.listTemPlate[t].fields;if(angular.isDefined(i)&&i.length){v(n,t,i,e.listFieldTemplateRequired[t]);var a=e.listFieldTemplateRequired[t];V(t,a,e.contentPage["_"+t].data.fields)}angular.element("#page-loading").css("display","none")}function T(t){var n=e.listTemPlate[t].sections;for(var i in n){e.chooseSection(!1,n[i].variable,n[i]._id,e.indexCurrentTemplate);break}}function I(t,n,i,a){if(angular.isDefined(e.listFieldTemplateRequired[t],e.listFieldTemplateRequired[e.currentChosseTemplate][t])){var r="_"+t+"_"+n,l=angular.isDefined(e.listFieldTemplateRequired[t])?e.listFieldTemplateRequired[t]:e.listFieldTemplateRequired[e.currentChosseTemplate][t];if(angular.isDefined(l)&&angular.isDefined(l[r])&&angular.isDefined(l[r][a])&&angular.isDefined(l[r][i])){var o=angular.copy(l[r][i]);l[r][i]=angular.copy(l[r][a]),l[r][a]=angular.copy(o)}}}function M(t,n){if(t){if(e.activeTemplate={},e.activeTemplate[e.indexCurrentTemplate]=!0,e.currentTabActive==e.currentChosseTemplate&&angular.isDefined(e.currentTabActive)){var i={};i[e.indexCurrentTemplate]=!0,e.activeFields=i}else if(e.curSecIndex==e.currentTabActive&&angular.isDefined(e.currentTabActive)){var i={};i[e.curSecIndex+e.indexCurrentTemplate]=!0,e.activeBlocks=i}return e.submitted=!0,A(),e.warningError=!0,!0}return e.submitted=!1,!1}function x(e){var t=e.parent().find('[data-toggle="collapse"]');return t.each(function(){var t=$(this).attr("data-target"),n=new RegExp("(.|#)");return t=t.replace(n,""),e.hasClass(t)||e.attr("id")==t?($(this).trigger("click"),!0):void 0}),!1}function A(){var e=$('form[name="formData"]').find(".ng-invalid:eq(0)");e.length&&(!function t(e){if(!e.parent().is("form")&&(e=e.parents(".collapse:not(.in)"),e.length)){if(x(e))return;t(e)}}(e),S())}function S(){var e=$('form[name="formData"]').find(".ng-invalid:eq(0)");if(e.is("div"))$offsetTopOfCurrentDiv=e.offset().top,$("body").scrollTop($offsetTopOfCurrentDiv-150);else if(e.is("textarea")){var t=e.parent(),n=t.find("div.redactor-editor").length;n&&($offsetTopOfCurrentDiv=t.offset().top,$("body").scrollTop($offsetTopOfCurrentDiv-150))}else e&&($offsetTopOfCurrentDiv=e.offset().top,$("body").scrollTop($offsetTopOfCurrentDiv-150));e.focus()}function U(t){if(!e.successField[t])return e.successForm[t]=!1,!0;if(angular.isDefined(e.listTemPlate[t].injects)&&Object.keys(angular.extend({},e.listTemPlate[t].injects)).length){var n=e.listTemPlate[t].injects;for(var i in n)if(angular.isDefined(e.successInject[t])&&angular.isDefined(e.successInject[t][i])&&!e.successInject[t][i])return e.successForm[t]=!1,!0}e.successForm[t]=!0,e.warningError=!1}function V(t,i,a){if(angular.isDefined(a)&&a)for(var r in i)if(Object.keys(angular.extend({},i[r])).length&&-1!=r.indexOf("_"+t)&&angular.isDefined(a[r]))for(var l in i[r])V(t,i[r][l],a[r][l]);else if(angular.isDate(a[r])&&(a[r]=n("date")(a[r],"yyyy-MM-dd")),"object"!=typeof i[r]&&"array"!=typeof i[r]||angular.isDate(i[r]))if(angular.isDefined(a[r])&&(a[r]||0==a[r]))i[r]=!1;else{var o=e.currentChosseTemplate,s=e.listTemPlate[o].term;angular.isDefined(s)&&(angular.isDefined(s[o])&&angular.isDefined(s[o][r])&&s[o][r]?i[r]=!0:angular.isDefined(s[t])&&angular.isDefined(s[t][r])&&s[t][r]&&(i[r]=!0))}return i}function P(t,n,i,a){if("undefined"!=typeof t&&t.length>0){var r=e.currentChosseTemplate;if("undefined"!=typeof n&&(r=n),e.listErrorListFile=[],angular.isDefined(t))for(var o in t){var s="_"+r+"_"+t[o].variable;if(t[o].multiple&&(angular.isUndefined(e.countFieldsOfMultiField[s])||e.countFieldsOfMultiField[s]<t[o].min_field)&&t[o].min_field>0){if(angular.isUndefined(e.countFieldsOfMultiField[s])){var d=angular.isDefined(a)?e.listFieldTemplateRequired[a][r][s]:e.listFieldTemplateRequired[r][s];if(Object.keys(angular.extend({},d)).length&&Object.keys(angular.extend({},d)).length>=t[o].min_field)return!1}return e.listErrorListFile.push("Please, add minimum "+t[o].min_field+" field "+t[o].name),l(function(){r!=e.currentChosseTemplate&&angular.isDefined(r)&&(e.isDetails=!1,e.hasInjectFocus=r),angular.isDefined(a)?angular.element("#populate_"+a).trigger("click"):angular.element("#populate_"+r).trigger("click"),$("body").scrollTop($("#btnSubmitButton").offset().top)}),!0}}}return!1}function j(t){var n=!1;for(var i in e.listTemPlate)if(n=P(e.listTemPlate[i].fields,i,t),n||"undefined"==typeof e.listTemPlate[i].injects){if(n)return n}else for(var a in e.listTemPlate[i].injects)if(n=P(e.listTemPlate[i].injects[a].fields,a,t,i))return n;return n}function q(){for(var t in e.content)angular.isDefined(e.contentPage["_"+t])&&angular.isDefined(e.contentPage["_"+t].data)&&(angular.isUndefined(e.contentPage["_"+t].data.sections)&&(e.contentPage["_"+t].data.sections={}),e.contentPage["_"+t].data.sections=angular.extend({},e.content[t]))}function O(e){var t=/[^a-zA-Z0-9\/\-]/g,n=t.test(e);if(!n){var i=/\/{2,}|\-{2,}/g;n=i.test(e)}return n}function E(t,n,i,a,r){angular.isUndefined(e.multiFieldFollowVariable[i])?(e.multiFieldFollowVariable[i]=[{id:t.variable+"___"+a,key_field:a}],e.currentChosseTemplate==n?e.listFieldTemplateRequired[e.currentChosseTemplate][i][a]=L(t.option_id):e.listFieldTemplateRequired[e.currentChosseTemplate][r][i][a]=L(t.option_id,r),z("add",i)):(e.multiFieldFollowVariable[i].push({id:t.variable+"___"+a,key_field:a}),e.currentChosseTemplate==n?e.listFieldTemplateRequired[e.currentChosseTemplate][i][a]=L(t.option_id):e.listFieldTemplateRequired[e.currentChosseTemplate][r][i][a]=L(t.option_id,r),z("add",i))}function L(t,n){if("undefined"==typeof n)var i=e.listTemPlate[e.currentChosseTemplate].term[e.currentChosseTemplate];else var i=e.listTemPlate[e.currentChosseTemplate].term[n];var a=[];for(var r in i)-1!=r.indexOf(t)&&(a[r]=i[r]);return angular.extend({},a)}function B(t,n,i,a){if(angular.isDefined(e.contentPage["_"+t])&&angular.isDefined(e.contentPage["_"+t].data)&&angular.isDefined(e.contentPage["_"+t].data.fields)&&angular.isDefined(e.contentPage["_"+t].data.fields[i])){var r=angular.copy(e.contentPage["_"+t].data.fields[i]);r=angular.extend({},r);var l=Object.keys(r);if(1==l.length||l[l.length-1]==n)delete r[n];else for(var o in r)parseInt(o)>parseInt(n)&&angular.isDefined(r[o])&&(r[o-1]=angular.copy(r[o]),delete r[o]);e.contentPage["_"+t].data.fields[i]=r}a.call()}function R(t,n,i){var a=e.nested_block[t];if("undefined"!=typeof a&&"undefined"!=typeof a[n]){var r=angular.copy(a[n]);if("undefined"==typeof r.length)for(var l in r)parseInt(l)>parseInt(i)&&"undefined"!=typeof r[l]?(r[l-1]=angular.copy(r[l]),delete r[l]):parseInt(l)==parseInt(i)&&"undefined"!=typeof r[i]&&delete r[i];else r.splice(i,1);e.nested_block[t][n]=r}}function N(t,n,i,a){var r=e.listFieldTemplateRequired[e.currentChosseTemplate];if(angular.isDefined(r)&&(angular.isDefined(r[i])||angular.isDefined(r[a][i]))){if(e.currentChosseTemplate==t)var l=angular.extend({},r[i]);else var l=angular.extend({},r[a][i]);var o=Object.keys(l);if(1==o.length||o[o.length-1]==n)delete l[n];else for(var s in l)parseInt(s)>parseInt(n)&&angular.isDefined(l[s])&&(l[s-1]=angular.copy(l[s]),delete l[s]);e.currentChosseTemplate==t?r[i]=l:r[a][i]=l,W(e.listTemPlate,!1)}}function z(t,n){if(angular.isDefined(e.countFieldsOfMultiField[n]))switch(t){case"add":e.countFieldsOfMultiField[n]+=1;break;case"remove":if(angular.isDefined(e.countFieldsOfMultiField[n])&&e.countFieldsOfMultiField[n]>0){e.countFieldsOfMultiField[n]-=1;break}}else e.countFieldsOfMultiField[n]=1}function H(t,n,i,a,r){var o=!1;return function s(t){for(var d in t)if(Object.keys(angular.extend({},t[d])).length&&-1!=d.indexOf(n))for(var u in t[d])s(t[d][u]);else if(1==t[d]&&(e.successForm[a]=!1,"block"!=r?e.successField[a]=!1:e.successInject[a][n]=!1,i))return l(function(){"block"==r&&(e.isDetails=!1,e.hasInjectFocus=n),$("#populate_"+a).trigger("click")}),o=!0,!0}(t),o}function W(t,n){for(var i in t)if(G(i,n))return!0;return 0===Object.keys(angular.extend({},t)).length&&(e.successForm[e.currentChosseTemplate]=!0),!1}function G(t,n){e.successField[t]=!0;var i=e.listTemPlate[t],a=e.listFieldTemplateRequired[t];if(angular.isDefined(a)){if(H(a,t,n,t,"template"))return U(t),!0;var r=i.injects;if(angular.isDefined(r)&&Object.keys(angular.extend({},r)).length)for(var l in r){var o=a[l];if(e.successInject[t][l]=!0,angular.isDefined(o)&&H(o,l,n,t,"block"))return U(t),!0}}U(t)}p("BaseController",{$scope:e}),e.isSearch=!1,angular.element(".wrap-content-management").removeClass("hidden"),l(function(){$(document).ready(function(){e.setDIVHeight()}),$(window).resize(function(){e.setDIVHeight()})}),e.setDIVHeight=function(){var e=$(".set-height"),t=$(".top-tab").offset(),n=t.top,i=screen.height,a=i-n-490;e.attr("style","height: "+a+"px!important;min-height:300px;overflow:auto")},e.callbackLoadUserFinish=function(){},e.changePageType=function(t){data={pageId:t,language:e.page.language,region:e.page.region},s.getParentUrl(data).then(function(t){e.page.parentUrl=t.url_build})},e.listBlockMapData=angular.copy(window.blockMapFileld),e.listFieldTemplateRequired=angular.copy(window.listFieldTemplateRequired.fieldRequiredIsValid),e.listTemPlate={},e.multiFieldFollowVariable=[],e.exitsFieldBlock={},e.isDetails=!0,e.codeMirrorInited=!1,e.currentChosseTemplate=0,e.page=angular.copy(window.page),e.versions=angular.copy(window.versions),e.curLanguage=angular.copy(window.page.language),e.region=angular.copy(window.page.region),e.folderPages=window.folderPages,e.isChangeTemplate=!1,g(),e.baseUrl=window.baseUrl,e.parents=window.parents,e.templates=angular.copy(window.templates),e.checkPage=window.checkPage,e.listOutTypeMap=angular.copy(window.listOutTypeMap),e.maxUpload=window.maxUpload,e.nested_block={},e.curFields={},e.activeFields={},e.isShowInjects={},e.isDisable=window.isDisable,e.cacheNestedContend={};var Q=function(t){g(),e.activeTemplate[e.indexCurrentTemplate]=!0;var n=1;e.successForm[1]=!0,b(t);for(var i in e.listTemPlate){var a=angular.copy(e.listTemPlate[i]);(a.fields.length||a.sections.length||w(a.injects))&&(angular.isUndefined(e.successInject[t])&&(e.successInject[i]={}),n++,e.extendsTemplate[n]=i,e.listTemPlate[i].stepTemplate=n,h(a,"edit",i,n))}W(e.listTemPlate,!1),e.lastTemplate=n};angular.isDefined(e.page.template)&&(angular.isDefined(e.templates[e.page.template])?Q(e.page.template):e.page.template=null,e.currentChosseTemplate=e.page.template),e.isShowCode=!0,e.changeTemplate=function(t){if(angular.isDefined(e.currentChosseTemplate)&&e.currentChosseTemplate&&e.currentChosseTemplate!=t){var i=confirm(n("trans")("confirm-change-template","page"));if(!i)return void(angular.isDefined(e.page.template)&&(e.page.template=e.currentChosseTemplate))}g(),e.listFieldTemplateRequired=angular.copy(window.listFieldTemplateRequired.fieldRequiredIsInvalid),e.nested_block={},e.listTemPlate={},e.isChangeTemplate=!0,b(t),e.currentChosseTemplate=t,e.template=e.templates[t],e.activeTemplate[e.indexCurrentTemplate]=!0;var a=1;e.isShowContentSection=!1,e.content={},ee(e.listTemPlate,a),e.extend=t,W(e.listTemPlate)},e.closeAlert=function(){e.warningError=!1},e.checkWhenSavePreview=function(){var t=$("#extend-template").find(".ti-alert");return 0==t.length?(e.warningError=!1,!1):(e.warningError=!0,!0)},e.nextStepPage=function(t,n){if(e.showNotificationNoFields=!1,e.warningError=!1,e.submitted=!1,!(n>e.lastTemplate)){if(t)return e.submitted=!0,void $('form[name="formData"]').find(".ng-invalid:eq(0)").focus();e.indexCurrentTemplate++,e.currentChosseTemplate=e.extendsTemplate[e.indexCurrentTemplate],X(e.currentChosseTemplate,"template",function(t){0==e.listTemPlate[e.currentChosseTemplate].fields.length?D(e.currentChosseTemplate):k(isDetails=!1,isShowField=!0,isShowInject=!1,isShowContentSection=!1,isShowDatabase=!1),e.activeTemplate[n]=!1,e.activeTemplate[e.indexCurrentTemplate]=!0,W(e.listTemPlate,!1)}),Y(e.currentChosseTemplate)}},e.prevStepPage=function(t){e.showNotificationNoFields=!1,2>t||(3>t&&(e.isShowField=!1,e.isDetails=!0),e.activeTemplate[t]=!1,e.indexCurrentTemplate--,angular.isDefined(e.extendsTemplate[e.indexCurrentTemplate])&&(e.currentChosseTemplate=e.extendsTemplate[e.indexCurrentTemplate]),0==e.listTemPlate[e.currentChosseTemplate].fields.length&&D(e.currentChosseTemplate),angular.isDefined(e.nested_block)&&Object.keys(e.nested_block).length&&F(e.nested_block),e.activeTemplate[e.indexCurrentTemplate]=!0)},e.indexCurrentTemplate=1,e.chooseDetails=function(t){e.submitted=!1,e.activeTemplate={},e.activeBlocks={},e.activeFields={},delete e.currentTabActive,e.showNotificationNoFields=!1,e.listErrorListFile=[],e.indexCurrentTemplate=1,e.activeTemplate[e.indexCurrentTemplate]=!0,k(isDetails=!0,isShowField=!1,isShowInject=!1,isShowContentSection=!1,isShowDatabase=!1)};var X=function(t,n,i){if(angular.isDefined(e.cacheContentPage["_"+t])){if(e.contentPage["_"+t]=e.cacheContentPage["_"+t],angular.isDefined(i))var a=i.call(a,!0)}else{var r={base_id:t,content_id:e.page.content_id,type:n,template_id:e.currentChosseTemplate,blocks_injects:e.blocksInjects,is_change_template:e.isChangeTemplate};angular.element("#page-loading").css("display","block"),s.getDataPage(r).then(function(a){if(angular.isDefined(a.data["_"+t].data)&&(a.data["_"+t].data=angular.extend({},a.data["_"+t].data),angular.isDefined(a.data["_"+t].data.fields)&&(a.data["_"+t].data.fields=angular.extend({},a.data["_"+t].data.fields))),e.contentPage["_"+t]=a.data["_"+t],e.cacheContentPage["_"+t]=e.contentPage["_"+t],"block"==n?C(e.currentChosseTemplate,t,e.contentPage["_"+t].data.fields):(n="template")&&_(t,e.contentPage["_"+t].data.fields),angular.element("#page-loading").css("display","none"),angular.isDefined(i))var r=i.call(r,!0)})}};e.chooseCurrentTemplate=function(t,n,i,a){if(e.submitted=!1,!M(t)){e.currentTabActive=n,e.showNotificationNoFields=!1,e.blocksInjects=[];for(var r in e.templates[n].injects)e.blocksInjects.push(r);if(e.indexCurrentTemplate=a,e.currentChosseTemplate=n,e.activeTemplate={},e.activeTemplate[a]=!0,!t&&angular.isDefined(e.hasInjectFocus)&&angular.isDefined(angular.element("#injects_"+e.hasInjectFocus)))return void l(function(){$("#injects_"+e.hasInjectFocus).trigger("click"),delete e.hasInjectFocus});angular.isDefined(e.hasInjectFocus)&&delete e.hasInjectFocus,X(n,"template",function(t){e.activeFields={},0==e.listTemPlate[n].fields.length?D(n):(k(isDetails=!1,isShowField=!0,isShowInject=!1,isShowContentSection=!1,isShowDatabase=!1),angular.isUndefined(e.activeFields[e.indexCurrentTemplate])&&(e.activeFields={},e.activeBlocks={},e.activeFields[e.indexCurrentTemplate]=!0)),G(e.currentChosseTemplate,!1),e.isDetails=!1,l(function(){A()})}),Y(n)}},e.chooseFields=function(t,n){e.submitted=!1,M(t)||(e.currentTabActive=e.currentChosseTemplate,X(e.currentChosseTemplate,"template",function(t){k(isDetails=!1,isShowField=!0,isShowInject=!1,isShowContentSection=!1,isShowDatabase=!1),e.activeFields={},e.activeFields[e.indexCurrentTemplate]=!0,l(function(){A()})}),Y(e.currentChosseTemplate))},e.chooseSection=function(t,n,i,a){e.submitted=!1,M(t,e.curSecIndex)||(delete e.currentTabActive,e.codeMirrorInited||e.initCodeMirror(),l(function(){var t=angular.isDefined(e.currentChosseTemplate)?e.currentChosseTemplate:e.page.template;if(angular.isUndefined(e.content[t])&&(e.content[t]={}),angular.isDefined(e.content[t][n])&&e.content[t][n])e.editableCodeMirror.setValue(e.content[t][n]);else{var i=e.contentPage["_"+t];angular.isDefined(i)&&angular.isDefined(i.data)&&angular.isDefined(i.data.sections)&&angular.isDefined(i.data.sections[n])?(e.editableCodeMirror.setValue(i.data.sections[n]),e.content[t][n]=i.data.sections[n]):e.editableCodeMirror.setValue("")}}),e.curSection=!0,e.curSecIndex=i,k(isDetails=!1,isShowField=!1,isShowInject=!1,isShowContentSection=!0,isShowDatabase=!1),e.secVariable=n)},e.activeBlocks=[],e.chooseInject=function(t,n,i){e.submitted=!1,M(t,n)||(e.currentTabActive=n,e.childInject={},e.childInject[n]=!0,e.curSecIndex=n,e.curSection=!1,X(n,"block",function(t){k(isDetails=!1,isShowField=!1,isShowInject=!0,isShowContentSection=!1,isShowDatabase=!1),e.isShowInjects={},e.isShowInjects[n+i]=!0,e.activeBlocks[n+i]=!0,l(function(){A()})}),Y(n))};var Y=function(t){if(angular.isDefined(e.cacheNestedContend[t]))return void(e.nested_block=e.cacheNestedContend[t]);var n={contentId:e.page.content_id,blockId:t};o.getDataNestedBlock(n).then(function(n){n.results&&Object.keys(n.results).length?e.nested_block[t]=n.results:e.nested_block[t]={},e.cacheNestedContend[t]=e.nested_block})};e.sortableOptionsFields={axis:"y",handle:"span.my-handle-field",start:function(e,t){$(this).attr("data-previndex",t.item.index())},update:function(e,t){},stop:function(t,n){var i=$(this).attr("data-previndex"),a=n.item.index();if(i!=a){$(this).removeAttr("data-previndex");var r=n.item.sortable.droptarget.attr("tab-field").split("-")[1],l=n.item.sortable.droptarget.attr("variable-field").split("-")[1];e.sortFields(r,l,i,a)}}},e.sortFields=function(t,n,i,a){_tab="_"+t,_variable=_tab+"_"+n;for(var r=[],l=0;l<=e.multiFieldFollowVariable[_variable].length-1;l++){var o=e.multiFieldFollowVariable[_variable][l].id.split("___")[0];e.multiFieldFollowVariable[_variable][l].id=o+"___"+l,e.multiFieldFollowVariable[_variable][l].key_field=""+l,angular.isDefined(e.contentPage[_tab])&&angular.isDefined(e.contentPage[_tab].data.fields[_variable])&&angular.isDefined(e.contentPage[_tab].data.fields[_variable][l])?r[l]=e.contentPage[_tab].data.fields[_variable][l]:r[l]=null}s.sortArray(i,a,r).then(function(r){r&&(e.contentPage[_tab].data.fields[_variable]=r),Z(t,n,i,a),I(t,n,i,a)})},e.parseInt=function(e){return parseInt(e)},e.moveUp=function(t){var n=$(t.currentTarget).closest(".panel-group"),i=$(n).closest(".ui-sortable"),a=i.children(".panel-group"),r=a.index(n),l=-(a.eq(r-1).height()+20),o=n.height()+20;a.eq(r-1).css({position:"relative"}).animate({top:o},500,function(){a.eq(r-1).css({position:"static",top:"auto"})}),n.css({position:"relative"}).animate({top:l},500,function(){if(n.css({position:"static",top:"auto"}),r>0){var t=i.attr("data-tab-key"),a=e.multiFieldFollowVariable[t].splice(r,1);e.multiFieldFollowVariable[t].splice(r-1,0,a[0])}var l=r,o=r-1,s=i.attr("tab-field").split("-")[1],d=i.attr("variable-field").split("-")[1];e.sortFields(s,d,l,o)})},e.moveDown=function(t){var n=$(t.currentTarget).closest(".panel-group"),i=$(n).closest(".ui-sortable"),a=i.children(".panel-group"),r=a.index(n);if(!(r>=a.length)){var l=-(n.height()+20),o=a.eq(r-1).height()+20;n.css({position:"relative"}).animate({top:o},500,function(){n.css({position:"static",top:"auto"})}),a.eq(r+1).css({position:"relative"}).animate({top:l},500,function(){a.eq(r+1).css({position:"static",top:"auto"});var t=i.attr("data-tab-key"),n=e.multiFieldFollowVariable[t].splice(r,1),l=r,o=r+1,s=i.attr("tab-field").split("-")[1],d=i.attr("variable-field").split("-")[1];e.multiFieldFollowVariable[t].splice(r+1,0,n[0]),e.sortFields(s,d,l,o)})}},e.moveDownNestedBlock=function(t){t.pageX--;var n=$(t.currentTarget).closest(".panel-group"),i=$(n).closest(".ui-sortable"),a=i.children(".panel-group"),r=a.index(n),l=-(n.height()+20),o=+(a.eq(r+1).height()+20);n.css({position:"relative"}).animate({top:o},500,function(){n.css({position:"static",top:"auto"})}),a.eq(r+1).css({position:"relative"}).animate({top:l},500,function(){if(r<a.length){var n=$(t.currentTarget).attr("data-tab-id"),i=$(t.currentTarget).attr("data-variable"),l=$(t.currentTarget).attr("data-index-parent"),o=($(t.currentTarget).attr("data-nested-id"),e.nested_block[n][i][l]);++o[r].sort_number,--o[r+1].sort_number;var s=o.splice(r,1);o.splice(r+1,0,s[0]),e.$apply()}a.eq(r+1).css({position:"static",top:"auto"})}),angular.isDefined(e.nested_block)&&Object.keys(e.nested_block).length&&F(e.nested_block)},e.moveUpNestedBlock=function(t){var n=$(t.currentTarget).closest(".panel-group"),i=$(n).closest(".ui-sortable"),a=i.children(".panel-group"),r=a.index(n),l=-(a.eq(r-1).height()+20),o=+(n.height()+20);n.css({position:"relative"}).animate({top:l},500,function(){n.css({position:"static",top:"auto"})}),a.eq(r-1).css({position:"relative"}).animate({top:o},500,function(){if(a.eq(r-1).css({position:"static",top:"auto"}),r>0){var n=$(t.currentTarget).attr("data-tab-id"),i=$(t.currentTarget).attr("data-variable"),l=$(t.currentTarget).attr("data-index-parent");$(t.currentTarget).attr("data-nested-id")}var o=e.nested_block[n][i][l];--o[r].sort_number,++o[r-1].sort_number;var s=o.splice(r,1);o.splice(r-1,0,s[0]),e.$apply()}),angular.isDefined(e.nested_block)&&Object.keys(e.nested_block).length&&F(e.nested_block)};var Z=function(t,n,i,a){for(var r=[],l=0;l<=e.multiFieldFollowVariable[_variable].length-1;l++)angular.isDefined(e.nested_block[t])&&angular.isDefined(e.nested_block[t][n])&&angular.isDefined(e.nested_block[t][n][l])?r[l]=e.nested_block[t][n][l]:r[l]=null;s.sortArray(i,a,r).then(function(i){e.nested_block[t][n]=i})};e.sortableOptionsNesteds={connectWith:".connected-drop-target-sortable",axis:"y",handle:"span.my-handle",update:function(e,t){},stop:function(t,n){var i=n.item.sortable.droptarget.attr("tab-nested").split("-")[1],a=n.item.sortable.droptarget.attr("variable").split("-")[1],r=n.item.sortable.droptarget.attr("id").split("-")[1];e.sortCurrentNesteds(i,a,r)}},e.sortCurrentNesteds=function(t,n,i){var a=0;for(var r in e.nested_block[t][n][i])e.nested_block[t][n][i][r].sort_number=a,a++};var J=function(t,n,i,a){var r=[];for(var l in e.nested_block[t][n][i])a<e.nested_block[t][n][i][l].sort_number&&(sort=e.nested_block[t][n][i][l].sort_number-1,e.nested_block[t][n][i][l].sort_number=sort),e.nested_block[t][n][i][l].data=angular.extend({},e.nested_block[t][n][i][l].data),r.push(e.nested_block[t][n][i][l]);e.nested_block[t][n][i]=r};e.validateCurrentForm=function(t,n,i,a){if(t&&1==e.indexCurrentTemplate)return void(e.successForm[1]=!1);var r=e.currentChosseTemplate,l=e.listFieldTemplateRequired[r];switch(n){case"page":var o=e.contentPage["_"+r];angular.isDefined(o)&&angular.isDefined(o.data)&&angular.isDefined(o.data.fields)&&V(r,l,o.data.fields),e.successField[r]=!0,H(l,r,!1,r,"template");break;case"block":var s=e.curSecIndex,d=e.listFieldTemplateRequired[r][s],o=e.contentPage["_"+s];angular.isDefined(o)&&angular.isDefined(o.data)&&angular.isDefined(o.data.fields)&&V(s,d,e.contentPage["_"+s].data.fields),e.successInject[r][s]=!0,H(d,s,!1,r,"block")}U(e.currentChosseTemplate)},e.initCodeMirror=function(){e.codeMirrorInited=!0,l(function(){e.editableCodeMirror=CodeMirror.fromTextArea(document.getElementById("editor"),{mode:"htmlmixed",theme:"night",styleActiveLine:!0,lineNumbers:!0,readOnly:e.isDisable}),e.editableCodeMirror.on("change",function(){l(function(){e.$apply(function(){var t=angular.isDefined(e.currentChosseTemplate)?e.currentChosseTemplate:e.page.template;angular.isUndefined(e.content[t])&&(e.content[t]={}),angular.isDefined(e.secVariable)&&(e.content[t][e.secVariable]=e.editableCodeMirror.getValue())})})})})};var K=!1;e.callModalInsert=function(n,i,a,r){if(!K){var o="/cms/block-manager/insert?language="+i+"&&region="+a+"&&type="+n+"&&site="+r+"&&id=",s=t.open({templateUrl:window.baseUrl+o,controller:"ModalInsertCms",size:void 0,resolve:{language:function(){return null},region:function(){return null}}});K=!0,s.result.then(function(t){K=!1,l(function(){e.editableCodeMirror.replaceSelection(t)})},function(){K=!1})}},e.content=angular.copy(window.contents);var ee=function(t,n){angular.isUndefined(e.page)&&(e.page={});for(var i in t)(t[i].fields&&t[i].fields.length||t[i].sections.length||w(t[i].injects))&&(angular.isUndefined(e.successInject[i])&&(e.successInject[i]={}),n++,h(t[i],"create",i,0),e.extendsTemplate[n]=i,e.listTemPlate[i].stepTemplate=n);e.lastTemplate=n};e.submit=function(t){if(e.warningError=!1,e.pageNameUnique=!1,e.pageUrlUnique=!1,e.errorTypeUrl=!1,e.submitted=!0,"undefined"!=typeof e.page.template){if(t||e.checkWhenSavePreview()||$(".exits-required").length>0)return t?A():S(),void(e.warningError=!0);if(W(e.listTemPlate,!0))return void(e.warningError=!0)}else if(e.formData.name.$error.required||e.formData.url.$error.required)return $(".ng-invalid:eq(5)").focus(),void(e.warningError=!0);e.page.url=e.page.url.trim();var i=O(e.page.url);
if(i)return e.errorTypeUrl=!0,$('form[name="formData"]').find(".ng-invalid:eq(0)").focus(),void(e.warningError=!0);if("undefined"==typeof e.page.parent_id&&($('form[name="formData"]').find(".ng-invalid:eq(0)").focus(),e.page.parent_id="0"),j())return void(e.warningError=!1);$("#btnSubmitButton").attr("disabled","true"),q();var a=angular.copy(e.page),l=angular.copy(e.nested_block);a.nestedContent=function o(e){for(var t in e)angular.isDate(e[t])?e[t]=n("date")(e[t],"yyyy-MM-dd"):"object"!=typeof e[t]&&"array"!=typeof e[t]||(e[t]=angular.extend({},e[t]),o(e[t]));return e}(l),a.contentPage=e.contentPage,s.editDraft(a).then(function(t){t.status?e.checkPage?r.location=e.baseUrl+"/cms/pages/set-page-selected/"+e.page.parent_id:r.location=e.baseUrl+"/support/show/"+e.page.ticket_id:($("#btnSubmitButton").removeAttr("disabled"),t.name&&(e.pageNameUnique=!0),t.url&&(e.pageUrlUnique=!0))})},e.cancel=function(){r.location="/cms/pages"},e.url=[],e.getUrlImageAsset=function(t){d.getUrlImageAsset(t).then(function(n){"undefined"==typeof e.url[t]&&(e.url[t]=n.url)})},e.removeThumbnailAssert=function(t,n,i){e.url[t]=""},e.addNewField=function(t,n){$("#page-loading").css("display","block");var i=e.currentChosseTemplate;"undefined"!=typeof n&&(i=n),e.listErrorListFile=[];var a=0,r=0,l="_"+i+"_"+t.variable;if(angular.isDefined(e.multiFieldFollowVariable[l])&&e.multiFieldFollowVariable[l].length)for(var o in e.multiFieldFollowVariable[l])e.multiFieldFollowVariable[l][o].id==t.variable+"___"+e.multiFieldFollowVariable[l][o].key_field&&(r+=1,e.multiFieldFollowVariable[l][o].key_field>a&&(a=e.multiFieldFollowVariable[l][o].key_field));return r>=t.max_field&&t.max_field?(alert("Maximum "+t.name+" field is "+t.max_field),void $("#page-loading").css("display","none")):(a=r>0?parseInt(a)+1:0,E(t,i,l,a,n),W(e.listTemPlate,!1),angular.element("#parentBlock_"+t.variable).hasClass("in")||angular.element("#action-"+t.variable).trigger("click"),void $("#page-loading").css("display","none"))},e.removeCurrentField=function(t,n,i){var a=e.currentChosseTemplate;"undefined"!=typeof i&&(a=i),e.listErrorListFile=[];var r="_"+a+"_"+t.variable,l=angular.copy(e.multiFieldFollowVariable[r]);if(angular.isDefined(l)&&l.length)for(var o in l)if(l[o].key_field==n&&l[o].id==t.variable+"___"+l[o].key_field){B(a,l[o].key_field,r,function(){z("remove",r),e.multiFieldFollowVariable[r].splice(l[o].key_field,1);for(var n in e.multiFieldFollowVariable[r])e.multiFieldFollowVariable[r][n].key_field>l[o].key_field&&(e.multiFieldFollowVariable[r][n]={id:t.variable+"___"+n,key_field:n});R(a,t.variable,l[o].key_field),N(a,l[o].key_field,r,i)});break}},e.removeNestedContent=function(t,n,i,a,r){var l=confirm("Would you like to delete the  nested block?");te(),l&&o.deleteContentNestedBlock(t).then(function(t){if(t.status&&angular.isDefined(e.nested_block[n])&&angular.isDefined(e.nested_block[n][a])&&angular.isDefined(e.nested_block[n][a][i])&&angular.isDefined(e.nested_block[n][a][i][r])){var l=angular.extend({},e.nested_block[n][a][i]);delete l[r],e.nested_block[n][a][i]=angular.copy(l),J(n,a,i,r),angular.isDefined(e.nested_block)&&Object.keys(e.nested_block).length&&F(e.nested_block),ne()}})},e.previewDraff=function(t){if(e.warningError=!1,e.submitted=!1,W(e.listTemPlate,!0))return void(e.warningError=!0);if(t||e.checkWhenSavePreview())return t?A():S(),e.warningError=!0,void(e.submitted=!0);if(j())return void(e.warningError=!1);q(),"undefined"==typeof e.page.parent_id&&(e.page.parent_id="0");var i=angular.copy(e.page);angular.isDefined(e.nested_block)&&Object.keys(e.nested_block).length&&F(e.nested_block);var a=angular.copy(e.nested_block);i.nestedContent=function r(e){for(var t in e)angular.isDate(e[t])?e[t]=n("date")(e[t],"yyyy-MM-dd"):"object"!=typeof e[t]&&"array"!=typeof e[t]||(e[t]=angular.extend({},e[t]),r(e[t]));return e}(a),i.contentPage=e.contentPage,s.createDraftContentPreview(i,e.parents[e.page.parent_id]).then(function(t){var n=e.baseUrl+"/cms/pages/preview-draft/"+e.page.content_id+"?v="+(new Date).getTime();window.open(n)})},e.addSubContentBlock=function(n,i,a,r,l,s,d){var u="/cms/block-manager/add-subblock-nested/?blockId= "+n+"&&language="+r+"&&region="+l+"&v="+(new Date).getTime(),c=t.open({animation:e.animationsEnabled,templateUrl:window.baseUrl+u,controller:"addSubBlockNestedCtrl",size:null,resolve:{parent_id:function(){return n},content_id:function(){return a},variable:function(){return d},index:function(){return s},tab_id:function(){return i}}});c.result.then(function(t){var n=0;angular.isDefined(e.nested_block[i])&&angular.isDefined(e.nested_block[i][d])&&angular.isDefined(e.nested_block[i][d][s])&&(n=e.nested_block[i][d][s].length),t.template_id=e.page.template,t.count_nested=n,te(),o.saveNestedBlock(t).then(function(t){angular.isUndefined(e.nested_block[i])&&(e.nested_block[i]=[]),angular.isUndefined(e.nested_block[i][d])&&(e.nested_block[i][d]=[]),!angular.isUndefined(e.nested_block[i][d][s])&&e.nested_block[i][d][s]||(e.nested_block[i][d][s]=[]);for(var n in t.block[d][s])t.block[d][s][n].data=angular.extend({},t.block[d][s][n].data),e.nested_block[i][d][s][n]=t.block[d][s][n];e.cacheNestedContend[i]=e.nested_block,ne()})})};var te=function(){angular.element("#page-loading").css("display","block")},ne=function(){angular.element("#page-loading").css("display","none")}}]).filter("formatName",function(){return function(e){return String(e).replace(/\s+/g,"-")}}).filter("formatText",function(){return function(e){var t=e.replace(/_/gi," ");return t[0].toUpperCase()+t.slice(1)}}).controller("addSubBlockNestedCtrl",["$scope","$modalInstance","parent_id","content_id","tab_id","index","variable","EditDraftService","$http","$q",function(e,t,n,i,a,r,l,o,s,d){e.submit=function(o){if(e.submitted=!0,o){var s=[];s.sub_block_id=o,s.parent_id=n,s.content_id=i,s.tab_id=a,s.index=r,s.variable=l,t.close(s)}},e.cancel=function(){t.dismiss("cancel")}}]);var nestedBlockApp=angular.module("BlockNestedApp");nestedBlockApp.factory("BlockNestedResource",["$resource",function(e){return e("/api/block-manager/:method/:id",{method:"@method",id:"@id"},{add:{method:"post"},save:{method:"post"},update:{method:"put"}})}]).service("BlockNestedService",["BlockNestedResource","$q",function(e,t){that=this,this.updateNestedBlock=function(n){var i=t.defer(),a=new e(n);return a.$save({method:"update-nested-block"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.deleteContentNestedBlock=function(n){var i=t.defer(),a=new e;return a.$get({id:n,method:"delete-nested-block"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.getDataNestedBlock=function(n){var i=t.defer(),a=new e(n);return a.$save({method:"get-data-nested-block"},function(e){for(var t in e.results){angular.isObject(e.results[t])&&(e.results[t]=that.convertObjectToArray(e.results[t]));for(var n in e.results[t]){angular.isObject(e.results[t][n])&&(e.results[t][n]=that.convertObjectToArray(e.results[t][n]));for(var a in e.results[t][n])e.results[t][n][a].data=angular.extend({},e.results[t][n][a].data)}}i.resolve(e)},function(e){i.resolve(e.result)}),i.promise},this.convertObjectToArray=function(e){array=[];for(var t in e)e.hasOwnProperty(t)&&array.push(e[t]);return array},this.reIndex=function(n){var i=t.defer(),a=new e(n);return a.$save({method:"re-index-nested-block"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.saveNestedBlock=function(n){tmpData=n;var i=t.defer(),a=new e(n);return a.$save({method:"save-data-nested-block"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise},this.updateIndexNestedWhenSortField=function(n){tmpData=n;var i=t.defer(),a=new e(n);return a.$save({method:"update-index-nested-block-sort-field"},function(e){i.resolve(e)},function(e){i.resolve(e.data)}),i.promise}}]),nestedBlockApp.controller("BlockNestedController",["$scope","$modal","$timeout","BlockNestedService","$filter",function(e,t,n,i,a){}]),function(e){angular.module("checkLimitAndChangeDateTimeDirectiveApp",[]).directive("checkLimitAndChangeDateTimeDirective",["$timeout","$filter",function(e,t){return{restrict:"EA",scope:{items:"=",itemsAssigned:"=",requiredItem:"=",placeholder:"@"},require:"?ngModel",templateUrl:"",link:function(e,n,i,a,r){n.bind("blur",function(){var n=a.$modelValue;if(angular.isDefined(n)&&n instanceof Date==1){var i=t("date")(new Date("2038-01-18"),"yyyy-MM-dd"),r=t("date")(new Date("1970-01-01"),"yyyy-MM-dd"),l=t("date")(new Date(n),"yyyy-MM-dd"),o=t("date")(new Date,"yyyy-MM-dd");(l>i||r>l)&&(a.$setViewValue(o),a.$render(),e.$apply())}})}}}])}(jQuery),function(e){angular.module("formBuilderDirectiveApp",[]).directive("switchBootstrap",["$parse","$timeout",function(e,t){return{restrict:"A",require:"?ngModel",link:function(e,t,n,i){e.isDisable=!1,angular.isDefined(window.isDisable)&&(e.isDisable=window.isDisable),t.bootstrapSwitch({}),window.isDisable||t.on("switchChange.bootstrapSwitch",function(t,n){i&&e.$apply(function(){i.$setViewValue(n)})}),e.$watch(n.ngModel,function(n,a){n?(i.$setViewValue(!0),t.bootstrapSwitch("state",!0,!0)):(i.$setViewValue(!1),t.bootstrapSwitch("state",!1,!0)),t.bootstrapSwitch("disabled",e.isDisable,e.isDisable)})}}}]).directive("limitTo",[function(){return{restrict:"A",link:function(e,t,n){var i=999999999999999;"number"==n.type&&(i=7),"text"==n.type&&(i=255),t.bind("keypress",function(e){return t[0].value.length>=i?(e.preventDefault(),!1):void 0})}}}]).directive("select2",["$timeout",function(t){return{restrict:"A",require:"?ngModel",replace:!0,link:function(n,i,a,r){function l(t){return e(i).find('[value="? undefined:undefined ?"]').remove(),e("<span>"+t.text+"</span>")}n.$watch(a.ngModel,function(a,l){angular.isDefined(r.$modelValue)&&r.$modelValue==r.$modelValue?(n.valueActived=r.$modelValue,t(function(){e(i).select2().val(n.valueActived).change()})):t(function(){e(i).select2().val("").change()})}),t(function(){e(i).select2({templateResult:l}),e(i).removeClass("form-control")},500)}}}]).directive("multiSelect",["$parse","$timeout",function(t,n){return{restrict:"A",require:"?ngModel",link:function(t,i,a,r){var l=[];t.isDisable=!1,angular.isDefined(window.isDisable)&&(t.isDisable=window.isDisable),t.$watch(a.ngModel,function(a,r){n(function(){angular.isDefined(a)&&(angular.isUndefined(r)||0==l.length)&&(l=a,e(i).multiSelect("select",a)),t.isDisable&&e(i).multiSelect({disabledClass:"disabled"})})}),t.isDisable||e(i).multiSelect({})}}}]).directive("colorPicker",["$parse","$compile","$timeout",function(t,n,i){return{restrict:"A",require:"?ngModel",link:function(n,i,a,r){function l(e,t){e.$setViewValue(t),e.$render(),s(t)}function o(e,t){var n;return n=e.length>5?-1!=r.$viewValue.indexOf("#")?String(e).substring(1,7):String(e).substring(1,6):e}function s(t){e(i).spectrum({color:t,preferredFormat:"hex",allowEmpty:!0,showInitial:!0,showInput:!0,disabled:n.isDisable,change:function(e){l(r,e.toHexString()),r.$parsers.push(function(e){return r.$viewValue=o(e,r),r.$render(),-1==r.$viewValue.indexOf("#")&&(r.$viewValue="#"+r.$viewValue),r.$viewValue})}})}n.isDisable=!1,angular.isDefined(window.isDisable)&&window.isDisable&&(n.isDisable=!0);var d=t(a.ngModel);d=d(n),d==d&&angular.isDefined(d)&&d?l(r,d):l(r,"#f00"),n.$watch(a.ngModel,function(e,t){angular.isDefined(r.$modelValue)&&l(r,r.$modelValue)})}}}]).directive("datepickerRowboat",["$compile",function(e){return{restrict:"A",require:"?ngModel",link:function(e,t,n,i){t.bind("click",function(){var t=n.isOpen;e.$apply(function(){angular.isUndefined(e[t])?e[t]=!0:e[t]=!e[t]})})}}}]).directive("uimaskRowboat",["$compile",function(e){return{restrict:"A",require:"?ngModel",link:function(e,t,n,i){var a=t.attr("ui-mask");t.mask(a)}}}]).directive("redactor",["$compile","$timeout","$parse",function(t,n,i){return{restrict:"A",require:"?ngModel",link:function(t,a,r,l){var o=!1;if(angular.isDefined(window.isDisable)&&window.isDisable&&n(function(){e(a).redactor("button.disableAll")}),t.$watch(r.ngModel,function(n,i){return o?void(o=!1):void(angular.isDefined(l.$modelValue)&&l.$modelValue==l.$modelValue&&(e(a).redactor("code.set",l.$modelValue),"<div></div>"!=l.$modelValue&&""!=l.$modelValue&&"<br>"!=l.$modelValue||(t.checkRequired=!0)))}),t.inited=0,window.redactorInited){if(o)return void(o=!1);var s=i(r.ngModel);return void(angular.isDefined(s(t))&&s(t)==s(t)&&e(a).redactor("code.set",s(t)))}e(a).redactor({imageUpload:"/content/upload",plugins:["table"],callbacks:{blur:function(e){var n=this.code.get();"<div></div>"!=n&&""!=n&&"<br>"!=n||(t.checkRequired=!0),l.$setViewValue(n),o=!0},change:function(e){if(!r.disabled){var n=this.code.get();"<div></div>"!=n&&""!=n&&"<br>"!=n||(t.checkRequired=!0),l.$setViewValue(n),o=!0}},insertedTable:function(e){var t=this.code.get();l.$setViewValue(t),o=!0},init:function(){t.inited=1,n(function(){e(a).each(function(t,n){l.$modelValue&&angular.isDefined(l.$modelValue)&&angular.isDefined(e.data(n,"redactor"))&&e(a).redactor("code.set",l.$modelValue)})})}},focus:!1,minHeight:300})}}}]).directive("uploadFile",["$http","$parse","$timeout","Upload",function(e,t,n,i){return{restrict:"EA",require:"?ngModel",scope:{files:"=",fileIds:"=",openPicture:"&",disabled:"=",isUploading:"&"},priority:1,replace:!0,transclude:!0,templateUrl:baseUrl+"/app/shared/form-builder-directive/views/file-upload.html?v="+(new Date).getTime(),link:function(e,t,a,r){function l(){a.ngMultiple||(a.ngMultiple="true");var t="true"===a.ngMultiple;if("true"!=a.ngMultiple?(e.ngMultiple=!1,"false"==a.ngMultiple?e.uploadMultiple=t:e.uploadMultiple="one"):(e.ngMultiple=t,e.uploadMultiple=t),"undefined"!=typeof r.$modelValue&&null!=r.$modelValue){if("one"==e.uploadMultiple){e.hideIconLoading=!0;var n=e.listFilesFormBuilder[r.$modelValue],i=[];i.uniId=d(),i.proccess=100,i.error=0,angular.isDefined(n)&&(i.name=n.file_name,i.file_name=n.file_name,i.id=n.id,i.size=n.size,i.type=n.type),e.fileUploadIds=r.$modelValue,e.fileUpload[i.uniId]=i,r.$setViewValue(e.fileUploadIds),e.hideIconLoading=!1,u(e.fileUpload)}else if(e.fileUploadIds=[],angular.isArray(r.$modelValue)){for(var l=0;l<r.$modelValue.length;l++){var o=r.$modelValue.length;e.hideIconLoading=!0;var n=e.listFilesFormBuilder[r.$modelValue[l]],i=[];i.uniId=d(),i.proccess=100,i.error=0,angular.isDefined(n)&&(i.name=n.file_name,i.file_name=n.file_name,i.id=n.id,i.size=n.size,i.type=n.type),e.fileUploadIds.push(r.$modelValue[l]),e.fileUpload[i.uniId]=i,o==e.fileUploadIds.length&&(e.hideIconLoading=!1)}r.$setViewValue(e.fileUploadIds),angular.isDefined(r.$modelValue)&&l==r.$modelValue.length&&u(e.fileUpload)}}else e.fileUpload={}}function o(e){f()}function s(e){var t=["png","gif","jpg","jpeg"];if("undefined"!=typeof e){if(-1!=t.indexOf(e.split("/")[1]))return"image";switch(e.split("/")[1]){case"zip":return"zip";case"pdf":return"pdf";case"msword":return"msword";default:return"other"}}}function d(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}function u(t){if(angular.isDefined(e.fileUploaded)&&!e.fileUploaded.length)for(var n in t)e.fileUploaded.push(t[n])}e.disabled=window.isDisable;var c=0;e.baseUrl=baseUrl,e.fileUpload={},e.fileUploaded=[],e.fileUploadIds=[],e.fileError={},e.accept=a.accept,e.uploadFinish=!0,e.listFilesFormBuilder=window.listFilesFormBuilder,e.isLoadField={},e.numberFileUpload=[];var f=e.$watch(function(){l()},o);e.upload=function(t){if(e.fileUploaded=[],t&&t.length){c++,angular.isUndefined(e.numberFileUpload[c])&&(e.numberFileUpload[c]=[]);for(var l=0;l<t.length;l++)"image"==a.accept&&a.accept!=s(t[l].type)||(e.isUploading({status:!0}),function(l){"one"==e.uploadMultiple&&(e.fileUpload={});var o=t[l];o.uniId=d(),o.proccess=0,o.error="",e.isUploadServe=a.isUploadServe,e.fileUpload[o.uniId]=o,angular.isDefined(window.maxUpload.size)&&o.size>window.maxUpload.size?(angular.isUndefined(e.fileError[o.uniId])&&(e.fileError[o.uniId]={}),e.fileError[o.uniId].status=0,e.fileError[o.uniId].error="Max file size is "+window.maxUpload.name,e.fileUpload[o.uniId].error="Max file size is "+window.maxUpload.name,e.uploadFinished=!0,r.$setViewValue(e.fileUploadIds)):i.upload({method:"POST",url:baseUrl+"/upload-form-builder/file",file:o,data:a.isUploadServe}).progress(function(t){var n=parseInt(100*t.loaded/t.total);if(e.fileIsUploading=!0,angular.isDefined(e.fileUpload[o.uniId])){e.fileUpload[o.uniId].proccess=n;var i=Object.keys(angular.extend({},e.fileUpload)).length,a=Object.keys(angular.extend({},e.fileUpload));for(var r in e.fileUpload)if(r==a[i-1]&&100==e.fileUpload[r].proccess)e.isUploading({status:!1});else if(e.fileUpload[r].proccess<100)break}}).error(function(n,i,a,r){t.splice(1,l),angular.isDefined(e.fileUpload[o.uniId])&&(n&&angular.isDefined(n.message)&&(e.fileUpload[o.uniId].error=n.message),e.fileError[r.file.uniId]=r.file,e.fileError[r.file.uniId].status=n.status)}).success(function(t,n,i,a){angular.isDefined(e.fileUpload[a.file.uniId])&&(e.isUploadServe?(t.item.uniId=a.file.uniId,"one"==e.uploadMultiple?(e.fileUploaded=t.item,e.fileUploadIds=t.item.id):(e.fileUploaded.push(t.item),e.fileUploadIds.push(t.item.id)),e.listFilesFormBuilder[t.item.id]=t.item):"one"==e.uploadMultiple?(e.fileUploaded=a.file.uniId,e.fileUploadIds=a.file):(e.fileUploaded.push(a.file.uniId),e.fileUploadIds.push(a.file)))})["finally"](function(){e.uploadFinished=!0,n(function(){r.$setViewValue(e.fileUploadIds)})})}(l))}},r.$render=function(){e.filesUpload=r.$viewValue},e.checkFile=function(e){return s(e)},e.deleteFile=function(t){if(delete e.fileUpload[t],"one"==e.uploadMultiple)e.fileUploadIds=[],e.uploadFinished=!0,r.$setViewValue(null);else for(var n in e.fileUploaded)if(t==e.fileUploaded[n].uniId){var i=e.fileUploadIds.indexOf(e.fileUploaded[n].id);e.fileUploadIds.splice(i,1),e.uploadFinished=!0,e.fileUploadIds.length?r.$setViewValue(e.fileUploadIds):r.$setViewValue(null)}},e.$on("emptyFiles",function(t,n){e.fileUpload={},e.fileUploaded=[],e.fileUploadIds=[]})}}}]).directive("refreshCheckbox",["$compile",function(e){return{restrict:"A",require:"?ngModel",link:function(e,t,n,i){e.$watch(n.ngModel,function(e,n){angular.isDefined(i.$modelValue)&&(1==i.$modelValue&&i.$setViewValue(!0),t.attr("checked",i.$modelValue))})}}}]).filter("bytes",function(){return function(e,t){if(isNaN(parseFloat(e))||!isFinite(e))return"-";"undefined"==typeof t&&(t=1);var n=["bytes","kB","MB","GB","TB","PB"],i=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,Math.floor(i))).toFixed(t)+" "+n[i]}})}(jQuery);var lowercaseCharater=angular.module("lowercaseCharater",[]);lowercaseCharater.directive("conventTextToLowercase",["$compile","$parse","$filter",function(e,t,n){return{restrict:"A",require:"?ngModel",link:function(e,t,i,a){var r=/\s+/g;t.bind("keypress",function(e){if(r.test(t.val())){var i=n("lowercase")(t.val());return a.$setViewValue(i),void a.$render()}}),a.$viewChangeListeners.push(function(){if(r.test(t.val())){var e=n("lowercase")(t.val());a.$setViewValue(e),a.$render()}})}}}]);var selectLevel=angular.module("selectLevel",[]),version=5;selectLevel.directive("selectLevel",["$timeout","$filter",function(e,t){return{require:"?ngModel",restrict:"EA",scope:{items:"=",text:"@",title:"@",textFilter:"@",index:"=",key:"=",itemChoose:"=",selectedItems:"=selectedItem",onClick:"&",currentPage:"=",showIcon:"=",typeSelect:"=",disableClick:"=",notSelectCurrent:"=",chageType:"=",type:"=",canChooseFolder:"="},replace:!0,templateUrl:baseUrl+"/app/shared/select-level/view.html?v="+(new Date).getTime(),link:function(n,i,a,r){function l(e){var t={};return angular.forEach(e,function(e,n){t[e]=n}),t}n.currentIndex={value:0},"Asset"==n.type&&(n.items=window.assets),n.$watch("selectedItems",function(t,i){angular.isDefined(t)&&null!=t&&e(function(){var e={_id:t.selectedItemId,name:t.selectedItemName,parentIds:t.parentIds};n.selectedItem(e)})});var o="";"undefined"==typeof n.index&&(n.index=0),"undefined"==typeof n.key&&(n.key=0),e(function(){$(document).on("click",function(e){$("#select-level-modal-"+n.key+"-"+n.index).hasClass("in")&&!$(".js-filterable-field").is(":focus")&&($("#select-level-modal-"+n.key+"-"+n.index).collapse("hide"),$(".show-sub-select i").removeClass("fa fa-folder-open fa").addClass("fa fa-folder"))}),$("#select-level li:has(ul)").children("ul").addClass("off"),$("#select-level li a i").addClass("fa fa-folder"),n.listsId=[],n.showSubSelect=function(e,t){e.preventDefault(),$(e.currentTarget).parent().find("ul:first").toggleClass("off"),$(e.currentTarget).find("i").addClass("fa fa-folder"),$(e.currentTarget).find("i").toggleClass("fa fa-folder-open fa"),e.stopPropagation()},"undefined"!=typeof n.itemChoose&&d(n.items)}),n.focusInput=function(e){e.stopPropagation()};var s=0;n.selectedItem=function(e,i){""!=e._id&&"Assets"==n.typeSelect&&2>=s&&(1==Object.keys(e.parentIds).length?angular.forEach(n.items,function(t,i){t._id==e._id&&(n.items=[],n.items.push(t))}):angular.forEach(n.items,function(t,i){t._id==e.parentIds[Object.keys(e.parentIds).length-1]&&(n.items=[],n.items.push(t))})),s+=1,angular.isDefined(n.currentPage)&&angular.isDefined(e)&&e._id==n.currentPage._id||(angular.isDefined(i)&&i.preventDefault(),(angular.isDefined(e.parentIds)||angular.isDefined(e.parentId)||angular.isDefined(e.parent_id))&&""!=e.name?n.text=e.name:n.text=t("trans")("select-folder","directive-select-level"),r.$setViewValue(e._id),n.chageType&&n.onClick({pageId:e._id}),$("#select-level-modal-"+n.key+"-"+n.index).find(".name-select.active").removeClass("active"),o=e,$("#select-level-modal-"+n.key+"-"+n.index).find(".item-"+o._id).addClass("active"),angular.isDefined(i)&&$("#select-level-modal-"+n.key+"-"+n.index).collapse("hide"))},n.toggleSelectMenu=function(t){e(function(){n.itemsTmp=n.items}),"disabled"!=n.disableClick&&e(function(){if($(".show-sub-select").removeClass("active"),$("#select-level li a i").removeClass("fa fa-folder-open fa").addClass("fa fa-folder"),$(".parrent-select").addClass("off"),o)if(angular.forEach($(".item-"+o._id).parents("ul"),function(e,t){$(e).removeClass("off")}),$(".show-sub-select-"+o._id).addClass("active"),"Link"==n.type){var e=l(window.listsIdsMapPageAndContent);angular.forEach(o.parentIds,function(t,n){$(".show-sub-select-"+e[t]).find("i").removeClass("fa fa-folder").addClass("fa fa-folder-open fa")})}else angular.forEach(o.parentIds,function(e,t){o._id!=e&&$(".show-sub-select-"+e).find("i").removeClass("fa fa-folder").addClass("fa fa-folder-open fa")});$("#select-level-modal-"+n.key+"-"+n.index).collapse("toggle")})},n.closed=function(e){$("#select-level-modal-"+n.key+"-"+n.index).collapse("hide")};var d=function(e){for(var t in e)if(e[t].subFolder&&d(e[t].subFolder),e[t]._id==n.itemChoose){n.text=e[t].name;break}}}}}]);var selectLevel=angular.module("modalSelectPage",[]),version=3;selectLevel.directive("modalSelectPage",["$timeout","$filter","$modal","$parse",function(e,t,n,i){return{require:"?ngModel",restrict:"EA",scope:{items:"=",itemSelected:"=",onClick:"&",ngModel:"=",isDisabled:"="},templateUrl:baseUrl+"/app/shared/modal-select-page/view.html?v="+version,link:function(e,t,i,a){if(e.text="",angular.isDefined(e.isDisabled)&&e.isDisabled&&$(".form-control").addClass("no-drop"),e.$watch("ngModel",function(e,n){angular.isDefined(e)&&null!=e&&$(t).find(".text-page").text(window.listsPageMap[e])}),""!=e.itemSelected)for(var r in window.listsPageMap)if(r==e.itemSelected){$(t).find(".text-page").text(window.listsPageMap[r]);break}e.callModal=function(){if(!e.isDisabled){var i="/app/shared/modal-select-page/select.html",r=n.open({templateUrl:window.baseUrl+i,controller:"SelectLevelLinkController",size:null,resolve:{itemSelected:function(){return angular.copy(e.itemSelected)}}});r.result.then(function(n){$(t).find(".text-page").text(n.name),e.itemSelected=n._id,a.$setViewValue(n._id),a.$render(),e.onClick()},function(){})}}}}}]),selectLevel.controller("SelectLevelLinkController",["$scope","$modalInstance","$timeout","itemSelected","$timeout",function(e,t,n,i,n){e.items=window.listpages,e.listsIdsMapPageAndContent=window.listsIdsMapPageAndContent;var a="";n(function(){if(!angular.isUndefined(i)&&null!=i){var t=$(".show-sub-select-"+window.listsIdsMapPageAndContent[i]).data("page");if(angular.isDefined(t)){var n={_id:t._id,name:t.name,parentIds:t.parentIds,folderId:t.folder_id};e.selectedItem(n)}}},500),n(function(){$(".parrent-select").addClass("off"),$("#select-level li a i").addClass("fa fa-folder"),e.listsId=[],e.showSubSelect=function(e,t){e.preventDefault(),$(e.currentTarget).parent().find("ul:first").toggleClass("off"),$(e.currentTarget).find("i").toggleClass("fa fa-folder-open fa"),$(e.currentTarget).find("i").addClass(" fa-folder"),e.stopPropagation()}}),e.selectedItem=function(e,t){angular.isDefined(t)&&t.preventDefault(),angular.forEach($(".item-"+e._id).parents("ul"),function(e,t){$(e).removeClass("off")}),angular.forEach(e.parentIds,function(e,t){$(".show-sub-select-"+e).find("i").removeClass("fa fa-folder").addClass("fa fa-folder-open fa")}),a=e,$(".show-sub-select").removeClass("active"),$(".show-sub-select-"+window.listsIdsMapPageAndContent[a._id]).addClass("active")},e.submit=function(){var e={};e._id=a._id,e.name=a.name,t.close(e)},e.cancel=function(){t.dismiss("cancel")}}]);var cmsInsertApp=angular.module("cmsContentInsertApp",[]);cmsInsertApp.factory("CmsContentInsertResource",["$resource",function(e){return e("/api/cm-content/:method/:id",{method:"@method",id:"@id"},{add:{method:"post"},save:{method:"post"},update:{method:"put"}})}]).service("CmsContentInsertService",["CmsContentInsertResource","$q","$filter",function(e,t,n){function i(e,t){for(var n in e)t=n;return t}function a(e,t,a){return function r(e,a){for(var l in e)!angular.isArray(e[l])&&angular.isObject(e[l])&&Object.keys(e[l]).length?(t+="[",a=i(e[l],a),r(e[l],a),t+="]"):(angular.isUndefined(e[l])&&(e[l]=null),angular.isDate(e[l])&&(e[l]=n("date")(e[l],"MM-dd-yyyy")),t+=l!=a?"'"+e[l]+"', ":"'"+e[l]+"'")}(e,a),t=t.replace(/\]\[/g,"], [")}this.insertServiceProvider=function(e){},this.getContentBlock=function(n,i){var a=t.defer(),r=new e(n);return r.$save({id:i,method:"get-content-block"},function(e){a.resolve(e)},function(e){a.resolve(e.data)}),a.promise},this.customCurrentData=function(e,t,r,l){var o="";if(angular.isDefined(l))for(var s in l){var d=0;if(d=i(r[l[s].variable],d),angular.isDate(r[l[s].variable])&&(r[l[s].variable]=n("date")(r[l[s].variable],"MM-dd-yyyy")),angular.isObject(r[l[s].variable])||angular.isArray(r[l[s].variable])){var u="term"==l[s].type?"term:":"",c=u+"[";c=a(r[l[s].variable],c,d),c+="]",o=o+", "+c}else angular.isUndefined(r[l[s].variable])&&(r[l[s].variable]=null),r[l[s].variable]=this.formatCurrentData(r[l[s].variable]),o=o+", '"+r[l[s].variable]+"'"}return"{{-- Begin "+window.blockCommentMap[t]+" Block --}}{{inject('"+n("lowercase")(e)+"', '"+t+"'"+this.formatCurrentData(o)+")}}{{-- End "+window.blockCommentMap[t]+" Block --}} "},this.formatCurrentData=function(e){if(angular.isString(e))var e=e.replace(/\r?\n/g,"<br />");return e},this.getDetailCommentAsset=function(n){var i=t.defer(),a=new e;return a.$save({id:n,method:"get-detail-comment-asset"},function(e){i.resolve(e)}),i.promise},this.getDetailCommentLink=function(n){var i=t.defer(),a=new e;return a.$save({id:n,method:"get-detail-comment-link"},function(e){i.resolve(e)}),i.promise},this.getBlockAndUpdateInjectAutoIncrement=function(n){var i=t.defer(),a=new e;return a.$save({id:n,method:"get-block-and-update-inject-auto-increment"},function(e){i.resolve(e)}),i.promise}}]);var selectLevel=angular.module("modalSelectLevel",[]),version=3;selectLevel.directive("modalSelectLevel",["$timeout","$filter","$modal","$parse",function(e,t,n,i){return{require:"?ngModel",restrict:"EA",scope:{items:"=",itemSelected:"=",type:"@",onClick:"&",ngModel:"=",isDisabled:"="},templateUrl:baseUrl+"/app/shared/modal-select-level/view.html?v="+version,link:function(e,t,i,a){e.text="",angular.isDefined(e.isDisabled)&&e.isDisabled&&$(".form-control").addClass("no-drop"),e.$watch("ngModel",function(e,n){angular.isDefined(e)&&null!=e&&$(t).find(".text-asset").text(window.listsAsset[e])}),""!=e.itemSelected&&$(t).find(".text-asset").text(window.listsAsset[e.itemSelected]),e.callModal=function(){if(!e.isDisabled){var i="/app/shared/modal-select-level/select.html",r=n.open({templateUrl:window.baseUrl+i,controller:"SelectLevelController",size:null,resolve:{itemSelected:function(){return angular.copy(e.itemSelected)},type:function(){return e.type}}});r.result.then(function(n){$(t).find(".text-asset").text(n.name),e.itemSelected=n._id,a.$setViewValue(n._id),a.$render(),e.onClick()},function(){})}}}}}]),selectLevel.controller("SelectLevelController",["$scope","$modalInstance","$timeout","itemSelected","$timeout","type",function(e,t,n,i,n,a){e.items=[],angular.isDefined(a)?e.items.push(_.find(window.assets,function(e){return e.name==a})):e.items=window.assets;var r="";n(function(){if(!angular.isUndefined(i)&&i){var t=$(".show-sub-select-"+i).data("asset");if(!angular.isUndefined(t)){var n={_id:t._id,name:t.name,parentIds:t.parentIds};e.selectedItem(n)}}},500),n(function(){$("#select-level li:has(ul)").children("ul").addClass("off"),$("#select-level li a i").addClass("fa fa-folder"),e.listsId=[],e.showSubSelect=function(e,t){e.preventDefault(),$(e.currentTarget).parent().find("ul:first").toggleClass("off"),$(e.currentTarget).find("i").toggleClass("fa fa-folder-open fa"),$(e.currentTarget).find("i").addClass(" fa-folder"),e.stopPropagation()}}),e.selectedItem=function(e,t){angular.isDefined(t)&&t.preventDefault(),angular.isDefined(e.subFolder)&&e.subFolder.length>0||$(".show-sub-select-"+e._id).find("i").hasClass("fa-folder")||(angular.forEach($(".item-"+e._id).parents("ul"),function(e,t){$(e).removeClass("off")}),angular.forEach(e.parentIds,function(e,t){$(".show-sub-select-"+e).find("i").removeClass("fa fa-folder").addClass("fa fa-folder-open fa")}),r=e,$(".show-sub-select").removeClass("active"),$(".show-sub-select-"+r._id).addClass("active"))},e.submit=function(){var e={};e._id=r._id,e.name=r.name,t.close(e)},e.cancel=function(){t.dismiss("cancel")}}]);var selectLevelAsset=angular.module("selectLevelAsset",[]);selectLevelAsset.directive("selectLevelAsset",["$timeout","$filter",function(e,t){return{require:"?ngModel",restrict:"EA",scope:{items:"=",text:"@",title:"@",textFilter:"@",index:"=",key:"=",itemChoose:"=",selectedItems:"=selectedItem",onClick:"&",currentPage:"=",showIcon:"=",typeSelect:"=",disableClick:"=",notSelectCurrent:"=",chageType:"=",type:"="},replace:!0,templateUrl:baseUrl+"/app/shared/select-level-asset/view.html?v="+(new Date).getTime(),link:function(n,i,a,r){var l=window.window.listAssetFolderContainFirstLevel;n.$watch("selectedItems",function(t,i){angular.isDefined(t)&&e(function(){var e={_id:t.selectedItemId,name:t.selectedItemName,parentIds:t.parentIds};n.selectedItem(e)})});var o="";"undefined"==typeof n.index&&(n.index=0),"undefined"==typeof n.key&&(n.key=0),e(function(){$(document).on("click",function(e){$("#select-level-modal-"+n.key+"-"+n.index).hasClass("in")&&!$(".js-filterable-field").is(":focus")&&($("#select-level-modal-"+n.key+"-"+n.index).collapse("hide"),$(".show-sub-select i").removeClass("fa fa-folder-open fa").addClass("fa fa-folder"))}),$("#select-level li:has(ul)").children("ul").addClass("off"),$("#select-level li a i").addClass("fa fa-folder"),n.listsId=[],n.showSubSelect=function(e,t){e.preventDefault(),$(e.currentTarget).parent().find("ul:first").toggleClass("off"),$(e.currentTarget).find("i").addClass("fa fa-folder"),$(e.currentTarget).find("i").toggleClass("fa fa-folder-open fa"),e.stopPropagation(),n.value=t;var i=_.find(l,function(e){return e._id==t._id});angular.isUndefined(i)||(n.value.subFolder=i.subFolder)},"undefined"!=typeof n.itemChoose&&s(n.items)}),n.focusInput=function(e){e.stopPropagation()};n.selectedItem=function(e,i){angular.isDefined(i)&&i.preventDefault(),(angular.isDefined(e.ancestor_ids)||angular.isDefined(e.ancestor_ids))&&""!=e.name?n.text=e.name:n.text=t("trans")("select-asset","directive-select-level"),
r.$setViewValue(e._id),$("#select-level-modal").find(".name-select.active").removeClass("active"),$("#select-level-modal").find(".item-"+e._id).addClass("active"),angular.isDefined(i)&&$("#select-level-modal-"+n.key+"-"+n.index).collapse("hide"),o=e},n.toggleSelectMenu=function(t){e(function(){var e=_.find(l,function(e){return"0"==e.parent_id});n.itemsTmp=e.subFolder}),e(function(){$(".show-sub-select").removeClass("active"),$("#select-level li a i").removeClass("fa fa-folder-open fa").addClass("fa fa-folder"),$(".parrent-select").addClass("off"),o&&(angular.forEach($(".item-"+o._id).parents("ul"),function(e,t){$(e).removeClass("off")}),$(".show-sub-select-"+o._id).addClass("active"),angular.forEach(o.ancestor_ids,function(e,t){$(".show-sub-select-"+e).find("i").removeClass("fa fa-folder").addClass("fa fa-folder-open fa")})),$("#select-level-modal-"+n.key+"-"+n.index).collapse("toggle")})};var s=function(e){for(var t in e)if(e[t].subFolder&&s(e[t].subFolder),e[t]._id==n.itemChoose){n.text=e[t].name;break}}}}}]);var permissionModule=angular.module("cache");permissionModule.factory("RemoveCacheResource",["$resource",function(e){return e(window.urlFrontEnd+"/api/pages/:method/:id",{},{add:{method:"post"},save:{method:"post"}})}]).service("RemoveCacheService",["$q","$filter","RemoveCacheResource",function(e,t,n){this.removeCache=function(t){var i=e.defer();return n.get({method:"remove-cache",id:t},function(e){i.resolve(e)}),i.promise}}]);